(function(){const f=document.createElement("link").relList;if(f&&f.supports&&f.supports("modulepreload"))return;for(const k of document.querySelectorAll('link[rel="modulepreload"]'))E(k);new MutationObserver(k=>{for(const O of k)if(O.type==="childList")for(const F of O.addedNodes)F.tagName==="LINK"&&F.rel==="modulepreload"&&E(F)}).observe(document,{childList:!0,subtree:!0});function b(k){const O={};return k.integrity&&(O.integrity=k.integrity),k.referrerPolicy&&(O.referrerPolicy=k.referrerPolicy),k.crossOrigin==="use-credentials"?O.credentials="include":k.crossOrigin==="anonymous"?O.credentials="omit":O.credentials="same-origin",O}function E(k){if(k.ep)return;k.ep=!0;const O=b(k);fetch(k.href,O)}})();var ke,G,at,oe,qe,ht,Me,Se={},lt=[],Ot=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,He=Array.isArray;function re(m,f){for(var b in f)m[b]=f[b];return m}function ct(m){var f=m.parentNode;f&&f.removeChild(m)}function It(m,f,b){var E,k,O,F={};for(O in f)O=="key"?E=f[O]:O=="ref"?k=f[O]:F[O]=f[O];if(arguments.length>2&&(F.children=arguments.length>3?ke.call(arguments,2):b),typeof m=="function"&&m.defaultProps!=null)for(O in m.defaultProps)F[O]===void 0&&(F[O]=m.defaultProps[O]);return ve(m,F,E,k,null)}function ve(m,f,b,E,k){var O={type:m,props:f,key:b,ref:E,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:k??++at};return k==null&&G.vnode!=null&&G.vnode(O),O}function Le(m){return m.children}function pe(m,f){this.props=m,this.context=f}function _e(m,f){if(f==null)return m.__?_e(m.__,m.__.__k.indexOf(m)+1):null;for(var b;f<m.__k.length;f++)if((b=m.__k[f])!=null&&b.__e!=null)return b.__e;return typeof m.type=="function"?_e(m):null}function ut(m){var f,b;if((m=m.__)!=null&&m.__c!=null){for(m.__e=m.__c.base=null,f=0;f<m.__k.length;f++)if((b=m.__k[f])!=null&&b.__e!=null){m.__e=m.__c.base=b.__e;break}return ut(m)}}function Ve(m){(!m.__d&&(m.__d=!0)&&oe.push(m)&&!be.__r++||qe!==G.debounceRendering)&&((qe=G.debounceRendering)||ht)(be)}function be(){var m,f,b,E,k,O,F,t;for(oe.sort(Me);m=oe.shift();)m.__d&&(f=oe.length,E=void 0,k=void 0,F=(O=(b=m).__v).__e,(t=b.__P)&&(E=[],(k=re({},O)).__v=O.__v+1,Ue(t,O,k,b.__n,t.ownerSVGElement!==void 0,O.__h!=null?[F]:null,E,F??_e(O),O.__h),pt(E,O),O.__e!=F&&ut(O)),oe.length>f&&oe.sort(Me));be.__r=0}function _t(m,f,b,E,k,O,F,t,r,l){var a,c,u,p,v,_,e,s=E&&E.__k||lt,o=s.length;for(b.__k=[],a=0;a<f.length;a++)if((p=b.__k[a]=(p=f[a])==null||typeof p=="boolean"||typeof p=="function"?null:typeof p=="string"||typeof p=="number"||typeof p=="bigint"?ve(null,p,null,null,p):He(p)?ve(Le,{children:p},null,null,null):p.__b>0?ve(p.type,p.props,p.key,p.ref?p.ref:null,p.__v):p)!=null){if(p.__=b,p.__b=b.__b+1,(u=s[a])===null||u&&p.key==u.key&&p.type===u.type)s[a]=void 0;else for(c=0;c<o;c++){if((u=s[c])&&p.key==u.key&&p.type===u.type){s[c]=void 0;break}u=null}Ue(m,p,u=u||Se,k,O,F,t,r,l),v=p.__e,(c=p.ref)&&u.ref!=c&&(e||(e=[]),u.ref&&e.push(u.ref,null,p),e.push(c,p.__c||v,p)),v!=null?(_==null&&(_=v),typeof p.type=="function"&&p.__k===u.__k?p.__d=r=dt(p,r,m):r=ft(m,p,u,s,v,r),typeof b.type=="function"&&(b.__d=r)):r&&u.__e==r&&r.parentNode!=m&&(r=_e(u))}for(b.__e=_,a=o;a--;)s[a]!=null&&(typeof b.type=="function"&&s[a].__e!=null&&s[a].__e==b.__d&&(b.__d=vt(E).nextSibling),Dt(s[a],s[a]));if(e)for(a=0;a<e.length;a++)gt(e[a],e[++a],e[++a])}function dt(m,f,b){for(var E,k=m.__k,O=0;k&&O<k.length;O++)(E=k[O])&&(E.__=m,f=typeof E.type=="function"?dt(E,f,b):ft(b,E,E,k,E.__e,f));return f}function ft(m,f,b,E,k,O){var F,t,r;if(f.__d!==void 0)F=f.__d,f.__d=void 0;else if(b==null||k!=O||k.parentNode==null)e:if(O==null||O.parentNode!==m)m.appendChild(k),F=null;else{for(t=O,r=0;(t=t.nextSibling)&&r<E.length;r+=1)if(t==k)break e;m.insertBefore(k,O),F=O}return F!==void 0?F:k.nextSibling}function vt(m){var f,b,E;if(m.type==null||typeof m.type=="string")return m.__e;if(m.__k){for(f=m.__k.length-1;f>=0;f--)if((b=m.__k[f])&&(E=vt(b)))return E}return null}function Pt(m,f,b,E,k){var O;for(O in b)O==="children"||O==="key"||O in f||ye(m,O,null,b[O],E);for(O in f)k&&typeof f[O]!="function"||O==="children"||O==="key"||O==="value"||O==="checked"||b[O]===f[O]||ye(m,O,f[O],b[O],E)}function Ge(m,f,b){f[0]==="-"?m.setProperty(f,b??""):m[f]=b==null?"":typeof b!="number"||Ot.test(f)?b:b+"px"}function ye(m,f,b,E,k){var O;e:if(f==="style")if(typeof b=="string")m.style.cssText=b;else{if(typeof E=="string"&&(m.style.cssText=E=""),E)for(f in E)b&&f in b||Ge(m.style,f,"");if(b)for(f in b)E&&b[f]===E[f]||Ge(m.style,f,b[f])}else if(f[0]==="o"&&f[1]==="n")O=f!==(f=f.replace(/Capture$/,"")),f=f.toLowerCase()in m?f.toLowerCase().slice(2):f.slice(2),m.l||(m.l={}),m.l[f+O]=b,b?E||m.addEventListener(f,O?Ye:Xe,O):m.removeEventListener(f,O?Ye:Xe,O);else if(f!=="dangerouslySetInnerHTML"){if(k)f=f.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(f!=="width"&&f!=="height"&&f!=="href"&&f!=="list"&&f!=="form"&&f!=="tabIndex"&&f!=="download"&&f!=="rowSpan"&&f!=="colSpan"&&f in m)try{m[f]=b??"";break e}catch{}typeof b=="function"||(b==null||b===!1&&f[4]!=="-"?m.removeAttribute(f):m.setAttribute(f,b))}}function Xe(m){return this.l[m.type+!1](G.event?G.event(m):m)}function Ye(m){return this.l[m.type+!0](G.event?G.event(m):m)}function Ue(m,f,b,E,k,O,F,t,r){var l,a,c,u,p,v,_,e,s,o,i,n,d,g,S,h=f.type;if(f.constructor!==void 0)return null;b.__h!=null&&(r=b.__h,t=f.__e=b.__e,f.__h=null,O=[t]),(l=G.__b)&&l(f);try{e:if(typeof h=="function"){if(e=f.props,s=(l=h.contextType)&&E[l.__c],o=l?s?s.props.value:l.__:E,b.__c?_=(a=f.__c=b.__c).__=a.__E:("prototype"in h&&h.prototype.render?f.__c=a=new h(e,o):(f.__c=a=new pe(e,o),a.constructor=h,a.render=Ut),s&&s.sub(a),a.props=e,a.state||(a.state={}),a.context=o,a.__n=E,c=a.__d=!0,a.__h=[],a._sb=[]),a.__s==null&&(a.__s=a.state),h.getDerivedStateFromProps!=null&&(a.__s==a.state&&(a.__s=re({},a.__s)),re(a.__s,h.getDerivedStateFromProps(e,a.__s))),u=a.props,p=a.state,a.__v=f,c)h.getDerivedStateFromProps==null&&a.componentWillMount!=null&&a.componentWillMount(),a.componentDidMount!=null&&a.__h.push(a.componentDidMount);else{if(h.getDerivedStateFromProps==null&&e!==u&&a.componentWillReceiveProps!=null&&a.componentWillReceiveProps(e,o),!a.__e&&a.shouldComponentUpdate!=null&&a.shouldComponentUpdate(e,a.__s,o)===!1||f.__v===b.__v){for(f.__v!==b.__v&&(a.props=e,a.state=a.__s,a.__d=!1),a.__e=!1,f.__e=b.__e,f.__k=b.__k,f.__k.forEach(function(D){D&&(D.__=f)}),i=0;i<a._sb.length;i++)a.__h.push(a._sb[i]);a._sb=[],a.__h.length&&F.push(a);break e}a.componentWillUpdate!=null&&a.componentWillUpdate(e,a.__s,o),a.componentDidUpdate!=null&&a.__h.push(function(){a.componentDidUpdate(u,p,v)})}if(a.context=o,a.props=e,a.__P=m,n=G.__r,d=0,"prototype"in h&&h.prototype.render){for(a.state=a.__s,a.__d=!1,n&&n(f),l=a.render(a.props,a.state,a.context),g=0;g<a._sb.length;g++)a.__h.push(a._sb[g]);a._sb=[]}else do a.__d=!1,n&&n(f),l=a.render(a.props,a.state,a.context),a.state=a.__s;while(a.__d&&++d<25);a.state=a.__s,a.getChildContext!=null&&(E=re(re({},E),a.getChildContext())),c||a.getSnapshotBeforeUpdate==null||(v=a.getSnapshotBeforeUpdate(u,p)),_t(m,He(S=l!=null&&l.type===Le&&l.key==null?l.props.children:l)?S:[S],f,b,E,k,O,F,t,r),a.base=f.__e,f.__h=null,a.__h.length&&F.push(a),_&&(a.__E=a.__=null),a.__e=!1}else O==null&&f.__v===b.__v?(f.__k=b.__k,f.__e=b.__e):f.__e=Ht(b.__e,f,b,E,k,O,F,r);(l=G.diffed)&&l(f)}catch(D){f.__v=null,(r||O!=null)&&(f.__e=t,f.__h=!!r,O[O.indexOf(t)]=null),G.__e(D,f,b)}}function pt(m,f){G.__c&&G.__c(f,m),m.some(function(b){try{m=b.__h,b.__h=[],m.some(function(E){E.call(b)})}catch(E){G.__e(E,b.__v)}})}function Ht(m,f,b,E,k,O,F,t){var r,l,a,c=b.props,u=f.props,p=f.type,v=0;if(p==="svg"&&(k=!0),O!=null){for(;v<O.length;v++)if((r=O[v])&&"setAttribute"in r==!!p&&(p?r.localName===p:r.nodeType===3)){m=r,O[v]=null;break}}if(m==null){if(p===null)return document.createTextNode(u);m=k?document.createElementNS("http://www.w3.org/2000/svg",p):document.createElement(p,u.is&&u),O=null,t=!1}if(p===null)c===u||t&&m.data===u||(m.data=u);else{if(O=O&&ke.call(m.childNodes),l=(c=b.props||Se).dangerouslySetInnerHTML,a=u.dangerouslySetInnerHTML,!t){if(O!=null)for(c={},v=0;v<m.attributes.length;v++)c[m.attributes[v].name]=m.attributes[v].value;(a||l)&&(a&&(l&&a.__html==l.__html||a.__html===m.innerHTML)||(m.innerHTML=a&&a.__html||""))}if(Pt(m,u,c,k,t),a)f.__k=[];else if(_t(m,He(v=f.props.children)?v:[v],f,b,E,k&&p!=="foreignObject",O,F,O?O[0]:b.__k&&_e(b,0),t),O!=null)for(v=O.length;v--;)O[v]!=null&&ct(O[v]);t||("value"in u&&(v=u.value)!==void 0&&(v!==m.value||p==="progress"&&!v||p==="option"&&v!==c.value)&&ye(m,"value",v,c.value,!1),"checked"in u&&(v=u.checked)!==void 0&&v!==m.checked&&ye(m,"checked",v,c.checked,!1))}return m}function gt(m,f,b){try{typeof m=="function"?m(f):m.current=f}catch(E){G.__e(E,b)}}function Dt(m,f,b){var E,k;if(G.unmount&&G.unmount(m),(E=m.ref)&&(E.current&&E.current!==m.__e||gt(E,null,f)),(E=m.__c)!=null){if(E.componentWillUnmount)try{E.componentWillUnmount()}catch(O){G.__e(O,f)}E.base=E.__P=null,m.__c=void 0}if(E=m.__k)for(k=0;k<E.length;k++)E[k]&&Dt(E[k],f,b||typeof m.type!="function");b||m.__e==null||ct(m.__e),m.__=m.__e=m.__d=void 0}function Ut(m,f,b){return this.constructor(m,b)}function Wt(m,f,b){var E,k,O;G.__&&G.__(m,f),k=(E=typeof b=="function")?null:b&&b.__k||f.__k,O=[],Ue(f,m=(!E&&b||f).__k=It(Le,null,[m]),k||Se,Se,f.ownerSVGElement!==void 0,!E&&b?[b]:k?null:f.firstChild?ke.call(f.childNodes):null,O,!E&&b?b:k?k.__e:f.firstChild,E),pt(O,m)}ke=lt.slice,G={__e:function(m,f,b,E){for(var k,O,F;f=f.__;)if((k=f.__c)&&!k.__)try{if((O=k.constructor)&&O.getDerivedStateFromError!=null&&(k.setState(O.getDerivedStateFromError(m)),F=k.__d),k.componentDidCatch!=null&&(k.componentDidCatch(m,E||{}),F=k.__d),F)return k.__E=k}catch(t){m=t}throw m}},at=0,pe.prototype.setState=function(m,f){var b;b=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=re({},this.state),typeof m=="function"&&(m=m(re({},b),this.props)),m&&re(b,m),m!=null&&this.__v&&(f&&this._sb.push(f),Ve(this))},pe.prototype.forceUpdate=function(m){this.__v&&(this.__e=!0,m&&this.__h.push(m),Ve(this))},pe.prototype.render=Le,oe=[],ht=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Me=function(m,f){return m.__v.__b-f.__v.__b},be.__r=0;var de,Z,xe,Je,fe=0,mt=[],ge=[],Ze=G.__b,Qe=G.__r,et=G.diffed,tt=G.__c,it=G.unmount;function We(m,f){G.__h&&G.__h(Z,m,fe||f),fe=0;var b=Z.__H||(Z.__H={__:[],__h:[]});return m>=b.__.length&&b.__.push({__V:ge}),b.__[m]}function Nt(m){return fe=1,$t(bt,m)}function $t(m,f,b){var E=We(de++,2);if(E.t=m,!E.__c&&(E.__=[b?b(f):bt(void 0,f),function(t){var r=E.__N?E.__N[0]:E.__[0],l=E.t(r,t);r!==l&&(E.__N=[l,E.__[1]],E.__c.setState({}))}],E.__c=Z,!Z.u)){var k=function(t,r,l){if(!E.__c.__H)return!0;var a=E.__c.__H.__.filter(function(u){return u.__c});if(a.every(function(u){return!u.__N}))return!O||O.call(this,t,r,l);var c=!1;return a.forEach(function(u){if(u.__N){var p=u.__[0];u.__=u.__N,u.__N=void 0,p!==u.__[0]&&(c=!0)}}),!(!c&&E.__c.props===t)&&(!O||O.call(this,t,r,l))};Z.u=!0;var O=Z.shouldComponentUpdate,F=Z.componentWillUpdate;Z.componentWillUpdate=function(t,r,l){if(this.__e){var a=O;O=void 0,k(t,r,l),O=a}F&&F.call(this,t,r,l)},Z.shouldComponentUpdate=k}return E.__N||E.__}function Ct(m,f){var b=We(de++,3);!G.__s&&St(b.__H,f)&&(b.__=m,b.i=f,Z.__H.__h.push(b))}function st(m){return fe=5,Ne(function(){return{current:m}},[])}function Ne(m,f){var b=We(de++,7);return St(b.__H,f)?(b.__V=m(),b.i=f,b.__h=m,b.__V):b.__}function jt(m,f){return fe=8,Ne(function(){return m},f)}function zt(){for(var m;m=mt.shift();)if(m.__P&&m.__H)try{m.__H.__h.forEach(De),m.__H.__h.forEach(Oe),m.__H.__h=[]}catch(f){m.__H.__h=[],G.__e(f,m.__v)}}G.__b=function(m){Z=null,Ze&&Ze(m)},G.__r=function(m){Qe&&Qe(m),de=0;var f=(Z=m.__c).__H;f&&(xe===Z?(f.__h=[],Z.__h=[],f.__.forEach(function(b){b.__N&&(b.__=b.__N),b.__V=ge,b.__N=b.i=void 0})):(f.__h.forEach(De),f.__h.forEach(Oe),f.__h=[],de=0)),xe=Z},G.diffed=function(m){et&&et(m);var f=m.__c;f&&f.__H&&(f.__H.__h.length&&(mt.push(f)!==1&&Je===G.requestAnimationFrame||((Je=G.requestAnimationFrame)||Kt)(zt)),f.__H.__.forEach(function(b){b.i&&(b.__H=b.i),b.__V!==ge&&(b.__=b.__V),b.i=void 0,b.__V=ge})),xe=Z=null},G.__c=function(m,f){f.some(function(b){try{b.__h.forEach(De),b.__h=b.__h.filter(function(E){return!E.__||Oe(E)})}catch(E){f.some(function(k){k.__h&&(k.__h=[])}),f=[],G.__e(E,b.__v)}}),tt&&tt(m,f)},G.unmount=function(m){it&&it(m);var f,b=m.__c;b&&b.__H&&(b.__H.__.forEach(function(E){try{De(E)}catch(k){f=k}}),b.__H=void 0,f&&G.__e(f,b.__v))};var rt=typeof requestAnimationFrame=="function";function Kt(m){var f,b=function(){clearTimeout(E),rt&&cancelAnimationFrame(f),setTimeout(m)},E=setTimeout(b,100);rt&&(f=requestAnimationFrame(b))}function De(m){var f=Z,b=m.__c;typeof b=="function"&&(m.__c=void 0,b()),Z=f}function Oe(m){var f=Z;m.__c=m.__(),Z=f}function St(m,f){return!m||m.length!==f.length||f.some(function(b,E){return b!==m[E]})}function bt(m,f){return typeof f=="function"?f(m):f}var we=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},yt={exports:{}};(function(m,f){(function(b,E){m.exports=E()})(self,function(){return(()=>{var b={4567:(F,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AccessibilityManager=void 0;const l=r(9042),a=r(6114),c=r(9924),u=r(3656),p=r(844),v=r(5596),_=r(9631);class e extends p.Disposable{constructor(o,i){super(),this._terminal=o,this._renderService=i,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityTreeRoot=document.createElement("div"),this._accessibilityTreeRoot.classList.add("xterm-accessibility"),this._accessibilityTreeRoot.tabIndex=0,this._rowContainer=document.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let n=0;n<this._terminal.rows;n++)this._rowElements[n]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[n]);if(this._topBoundaryFocusListener=n=>this._handleBoundaryFocus(n,0),this._bottomBoundaryFocusListener=n=>this._handleBoundaryFocus(n,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityTreeRoot.appendChild(this._rowContainer),this._renderRowsDebouncer=new c.TimeBasedDebouncer(this._renderRows.bind(this)),this._refreshRows(),this._liveRegion=document.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityTreeRoot.appendChild(this._liveRegion),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityTreeRoot),this.register(this._renderRowsDebouncer),this.register(this._terminal.onResize(n=>this._handleResize(n.rows))),this.register(this._terminal.onRender(n=>this._refreshRows(n.start,n.end))),this.register(this._terminal.onScroll(()=>this._refreshRows())),this.register(this._terminal.onA11yChar(n=>this._handleChar(n))),this.register(this._terminal.onLineFeed(()=>this._handleChar(`
`))),this.register(this._terminal.onA11yTab(n=>this._handleTab(n))),this.register(this._terminal.onKey(n=>this._handleKey(n.key))),this.register(this._terminal.onBlur(()=>this._clearLiveRegion())),this.register(this._renderService.onDimensionsChange(()=>this._refreshRowsDimensions())),this._screenDprMonitor=new v.ScreenDprMonitor(window),this.register(this._screenDprMonitor),this._screenDprMonitor.setListener(()=>this._refreshRowsDimensions()),this.register((0,u.addDisposableDomListener)(window,"resize",()=>this._refreshRowsDimensions())),this.register((0,p.toDisposable)(()=>{(0,_.removeElementFromParent)(this._accessibilityTreeRoot),this._rowElements.length=0}))}_handleBoundaryFocus(o,i){const n=o.target,d=this._rowElements[i===0?1:this._rowElements.length-2];if(n.getAttribute("aria-posinset")===(i===0?"1":`${this._terminal.buffer.lines.length}`)||o.relatedTarget!==d)return;let g,S;if(i===0?(g=n,S=this._rowElements.pop(),this._rowContainer.removeChild(S)):(g=this._rowElements.shift(),S=n,this._rowContainer.removeChild(g)),g.removeEventListener("focus",this._topBoundaryFocusListener),S.removeEventListener("focus",this._bottomBoundaryFocusListener),i===0){const h=this._createAccessibilityTreeNode();this._rowElements.unshift(h),this._rowContainer.insertAdjacentElement("afterbegin",h)}else{const h=this._createAccessibilityTreeNode();this._rowElements.push(h),this._rowContainer.appendChild(h)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(i===0?-1:1),this._rowElements[i===0?1:this._rowElements.length-2].focus(),o.preventDefault(),o.stopImmediatePropagation()}_handleResize(o){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let i=this._rowContainer.children.length;i<this._terminal.rows;i++)this._rowElements[i]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[i]);for(;this._rowElements.length>o;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){const o=document.createElement("div");return o.setAttribute("role","listitem"),o.tabIndex=-1,this._refreshRowDimensions(o),o}_handleTab(o){for(let i=0;i<o;i++)this._handleChar(" ")}_handleChar(o){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==o&&(this._charsToAnnounce+=o):this._charsToAnnounce+=o,o===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===21&&(this._liveRegion.textContent+=l.tooMuchOutput)),a.isMac&&this._liveRegion.textContent&&this._liveRegion.textContent.length>0&&!this._liveRegion.parentNode&&setTimeout(()=>{this._accessibilityTreeRoot.appendChild(this._liveRegion)},0))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0,a.isMac&&(0,_.removeElementFromParent)(this._liveRegion)}_handleKey(o){this._clearLiveRegion(),/\p{Control}/u.test(o)||this._charsToConsume.push(o)}_refreshRows(o,i){this._renderRowsDebouncer.refresh(o,i,this._terminal.rows)}_renderRows(o,i){const n=this._terminal.buffer,d=n.lines.length.toString();for(let g=o;g<=i;g++){const S=n.translateBufferLineToString(n.ydisp+g,!0),h=(n.ydisp+g+1).toString(),D=this._rowElements[g];D&&(S.length===0?D.innerText=" ":D.textContent=S,D.setAttribute("aria-posinset",h),D.setAttribute("aria-setsize",d))}this._announceCharacters()}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){this._accessibilityTreeRoot.style.width=`${this._renderService.dimensions.css.canvas.width}px`,this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let o=0;o<this._terminal.rows;o++)this._refreshRowDimensions(this._rowElements[o])}}_refreshRowDimensions(o){o.style.height=`${this._renderService.dimensions.css.cell.height}px`}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}}t.AccessibilityManager=e},3614:(F,t)=>{function r(u){return u.replace(/\r?\n/g,"\r")}function l(u,p){return p?"\x1B[200~"+u+"\x1B[201~":u}function a(u,p,v){u=l(u=r(u),v.decPrivateModes.bracketedPasteMode),v.triggerDataEvent(u,!0),p.value=""}function c(u,p,v){const _=v.getBoundingClientRect(),e=u.clientX-_.left-10,s=u.clientY-_.top-10;p.style.width="20px",p.style.height="20px",p.style.left=`${e}px`,p.style.top=`${s}px`,p.style.zIndex="1000",p.focus()}Object.defineProperty(t,"__esModule",{value:!0}),t.rightClickHandler=t.moveTextAreaUnderMouseCursor=t.paste=t.handlePasteEvent=t.copyHandler=t.bracketTextForPaste=t.prepareTextForTerminal=void 0,t.prepareTextForTerminal=r,t.bracketTextForPaste=l,t.copyHandler=function(u,p){u.clipboardData&&u.clipboardData.setData("text/plain",p.selectionText),u.preventDefault()},t.handlePasteEvent=function(u,p,v){u.stopPropagation(),u.clipboardData&&a(u.clipboardData.getData("text/plain"),p,v)},t.paste=a,t.moveTextAreaUnderMouseCursor=c,t.rightClickHandler=function(u,p,v,_,e){c(u,p,v),e&&_.rightClickSelect(u),p.value=_.selectionText,p.select()}},7239:(F,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ColorContrastCache=void 0;const l=r(1505);t.ColorContrastCache=class{constructor(){this._color=new l.TwoKeyMap,this._css=new l.TwoKeyMap}setCss(a,c,u){this._css.set(a,c,u)}getCss(a,c){return this._css.get(a,c)}setColor(a,c,u){this._color.set(a,c,u)}getColor(a,c){return this._color.get(a,c)}clear(){this._color.clear(),this._css.clear()}}},9631:(F,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.removeElementFromParent=void 0,t.removeElementFromParent=function(...r){var l;for(const a of r)(l=a?.parentElement)===null||l===void 0||l.removeChild(a)}},3656:(F,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addDisposableDomListener=void 0,t.addDisposableDomListener=function(r,l,a,c){r.addEventListener(l,a,c);let u=!1;return{dispose:()=>{u||(u=!0,r.removeEventListener(l,a,c))}}}},6465:function(F,t,r){var l=this&&this.__decorate||function(e,s,o,i){var n,d=arguments.length,g=d<3?s:i===null?i=Object.getOwnPropertyDescriptor(s,o):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(e,s,o,i);else for(var S=e.length-1;S>=0;S--)(n=e[S])&&(g=(d<3?n(g):d>3?n(s,o,g):n(s,o))||g);return d>3&&g&&Object.defineProperty(s,o,g),g},a=this&&this.__param||function(e,s){return function(o,i){s(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Linkifier2=void 0;const c=r(2585),u=r(8460),p=r(844),v=r(3656);let _=class extends p.Disposable{constructor(e){super(),this._bufferService=e,this._linkProviders=[],this._linkCacheDisposables=[],this._isMouseOut=!0,this._activeLine=-1,this._onShowLinkUnderline=this.register(new u.EventEmitter),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this.register(new u.EventEmitter),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this.register((0,p.getDisposeArrayDisposable)(this._linkCacheDisposables)),this.register((0,p.toDisposable)(()=>{this._lastMouseEvent=void 0}))}get currentLink(){return this._currentLink}registerLinkProvider(e){return this._linkProviders.push(e),{dispose:()=>{const s=this._linkProviders.indexOf(e);s!==-1&&this._linkProviders.splice(s,1)}}}attachToDom(e,s,o){this._element=e,this._mouseService=s,this._renderService=o,this.register((0,v.addDisposableDomListener)(this._element,"mouseleave",()=>{this._isMouseOut=!0,this._clearCurrentLink()})),this.register((0,v.addDisposableDomListener)(this._element,"mousemove",this._handleMouseMove.bind(this))),this.register((0,v.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,v.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))}_handleMouseMove(e){if(this._lastMouseEvent=e,!this._element||!this._mouseService)return;const s=this._positionFromMouseEvent(e,this._element,this._mouseService);if(!s)return;this._isMouseOut=!1;const o=e.composedPath();for(let i=0;i<o.length;i++){const n=o[i];if(n.classList.contains("xterm"))break;if(n.classList.contains("xterm-hover"))return}this._lastBufferCell&&s.x===this._lastBufferCell.x&&s.y===this._lastBufferCell.y||(this._handleHover(s),this._lastBufferCell=s)}_handleHover(e){if(this._activeLine!==e.y)return this._clearCurrentLink(),void this._askForLink(e,!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,e)||(this._clearCurrentLink(),this._askForLink(e,!0))}_askForLink(e,s){var o,i;this._activeProviderReplies&&s||((o=this._activeProviderReplies)===null||o===void 0||o.forEach(d=>{d?.forEach(g=>{g.link.dispose&&g.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=e.y);let n=!1;for(const[d,g]of this._linkProviders.entries())s?!((i=this._activeProviderReplies)===null||i===void 0)&&i.get(d)&&(n=this._checkLinkProviderResult(d,e,n)):g.provideLinks(e.y,S=>{var h,D;if(this._isMouseOut)return;const y=S?.map(L=>({link:L}));(h=this._activeProviderReplies)===null||h===void 0||h.set(d,y),n=this._checkLinkProviderResult(d,e,n),((D=this._activeProviderReplies)===null||D===void 0?void 0:D.size)===this._linkProviders.length&&this._removeIntersectingLinks(e.y,this._activeProviderReplies)})}_removeIntersectingLinks(e,s){const o=new Set;for(let i=0;i<s.size;i++){const n=s.get(i);if(n)for(let d=0;d<n.length;d++){const g=n[d],S=g.link.range.start.y<e?0:g.link.range.start.x,h=g.link.range.end.y>e?this._bufferService.cols:g.link.range.end.x;for(let D=S;D<=h;D++){if(o.has(D)){n.splice(d--,1);break}o.add(D)}}}}_checkLinkProviderResult(e,s,o){var i;if(!this._activeProviderReplies)return o;const n=this._activeProviderReplies.get(e);let d=!1;for(let g=0;g<e;g++)this._activeProviderReplies.has(g)&&!this._activeProviderReplies.get(g)||(d=!0);if(!d&&n){const g=n.find(S=>this._linkAtPosition(S.link,s));g&&(o=!0,this._handleNewLink(g))}if(this._activeProviderReplies.size===this._linkProviders.length&&!o)for(let g=0;g<this._activeProviderReplies.size;g++){const S=(i=this._activeProviderReplies.get(g))===null||i===void 0?void 0:i.find(h=>this._linkAtPosition(h.link,s));if(S){o=!0,this._handleNewLink(S);break}}return o}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(e){if(!this._element||!this._mouseService||!this._currentLink)return;const s=this._positionFromMouseEvent(e,this._element,this._mouseService);s&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,s)&&this._currentLink.link.activate(e,this._currentLink.link.text)}_clearCurrentLink(e,s){this._element&&this._currentLink&&this._lastMouseEvent&&(!e||!s||this._currentLink.link.range.start.y>=e&&this._currentLink.link.range.end.y<=s)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,p.disposeArray)(this._linkCacheDisposables))}_handleNewLink(e){if(!this._element||!this._lastMouseEvent||!this._mouseService)return;const s=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);s&&this._linkAtPosition(e.link,s)&&(this._currentLink=e,this._currentLink.state={decorations:{underline:e.link.decorations===void 0||e.link.decorations.underline,pointerCursor:e.link.decorations===void 0||e.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,e.link,this._lastMouseEvent),e.link.decorations={},Object.defineProperties(e.link.decorations,{pointerCursor:{get:()=>{var o,i;return(i=(o=this._currentLink)===null||o===void 0?void 0:o.state)===null||i===void 0?void 0:i.decorations.pointerCursor},set:o=>{var i,n;!((i=this._currentLink)===null||i===void 0)&&i.state&&this._currentLink.state.decorations.pointerCursor!==o&&(this._currentLink.state.decorations.pointerCursor=o,this._currentLink.state.isHovered&&((n=this._element)===null||n===void 0||n.classList.toggle("xterm-cursor-pointer",o)))}},underline:{get:()=>{var o,i;return(i=(o=this._currentLink)===null||o===void 0?void 0:o.state)===null||i===void 0?void 0:i.decorations.underline},set:o=>{var i,n,d;!((i=this._currentLink)===null||i===void 0)&&i.state&&((d=(n=this._currentLink)===null||n===void 0?void 0:n.state)===null||d===void 0?void 0:d.decorations.underline)!==o&&(this._currentLink.state.decorations.underline=o,this._currentLink.state.isHovered&&this._fireUnderlineEvent(e.link,o))}}}),this._renderService&&this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange(o=>{const i=o.start===0?0:o.start+1+this._bufferService.buffer.ydisp,n=this._currentLink?this._lastMouseEvent:void 0;if(this._clearCurrentLink(i,o.end+1+this._bufferService.buffer.ydisp),n&&this._element){const d=this._positionFromMouseEvent(n,this._element,this._mouseService);d&&this._askForLink(d,!1)}})))}_linkHover(e,s,o){var i;!((i=this._currentLink)===null||i===void 0)&&i.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(s,!0),this._currentLink.state.decorations.pointerCursor&&e.classList.add("xterm-cursor-pointer")),s.hover&&s.hover(o,s.text)}_fireUnderlineEvent(e,s){const o=e.range,i=this._bufferService.buffer.ydisp,n=this._createLinkUnderlineEvent(o.start.x-1,o.start.y-i-1,o.end.x,o.end.y-i-1,void 0);(s?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(n)}_linkLeave(e,s,o){var i;!((i=this._currentLink)===null||i===void 0)&&i.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(s,!1),this._currentLink.state.decorations.pointerCursor&&e.classList.remove("xterm-cursor-pointer")),s.leave&&s.leave(o,s.text)}_linkAtPosition(e,s){const o=e.range.start.y*this._bufferService.cols+e.range.start.x,i=e.range.end.y*this._bufferService.cols+e.range.end.x,n=s.y*this._bufferService.cols+s.x;return o<=n&&n<=i}_positionFromMouseEvent(e,s,o){const i=o.getCoords(e,s,this._bufferService.cols,this._bufferService.rows);if(i)return{x:i[0],y:i[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(e,s,o,i,n){return{x1:e,y1:s,x2:o,y2:i,cols:this._bufferService.cols,fg:n}}};_=l([a(0,c.IBufferService)],_),t.Linkifier2=_},9042:(F,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.tooMuchOutput=t.promptLabel=void 0,t.promptLabel="Terminal input",t.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},3730:function(F,t,r){var l=this&&this.__decorate||function(_,e,s,o){var i,n=arguments.length,d=n<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,s):o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(_,e,s,o);else for(var g=_.length-1;g>=0;g--)(i=_[g])&&(d=(n<3?i(d):n>3?i(e,s,d):i(e,s))||d);return n>3&&d&&Object.defineProperty(e,s,d),d},a=this&&this.__param||function(_,e){return function(s,o){e(s,o,_)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OscLinkProvider=void 0;const c=r(511),u=r(2585);let p=class{constructor(_,e,s){this._bufferService=_,this._optionsService=e,this._oscLinkService=s}provideLinks(_,e){var s;const o=this._bufferService.buffer.lines.get(_-1);if(!o)return void e(void 0);const i=[],n=this._optionsService.rawOptions.linkHandler,d=new c.CellData,g=o.getTrimmedLength();let S=-1,h=-1,D=!1;for(let y=0;y<g;y++)if(h!==-1||o.hasContent(y)){if(o.loadCell(y,d),d.hasExtendedAttrs()&&d.extended.urlId){if(h===-1){h=y,S=d.extended.urlId;continue}D=d.extended.urlId!==S}else h!==-1&&(D=!0);if(D||h!==-1&&y===g-1){const L=(s=this._oscLinkService.getLinkData(S))===null||s===void 0?void 0:s.uri;if(L){const A={start:{x:h+1,y:_},end:{x:y+(D||y!==g-1?0:1),y:_}};let M=!1;if(!n?.allowNonHttpProtocols)try{const P=new URL(L);["http:","https:"].includes(P.protocol)||(M=!0)}catch{M=!0}M||i.push({text:L,range:A,activate:(P,N)=>n?n.activate(P,N,A):v(0,N),hover:(P,N)=>{var j;return(j=n?.hover)===null||j===void 0?void 0:j.call(n,P,N,A)},leave:(P,N)=>{var j;return(j=n?.leave)===null||j===void 0?void 0:j.call(n,P,N,A)}})}D=!1,d.hasExtendedAttrs()&&d.extended.urlId?(h=y,S=d.extended.urlId):(h=-1,S=-1)}}e(i)}};function v(_,e){if(confirm(`Do you want to navigate to ${e}?

WARNING: This link could potentially be dangerous`)){const s=window.open();if(s){try{s.opener=null}catch{}s.location.href=e}else console.warn("Opening link blocked as opener could not be cleared")}}p=l([a(0,u.IBufferService),a(1,u.IOptionsService),a(2,u.IOscLinkService)],p),t.OscLinkProvider=p},6193:(F,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RenderDebouncer=void 0,t.RenderDebouncer=class{constructor(r,l){this._parentWindow=r,this._renderCallback=l,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._parentWindow.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(r){return this._refreshCallbacks.push(r),this._animationFrame||(this._animationFrame=this._parentWindow.requestAnimationFrame(()=>this._innerRefresh())),this._animationFrame}refresh(r,l,a){this._rowCount=a,r=r!==void 0?r:0,l=l!==void 0?l:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,r):r,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,l):l,this._animationFrame||(this._animationFrame=this._parentWindow.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return void this._runRefreshCallbacks();const r=Math.max(this._rowStart,0),l=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(r,l),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(const r of this._refreshCallbacks)r(0);this._refreshCallbacks=[]}}},5596:(F,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenDprMonitor=void 0;const l=r(844);class a extends l.Disposable{constructor(u){super(),this._parentWindow=u,this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this.register((0,l.toDisposable)(()=>{this.clearListener()}))}setListener(u){this._listener&&this.clearListener(),this._listener=u,this._outerListener=()=>{this._listener&&(this._listener(this._parentWindow.devicePixelRatio,this._currentDevicePixelRatio),this._updateDpr())},this._updateDpr()}_updateDpr(){var u;this._outerListener&&((u=this._resolutionMediaMatchList)===null||u===void 0||u.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._listener&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._listener=void 0,this._outerListener=void 0)}}t.ScreenDprMonitor=a},3236:(F,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Terminal=void 0;const l=r(2950),a=r(1680),c=r(3614),u=r(2584),p=r(5435),v=r(9312),_=r(6114),e=r(3656),s=r(9042),o=r(4567),i=r(1296),n=r(7399),d=r(8460),g=r(8437),S=r(3230),h=r(4725),D=r(428),y=r(8934),L=r(6465),A=r(5114),M=r(8969),P=r(8055),N=r(4269),j=r(5941),C=r(3107),w=r(5744),R=r(9074),T=r(2585),U=r(3730),z=r(844),V=r(6731),W=typeof window<"u"?window.document:null;class q extends M.CoreTerminal{constructor(B={}){super(B),this.browser=_,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._onCursorMove=this.register(new d.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onKey=this.register(new d.EventEmitter),this.onKey=this._onKey.event,this._onRender=this.register(new d.EventEmitter),this.onRender=this._onRender.event,this._onSelectionChange=this.register(new d.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this.register(new d.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onBell=this.register(new d.EventEmitter),this.onBell=this._onBell.event,this._onFocus=this.register(new d.EventEmitter),this._onBlur=this.register(new d.EventEmitter),this._onA11yCharEmitter=this.register(new d.EventEmitter),this._onA11yTabEmitter=this.register(new d.EventEmitter),this._onWillOpen=this.register(new d.EventEmitter),this._setup(),this.linkifier2=this.register(this._instantiationService.createInstance(L.Linkifier2)),this.linkifier2.registerLinkProvider(this._instantiationService.createInstance(U.OscLinkProvider)),this._decorationService=this._instantiationService.createInstance(R.DecorationService),this._instantiationService.setService(T.IDecorationService,this._decorationService),this.register(this._inputHandler.onRequestBell(()=>this._onBell.fire())),this.register(this._inputHandler.onRequestRefreshRows((I,H)=>this.refresh(I,H))),this.register(this._inputHandler.onRequestSendFocus(()=>this._reportFocus())),this.register(this._inputHandler.onRequestReset(()=>this.reset())),this.register(this._inputHandler.onRequestWindowsOptionsReport(I=>this._reportWindowsOptions(I))),this.register(this._inputHandler.onColor(I=>this._handleColorEvent(I))),this.register((0,d.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,d.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,d.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,d.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize(I=>this._afterResize(I.cols,I.rows))),this.register((0,z.toDisposable)(()=>{var I,H;this._customKeyEventHandler=void 0,(H=(I=this.element)===null||I===void 0?void 0:I.parentNode)===null||H===void 0||H.removeChild(this.element)}))}get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}_handleColorEvent(B){if(this._themeService)for(const I of B){let H,$="";switch(I.index){case 256:H="foreground",$="10";break;case 257:H="background",$="11";break;case 258:H="cursor",$="12";break;default:H="ansi",$="4;"+I.index}switch(I.type){case 0:const J=P.color.toColorRGB(H==="ansi"?this._themeService.colors.ansi[I.index]:this._themeService.colors[H]);this.coreService.triggerDataEvent(`${u.C0.ESC}]${$};${(0,j.toRgbString)(J)}${u.C1_ESCAPED.ST}`);break;case 1:if(H==="ansi")this._themeService.modifyColors(K=>K.ansi[I.index]=P.rgba.toColor(...I.color));else{const K=H;this._themeService.modifyColors(ee=>ee[K]=P.rgba.toColor(...I.color))}break;case 2:this._themeService.restoreColor(I.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(B){var I;B?!this._accessibilityManager&&this._renderService&&(this._accessibilityManager=new o.AccessibilityManager(this,this._renderService)):((I=this._accessibilityManager)===null||I===void 0||I.dispose(),this._accessibilityManager=void 0)}_handleTextAreaFocus(B){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(u.C0.ESC+"[I"),this.updateCursorStyle(B),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){var B;return(B=this.textarea)===null||B===void 0?void 0:B.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(u.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;const B=this.buffer.ybase+this.buffer.y,I=this.buffer.lines.get(B);if(!I)return;const H=Math.min(this.buffer.x,this.cols-1),$=this._renderService.dimensions.css.cell.height,J=I.getWidth(H),K=this._renderService.dimensions.css.cell.width*J,ee=this.buffer.y*this._renderService.dimensions.css.cell.height,ie=H*this._renderService.dimensions.css.cell.width;this.textarea.style.left=ie+"px",this.textarea.style.top=ee+"px",this.textarea.style.width=K+"px",this.textarea.style.height=$+"px",this.textarea.style.lineHeight=$+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register((0,e.addDisposableDomListener)(this.element,"copy",I=>{this.hasSelection()&&(0,c.copyHandler)(I,this._selectionService)}));const B=I=>(0,c.handlePasteEvent)(I,this.textarea,this.coreService);this.register((0,e.addDisposableDomListener)(this.textarea,"paste",B)),this.register((0,e.addDisposableDomListener)(this.element,"paste",B)),_.isFirefox?this.register((0,e.addDisposableDomListener)(this.element,"mousedown",I=>{I.button===2&&(0,c.rightClickHandler)(I,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})):this.register((0,e.addDisposableDomListener)(this.element,"contextmenu",I=>{(0,c.rightClickHandler)(I,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})),_.isLinux&&this.register((0,e.addDisposableDomListener)(this.element,"auxclick",I=>{I.button===1&&(0,c.moveTextAreaUnderMouseCursor)(I,this.textarea,this.screenElement)}))}_bindKeys(){this.register((0,e.addDisposableDomListener)(this.textarea,"keyup",B=>this._keyUp(B),!0)),this.register((0,e.addDisposableDomListener)(this.textarea,"keydown",B=>this._keyDown(B),!0)),this.register((0,e.addDisposableDomListener)(this.textarea,"keypress",B=>this._keyPress(B),!0)),this.register((0,e.addDisposableDomListener)(this.textarea,"compositionstart",()=>this._compositionHelper.compositionstart())),this.register((0,e.addDisposableDomListener)(this.textarea,"compositionupdate",B=>this._compositionHelper.compositionupdate(B))),this.register((0,e.addDisposableDomListener)(this.textarea,"compositionend",()=>this._compositionHelper.compositionend())),this.register((0,e.addDisposableDomListener)(this.textarea,"input",B=>this._inputEvent(B),!0)),this.register(this.onRender(()=>this._compositionHelper.updateCompositionElements()))}open(B){var I;if(!B)throw new Error("Terminal requires a parent element.");B.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this._document=B.ownerDocument,this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),this.element.setAttribute("tabindex","0"),B.appendChild(this.element);const H=W.createDocumentFragment();this._viewportElement=W.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),H.appendChild(this._viewportElement),this._viewportScrollArea=W.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=W.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._helperContainer=W.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),H.appendChild(this.screenElement),this.textarea=W.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",s.promptLabel),_.isChromeOS||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._coreBrowserService=this._instantiationService.createInstance(A.CoreBrowserService,this.textarea,(I=this._document.defaultView)!==null&&I!==void 0?I:window),this._instantiationService.setService(h.ICoreBrowserService,this._coreBrowserService),this.register((0,e.addDisposableDomListener)(this.textarea,"focus",$=>this._handleTextAreaFocus($))),this.register((0,e.addDisposableDomListener)(this.textarea,"blur",()=>this._handleTextAreaBlur())),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(D.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(h.ICharSizeService,this._charSizeService),this._themeService=this._instantiationService.createInstance(V.ThemeService),this._instantiationService.setService(h.IThemeService,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(N.CharacterJoinerService),this._instantiationService.setService(h.ICharacterJoinerService,this._characterJoinerService),this._renderService=this.register(this._instantiationService.createInstance(S.RenderService,this.rows,this.screenElement)),this._instantiationService.setService(h.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange($=>this._onRender.fire($))),this.onResize($=>this._renderService.resize($.cols,$.rows)),this._compositionView=W.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(l.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this.element.appendChild(H);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this._mouseService=this._instantiationService.createInstance(y.MouseService),this._instantiationService.setService(h.IMouseService,this._mouseService),this.viewport=this._instantiationService.createInstance(a.Viewport,$=>this.scrollLines($,!0,1),this._viewportElement,this._viewportScrollArea),this.register(this._inputHandler.onRequestSyncScrollBar(()=>this.viewport.syncScrollArea())),this.register(this.viewport),this.register(this.onCursorMove(()=>{this._renderService.handleCursorMove(),this._syncTextArea()})),this.register(this.onResize(()=>this._renderService.handleResize(this.cols,this.rows))),this.register(this.onBlur(()=>this._renderService.handleBlur())),this.register(this.onFocus(()=>this._renderService.handleFocus())),this.register(this._renderService.onDimensionsChange(()=>this.viewport.syncScrollArea())),this._selectionService=this.register(this._instantiationService.createInstance(v.SelectionService,this.element,this.screenElement,this.linkifier2)),this._instantiationService.setService(h.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines($=>this.scrollLines($.amount,$.suppressScrollEvent))),this.register(this._selectionService.onSelectionChange(()=>this._onSelectionChange.fire())),this.register(this._selectionService.onRequestRedraw($=>this._renderService.handleSelectionChanged($.start,$.end,$.columnSelectMode))),this.register(this._selectionService.onLinuxMouseSelection($=>{this.textarea.value=$,this.textarea.focus(),this.textarea.select()})),this.register(this._onScroll.event($=>{this.viewport.syncScrollArea(),this._selectionService.refresh()})),this.register((0,e.addDisposableDomListener)(this._viewportElement,"scroll",()=>this._selectionService.refresh())),this.linkifier2.attachToDom(this.screenElement,this._mouseService,this._renderService),this.register(this._instantiationService.createInstance(C.BufferDecorationRenderer,this.screenElement)),this.register((0,e.addDisposableDomListener)(this.element,"mousedown",$=>this._selectionService.handleMouseDown($))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager=new o.AccessibilityManager(this,this._renderService)),this.register(this.optionsService.onSpecificOptionChange("screenReaderMode",$=>this._handleScreenReaderModeOptionChange($))),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(w.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRulerWidth",$=>{!this._overviewRulerRenderer&&$&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(w.OverviewRulerRenderer,this._viewportElement,this.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(i.DomRenderer,this.element,this.screenElement,this._viewportElement,this.linkifier2)}bindMouse(){const B=this,I=this.element;function H(K){const ee=B._mouseService.getMouseReportCoords(K,B.screenElement);if(!ee)return!1;let ie,te;switch(K.overrideType||K.type){case"mousemove":te=32,K.buttons===void 0?(ie=3,K.button!==void 0&&(ie=K.button<3?K.button:3)):ie=1&K.buttons?0:4&K.buttons?1:2&K.buttons?2:3;break;case"mouseup":te=0,ie=K.button<3?K.button:3;break;case"mousedown":te=1,ie=K.button<3?K.button:3;break;case"wheel":if(B.viewport.getLinesScrolled(K)===0)return!1;te=K.deltaY<0?0:1,ie=4;break;default:return!1}return!(te===void 0||ie===void 0||ie>4)&&B.coreMouseService.triggerMouseEvent({col:ee.col,row:ee.row,x:ee.x,y:ee.y,button:ie,action:te,ctrl:K.ctrlKey,alt:K.altKey,shift:K.shiftKey})}const $={mouseup:null,wheel:null,mousedrag:null,mousemove:null},J={mouseup:K=>(H(K),K.buttons||(this._document.removeEventListener("mouseup",$.mouseup),$.mousedrag&&this._document.removeEventListener("mousemove",$.mousedrag)),this.cancel(K)),wheel:K=>(H(K),this.cancel(K,!0)),mousedrag:K=>{K.buttons&&H(K)},mousemove:K=>{K.buttons||H(K)}};this.register(this.coreMouseService.onProtocolChange(K=>{K?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(K)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&K?$.mousemove||(I.addEventListener("mousemove",J.mousemove),$.mousemove=J.mousemove):(I.removeEventListener("mousemove",$.mousemove),$.mousemove=null),16&K?$.wheel||(I.addEventListener("wheel",J.wheel,{passive:!1}),$.wheel=J.wheel):(I.removeEventListener("wheel",$.wheel),$.wheel=null),2&K?$.mouseup||($.mouseup=J.mouseup):(this._document.removeEventListener("mouseup",$.mouseup),$.mouseup=null),4&K?$.mousedrag||($.mousedrag=J.mousedrag):(this._document.removeEventListener("mousemove",$.mousedrag),$.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,e.addDisposableDomListener)(I,"mousedown",K=>{if(K.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection(K))return H(K),$.mouseup&&this._document.addEventListener("mouseup",$.mouseup),$.mousedrag&&this._document.addEventListener("mousemove",$.mousedrag),this.cancel(K)})),this.register((0,e.addDisposableDomListener)(I,"wheel",K=>{if(!$.wheel){if(!this.buffer.hasScrollback){const ee=this.viewport.getLinesScrolled(K);if(ee===0)return;const ie=u.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(K.deltaY<0?"A":"B");let te="";for(let Y=0;Y<Math.abs(ee);Y++)te+=ie;return this.coreService.triggerDataEvent(te,!0),this.cancel(K,!0)}return this.viewport.handleWheel(K)?this.cancel(K):void 0}},{passive:!1})),this.register((0,e.addDisposableDomListener)(I,"touchstart",K=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchStart(K),this.cancel(K)},{passive:!0})),this.register((0,e.addDisposableDomListener)(I,"touchmove",K=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchMove(K)?void 0:this.cancel(K)},{passive:!1}))}refresh(B,I){var H;(H=this._renderService)===null||H===void 0||H.refreshRows(B,I)}updateCursorStyle(B){var I;!((I=this._selectionService)===null||I===void 0)&&I.shouldColumnSelect(B)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(B,I,H=0){super.scrollLines(B,I,H),this.refresh(0,this.rows-1)}paste(B){(0,c.paste)(B,this.textarea,this.coreService)}attachCustomKeyEventHandler(B){this._customKeyEventHandler=B}registerLinkProvider(B){return this.linkifier2.registerLinkProvider(B)}registerCharacterJoiner(B){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");const I=this._characterJoinerService.register(B);return this.refresh(0,this.rows-1),I}deregisterCharacterJoiner(B){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(B)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}addMarker(B){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+B)}registerDecoration(B){return this._decorationService.registerDecoration(B)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(B,I,H){this._selectionService.setSelection(B,I,H)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){var B;(B=this._selectionService)===null||B===void 0||B.clearSelection()}selectAll(){var B;(B=this._selectionService)===null||B===void 0||B.selectAll()}selectLines(B,I){var H;(H=this._selectionService)===null||H===void 0||H.selectLines(B,I)}_keyDown(B){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(B)===!1)return!1;const I=this.browser.isMac&&this.options.macOptionIsMeta&&B.altKey;if(!I&&!this._compositionHelper.keydown(B))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this._bufferService.scrollToBottom(),!1;I||B.key!=="Dead"&&B.key!=="AltGraph"||(this._unprocessedDeadKey=!0);const H=(0,n.evaluateKeyboardEvent)(B,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(B),H.type===3||H.type===2){const $=this.rows-1;return this.scrollLines(H.type===2?-$:$),this.cancel(B,!0)}return H.type===1&&this.selectAll(),!!this._isThirdLevelShift(this.browser,B)||(H.cancel&&this.cancel(B,!0),!H.key||!!(B.key&&!B.ctrlKey&&!B.altKey&&!B.metaKey&&B.key.length===1&&B.key.charCodeAt(0)>=65&&B.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(H.key!==u.C0.ETX&&H.key!==u.C0.CR||(this.textarea.value=""),this._onKey.fire({key:H.key,domEvent:B}),this._showCursor(),this.coreService.triggerDataEvent(H.key,!0),!this.optionsService.rawOptions.screenReaderMode||B.altKey||B.ctrlKey?this.cancel(B,!0):void(this._keyDownHandled=!0))))}_isThirdLevelShift(B,I){const H=B.isMac&&!this.options.macOptionIsMeta&&I.altKey&&!I.ctrlKey&&!I.metaKey||B.isWindows&&I.altKey&&I.ctrlKey&&!I.metaKey||B.isWindows&&I.getModifierState("AltGraph");return I.type==="keypress"?H:H&&(!I.keyCode||I.keyCode>47)}_keyUp(B){this._keyDownSeen=!1,this._customKeyEventHandler&&this._customKeyEventHandler(B)===!1||(function(I){return I.keyCode===16||I.keyCode===17||I.keyCode===18}(B)||this.focus(),this.updateCursorStyle(B),this._keyPressHandled=!1)}_keyPress(B){let I;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(B)===!1)return!1;if(this.cancel(B),B.charCode)I=B.charCode;else if(B.which===null||B.which===void 0)I=B.keyCode;else{if(B.which===0||B.charCode===0)return!1;I=B.which}return!(!I||(B.altKey||B.ctrlKey||B.metaKey)&&!this._isThirdLevelShift(this.browser,B)||(I=String.fromCharCode(I),this._onKey.fire({key:I,domEvent:B}),this._showCursor(),this.coreService.triggerDataEvent(I,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(B){if(B.data&&B.inputType==="insertText"&&(!B.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;const I=B.data;return this.coreService.triggerDataEvent(I,!0),this.cancel(B),!0}return!1}resize(B,I){B!==this.cols||I!==this.rows?super.resize(B,I):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(B,I){var H,$;(H=this._charSizeService)===null||H===void 0||H.measure(),($=this.viewport)===null||$===void 0||$.syncScrollArea(!0)}clear(){if(this.buffer.ybase!==0||this.buffer.y!==0){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let B=1;B<this.rows;B++)this.buffer.lines.push(this.buffer.getBlankLine(g.DEFAULT_ATTR_DATA));this.refresh(0,this.rows-1),this._onScroll.fire({position:this.buffer.ydisp,source:0})}}reset(){var B,I;this.options.rows=this.rows,this.options.cols=this.cols;const H=this._customKeyEventHandler;this._setup(),super.reset(),(B=this._selectionService)===null||B===void 0||B.reset(),this._decorationService.reset(),this._customKeyEventHandler=H,this.refresh(0,this.rows-1),(I=this.viewport)===null||I===void 0||I.syncScrollArea()}clearTextureAtlas(){var B;(B=this._renderService)===null||B===void 0||B.clearTextureAtlas()}_reportFocus(){var B;!((B=this.element)===null||B===void 0)&&B.classList.contains("focus")?this.coreService.triggerDataEvent(u.C0.ESC+"[I"):this.coreService.triggerDataEvent(u.C0.ESC+"[O")}_reportWindowsOptions(B){if(this._renderService)switch(B){case p.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:const I=this._renderService.dimensions.css.canvas.width.toFixed(0),H=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${u.C0.ESC}[4;${H};${I}t`);break;case p.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:const $=this._renderService.dimensions.css.cell.width.toFixed(0),J=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${u.C0.ESC}[6;${J};${$}t`)}}cancel(B,I){if(this.options.cancelEvents||I)return B.preventDefault(),B.stopPropagation(),!1}}t.Terminal=q},9924:(F,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TimeBasedDebouncer=void 0,t.TimeBasedDebouncer=class{constructor(r,l=1e3){this._renderCallback=r,this._debounceThresholdMS=l,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(r,l,a){this._rowCount=a,r=r!==void 0?r:0,l=l!==void 0?l:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,r):r,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,l):l;const c=Date.now();if(c-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=c,this._innerRefresh();else if(!this._additionalRefreshRequested){const u=c-this._lastRefreshMs,p=this._debounceThresholdMS-u;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0},p)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;const r=Math.max(this._rowStart,0),l=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(r,l)}}},1680:function(F,t,r){var l=this&&this.__decorate||function(e,s,o,i){var n,d=arguments.length,g=d<3?s:i===null?i=Object.getOwnPropertyDescriptor(s,o):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(e,s,o,i);else for(var S=e.length-1;S>=0;S--)(n=e[S])&&(g=(d<3?n(g):d>3?n(s,o,g):n(s,o))||g);return d>3&&g&&Object.defineProperty(s,o,g),g},a=this&&this.__param||function(e,s){return function(o,i){s(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Viewport=void 0;const c=r(844),u=r(3656),p=r(4725),v=r(2585);let _=class extends c.Disposable{constructor(e,s,o,i,n,d,g,S,h){super(),this._scrollLines=e,this._viewportElement=s,this._scrollArea=o,this._bufferService=i,this._optionsService=n,this._charSizeService=d,this._renderService=g,this._coreBrowserService=S,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register((0,u.addDisposableDomListener)(this._viewportElement,"scroll",this._handleScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(D=>this._activeBuffer=D.activeBuffer)),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange(D=>this._renderDimensions=D)),this._handleThemeChange(h.colors),this.register(h.onChangeColors(D=>this._handleThemeChange(D))),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.syncScrollArea())),setTimeout(()=>this.syncScrollArea(),0)}_handleThemeChange(e){this._viewportElement.style.backgroundColor=e.background.css}_refresh(e){if(e)return this._innerRefresh(),void(this._refreshAnimationFrame!==null&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));this._refreshAnimationFrame===null&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderService.dimensions.device.cell.height/this._coreBrowserService.dpr,this._currentDeviceCellHeight=this._renderService.dimensions.device.cell.height,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;const s=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderService.dimensions.css.canvas.height);this._lastRecordedBufferHeight!==s&&(this._lastRecordedBufferHeight=s,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}const e=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==e&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=e),this._refreshAnimationFrame=null}syncScrollArea(e=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(e);this._lastRecordedViewportHeight===this._renderService.dimensions.css.canvas.height&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.device.cell.height===this._currentDeviceCellHeight||this._refresh(e)}_handleScroll(e){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._scrollLines(0);const s=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._scrollLines(s)}_smoothScroll(){if(this._isDisposed||this._smoothScrollState.origin===-1||this._smoothScrollState.target===-1)return;const e=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(e*(this._smoothScrollState.target-this._smoothScrollState.origin)),e<1?this._coreBrowserService.window.requestAnimationFrame(()=>this._smoothScroll()):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(e,s){const o=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(s<0&&this._viewportElement.scrollTop!==0||s>0&&o<this._lastRecordedBufferHeight)||(e.cancelable&&e.preventDefault(),!1)}handleWheel(e){const s=this._getPixelsScrolled(e);return s!==0&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target===-1?this._smoothScrollState.target=this._viewportElement.scrollTop+s:this._smoothScrollState.target+=s,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=s,this._bubbleScroll(e,s))}_getPixelsScrolled(e){if(e.deltaY===0||e.shiftKey)return 0;let s=this._applyScrollModifier(e.deltaY,e);return e.deltaMode===WheelEvent.DOM_DELTA_LINE?s*=this._currentRowHeight:e.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(s*=this._currentRowHeight*this._bufferService.rows),s}getLinesScrolled(e){if(e.deltaY===0||e.shiftKey)return 0;let s=this._applyScrollModifier(e.deltaY,e);return e.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(s/=this._currentRowHeight+0,this._wheelPartialScroll+=s,s=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):e.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(s*=this._bufferService.rows),s}_applyScrollModifier(e,s){const o=this._optionsService.rawOptions.fastScrollModifier;return o==="alt"&&s.altKey||o==="ctrl"&&s.ctrlKey||o==="shift"&&s.shiftKey?e*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:e*this._optionsService.rawOptions.scrollSensitivity}handleTouchStart(e){this._lastTouchY=e.touches[0].pageY}handleTouchMove(e){const s=this._lastTouchY-e.touches[0].pageY;return this._lastTouchY=e.touches[0].pageY,s!==0&&(this._viewportElement.scrollTop+=s,this._bubbleScroll(e,s))}};_=l([a(3,v.IBufferService),a(4,v.IOptionsService),a(5,p.ICharSizeService),a(6,p.IRenderService),a(7,p.ICoreBrowserService),a(8,p.IThemeService)],_),t.Viewport=_},3107:function(F,t,r){var l=this&&this.__decorate||function(e,s,o,i){var n,d=arguments.length,g=d<3?s:i===null?i=Object.getOwnPropertyDescriptor(s,o):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(e,s,o,i);else for(var S=e.length-1;S>=0;S--)(n=e[S])&&(g=(d<3?n(g):d>3?n(s,o,g):n(s,o))||g);return d>3&&g&&Object.defineProperty(s,o,g),g},a=this&&this.__param||function(e,s){return function(o,i){s(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BufferDecorationRenderer=void 0;const c=r(3656),u=r(4725),p=r(844),v=r(2585);let _=class extends p.Disposable{constructor(e,s,o,i){super(),this._screenElement=e,this._bufferService=s,this._decorationService=o,this._renderService=i,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange(()=>this._doRefreshDecorations())),this.register(this._renderService.onDimensionsChange(()=>{this._dimensionsChanged=!0,this._queueRefresh()})),this.register((0,c.addDisposableDomListener)(window,"resize",()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt})),this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh())),this.register(this._decorationService.onDecorationRemoved(n=>this._removeDecoration(n))),this.register((0,p.toDisposable)(()=>{this._container.remove(),this._decorationElements.clear()}))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback(()=>{this._doRefreshDecorations(),this._animationFrame=void 0}))}_doRefreshDecorations(){for(const e of this._decorationService.decorations)this._renderDecoration(e);this._dimensionsChanged=!1}_renderDecoration(e){this._refreshStyle(e),this._dimensionsChanged&&this._refreshXPosition(e)}_createElement(e){var s;const o=document.createElement("div");o.classList.add("xterm-decoration"),o.style.width=`${Math.round((e.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,o.style.height=(e.options.height||1)*this._renderService.dimensions.css.cell.height+"px",o.style.top=(e.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height+"px",o.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;const i=(s=e.options.x)!==null&&s!==void 0?s:0;return i&&i>this._bufferService.cols&&(o.style.display="none"),this._refreshXPosition(e,o),o}_refreshStyle(e){const s=e.marker.line-this._bufferService.buffers.active.ydisp;if(s<0||s>=this._bufferService.rows)e.element&&(e.element.style.display="none",e.onRenderEmitter.fire(e.element));else{let o=this._decorationElements.get(e);o||(o=this._createElement(e),e.element=o,this._decorationElements.set(e,o),this._container.appendChild(o)),o.style.top=s*this._renderService.dimensions.css.cell.height+"px",o.style.display=this._altBufferIsActive?"none":"block",e.onRenderEmitter.fire(o)}}_refreshXPosition(e,s=e.element){var o;if(!s)return;const i=(o=e.options.x)!==null&&o!==void 0?o:0;(e.options.anchor||"left")==="right"?s.style.right=i?i*this._renderService.dimensions.css.cell.width+"px":"":s.style.left=i?i*this._renderService.dimensions.css.cell.width+"px":""}_removeDecoration(e){var s;(s=this._decorationElements.get(e))===null||s===void 0||s.remove(),this._decorationElements.delete(e),e.dispose()}};_=l([a(1,v.IBufferService),a(2,v.IDecorationService),a(3,u.IRenderService)],_),t.BufferDecorationRenderer=_},5871:(F,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ColorZoneStore=void 0,t.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(r){if(r.options.overviewRulerOptions){for(const l of this._zones)if(l.color===r.options.overviewRulerOptions.color&&l.position===r.options.overviewRulerOptions.position){if(this._lineIntersectsZone(l,r.marker.line))return;if(this._lineAdjacentToZone(l,r.marker.line,r.options.overviewRulerOptions.position))return void this._addLineToZone(l,r.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=r.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=r.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=r.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=r.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:r.options.overviewRulerOptions.color,position:r.options.overviewRulerOptions.position,startBufferLine:r.marker.line,endBufferLine:r.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(r){this._linePadding=r}_lineIntersectsZone(r,l){return l>=r.startBufferLine&&l<=r.endBufferLine}_lineAdjacentToZone(r,l,a){return l>=r.startBufferLine-this._linePadding[a||"full"]&&l<=r.endBufferLine+this._linePadding[a||"full"]}_addLineToZone(r,l){r.startBufferLine=Math.min(r.startBufferLine,l),r.endBufferLine=Math.max(r.endBufferLine,l)}}},5744:function(F,t,r){var l=this&&this.__decorate||function(n,d,g,S){var h,D=arguments.length,y=D<3?d:S===null?S=Object.getOwnPropertyDescriptor(d,g):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(n,d,g,S);else for(var L=n.length-1;L>=0;L--)(h=n[L])&&(y=(D<3?h(y):D>3?h(d,g,y):h(d,g))||y);return D>3&&y&&Object.defineProperty(d,g,y),y},a=this&&this.__param||function(n,d){return function(g,S){d(g,S,n)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OverviewRulerRenderer=void 0;const c=r(5871),u=r(3656),p=r(4725),v=r(844),_=r(2585),e={full:0,left:0,center:0,right:0},s={full:0,left:0,center:0,right:0},o={full:0,left:0,center:0,right:0};let i=class extends v.Disposable{constructor(n,d,g,S,h,D,y){var L;super(),this._viewportElement=n,this._screenElement=d,this._bufferService=g,this._decorationService=S,this._renderService=h,this._optionsService=D,this._coreBrowseService=y,this._colorZoneStore=new c.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=document.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),(L=this._viewportElement.parentElement)===null||L===void 0||L.insertBefore(this._canvas,this._viewportElement);const A=this._canvas.getContext("2d");if(!A)throw new Error("Ctx cannot be null");this._ctx=A,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners(),this.register((0,v.toDisposable)(()=>{var M;(M=this._canvas)===null||M===void 0||M.remove()}))}get _width(){return this._optionsService.options.overviewRulerWidth||0}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh(void 0,!0))),this.register(this._decorationService.onDecorationRemoved(()=>this._queueRefresh(void 0,!0)))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange(()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"})),this.register(this._bufferService.onScroll(()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())}))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender(()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)})),this.register(this._optionsService.onSpecificOptionChange("overviewRulerWidth",()=>this._queueRefresh(!0))),this.register((0,u.addDisposableDomListener)(this._coreBrowseService.window,"resize",()=>this._queueRefresh(!0))),this._queueRefresh(!0)}_refreshDrawConstants(){const n=Math.floor(this._canvas.width/3),d=Math.ceil(this._canvas.width/3);s.full=this._canvas.width,s.left=n,s.center=d,s.right=n,this._refreshDrawHeightConstants(),o.full=0,o.left=0,o.center=s.left,o.right=s.left+s.center}_refreshDrawHeightConstants(){e.full=Math.round(2*this._coreBrowseService.dpr);const n=this._canvas.height/this._bufferService.buffer.lines.length,d=Math.round(Math.max(Math.min(n,12),6)*this._coreBrowseService.dpr);e.left=d,e.center=d,e.right=d}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*e.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*e.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*e.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*e.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowseService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowseService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(const d of this._decorationService.decorations)this._colorZoneStore.addDecoration(d);this._ctx.lineWidth=1;const n=this._colorZoneStore.zones;for(const d of n)d.position!=="full"&&this._renderColorZone(d);for(const d of n)d.position==="full"&&this._renderColorZone(d);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(n){this._ctx.fillStyle=n.color,this._ctx.fillRect(o[n.position||"full"],Math.round((this._canvas.height-1)*(n.startBufferLine/this._bufferService.buffers.active.lines.length)-e[n.position||"full"]/2),s[n.position||"full"],Math.round((this._canvas.height-1)*((n.endBufferLine-n.startBufferLine)/this._bufferService.buffers.active.lines.length)+e[n.position||"full"]))}_queueRefresh(n,d){this._shouldUpdateDimensions=n||this._shouldUpdateDimensions,this._shouldUpdateAnchor=d||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowseService.window.requestAnimationFrame(()=>{this._refreshDecorations(),this._animationFrame=void 0}))}};i=l([a(2,_.IBufferService),a(3,_.IDecorationService),a(4,p.IRenderService),a(5,_.IOptionsService),a(6,p.ICoreBrowserService)],i),t.OverviewRulerRenderer=i},2950:function(F,t,r){var l=this&&this.__decorate||function(_,e,s,o){var i,n=arguments.length,d=n<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,s):o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(_,e,s,o);else for(var g=_.length-1;g>=0;g--)(i=_[g])&&(d=(n<3?i(d):n>3?i(e,s,d):i(e,s))||d);return n>3&&d&&Object.defineProperty(e,s,d),d},a=this&&this.__param||function(_,e){return function(s,o){e(s,o,_)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CompositionHelper=void 0;const c=r(4725),u=r(2585),p=r(2584);let v=class{constructor(_,e,s,o,i,n){this._textarea=_,this._compositionView=e,this._bufferService=s,this._optionsService=o,this._coreService=i,this._renderService=n,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}get isComposing(){return this._isComposing}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(_){this._compositionView.textContent=_.data,this.updateCompositionElements(),setTimeout(()=>{this._compositionPosition.end=this._textarea.value.length},0)}compositionend(){this._finalizeComposition(!0)}keydown(_){if(this._isComposing||this._isSendingComposition){if(_.keyCode===229||_.keyCode===16||_.keyCode===17||_.keyCode===18)return!1;this._finalizeComposition(!1)}return _.keyCode!==229||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(_){if(this._compositionView.classList.remove("active"),this._isComposing=!1,_){const e={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(()=>{if(this._isSendingComposition){let s;this._isSendingComposition=!1,e.start+=this._dataAlreadySent.length,s=this._isComposing?this._textarea.value.substring(e.start,e.end):this._textarea.value.substring(e.start),s.length>0&&this._coreService.triggerDataEvent(s,!0)}},0)}else{this._isSendingComposition=!1;const e=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(e,!0)}}_handleAnyTextareaChanges(){const _=this._textarea.value;setTimeout(()=>{if(!this._isComposing){const e=this._textarea.value,s=e.replace(_,"");this._dataAlreadySent=s,e.length>_.length?this._coreService.triggerDataEvent(s,!0):e.length<_.length?this._coreService.triggerDataEvent(`${p.C0.DEL}`,!0):e.length===_.length&&e!==_&&this._coreService.triggerDataEvent(e,!0)}},0)}updateCompositionElements(_){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){const e=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),s=this._renderService.dimensions.css.cell.height,o=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,i=e*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=i+"px",this._compositionView.style.top=o+"px",this._compositionView.style.height=s+"px",this._compositionView.style.lineHeight=s+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";const n=this._compositionView.getBoundingClientRect();this._textarea.style.left=i+"px",this._textarea.style.top=o+"px",this._textarea.style.width=Math.max(n.width,1)+"px",this._textarea.style.height=Math.max(n.height,1)+"px",this._textarea.style.lineHeight=n.height+"px"}_||setTimeout(()=>this.updateCompositionElements(!0),0)}}};v=l([a(2,u.IBufferService),a(3,u.IOptionsService),a(4,u.ICoreService),a(5,c.IRenderService)],v),t.CompositionHelper=v},9806:(F,t)=>{function r(l,a,c){const u=c.getBoundingClientRect(),p=l.getComputedStyle(c),v=parseInt(p.getPropertyValue("padding-left")),_=parseInt(p.getPropertyValue("padding-top"));return[a.clientX-u.left-v,a.clientY-u.top-_]}Object.defineProperty(t,"__esModule",{value:!0}),t.getCoords=t.getCoordsRelativeToElement=void 0,t.getCoordsRelativeToElement=r,t.getCoords=function(l,a,c,u,p,v,_,e,s){if(!v)return;const o=r(l,a,c);return o?(o[0]=Math.ceil((o[0]+(s?_/2:0))/_),o[1]=Math.ceil(o[1]/e),o[0]=Math.min(Math.max(o[0],1),u+(s?1:0)),o[1]=Math.min(Math.max(o[1],1),p),o):void 0}},9504:(F,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.moveToCellSequence=void 0;const l=r(2584);function a(e,s,o,i){const n=e-c(e,o),d=s-c(s,o),g=Math.abs(n-d)-function(S,h,D){let y=0;const L=S-c(S,D),A=h-c(h,D);for(let M=0;M<Math.abs(L-A);M++){const P=u(S,h)==="A"?-1:1,N=D.buffer.lines.get(L+P*M);N?.isWrapped&&y++}return y}(e,s,o);return _(g,v(u(e,s),i))}function c(e,s){let o=0,i=s.buffer.lines.get(e),n=i?.isWrapped;for(;n&&e>=0&&e<s.rows;)o++,i=s.buffer.lines.get(--e),n=i?.isWrapped;return o}function u(e,s){return e>s?"A":"B"}function p(e,s,o,i,n,d){let g=e,S=s,h="";for(;g!==o||S!==i;)g+=n?1:-1,n&&g>d.cols-1?(h+=d.buffer.translateBufferLineToString(S,!1,e,g),g=0,e=0,S++):!n&&g<0&&(h+=d.buffer.translateBufferLineToString(S,!1,0,e+1),g=d.cols-1,e=g,S--);return h+d.buffer.translateBufferLineToString(S,!1,e,g)}function v(e,s){const o=s?"O":"[";return l.C0.ESC+o+e}function _(e,s){e=Math.floor(e);let o="";for(let i=0;i<e;i++)o+=s;return o}t.moveToCellSequence=function(e,s,o,i){const n=o.buffer.x,d=o.buffer.y;if(!o.buffer.hasScrollback)return function(h,D,y,L,A,M){return a(D,L,A,M).length===0?"":_(p(h,D,h,D-c(D,A),!1,A).length,v("D",M))}(n,d,0,s,o,i)+a(d,s,o,i)+function(h,D,y,L,A,M){let P;P=a(D,L,A,M).length>0?L-c(L,A):D;const N=L,j=function(C,w,R,T,U,z){let V;return V=a(R,T,U,z).length>0?T-c(T,U):w,C<R&&V<=T||C>=R&&V<T?"C":"D"}(h,D,y,L,A,M);return _(p(h,P,y,N,j==="C",A).length,v(j,M))}(n,d,e,s,o,i);let g;if(d===s)return g=n>e?"D":"C",_(Math.abs(n-e),v(g,i));g=d>s?"D":"C";const S=Math.abs(d-s);return _(function(h,D){return D.cols-h}(d>s?e:n,o)+(S-1)*o.cols+1+((d>s?n:e)-1),v(g,i))}},1296:function(F,t,r){var l=this&&this.__decorate||function(h,D,y,L){var A,M=arguments.length,P=M<3?D:L===null?L=Object.getOwnPropertyDescriptor(D,y):L;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")P=Reflect.decorate(h,D,y,L);else for(var N=h.length-1;N>=0;N--)(A=h[N])&&(P=(M<3?A(P):M>3?A(D,y,P):A(D,y))||P);return M>3&&P&&Object.defineProperty(D,y,P),P},a=this&&this.__param||function(h,D){return function(y,L){D(y,L,h)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DomRenderer=void 0;const c=r(9631),u=r(3787),p=r(2223),v=r(6171),_=r(4725),e=r(8055),s=r(8460),o=r(844),i=r(2585),n="xterm-dom-renderer-owner-",d="xterm-focus";let g=1,S=class extends o.Disposable{constructor(h,D,y,L,A,M,P,N,j,C){super(),this._element=h,this._screenElement=D,this._viewportElement=y,this._linkifier2=L,this._charSizeService=M,this._optionsService=P,this._bufferService=N,this._coreBrowserService=j,this._terminalClass=g++,this._rowElements=[],this._cellToRowElements=[],this.onRequestRedraw=this.register(new s.EventEmitter).event,this._rowContainer=document.createElement("div"),this._rowContainer.classList.add("xterm-rows"),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=document.createElement("div"),this._selectionContainer.classList.add("xterm-selection"),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=(0,v.createRenderDimensions)(),this._updateDimensions(),this.register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this.register(C.onChangeColors(w=>this._injectCss(w))),this._injectCss(C.colors),this._rowFactory=A.createInstance(u.DomRendererRowFactory,document),this._element.classList.add(n+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline(w=>this._handleLinkHover(w))),this.register(this._linkifier2.onHideLinkUnderline(w=>this._handleLinkLeave(w))),this.register((0,o.toDisposable)(()=>{this._element.classList.remove(n+this._terminalClass),(0,c.removeElementFromParent)(this._rowContainer,this._selectionContainer,this._themeStyleElement,this._dimensionsStyleElement)}))}_updateDimensions(){const h=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*h,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*h),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/h),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/h),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(const y of this._rowElements)y.style.width=`${this.dimensions.css.canvas.width}px`,y.style.height=`${this.dimensions.css.cell.height}px`,y.style.lineHeight=`${this.dimensions.css.cell.height}px`,y.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));const D=`${this._terminalSelector} .xterm-rows span { display: inline-block; height: 100%; vertical-align: top; width: ${this.dimensions.css.cell.width}px}`;this._dimensionsStyleElement.textContent=D,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(h){this._themeStyleElement||(this._themeStyleElement=document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let D=`${this._terminalSelector} .xterm-rows { color: ${h.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px;}`;D+=`${this._terminalSelector} span:not(.${u.BOLD_CLASS}) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.${u.BOLD_CLASS} { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.${u.ITALIC_CLASS} { font-style: italic;}`,D+="@keyframes blink_box_shadow_"+this._terminalClass+" { 50% {  box-shadow: none; }}",D+="@keyframes blink_block_"+this._terminalClass+` { 0% {  background-color: ${h.cursor.css};  color: ${h.cursorAccent.css}; } 50% {  background-color: ${h.cursorAccent.css};  color: ${h.cursor.css}; }}`,D+=`${this._terminalSelector} .xterm-rows:not(.xterm-focus) .${u.CURSOR_CLASS}.${u.CURSOR_STYLE_BLOCK_CLASS} { outline: 1px solid ${h.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .xterm-rows.xterm-focus .${u.CURSOR_CLASS}.${u.CURSOR_BLINK_CLASS}:not(.${u.CURSOR_STYLE_BLOCK_CLASS}) { animation: blink_box_shadow_`+this._terminalClass+` 1s step-end infinite;}${this._terminalSelector} .xterm-rows.xterm-focus .${u.CURSOR_CLASS}.${u.CURSOR_BLINK_CLASS}.${u.CURSOR_STYLE_BLOCK_CLASS} { animation: blink_block_`+this._terminalClass+` 1s step-end infinite;}${this._terminalSelector} .xterm-rows.xterm-focus .${u.CURSOR_CLASS}.${u.CURSOR_STYLE_BLOCK_CLASS} { background-color: ${h.cursor.css}; color: ${h.cursorAccent.css};}${this._terminalSelector} .xterm-rows .${u.CURSOR_CLASS}.${u.CURSOR_STYLE_BAR_CLASS} { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${h.cursor.css} inset;}${this._terminalSelector} .xterm-rows .${u.CURSOR_CLASS}.${u.CURSOR_STYLE_UNDERLINE_CLASS} { box-shadow: 0 -1px 0 ${h.cursor.css} inset;}`,D+=`${this._terminalSelector} .xterm-selection { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .xterm-selection div { position: absolute; background-color: ${h.selectionBackgroundOpaque.css};}${this._terminalSelector} .xterm-selection div { position: absolute; background-color: ${h.selectionInactiveBackgroundOpaque.css};}`;for(const[y,L]of h.ansi.entries())D+=`${this._terminalSelector} .xterm-fg-${y} { color: ${L.css}; }${this._terminalSelector} .xterm-bg-${y} { background-color: ${L.css}; }`;D+=`${this._terminalSelector} .xterm-fg-${p.INVERTED_DEFAULT_COLOR} { color: ${e.color.opaque(h.background).css}; }${this._terminalSelector} .xterm-bg-${p.INVERTED_DEFAULT_COLOR} { background-color: ${h.foreground.css}; }`,this._themeStyleElement.textContent=D}handleDevicePixelRatioChange(){this._updateDimensions()}_refreshRowElements(h,D){for(let y=this._rowElements.length;y<=D;y++){const L=document.createElement("div");this._rowContainer.appendChild(L),this._rowElements.push(L)}for(;this._rowElements.length>D;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(h,D){this._refreshRowElements(h,D),this._updateDimensions()}handleCharSizeChanged(){this._updateDimensions()}handleBlur(){this._rowContainer.classList.remove(d)}handleFocus(){this._rowContainer.classList.add(d)}handleSelectionChanged(h,D,y){for(;this._selectionContainer.children.length;)this._selectionContainer.removeChild(this._selectionContainer.children[0]);if(this._rowFactory.handleSelectionChanged(h,D,y),this.renderRows(0,this._bufferService.rows-1),!h||!D)return;const L=h[1]-this._bufferService.buffer.ydisp,A=D[1]-this._bufferService.buffer.ydisp,M=Math.max(L,0),P=Math.min(A,this._bufferService.rows-1);if(M>=this._bufferService.rows||P<0)return;const N=document.createDocumentFragment();if(y){const j=h[0]>D[0];N.appendChild(this._createSelectionElement(M,j?D[0]:h[0],j?h[0]:D[0],P-M+1))}else{const j=L===M?h[0]:0,C=M===A?D[0]:this._bufferService.cols;N.appendChild(this._createSelectionElement(M,j,C));const w=P-M-1;if(N.appendChild(this._createSelectionElement(M+1,0,this._bufferService.cols,w)),M!==P){const R=A===P?D[0]:this._bufferService.cols;N.appendChild(this._createSelectionElement(P,0,R))}}this._selectionContainer.appendChild(N)}_createSelectionElement(h,D,y,L=1){const A=document.createElement("div");return A.style.height=L*this.dimensions.css.cell.height+"px",A.style.top=h*this.dimensions.css.cell.height+"px",A.style.left=D*this.dimensions.css.cell.width+"px",A.style.width=this.dimensions.css.cell.width*(y-D)+"px",A}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions()}clear(){for(const h of this._rowElements)h.replaceChildren()}renderRows(h,D){const y=this._bufferService.buffer.ybase+this._bufferService.buffer.y,L=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),A=this._optionsService.rawOptions.cursorBlink;for(let M=h;M<=D;M++){const P=this._rowElements[M],N=M+this._bufferService.buffer.ydisp,j=this._bufferService.buffer.lines.get(N),C=this._optionsService.rawOptions.cursorStyle;this._cellToRowElements[M]&&this._cellToRowElements[M].length===this._bufferService.cols||(this._cellToRowElements[M]=new Int16Array(this._bufferService.cols)),P.replaceChildren(this._rowFactory.createRow(j,N,N===y,C,L,A,this.dimensions.css.cell.width,this._bufferService.cols,this._cellToRowElements[M]))}}get _terminalSelector(){return`.${n}${this._terminalClass}`}_handleLinkHover(h){this._setCellUnderline(h.x1,h.x2,h.y1,h.y2,h.cols,!0)}_handleLinkLeave(h){this._setCellUnderline(h.x1,h.x2,h.y1,h.y2,h.cols,!1)}_setCellUnderline(h,D,y,L,A,M){if(h=this._cellToRowElements[y][h],D=this._cellToRowElements[L][D],h!==-1&&D!==-1)for(;h!==D||y!==L;){const P=this._rowElements[y];if(!P)return;const N=P.children[h];N&&(N.style.textDecoration=M?"underline":"none"),++h>=A&&(h=0,y++)}}};S=l([a(4,i.IInstantiationService),a(5,_.ICharSizeService),a(6,i.IOptionsService),a(7,i.IBufferService),a(8,_.ICoreBrowserService),a(9,_.IThemeService)],S),t.DomRenderer=S},3787:function(F,t,r){var l=this&&this.__decorate||function(g,S,h,D){var y,L=arguments.length,A=L<3?S:D===null?D=Object.getOwnPropertyDescriptor(S,h):D;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")A=Reflect.decorate(g,S,h,D);else for(var M=g.length-1;M>=0;M--)(y=g[M])&&(A=(L<3?y(A):L>3?y(S,h,A):y(S,h))||A);return L>3&&A&&Object.defineProperty(S,h,A),A},a=this&&this.__param||function(g,S){return function(h,D){S(h,D,g)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DomRendererRowFactory=t.CURSOR_STYLE_UNDERLINE_CLASS=t.CURSOR_STYLE_BAR_CLASS=t.CURSOR_STYLE_BLOCK_CLASS=t.CURSOR_BLINK_CLASS=t.CURSOR_CLASS=t.STRIKETHROUGH_CLASS=t.UNDERLINE_CLASS=t.ITALIC_CLASS=t.DIM_CLASS=t.BOLD_CLASS=void 0;const c=r(2223),u=r(643),p=r(511),v=r(2585),_=r(8055),e=r(4725),s=r(4269),o=r(6171),i=r(3734);t.BOLD_CLASS="xterm-bold",t.DIM_CLASS="xterm-dim",t.ITALIC_CLASS="xterm-italic",t.UNDERLINE_CLASS="xterm-underline",t.STRIKETHROUGH_CLASS="xterm-strikethrough",t.CURSOR_CLASS="xterm-cursor",t.CURSOR_BLINK_CLASS="xterm-cursor-blink",t.CURSOR_STYLE_BLOCK_CLASS="xterm-cursor-block",t.CURSOR_STYLE_BAR_CLASS="xterm-cursor-bar",t.CURSOR_STYLE_UNDERLINE_CLASS="xterm-cursor-underline";let n=class{constructor(g,S,h,D,y,L,A){this._document=g,this._characterJoinerService=S,this._optionsService=h,this._coreBrowserService=D,this._coreService=y,this._decorationService=L,this._themeService=A,this._workCell=new p.CellData,this._columnSelectMode=!1}handleSelectionChanged(g,S,h){this._selectionStart=g,this._selectionEnd=S,this._columnSelectMode=h}createRow(g,S,h,D,y,L,A,M,P){const N=this._document.createDocumentFragment(),j=this._characterJoinerService.getJoinedCharacters(S);let C=0;for(let U=Math.min(g.length,M)-1;U>=0;U--)if(g.loadCell(U,this._workCell).getCode()!==u.NULL_CELL_CODE||h&&U===y){C=U+1;break}const w=this._themeService.colors;let R=-1,T=0;for(;T<C;T++){g.loadCell(T,this._workCell);let U=this._workCell.getWidth();if(U===0){P[T]=R;continue}let z=!1,V=T,W=this._workCell;if(j.length>0&&T===j[0][0]){z=!0;const Y=j.shift();W=new s.JoinedCellData(this._workCell,g.translateToString(!0,Y[0],Y[1]),Y[1]-Y[0]),V=Y[1]-1,U=W.getWidth()}const q=this._document.createElement("span");if(U>1&&(q.style.width=A*U+"px"),z&&(q.style.display="inline",y>=T&&y<=V&&(y=T)),!this._coreService.isCursorHidden&&h&&T===y)switch(q.classList.add(t.CURSOR_CLASS),L&&q.classList.add(t.CURSOR_BLINK_CLASS),D){case"bar":q.classList.add(t.CURSOR_STYLE_BAR_CLASS);break;case"underline":q.classList.add(t.CURSOR_STYLE_UNDERLINE_CLASS);break;default:q.classList.add(t.CURSOR_STYLE_BLOCK_CLASS)}if(W.isBold()&&q.classList.add(t.BOLD_CLASS),W.isItalic()&&q.classList.add(t.ITALIC_CLASS),W.isDim()&&q.classList.add(t.DIM_CLASS),W.isInvisible()?q.textContent=u.WHITESPACE_CELL_CHAR:q.textContent=W.getChars()||u.WHITESPACE_CELL_CHAR,W.isUnderline()&&(q.classList.add(`${t.UNDERLINE_CLASS}-${W.extended.underlineStyle}`),q.textContent===" "&&(q.textContent=" "),!W.isUnderlineColorDefault()))if(W.isUnderlineColorRGB())q.style.textDecorationColor=`rgb(${i.AttributeData.toColorRGB(W.getUnderlineColor()).join(",")})`;else{let Y=W.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&W.isBold()&&Y<8&&(Y+=8),q.style.textDecorationColor=w.ansi[Y].css}W.isStrikethrough()&&q.classList.add(t.STRIKETHROUGH_CLASS);let x=W.getFgColor(),B=W.getFgColorMode(),I=W.getBgColor(),H=W.getBgColorMode();const $=!!W.isInverse();if($){const Y=x;x=I,I=Y;const Mt=B;B=H,H=Mt}let J,K,ee=!1;this._decorationService.forEachDecorationAtCell(T,S,void 0,Y=>{Y.options.layer!=="top"&&ee||(Y.backgroundColorRGB&&(H=50331648,I=Y.backgroundColorRGB.rgba>>8&16777215,J=Y.backgroundColorRGB),Y.foregroundColorRGB&&(B=50331648,x=Y.foregroundColorRGB.rgba>>8&16777215,K=Y.foregroundColorRGB),ee=Y.options.layer==="top")});const ie=this._isCellInSelection(T,S);let te;switch(ee||w.selectionForeground&&ie&&(B=50331648,x=w.selectionForeground.rgba>>8&16777215,K=w.selectionForeground),ie&&(J=this._coreBrowserService.isFocused?w.selectionBackgroundOpaque:w.selectionInactiveBackgroundOpaque,ee=!0),ee&&q.classList.add("xterm-decoration-top"),H){case 16777216:case 33554432:te=w.ansi[I],q.classList.add(`xterm-bg-${I}`);break;case 50331648:te=_.rgba.toColor(I>>16,I>>8&255,255&I),this._addStyle(q,`background-color:#${d((I>>>0).toString(16),"0",6)}`);break;default:$?(te=w.foreground,q.classList.add(`xterm-bg-${c.INVERTED_DEFAULT_COLOR}`)):te=w.background}switch(J||W.isDim()&&(J=_.color.multiplyOpacity(te,.5)),B){case 16777216:case 33554432:W.isBold()&&x<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(x+=8),this._applyMinimumContrast(q,te,w.ansi[x],W,J,void 0)||q.classList.add(`xterm-fg-${x}`);break;case 50331648:const Y=_.rgba.toColor(x>>16&255,x>>8&255,255&x);this._applyMinimumContrast(q,te,Y,W,J,K)||this._addStyle(q,`color:#${d(x.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(q,te,w.foreground,W,J,void 0)||$&&q.classList.add(`xterm-fg-${c.INVERTED_DEFAULT_COLOR}`)}N.appendChild(q),P[T]=++R,T=V}return T<M-1&&P.subarray(T).fill(++R),N}_applyMinimumContrast(g,S,h,D,y,L){if(this._optionsService.rawOptions.minimumContrastRatio===1||(0,o.excludeFromContrastRatioDemands)(D.getCode()))return!1;let A;return y||L||(A=this._themeService.colors.contrastCache.getColor(S.rgba,h.rgba)),A===void 0&&(A=_.color.ensureContrastRatio(y||S,L||h,this._optionsService.rawOptions.minimumContrastRatio),this._themeService.colors.contrastCache.setColor((y||S).rgba,(L||h).rgba,A??null)),!!A&&(this._addStyle(g,`color:${A.css}`),!0)}_addStyle(g,S){g.setAttribute("style",`${g.getAttribute("style")||""}${S};`)}_isCellInSelection(g,S){const h=this._selectionStart,D=this._selectionEnd;return!(!h||!D)&&(this._columnSelectMode?h[0]<=D[0]?g>=h[0]&&S>=h[1]&&g<D[0]&&S<=D[1]:g<h[0]&&S>=h[1]&&g>=D[0]&&S<=D[1]:S>h[1]&&S<D[1]||h[1]===D[1]&&S===h[1]&&g>=h[0]&&g<D[0]||h[1]<D[1]&&S===D[1]&&g<D[0]||h[1]<D[1]&&S===h[1]&&g>=h[0])}};function d(g,S,h){for(;g.length<h;)g=S+g;return g}n=l([a(1,e.ICharacterJoinerService),a(2,v.IOptionsService),a(3,e.ICoreBrowserService),a(4,v.ICoreService),a(5,v.IDecorationService),a(6,e.IThemeService)],n),t.DomRendererRowFactory=n},2223:(F,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TEXT_BASELINE=t.DIM_OPACITY=t.INVERTED_DEFAULT_COLOR=void 0;const l=r(6114);t.INVERTED_DEFAULT_COLOR=257,t.DIM_OPACITY=.5,t.TEXT_BASELINE=l.isFirefox||l.isLegacyEdge?"bottom":"ideographic"},6171:(F,t)=>{function r(l){return 57508<=l&&l<=57558}Object.defineProperty(t,"__esModule",{value:!0}),t.createRenderDimensions=t.excludeFromContrastRatioDemands=t.isRestrictedPowerlineGlyph=t.isPowerlineGlyph=t.throwIfFalsy=void 0,t.throwIfFalsy=function(l){if(!l)throw new Error("value must not be falsy");return l},t.isPowerlineGlyph=r,t.isRestrictedPowerlineGlyph=function(l){return 57520<=l&&l<=57527},t.excludeFromContrastRatioDemands=function(l){return r(l)||function(a){return 9472<=a&&a<=9631}(l)},t.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}}},456:(F,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionModel=void 0,t.SelectionModel=class{constructor(r){this._bufferService=r,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){const r=this.selectionStart[0]+this.selectionStartLength;return r>this._bufferService.cols?r%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(r/this._bufferService.cols)-1]:[r%this._bufferService.cols,this.selectionStart[1]+Math.floor(r/this._bufferService.cols)]:[r,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){const r=this.selectionStart[0]+this.selectionStartLength;return r>this._bufferService.cols?[r%this._bufferService.cols,this.selectionStart[1]+Math.floor(r/this._bufferService.cols)]:[Math.max(r,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){const r=this.selectionStart,l=this.selectionEnd;return!(!r||!l)&&(r[1]>l[1]||r[1]===l[1]&&r[0]>l[0])}handleTrim(r){return this.selectionStart&&(this.selectionStart[1]-=r),this.selectionEnd&&(this.selectionEnd[1]-=r),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(F,t,r){var l=this&&this.__decorate||function(e,s,o,i){var n,d=arguments.length,g=d<3?s:i===null?i=Object.getOwnPropertyDescriptor(s,o):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(e,s,o,i);else for(var S=e.length-1;S>=0;S--)(n=e[S])&&(g=(d<3?n(g):d>3?n(s,o,g):n(s,o))||g);return d>3&&g&&Object.defineProperty(s,o,g),g},a=this&&this.__param||function(e,s){return function(o,i){s(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CharSizeService=void 0;const c=r(2585),u=r(8460),p=r(844);let v=class extends p.Disposable{constructor(e,s,o){super(),this._optionsService=o,this.width=0,this.height=0,this._onCharSizeChange=this.register(new u.EventEmitter),this.onCharSizeChange=this._onCharSizeChange.event,this._measureStrategy=new _(e,s,this._optionsService),this.register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],()=>this.measure()))}get hasValidSize(){return this.width>0&&this.height>0}measure(){const e=this._measureStrategy.measure();e.width===this.width&&e.height===this.height||(this.width=e.width,this.height=e.height,this._onCharSizeChange.fire())}};v=l([a(2,c.IOptionsService)],v),t.CharSizeService=v;class _{constructor(s,o,i){this._document=s,this._parentElement=o,this._optionsService=i,this._result={width:0,height:0},this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W",this._measureElement.setAttribute("aria-hidden","true"),this._parentElement.appendChild(this._measureElement)}measure(){this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`;const s=this._measureElement.getBoundingClientRect();return s.width!==0&&s.height!==0&&(this._result.width=s.width,this._result.height=Math.ceil(s.height)),this._result}}},4269:function(F,t,r){var l=this&&this.__decorate||function(s,o,i,n){var d,g=arguments.length,S=g<3?o:n===null?n=Object.getOwnPropertyDescriptor(o,i):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(s,o,i,n);else for(var h=s.length-1;h>=0;h--)(d=s[h])&&(S=(g<3?d(S):g>3?d(o,i,S):d(o,i))||S);return g>3&&S&&Object.defineProperty(o,i,S),S},a=this&&this.__param||function(s,o){return function(i,n){o(i,n,s)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CharacterJoinerService=t.JoinedCellData=void 0;const c=r(3734),u=r(643),p=r(511),v=r(2585);class _ extends c.AttributeData{constructor(o,i,n){super(),this.content=0,this.combinedData="",this.fg=o.fg,this.bg=o.bg,this.combinedData=i,this._width=n}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(o){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}t.JoinedCellData=_;let e=class wt{constructor(o){this._bufferService=o,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new p.CellData}register(o){const i={id:this._nextCharacterJoinerId++,handler:o};return this._characterJoiners.push(i),i.id}deregister(o){for(let i=0;i<this._characterJoiners.length;i++)if(this._characterJoiners[i].id===o)return this._characterJoiners.splice(i,1),!0;return!1}getJoinedCharacters(o){if(this._characterJoiners.length===0)return[];const i=this._bufferService.buffer.lines.get(o);if(!i||i.length===0)return[];const n=[],d=i.translateToString(!0);let g=0,S=0,h=0,D=i.getFg(0),y=i.getBg(0);for(let L=0;L<i.getTrimmedLength();L++)if(i.loadCell(L,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==D||this._workCell.bg!==y){if(L-g>1){const A=this._getJoinedRanges(d,h,S,i,g);for(let M=0;M<A.length;M++)n.push(A[M])}g=L,h=S,D=this._workCell.fg,y=this._workCell.bg}S+=this._workCell.getChars().length||u.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-g>1){const L=this._getJoinedRanges(d,h,S,i,g);for(let A=0;A<L.length;A++)n.push(L[A])}return n}_getJoinedRanges(o,i,n,d,g){const S=o.substring(i,n);let h=[];try{h=this._characterJoiners[0].handler(S)}catch(D){console.error(D)}for(let D=1;D<this._characterJoiners.length;D++)try{const y=this._characterJoiners[D].handler(S);for(let L=0;L<y.length;L++)wt._mergeRanges(h,y[L])}catch(y){console.error(y)}return this._stringRangesToCellRanges(h,d,g),h}_stringRangesToCellRanges(o,i,n){let d=0,g=!1,S=0,h=o[d];if(h){for(let D=n;D<this._bufferService.cols;D++){const y=i.getWidth(D),L=i.getString(D).length||u.WHITESPACE_CELL_CHAR.length;if(y!==0){if(!g&&h[0]<=S&&(h[0]=D,g=!0),h[1]<=S){if(h[1]=D,h=o[++d],!h)break;h[0]<=S?(h[0]=D,g=!0):g=!1}S+=L}}h&&(h[1]=this._bufferService.cols)}}static _mergeRanges(o,i){let n=!1;for(let d=0;d<o.length;d++){const g=o[d];if(n){if(i[1]<=g[0])return o[d-1][1]=i[1],o;if(i[1]<=g[1])return o[d-1][1]=Math.max(i[1],g[1]),o.splice(d,1),o;o.splice(d,1),d--}else{if(i[1]<=g[0])return o.splice(d,0,i),o;if(i[1]<=g[1])return g[0]=Math.min(i[0],g[0]),o;i[0]<g[1]&&(g[0]=Math.min(i[0],g[0]),n=!0)}}return n?o[o.length-1][1]=i[1]:o.push(i),o}};e=l([a(0,v.IBufferService)],e),t.CharacterJoinerService=e},5114:(F,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CoreBrowserService=void 0,t.CoreBrowserService=class{constructor(r,l){this._textarea=r,this.window=l,this._isFocused=!1,this._cachedIsFocused=void 0,this._textarea.addEventListener("focus",()=>this._isFocused=!0),this._textarea.addEventListener("blur",()=>this._isFocused=!1)}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(()=>this._cachedIsFocused=void 0)),this._cachedIsFocused}}},8934:function(F,t,r){var l=this&&this.__decorate||function(v,_,e,s){var o,i=arguments.length,n=i<3?_:s===null?s=Object.getOwnPropertyDescriptor(_,e):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(v,_,e,s);else for(var d=v.length-1;d>=0;d--)(o=v[d])&&(n=(i<3?o(n):i>3?o(_,e,n):o(_,e))||n);return i>3&&n&&Object.defineProperty(_,e,n),n},a=this&&this.__param||function(v,_){return function(e,s){_(e,s,v)}};Object.defineProperty(t,"__esModule",{value:!0}),t.MouseService=void 0;const c=r(4725),u=r(9806);let p=class{constructor(v,_){this._renderService=v,this._charSizeService=_}getCoords(v,_,e,s,o){return(0,u.getCoords)(window,v,_,e,s,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,o)}getMouseReportCoords(v,_){const e=(0,u.getCoordsRelativeToElement)(window,v,_);if(!(!this._charSizeService.hasValidSize||e[0]<0||e[1]<0||e[0]>=this._renderService.dimensions.css.canvas.width||e[1]>=this._renderService.dimensions.css.canvas.height))return{col:Math.floor(e[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(e[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(e[0]),y:Math.floor(e[1])}}};p=l([a(0,c.IRenderService),a(1,c.ICharSizeService)],p),t.MouseService=p},3230:function(F,t,r){var l=this&&this.__decorate||function(n,d,g,S){var h,D=arguments.length,y=D<3?d:S===null?S=Object.getOwnPropertyDescriptor(d,g):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(n,d,g,S);else for(var L=n.length-1;L>=0;L--)(h=n[L])&&(y=(D<3?h(y):D>3?h(d,g,y):h(d,g))||y);return D>3&&y&&Object.defineProperty(d,g,y),y},a=this&&this.__param||function(n,d){return function(g,S){d(g,S,n)}};Object.defineProperty(t,"__esModule",{value:!0}),t.RenderService=void 0;const c=r(6193),u=r(8460),p=r(844),v=r(5596),_=r(3656),e=r(2585),s=r(4725),o=r(7226);let i=class extends p.Disposable{constructor(n,d,g,S,h,D,y,L){if(super(),this._rowCount=n,this._charSizeService=S,this._pausedResizeTask=new o.DebouncedIdleTask,this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this.register(new u.EventEmitter),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this.register(new u.EventEmitter),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this.register(new u.EventEmitter),this.onRender=this._onRender.event,this._onRefreshRequest=this.register(new u.EventEmitter),this.onRefreshRequest=this._onRefreshRequest.event,this.register({dispose:()=>{var A;return(A=this._renderer)===null||A===void 0?void 0:A.dispose()}}),this._renderDebouncer=new c.RenderDebouncer(y.window,(A,M)=>this._renderRows(A,M)),this.register(this._renderDebouncer),this._screenDprMonitor=new v.ScreenDprMonitor(y.window),this._screenDprMonitor.setListener(()=>this.handleDevicePixelRatioChange()),this.register(this._screenDprMonitor),this.register(D.onResize(()=>this._fullRefresh())),this.register(D.buffers.onBufferActivate(()=>{var A;return(A=this._renderer)===null||A===void 0?void 0:A.clear()})),this.register(g.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._charSizeService.onCharSizeChange(()=>this.handleCharSizeChanged())),this.register(h.onDecorationRegistered(()=>this._fullRefresh())),this.register(h.onDecorationRemoved(()=>this._fullRefresh())),this.register(g.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio"],()=>{this.clear(),this.handleResize(D.cols,D.rows),this._fullRefresh()})),this.register(g.onMultipleOptionChange(["cursorBlink","cursorStyle"],()=>this.refreshRows(D.buffer.y,D.buffer.y,!0))),this.register((0,_.addDisposableDomListener)(y.window,"resize",()=>this.handleDevicePixelRatioChange())),this.register(L.onChangeColors(()=>this._fullRefresh())),"IntersectionObserver"in y.window){const A=new y.window.IntersectionObserver(M=>this._handleIntersectionChange(M[M.length-1]),{threshold:0});A.observe(d),this.register({dispose:()=>A.disconnect()})}}get dimensions(){return this._renderer.dimensions}_handleIntersectionChange(n){this._isPaused=n.isIntersecting===void 0?n.intersectionRatio===0:!n.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(n,d,g=!1){this._isPaused?this._needsFullRefresh=!0:(g||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(n,d,this._rowCount))}_renderRows(n,d){this._renderer&&(this._renderer.renderRows(n,d),this._needsSelectionRefresh&&(this._renderer.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:n,end:d}),this._onRender.fire({start:n,end:d}),this._isNextRenderRedrawOnly=!0)}resize(n,d){this._rowCount=d,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer&&(this._renderer.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.dimensions))}hasRenderer(){return!!this._renderer}setRenderer(n){var d;(d=this._renderer)===null||d===void 0||d.dispose(),this._renderer=n,this._renderer.onRequestRedraw(g=>this.refreshRows(g.start,g.end,!0)),this._needsSelectionRefresh=!0,this._fullRefresh()}addRefreshCallback(n){return this._renderDebouncer.addRefreshCallback(n)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){var n,d;this._renderer&&((d=(n=this._renderer).clearTextureAtlas)===null||d===void 0||d.call(n),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer&&(this._renderer.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(n,d){this._renderer&&(this._isPaused?this._pausedResizeTask.set(()=>this._renderer.handleResize(n,d)):this._renderer.handleResize(n,d),this._fullRefresh())}handleCharSizeChanged(){var n;(n=this._renderer)===null||n===void 0||n.handleCharSizeChanged()}handleBlur(){var n;(n=this._renderer)===null||n===void 0||n.handleBlur()}handleFocus(){var n;(n=this._renderer)===null||n===void 0||n.handleFocus()}handleSelectionChanged(n,d,g){var S;this._selectionState.start=n,this._selectionState.end=d,this._selectionState.columnSelectMode=g,(S=this._renderer)===null||S===void 0||S.handleSelectionChanged(n,d,g)}handleCursorMove(){var n;(n=this._renderer)===null||n===void 0||n.handleCursorMove()}clear(){var n;(n=this._renderer)===null||n===void 0||n.clear()}};i=l([a(2,e.IOptionsService),a(3,s.ICharSizeService),a(4,e.IDecorationService),a(5,e.IBufferService),a(6,s.ICoreBrowserService),a(7,s.IThemeService)],i),t.RenderService=i},9312:function(F,t,r){var l=this&&this.__decorate||function(h,D,y,L){var A,M=arguments.length,P=M<3?D:L===null?L=Object.getOwnPropertyDescriptor(D,y):L;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")P=Reflect.decorate(h,D,y,L);else for(var N=h.length-1;N>=0;N--)(A=h[N])&&(P=(M<3?A(P):M>3?A(D,y,P):A(D,y))||P);return M>3&&P&&Object.defineProperty(D,y,P),P},a=this&&this.__param||function(h,D){return function(y,L){D(y,L,h)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionService=void 0;const c=r(6114),u=r(456),p=r(511),v=r(8460),_=r(4725),e=r(2585),s=r(9806),o=r(9504),i=r(844),n=r(4841),d=String.fromCharCode(160),g=new RegExp(d,"g");let S=class extends i.Disposable{constructor(h,D,y,L,A,M,P,N,j){super(),this._element=h,this._screenElement=D,this._linkifier=y,this._bufferService=L,this._coreService=A,this._mouseService=M,this._optionsService=P,this._renderService=N,this._coreBrowserService=j,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new p.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new v.EventEmitter),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this.register(new v.EventEmitter),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this.register(new v.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this.register(new v.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=C=>this._handleMouseMove(C),this._mouseUpListener=C=>this._handleMouseUp(C),this._coreService.onUserInput(()=>{this.hasSelection&&this.clearSelection()}),this._trimListener=this._bufferService.buffer.lines.onTrim(C=>this._handleTrim(C)),this.register(this._bufferService.buffers.onBufferActivate(C=>this._handleBufferActivate(C))),this.enable(),this._model=new u.SelectionModel(this._bufferService),this._activeSelectionMode=0,this.register((0,i.toDisposable)(()=>{this._removeMouseDownListeners()}))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){const h=this._model.finalSelectionStart,D=this._model.finalSelectionEnd;return!(!h||!D||h[0]===D[0]&&h[1]===D[1])}get selectionText(){const h=this._model.finalSelectionStart,D=this._model.finalSelectionEnd;if(!h||!D)return"";const y=this._bufferService.buffer,L=[];if(this._activeSelectionMode===3){if(h[0]===D[0])return"";const A=h[0]<D[0]?h[0]:D[0],M=h[0]<D[0]?D[0]:h[0];for(let P=h[1];P<=D[1];P++){const N=y.translateBufferLineToString(P,!0,A,M);L.push(N)}}else{const A=h[1]===D[1]?D[0]:void 0;L.push(y.translateBufferLineToString(h[1],!0,h[0],A));for(let M=h[1]+1;M<=D[1]-1;M++){const P=y.lines.get(M),N=y.translateBufferLineToString(M,!0);P?.isWrapped?L[L.length-1]+=N:L.push(N)}if(h[1]!==D[1]){const M=y.lines.get(D[1]),P=y.translateBufferLineToString(D[1],!0,0,D[0]);M&&M.isWrapped?L[L.length-1]+=P:L.push(P)}}return L.map(A=>A.replace(g," ")).join(c.isWindows?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(h){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._refresh())),c.isLinux&&h&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(h){const D=this._getMouseBufferCoords(h),y=this._model.finalSelectionStart,L=this._model.finalSelectionEnd;return!!(y&&L&&D)&&this._areCoordsInSelection(D,y,L)}isCellInSelection(h,D){const y=this._model.finalSelectionStart,L=this._model.finalSelectionEnd;return!(!y||!L)&&this._areCoordsInSelection([h,D],y,L)}_areCoordsInSelection(h,D,y){return h[1]>D[1]&&h[1]<y[1]||D[1]===y[1]&&h[1]===D[1]&&h[0]>=D[0]&&h[0]<y[0]||D[1]<y[1]&&h[1]===y[1]&&h[0]<y[0]||D[1]<y[1]&&h[1]===D[1]&&h[0]>=D[0]}_selectWordAtCursor(h,D){var y,L;const A=(L=(y=this._linkifier.currentLink)===null||y===void 0?void 0:y.link)===null||L===void 0?void 0:L.range;if(A)return this._model.selectionStart=[A.start.x-1,A.start.y-1],this._model.selectionStartLength=(0,n.getRangeLength)(A,this._bufferService.cols),this._model.selectionEnd=void 0,!0;const M=this._getMouseBufferCoords(h);return!!M&&(this._selectWordAt(M,D),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(h,D){this._model.clearSelection(),h=Math.max(h,0),D=Math.min(D,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,h],this._model.selectionEnd=[this._bufferService.cols,D],this.refresh(),this._onSelectionChange.fire()}_handleTrim(h){this._model.handleTrim(h)&&this.refresh()}_getMouseBufferCoords(h){const D=this._mouseService.getCoords(h,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(D)return D[0]--,D[1]--,D[1]+=this._bufferService.buffer.ydisp,D}_getMouseEventScrollAmount(h){let D=(0,s.getCoordsRelativeToElement)(this._coreBrowserService.window,h,this._screenElement)[1];const y=this._renderService.dimensions.css.canvas.height;return D>=0&&D<=y?0:(D>y&&(D-=y),D=Math.min(Math.max(D,-50),50),D/=50,D/Math.abs(D)+Math.round(14*D))}shouldForceSelection(h){return c.isMac?h.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:h.shiftKey}handleMouseDown(h){if(this._mouseDownTimeStamp=h.timeStamp,(h.button!==2||!this.hasSelection)&&h.button===0){if(!this._enabled){if(!this.shouldForceSelection(h))return;h.stopPropagation()}h.preventDefault(),this._dragScrollAmount=0,this._enabled&&h.shiftKey?this._handleIncrementalClick(h):h.detail===1?this._handleSingleClick(h):h.detail===2?this._handleDoubleClick(h):h.detail===3&&this._handleTripleClick(h),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(()=>this._dragScroll(),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(h){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(h))}_handleSingleClick(h){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(h)?3:0,this._model.selectionStart=this._getMouseBufferCoords(h),!this._model.selectionStart)return;this._model.selectionEnd=void 0;const D=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);D&&D.length!==this._model.selectionStart[0]&&D.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(h){this._selectWordAtCursor(h,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(h){const D=this._getMouseBufferCoords(h);D&&(this._activeSelectionMode=2,this._selectLineAt(D[1]))}shouldColumnSelect(h){return h.altKey&&!(c.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(h){if(h.stopImmediatePropagation(),!this._model.selectionStart)return;const D=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(h),!this._model.selectionEnd)return void this.refresh(!0);this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(h),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));const y=this._bufferService.buffer;if(this._model.selectionEnd[1]<y.lines.length){const L=y.lines.get(this._model.selectionEnd[1]);L&&L.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]++}D&&D[0]===this._model.selectionEnd[0]&&D[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});const h=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(h.ydisp+this._bufferService.rows,h.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=h.ydisp),this.refresh()}}_handleMouseUp(h){const D=h.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&D<500&&h.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){const y=this._mouseService.getCoords(h,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(y&&y[0]!==void 0&&y[1]!==void 0){const L=(0,o.moveToCellSequence)(y[0]-1,y[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(L,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){const h=this._model.finalSelectionStart,D=this._model.finalSelectionEnd,y=!(!h||!D||h[0]===D[0]&&h[1]===D[1]);y?h&&D&&(this._oldSelectionStart&&this._oldSelectionEnd&&h[0]===this._oldSelectionStart[0]&&h[1]===this._oldSelectionStart[1]&&D[0]===this._oldSelectionEnd[0]&&D[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(h,D,y)):this._oldHasSelection&&this._fireOnSelectionChange(h,D,y)}_fireOnSelectionChange(h,D,y){this._oldSelectionStart=h,this._oldSelectionEnd=D,this._oldHasSelection=y,this._onSelectionChange.fire()}_handleBufferActivate(h){this.clearSelection(),this._trimListener.dispose(),this._trimListener=h.activeBuffer.lines.onTrim(D=>this._handleTrim(D))}_convertViewportColToCharacterIndex(h,D){let y=D;for(let L=0;D>=L;L++){const A=h.loadCell(L,this._workCell).getChars().length;this._workCell.getWidth()===0?y--:A>1&&D!==L&&(y+=A-1)}return y}setSelection(h,D,y){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[h,D],this._model.selectionStartLength=y,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(h){this._isClickInSelection(h)||(this._selectWordAtCursor(h,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(h,D,y=!0,L=!0){if(h[0]>=this._bufferService.cols)return;const A=this._bufferService.buffer,M=A.lines.get(h[1]);if(!M)return;const P=A.translateBufferLineToString(h[1],!1);let N=this._convertViewportColToCharacterIndex(M,h[0]),j=N;const C=h[0]-N;let w=0,R=0,T=0,U=0;if(P.charAt(N)===" "){for(;N>0&&P.charAt(N-1)===" ";)N--;for(;j<P.length&&P.charAt(j+1)===" ";)j++}else{let W=h[0],q=h[0];M.getWidth(W)===0&&(w++,W--),M.getWidth(q)===2&&(R++,q++);const x=M.getString(q).length;for(x>1&&(U+=x-1,j+=x-1);W>0&&N>0&&!this._isCharWordSeparator(M.loadCell(W-1,this._workCell));){M.loadCell(W-1,this._workCell);const B=this._workCell.getChars().length;this._workCell.getWidth()===0?(w++,W--):B>1&&(T+=B-1,N-=B-1),N--,W--}for(;q<M.length&&j+1<P.length&&!this._isCharWordSeparator(M.loadCell(q+1,this._workCell));){M.loadCell(q+1,this._workCell);const B=this._workCell.getChars().length;this._workCell.getWidth()===2?(R++,q++):B>1&&(U+=B-1,j+=B-1),j++,q++}}j++;let z=N+C-w+T,V=Math.min(this._bufferService.cols,j-N+w+R-T-U);if(D||P.slice(N,j).trim()!==""){if(y&&z===0&&M.getCodePoint(0)!==32){const W=A.lines.get(h[1]-1);if(W&&M.isWrapped&&W.getCodePoint(this._bufferService.cols-1)!==32){const q=this._getWordAt([this._bufferService.cols-1,h[1]-1],!1,!0,!1);if(q){const x=this._bufferService.cols-q.start;z-=x,V+=x}}}if(L&&z+V===this._bufferService.cols&&M.getCodePoint(this._bufferService.cols-1)!==32){const W=A.lines.get(h[1]+1);if(W?.isWrapped&&W.getCodePoint(0)!==32){const q=this._getWordAt([0,h[1]+1],!1,!1,!0);q&&(V+=q.length)}}return{start:z,length:V}}}_selectWordAt(h,D){const y=this._getWordAt(h,D);if(y){for(;y.start<0;)y.start+=this._bufferService.cols,h[1]--;this._model.selectionStart=[y.start,h[1]],this._model.selectionStartLength=y.length}}_selectToWordAt(h){const D=this._getWordAt(h,!0);if(D){let y=h[1];for(;D.start<0;)D.start+=this._bufferService.cols,y--;if(!this._model.areSelectionValuesReversed())for(;D.start+D.length>this._bufferService.cols;)D.length-=this._bufferService.cols,y++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?D.start:D.start+D.length,y]}}_isCharWordSeparator(h){return h.getWidth()!==0&&this._optionsService.rawOptions.wordSeparator.indexOf(h.getChars())>=0}_selectLineAt(h){const D=this._bufferService.buffer.getWrappedRangeForLine(h),y={start:{x:0,y:D.first},end:{x:this._bufferService.cols-1,y:D.last}};this._model.selectionStart=[0,D.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,n.getRangeLength)(y,this._bufferService.cols)}};S=l([a(3,e.IBufferService),a(4,e.ICoreService),a(5,_.IMouseService),a(6,e.IOptionsService),a(7,_.IRenderService),a(8,_.ICoreBrowserService)],S),t.SelectionService=S},4725:(F,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IThemeService=t.ICharacterJoinerService=t.ISelectionService=t.IRenderService=t.IMouseService=t.ICoreBrowserService=t.ICharSizeService=void 0;const l=r(8343);t.ICharSizeService=(0,l.createDecorator)("CharSizeService"),t.ICoreBrowserService=(0,l.createDecorator)("CoreBrowserService"),t.IMouseService=(0,l.createDecorator)("MouseService"),t.IRenderService=(0,l.createDecorator)("RenderService"),t.ISelectionService=(0,l.createDecorator)("SelectionService"),t.ICharacterJoinerService=(0,l.createDecorator)("CharacterJoinerService"),t.IThemeService=(0,l.createDecorator)("ThemeService")},6731:function(F,t,r){var l=this&&this.__decorate||function(S,h,D,y){var L,A=arguments.length,M=A<3?h:y===null?y=Object.getOwnPropertyDescriptor(h,D):y;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")M=Reflect.decorate(S,h,D,y);else for(var P=S.length-1;P>=0;P--)(L=S[P])&&(M=(A<3?L(M):A>3?L(h,D,M):L(h,D))||M);return A>3&&M&&Object.defineProperty(h,D,M),M},a=this&&this.__param||function(S,h){return function(D,y){h(D,y,S)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ThemeService=t.DEFAULT_ANSI_COLORS=void 0;const c=r(7239),u=r(8055),p=r(8460),v=r(844),_=r(2585),e=u.css.toColor("#ffffff"),s=u.css.toColor("#000000"),o=u.css.toColor("#ffffff"),i=u.css.toColor("#000000"),n={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};t.DEFAULT_ANSI_COLORS=Object.freeze((()=>{const S=[u.css.toColor("#2e3436"),u.css.toColor("#cc0000"),u.css.toColor("#4e9a06"),u.css.toColor("#c4a000"),u.css.toColor("#3465a4"),u.css.toColor("#75507b"),u.css.toColor("#06989a"),u.css.toColor("#d3d7cf"),u.css.toColor("#555753"),u.css.toColor("#ef2929"),u.css.toColor("#8ae234"),u.css.toColor("#fce94f"),u.css.toColor("#729fcf"),u.css.toColor("#ad7fa8"),u.css.toColor("#34e2e2"),u.css.toColor("#eeeeec")],h=[0,95,135,175,215,255];for(let D=0;D<216;D++){const y=h[D/36%6|0],L=h[D/6%6|0],A=h[D%6];S.push({css:u.channels.toCss(y,L,A),rgba:u.channels.toRgba(y,L,A)})}for(let D=0;D<24;D++){const y=8+10*D;S.push({css:u.channels.toCss(y,y,y),rgba:u.channels.toRgba(y,y,y)})}return S})());let d=class extends v.Disposable{constructor(S){super(),this._optionsService=S,this._onChangeColors=this.register(new p.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._contrastCache=new c.ColorContrastCache,this._colors={foreground:e,background:s,cursor:o,cursorAccent:i,selectionForeground:void 0,selectionBackgroundTransparent:n,selectionBackgroundOpaque:u.color.blend(s,n),selectionInactiveBackgroundTransparent:n,selectionInactiveBackgroundOpaque:u.color.blend(s,n),ansi:t.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",()=>this._contrastCache.clear())),this.register(this._optionsService.onSpecificOptionChange("theme",()=>this._setTheme(this._optionsService.rawOptions.theme)))}get colors(){return this._colors}_setTheme(S={}){const h=this._colors;if(h.foreground=g(S.foreground,e),h.background=g(S.background,s),h.cursor=g(S.cursor,o),h.cursorAccent=g(S.cursorAccent,i),h.selectionBackgroundTransparent=g(S.selectionBackground,n),h.selectionBackgroundOpaque=u.color.blend(h.background,h.selectionBackgroundTransparent),h.selectionInactiveBackgroundTransparent=g(S.selectionInactiveBackground,h.selectionBackgroundTransparent),h.selectionInactiveBackgroundOpaque=u.color.blend(h.background,h.selectionInactiveBackgroundTransparent),h.selectionForeground=S.selectionForeground?g(S.selectionForeground,u.NULL_COLOR):void 0,h.selectionForeground===u.NULL_COLOR&&(h.selectionForeground=void 0),u.color.isOpaque(h.selectionBackgroundTransparent)&&(h.selectionBackgroundTransparent=u.color.opacity(h.selectionBackgroundTransparent,.3)),u.color.isOpaque(h.selectionInactiveBackgroundTransparent)&&(h.selectionInactiveBackgroundTransparent=u.color.opacity(h.selectionInactiveBackgroundTransparent,.3)),h.ansi=t.DEFAULT_ANSI_COLORS.slice(),h.ansi[0]=g(S.black,t.DEFAULT_ANSI_COLORS[0]),h.ansi[1]=g(S.red,t.DEFAULT_ANSI_COLORS[1]),h.ansi[2]=g(S.green,t.DEFAULT_ANSI_COLORS[2]),h.ansi[3]=g(S.yellow,t.DEFAULT_ANSI_COLORS[3]),h.ansi[4]=g(S.blue,t.DEFAULT_ANSI_COLORS[4]),h.ansi[5]=g(S.magenta,t.DEFAULT_ANSI_COLORS[5]),h.ansi[6]=g(S.cyan,t.DEFAULT_ANSI_COLORS[6]),h.ansi[7]=g(S.white,t.DEFAULT_ANSI_COLORS[7]),h.ansi[8]=g(S.brightBlack,t.DEFAULT_ANSI_COLORS[8]),h.ansi[9]=g(S.brightRed,t.DEFAULT_ANSI_COLORS[9]),h.ansi[10]=g(S.brightGreen,t.DEFAULT_ANSI_COLORS[10]),h.ansi[11]=g(S.brightYellow,t.DEFAULT_ANSI_COLORS[11]),h.ansi[12]=g(S.brightBlue,t.DEFAULT_ANSI_COLORS[12]),h.ansi[13]=g(S.brightMagenta,t.DEFAULT_ANSI_COLORS[13]),h.ansi[14]=g(S.brightCyan,t.DEFAULT_ANSI_COLORS[14]),h.ansi[15]=g(S.brightWhite,t.DEFAULT_ANSI_COLORS[15]),S.extendedAnsi){const D=Math.min(h.ansi.length-16,S.extendedAnsi.length);for(let y=0;y<D;y++)h.ansi[y+16]=g(S.extendedAnsi[y],t.DEFAULT_ANSI_COLORS[y+16])}this._contrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(S){this._restoreColor(S),this._onChangeColors.fire(this.colors)}_restoreColor(S){if(S!==void 0)switch(S){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[S]=this._restoreColors.ansi[S]}else for(let h=0;h<this._restoreColors.ansi.length;++h)this._colors.ansi[h]=this._restoreColors.ansi[h]}modifyColors(S){S(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function g(S,h){if(S!==void 0)try{return u.css.toColor(S)}catch{}return h}d=l([a(0,_.IOptionsService)],d),t.ThemeService=d},6349:(F,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CircularList=void 0;const l=r(8460),a=r(844);class c extends a.Disposable{constructor(p){super(),this._maxLength=p,this.onDeleteEmitter=this.register(new l.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new l.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new l.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(p){if(this._maxLength===p)return;const v=new Array(p);for(let _=0;_<Math.min(p,this.length);_++)v[_]=this._array[this._getCyclicIndex(_)];this._array=v,this._maxLength=p,this._startIndex=0}get length(){return this._length}set length(p){if(p>this._length)for(let v=this._length;v<p;v++)this._array[v]=void 0;this._length=p}get(p){return this._array[this._getCyclicIndex(p)]}set(p,v){this._array[this._getCyclicIndex(p)]=v}push(p){this._array[this._getCyclicIndex(this._length)]=p,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(p,v,..._){if(v){for(let e=p;e<this._length-v;e++)this._array[this._getCyclicIndex(e)]=this._array[this._getCyclicIndex(e+v)];this._length-=v,this.onDeleteEmitter.fire({index:p,amount:v})}for(let e=this._length-1;e>=p;e--)this._array[this._getCyclicIndex(e+_.length)]=this._array[this._getCyclicIndex(e)];for(let e=0;e<_.length;e++)this._array[this._getCyclicIndex(p+e)]=_[e];if(_.length&&this.onInsertEmitter.fire({index:p,amount:_.length}),this._length+_.length>this._maxLength){const e=this._length+_.length-this._maxLength;this._startIndex+=e,this._length=this._maxLength,this.onTrimEmitter.fire(e)}else this._length+=_.length}trimStart(p){p>this._length&&(p=this._length),this._startIndex+=p,this._length-=p,this.onTrimEmitter.fire(p)}shiftElements(p,v,_){if(!(v<=0)){if(p<0||p>=this._length)throw new Error("start argument out of range");if(p+_<0)throw new Error("Cannot shift elements in list beyond index 0");if(_>0){for(let s=v-1;s>=0;s--)this.set(p+s+_,this.get(p+s));const e=p+v+_-this._length;if(e>0)for(this._length+=e;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let e=0;e<v;e++)this.set(p+e+_,this.get(p+e))}}_getCyclicIndex(p){return(this._startIndex+p)%this._maxLength}}t.CircularList=c},1439:(F,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.clone=void 0,t.clone=function r(l,a=5){if(typeof l!="object")return l;const c=Array.isArray(l)?[]:{};for(const u in l)c[u]=a<=1?l[u]:l[u]&&r(l[u],a-1);return c}},8055:(F,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.contrastRatio=t.toPaddedHex=t.rgba=t.rgb=t.css=t.color=t.channels=t.NULL_COLOR=void 0;const l=r(6114);let a=0,c=0,u=0,p=0;var v,_,e;function s(i){const n=i.toString(16);return n.length<2?"0"+n:n}function o(i,n){return i<n?(n+.05)/(i+.05):(i+.05)/(n+.05)}t.NULL_COLOR={css:"#00000000",rgba:0},function(i){i.toCss=function(n,d,g,S){return S!==void 0?`#${s(n)}${s(d)}${s(g)}${s(S)}`:`#${s(n)}${s(d)}${s(g)}`},i.toRgba=function(n,d,g,S=255){return(n<<24|d<<16|g<<8|S)>>>0}}(v=t.channels||(t.channels={})),function(i){function n(d,g){return p=Math.round(255*g),[a,c,u]=e.toChannels(d.rgba),{css:v.toCss(a,c,u,p),rgba:v.toRgba(a,c,u,p)}}i.blend=function(d,g){if(p=(255&g.rgba)/255,p===1)return{css:g.css,rgba:g.rgba};const S=g.rgba>>24&255,h=g.rgba>>16&255,D=g.rgba>>8&255,y=d.rgba>>24&255,L=d.rgba>>16&255,A=d.rgba>>8&255;return a=y+Math.round((S-y)*p),c=L+Math.round((h-L)*p),u=A+Math.round((D-A)*p),{css:v.toCss(a,c,u),rgba:v.toRgba(a,c,u)}},i.isOpaque=function(d){return(255&d.rgba)==255},i.ensureContrastRatio=function(d,g,S){const h=e.ensureContrastRatio(d.rgba,g.rgba,S);if(h)return e.toColor(h>>24&255,h>>16&255,h>>8&255)},i.opaque=function(d){const g=(255|d.rgba)>>>0;return[a,c,u]=e.toChannels(g),{css:v.toCss(a,c,u),rgba:g}},i.opacity=n,i.multiplyOpacity=function(d,g){return p=255&d.rgba,n(d,p*g/255)},i.toColorRGB=function(d){return[d.rgba>>24&255,d.rgba>>16&255,d.rgba>>8&255]}}(t.color||(t.color={})),function(i){let n,d;if(!l.isNode){const g=document.createElement("canvas");g.width=1,g.height=1;const S=g.getContext("2d",{willReadFrequently:!0});S&&(n=S,n.globalCompositeOperation="copy",d=n.createLinearGradient(0,0,1,1))}i.toColor=function(g){if(g.match(/#[\da-f]{3,8}/i))switch(g.length){case 4:return a=parseInt(g.slice(1,2).repeat(2),16),c=parseInt(g.slice(2,3).repeat(2),16),u=parseInt(g.slice(3,4).repeat(2),16),e.toColor(a,c,u);case 5:return a=parseInt(g.slice(1,2).repeat(2),16),c=parseInt(g.slice(2,3).repeat(2),16),u=parseInt(g.slice(3,4).repeat(2),16),p=parseInt(g.slice(4,5).repeat(2),16),e.toColor(a,c,u,p);case 7:return{css:g,rgba:(parseInt(g.slice(1),16)<<8|255)>>>0};case 9:return{css:g,rgba:parseInt(g.slice(1),16)>>>0}}const S=g.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(S)return a=parseInt(S[1]),c=parseInt(S[2]),u=parseInt(S[3]),p=Math.round(255*(S[5]===void 0?1:parseFloat(S[5]))),e.toColor(a,c,u,p);if(!n||!d)throw new Error("css.toColor: Unsupported css format");if(n.fillStyle=d,n.fillStyle=g,typeof n.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(n.fillRect(0,0,1,1),[a,c,u,p]=n.getImageData(0,0,1,1).data,p!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:v.toRgba(a,c,u,p),css:g}}}(t.css||(t.css={})),function(i){function n(d,g,S){const h=d/255,D=g/255,y=S/255;return .2126*(h<=.03928?h/12.92:Math.pow((h+.055)/1.055,2.4))+.7152*(D<=.03928?D/12.92:Math.pow((D+.055)/1.055,2.4))+.0722*(y<=.03928?y/12.92:Math.pow((y+.055)/1.055,2.4))}i.relativeLuminance=function(d){return n(d>>16&255,d>>8&255,255&d)},i.relativeLuminance2=n}(_=t.rgb||(t.rgb={})),function(i){function n(g,S,h){const D=g>>24&255,y=g>>16&255,L=g>>8&255;let A=S>>24&255,M=S>>16&255,P=S>>8&255,N=o(_.relativeLuminance2(A,M,P),_.relativeLuminance2(D,y,L));for(;N<h&&(A>0||M>0||P>0);)A-=Math.max(0,Math.ceil(.1*A)),M-=Math.max(0,Math.ceil(.1*M)),P-=Math.max(0,Math.ceil(.1*P)),N=o(_.relativeLuminance2(A,M,P),_.relativeLuminance2(D,y,L));return(A<<24|M<<16|P<<8|255)>>>0}function d(g,S,h){const D=g>>24&255,y=g>>16&255,L=g>>8&255;let A=S>>24&255,M=S>>16&255,P=S>>8&255,N=o(_.relativeLuminance2(A,M,P),_.relativeLuminance2(D,y,L));for(;N<h&&(A<255||M<255||P<255);)A=Math.min(255,A+Math.ceil(.1*(255-A))),M=Math.min(255,M+Math.ceil(.1*(255-M))),P=Math.min(255,P+Math.ceil(.1*(255-P))),N=o(_.relativeLuminance2(A,M,P),_.relativeLuminance2(D,y,L));return(A<<24|M<<16|P<<8|255)>>>0}i.ensureContrastRatio=function(g,S,h){const D=_.relativeLuminance(g>>8),y=_.relativeLuminance(S>>8);if(o(D,y)<h){if(y<D){const M=n(g,S,h),P=o(D,_.relativeLuminance(M>>8));if(P<h){const N=d(g,S,h);return P>o(D,_.relativeLuminance(N>>8))?M:N}return M}const L=d(g,S,h),A=o(D,_.relativeLuminance(L>>8));if(A<h){const M=n(g,S,h);return A>o(D,_.relativeLuminance(M>>8))?L:M}return L}},i.reduceLuminance=n,i.increaseLuminance=d,i.toChannels=function(g){return[g>>24&255,g>>16&255,g>>8&255,255&g]},i.toColor=function(g,S,h,D){return{css:v.toCss(g,S,h,D),rgba:v.toRgba(g,S,h,D)}}}(e=t.rgba||(t.rgba={})),t.toPaddedHex=s,t.contrastRatio=o},8969:(F,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CoreTerminal=void 0;const l=r(844),a=r(2585),c=r(4348),u=r(7866),p=r(744),v=r(7302),_=r(6975),e=r(8460),s=r(1753),o=r(1480),i=r(7994),n=r(9282),d=r(5435),g=r(5981),S=r(2660);let h=!1;class D extends l.Disposable{constructor(L){super(),this._onBinary=this.register(new e.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new e.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new e.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new e.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new e.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new e.EventEmitter),this._instantiationService=new c.InstantiationService,this.optionsService=this.register(new v.OptionsService(L)),this._instantiationService.setService(a.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(p.BufferService)),this._instantiationService.setService(a.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(u.LogService)),this._instantiationService.setService(a.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(_.CoreService)),this._instantiationService.setService(a.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(s.CoreMouseService)),this._instantiationService.setService(a.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(o.UnicodeService)),this._instantiationService.setService(a.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(i.CharsetService),this._instantiationService.setService(a.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(S.OscLinkService),this._instantiationService.setService(a.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new d.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,e.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,e.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,e.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,e.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom())),this.register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this.register(this.optionsService.onSpecificOptionChange("windowsMode",A=>this._handleWindowsModeOptionChange(A))),this.register(this._bufferService.onScroll(A=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this.register(this._inputHandler.onScroll(A=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this.register(new g.WriteBuffer((A,M)=>this._inputHandler.parse(A,M))),this.register((0,e.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed)),this.register((0,l.toDisposable)(()=>{var A;(A=this._windowsMode)===null||A===void 0||A.dispose(),this._windowsMode=void 0}))}get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new e.EventEmitter),this._onScroll.event(L=>{var A;(A=this._onScrollApi)===null||A===void 0||A.fire(L.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(L){for(const A in L)this.optionsService.options[A]=L[A]}write(L,A){this._writeBuffer.write(L,A)}writeSync(L,A){this._logService.logLevel<=a.LogLevelEnum.WARN&&!h&&(this._logService.warn("writeSync is unreliable and will be removed soon."),h=!0),this._writeBuffer.writeSync(L,A)}resize(L,A){isNaN(L)||isNaN(A)||(L=Math.max(L,p.MINIMUM_COLS),A=Math.max(A,p.MINIMUM_ROWS),this._bufferService.resize(L,A))}scroll(L,A=!1){this._bufferService.scroll(L,A)}scrollLines(L,A,M){this._bufferService.scrollLines(L,A,M)}scrollPages(L){this._bufferService.scrollPages(L)}scrollToTop(){this._bufferService.scrollToTop()}scrollToBottom(){this._bufferService.scrollToBottom()}scrollToLine(L){this._bufferService.scrollToLine(L)}registerEscHandler(L,A){return this._inputHandler.registerEscHandler(L,A)}registerDcsHandler(L,A){return this._inputHandler.registerDcsHandler(L,A)}registerCsiHandler(L,A){return this._inputHandler.registerCsiHandler(L,A)}registerOscHandler(L,A){return this._inputHandler.registerOscHandler(L,A)}_setup(){this.optionsService.rawOptions.windowsMode&&this._enableWindowsMode()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsModeOptionChange(L){var A;L?this._enableWindowsMode():((A=this._windowsMode)===null||A===void 0||A.dispose(),this._windowsMode=void 0)}_enableWindowsMode(){if(!this._windowsMode){const L=[];L.push(this.onLineFeed(n.updateWindowsModeWrappedState.bind(null,this._bufferService))),L.push(this.registerCsiHandler({final:"H"},()=>((0,n.updateWindowsModeWrappedState)(this._bufferService),!1))),this._windowsMode={dispose:()=>{for(const A of L)A.dispose()}}}}}t.CoreTerminal=D},8460:(F,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.forwardEvent=t.EventEmitter=void 0,t.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=r=>(this._listeners.push(r),{dispose:()=>{if(!this._disposed){for(let l=0;l<this._listeners.length;l++)if(this._listeners[l]===r)return void this._listeners.splice(l,1)}}})),this._event}fire(r,l){const a=[];for(let c=0;c<this._listeners.length;c++)a.push(this._listeners[c]);for(let c=0;c<a.length;c++)a[c].call(void 0,r,l)}dispose(){this._listeners&&(this._listeners.length=0),this._disposed=!0}},t.forwardEvent=function(r,l){return r(a=>l.fire(a))}},5435:function(F,t,r){var l=this&&this.__decorate||function(j,C,w,R){var T,U=arguments.length,z=U<3?C:R===null?R=Object.getOwnPropertyDescriptor(C,w):R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")z=Reflect.decorate(j,C,w,R);else for(var V=j.length-1;V>=0;V--)(T=j[V])&&(z=(U<3?T(z):U>3?T(C,w,z):T(C,w))||z);return U>3&&z&&Object.defineProperty(C,w,z),z},a=this&&this.__param||function(j,C){return function(w,R){C(w,R,j)}};Object.defineProperty(t,"__esModule",{value:!0}),t.InputHandler=t.WindowsOptionsReportType=void 0;const c=r(2584),u=r(7116),p=r(2015),v=r(844),_=r(482),e=r(8437),s=r(8460),o=r(643),i=r(511),n=r(3734),d=r(2585),g=r(6242),S=r(6351),h=r(5941),D={"(":0,")":1,"*":2,"+":3,"-":1,".":2},y=131072;function L(j,C){if(j>24)return C.setWinLines||!1;switch(j){case 1:return!!C.restoreWin;case 2:return!!C.minimizeWin;case 3:return!!C.setWinPosition;case 4:return!!C.setWinSizePixels;case 5:return!!C.raiseWin;case 6:return!!C.lowerWin;case 7:return!!C.refreshWin;case 8:return!!C.setWinSizeChars;case 9:return!!C.maximizeWin;case 10:return!!C.fullscreenWin;case 11:return!!C.getWinState;case 13:return!!C.getWinPosition;case 14:return!!C.getWinSizePixels;case 15:return!!C.getScreenSizePixels;case 16:return!!C.getCellSizePixels;case 18:return!!C.getWinSizeChars;case 19:return!!C.getScreenSizeChars;case 20:return!!C.getIconTitle;case 21:return!!C.getWinTitle;case 22:return!!C.pushTitle;case 23:return!!C.popTitle;case 24:return!!C.setWinLines}return!1}var A;(function(j){j[j.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",j[j.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"})(A=t.WindowsOptionsReportType||(t.WindowsOptionsReportType={}));let M=0;class P extends v.Disposable{constructor(C,w,R,T,U,z,V,W,q=new p.EscapeSequenceParser){super(),this._bufferService=C,this._charsetService=w,this._coreService=R,this._logService=T,this._optionsService=U,this._oscLinkService=z,this._coreMouseService=V,this._unicodeService=W,this._parser=q,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new _.StringToUtf32,this._utf8Decoder=new _.Utf8ToUtf32,this._workCell=new i.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=e.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=e.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new s.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new s.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new s.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new s.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new s.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new s.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new s.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new s.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new s.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new s.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new s.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new s.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new s.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new N(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(x=>this._activeBuffer=x.activeBuffer)),this._parser.setCsiHandlerFallback((x,B)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(x),params:B.toArray()})}),this._parser.setEscHandlerFallback(x=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(x)})}),this._parser.setExecuteHandlerFallback(x=>{this._logService.debug("Unknown EXECUTE code: ",{code:x})}),this._parser.setOscHandlerFallback((x,B,I)=>{this._logService.debug("Unknown OSC code: ",{identifier:x,action:B,data:I})}),this._parser.setDcsHandlerFallback((x,B,I)=>{B==="HOOK"&&(I=I.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(x),action:B,payload:I})}),this._parser.setPrintHandler((x,B,I)=>this.print(x,B,I)),this._parser.registerCsiHandler({final:"@"},x=>this.insertChars(x)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},x=>this.scrollLeft(x)),this._parser.registerCsiHandler({final:"A"},x=>this.cursorUp(x)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},x=>this.scrollRight(x)),this._parser.registerCsiHandler({final:"B"},x=>this.cursorDown(x)),this._parser.registerCsiHandler({final:"C"},x=>this.cursorForward(x)),this._parser.registerCsiHandler({final:"D"},x=>this.cursorBackward(x)),this._parser.registerCsiHandler({final:"E"},x=>this.cursorNextLine(x)),this._parser.registerCsiHandler({final:"F"},x=>this.cursorPrecedingLine(x)),this._parser.registerCsiHandler({final:"G"},x=>this.cursorCharAbsolute(x)),this._parser.registerCsiHandler({final:"H"},x=>this.cursorPosition(x)),this._parser.registerCsiHandler({final:"I"},x=>this.cursorForwardTab(x)),this._parser.registerCsiHandler({final:"J"},x=>this.eraseInDisplay(x,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},x=>this.eraseInDisplay(x,!0)),this._parser.registerCsiHandler({final:"K"},x=>this.eraseInLine(x,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},x=>this.eraseInLine(x,!0)),this._parser.registerCsiHandler({final:"L"},x=>this.insertLines(x)),this._parser.registerCsiHandler({final:"M"},x=>this.deleteLines(x)),this._parser.registerCsiHandler({final:"P"},x=>this.deleteChars(x)),this._parser.registerCsiHandler({final:"S"},x=>this.scrollUp(x)),this._parser.registerCsiHandler({final:"T"},x=>this.scrollDown(x)),this._parser.registerCsiHandler({final:"X"},x=>this.eraseChars(x)),this._parser.registerCsiHandler({final:"Z"},x=>this.cursorBackwardTab(x)),this._parser.registerCsiHandler({final:"`"},x=>this.charPosAbsolute(x)),this._parser.registerCsiHandler({final:"a"},x=>this.hPositionRelative(x)),this._parser.registerCsiHandler({final:"b"},x=>this.repeatPrecedingCharacter(x)),this._parser.registerCsiHandler({final:"c"},x=>this.sendDeviceAttributesPrimary(x)),this._parser.registerCsiHandler({prefix:">",final:"c"},x=>this.sendDeviceAttributesSecondary(x)),this._parser.registerCsiHandler({final:"d"},x=>this.linePosAbsolute(x)),this._parser.registerCsiHandler({final:"e"},x=>this.vPositionRelative(x)),this._parser.registerCsiHandler({final:"f"},x=>this.hVPosition(x)),this._parser.registerCsiHandler({final:"g"},x=>this.tabClear(x)),this._parser.registerCsiHandler({final:"h"},x=>this.setMode(x)),this._parser.registerCsiHandler({prefix:"?",final:"h"},x=>this.setModePrivate(x)),this._parser.registerCsiHandler({final:"l"},x=>this.resetMode(x)),this._parser.registerCsiHandler({prefix:"?",final:"l"},x=>this.resetModePrivate(x)),this._parser.registerCsiHandler({final:"m"},x=>this.charAttributes(x)),this._parser.registerCsiHandler({final:"n"},x=>this.deviceStatus(x)),this._parser.registerCsiHandler({prefix:"?",final:"n"},x=>this.deviceStatusPrivate(x)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},x=>this.softReset(x)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},x=>this.setCursorStyle(x)),this._parser.registerCsiHandler({final:"r"},x=>this.setScrollRegion(x)),this._parser.registerCsiHandler({final:"s"},x=>this.saveCursor(x)),this._parser.registerCsiHandler({final:"t"},x=>this.windowOptions(x)),this._parser.registerCsiHandler({final:"u"},x=>this.restoreCursor(x)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},x=>this.insertColumns(x)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},x=>this.deleteColumns(x)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},x=>this.selectProtected(x)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},x=>this.requestMode(x,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},x=>this.requestMode(x,!1)),this._parser.setExecuteHandler(c.C0.BEL,()=>this.bell()),this._parser.setExecuteHandler(c.C0.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(c.C0.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(c.C0.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(c.C0.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(c.C0.BS,()=>this.backspace()),this._parser.setExecuteHandler(c.C0.HT,()=>this.tab()),this._parser.setExecuteHandler(c.C0.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(c.C0.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(c.C1.IND,()=>this.index()),this._parser.setExecuteHandler(c.C1.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(c.C1.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new g.OscHandler(x=>(this.setTitle(x),this.setIconName(x),!0))),this._parser.registerOscHandler(1,new g.OscHandler(x=>this.setIconName(x))),this._parser.registerOscHandler(2,new g.OscHandler(x=>this.setTitle(x))),this._parser.registerOscHandler(4,new g.OscHandler(x=>this.setOrReportIndexedColor(x))),this._parser.registerOscHandler(8,new g.OscHandler(x=>this.setHyperlink(x))),this._parser.registerOscHandler(10,new g.OscHandler(x=>this.setOrReportFgColor(x))),this._parser.registerOscHandler(11,new g.OscHandler(x=>this.setOrReportBgColor(x))),this._parser.registerOscHandler(12,new g.OscHandler(x=>this.setOrReportCursorColor(x))),this._parser.registerOscHandler(104,new g.OscHandler(x=>this.restoreIndexedColor(x))),this._parser.registerOscHandler(110,new g.OscHandler(x=>this.restoreFgColor(x))),this._parser.registerOscHandler(111,new g.OscHandler(x=>this.restoreBgColor(x))),this._parser.registerOscHandler(112,new g.OscHandler(x=>this.restoreCursorColor(x))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(const x in u.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:x},()=>this.selectCharset("("+x)),this._parser.registerEscHandler({intermediates:")",final:x},()=>this.selectCharset(")"+x)),this._parser.registerEscHandler({intermediates:"*",final:x},()=>this.selectCharset("*"+x)),this._parser.registerEscHandler({intermediates:"+",final:x},()=>this.selectCharset("+"+x)),this._parser.registerEscHandler({intermediates:"-",final:x},()=>this.selectCharset("-"+x)),this._parser.registerEscHandler({intermediates:".",final:x},()=>this.selectCharset("."+x)),this._parser.registerEscHandler({intermediates:"/",final:x},()=>this.selectCharset("/"+x));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler(x=>(this._logService.error("Parsing error: ",x),x)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new S.DcsHandler((x,B)=>this.requestStatusString(x,B)))}getAttrData(){return this._curAttrData}_preserveStack(C,w,R,T){this._parseStack.paused=!0,this._parseStack.cursorStartX=C,this._parseStack.cursorStartY=w,this._parseStack.decodedLength=R,this._parseStack.position=T}_logSlowResolvingAsync(C){this._logService.logLevel<=d.LogLevelEnum.WARN&&Promise.race([C,new Promise((w,R)=>setTimeout(()=>R("#SLOW_TIMEOUT"),5e3))]).catch(w=>{if(w!=="#SLOW_TIMEOUT")throw w;console.warn("async parser handler taking longer than 5000 ms")})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(C,w){let R,T=this._activeBuffer.x,U=this._activeBuffer.y,z=0;const V=this._parseStack.paused;if(V){if(R=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,w))return this._logSlowResolvingAsync(R),R;T=this._parseStack.cursorStartX,U=this._parseStack.cursorStartY,this._parseStack.paused=!1,C.length>y&&(z=this._parseStack.position+y)}if(this._logService.logLevel<=d.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+(typeof C=="string"?` "${C}"`:` "${Array.prototype.map.call(C,W=>String.fromCharCode(W)).join("")}"`),typeof C=="string"?C.split("").map(W=>W.charCodeAt(0)):C),this._parseBuffer.length<C.length&&this._parseBuffer.length<y&&(this._parseBuffer=new Uint32Array(Math.min(C.length,y))),V||this._dirtyRowTracker.clearRange(),C.length>y)for(let W=z;W<C.length;W+=y){const q=W+y<C.length?W+y:C.length,x=typeof C=="string"?this._stringDecoder.decode(C.substring(W,q),this._parseBuffer):this._utf8Decoder.decode(C.subarray(W,q),this._parseBuffer);if(R=this._parser.parse(this._parseBuffer,x))return this._preserveStack(T,U,x,W),this._logSlowResolvingAsync(R),R}else if(!V){const W=typeof C=="string"?this._stringDecoder.decode(C,this._parseBuffer):this._utf8Decoder.decode(C,this._parseBuffer);if(R=this._parser.parse(this._parseBuffer,W))return this._preserveStack(T,U,W,0),this._logSlowResolvingAsync(R),R}this._activeBuffer.x===T&&this._activeBuffer.y===U||this._onCursorMove.fire(),this._onRequestRefreshRows.fire(this._dirtyRowTracker.start,this._dirtyRowTracker.end)}print(C,w,R){let T,U;const z=this._charsetService.charset,V=this._optionsService.rawOptions.screenReaderMode,W=this._bufferService.cols,q=this._coreService.decPrivateModes.wraparound,x=this._coreService.modes.insertMode,B=this._curAttrData;let I=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&R-w>0&&I.getWidth(this._activeBuffer.x-1)===2&&I.setCellFromCodePoint(this._activeBuffer.x-1,0,1,B.fg,B.bg,B.extended);for(let H=w;H<R;++H){if(T=C[H],U=this._unicodeService.wcwidth(T),T<127&&z){const $=z[String.fromCharCode(T)];$&&(T=$.charCodeAt(0))}if(V&&this._onA11yChar.fire((0,_.stringFromCodePoint)(T)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),U||!this._activeBuffer.x){if(this._activeBuffer.x+U-1>=W){if(q){for(;this._activeBuffer.x<W;)I.setCellFromCodePoint(this._activeBuffer.x++,0,1,B.fg,B.bg,B.extended);this._activeBuffer.x=0,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),I=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)}else if(this._activeBuffer.x=W-1,U===2)continue}if(x&&(I.insertCells(this._activeBuffer.x,U,this._activeBuffer.getNullCell(B),B),I.getWidth(W-1)===2&&I.setCellFromCodePoint(W-1,o.NULL_CELL_CODE,o.NULL_CELL_WIDTH,B.fg,B.bg,B.extended)),I.setCellFromCodePoint(this._activeBuffer.x++,T,U,B.fg,B.bg,B.extended),U>0)for(;--U;)I.setCellFromCodePoint(this._activeBuffer.x++,0,0,B.fg,B.bg,B.extended)}else I.getWidth(this._activeBuffer.x-1)?I.addCodepointToCell(this._activeBuffer.x-1,T):I.addCodepointToCell(this._activeBuffer.x-2,T)}R-w>0&&(I.loadCell(this._activeBuffer.x-1,this._workCell),this._workCell.getWidth()===2||this._workCell.getCode()>65535?this._parser.precedingCodepoint=0:this._workCell.isCombined()?this._parser.precedingCodepoint=this._workCell.getChars().charCodeAt(0):this._parser.precedingCodepoint=this._workCell.content),this._activeBuffer.x<W&&R-w>0&&I.getWidth(this._activeBuffer.x)===0&&!I.hasContent(this._activeBuffer.x)&&I.setCellFromCodePoint(this._activeBuffer.x,0,1,B.fg,B.bg,B.extended),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(C,w){return C.final!=="t"||C.prefix||C.intermediates?this._parser.registerCsiHandler(C,w):this._parser.registerCsiHandler(C,R=>!L(R.params[0],this._optionsService.rawOptions.windowOptions)||w(R))}registerDcsHandler(C,w){return this._parser.registerDcsHandler(C,new S.DcsHandler(w))}registerEscHandler(C,w){return this._parser.registerEscHandler(C,w)}registerOscHandler(C,w){return this._parser.registerOscHandler(C,new g.OscHandler(w))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){var C;if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&(!((C=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y))===null||C===void 0)&&C.isWrapped)){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;const w=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);w.hasWidth(this._activeBuffer.x)&&!w.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;const C=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-C),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(C=this._bufferService.cols-1){this._activeBuffer.x=Math.min(C,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(C,w){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=C,this._activeBuffer.y=this._activeBuffer.scrollTop+w):(this._activeBuffer.x=C,this._activeBuffer.y=w),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(C,w){this._restrictCursor(),this._setCursor(this._activeBuffer.x+C,this._activeBuffer.y+w)}cursorUp(C){const w=this._activeBuffer.y-this._activeBuffer.scrollTop;return w>=0?this._moveCursor(0,-Math.min(w,C.params[0]||1)):this._moveCursor(0,-(C.params[0]||1)),!0}cursorDown(C){const w=this._activeBuffer.scrollBottom-this._activeBuffer.y;return w>=0?this._moveCursor(0,Math.min(w,C.params[0]||1)):this._moveCursor(0,C.params[0]||1),!0}cursorForward(C){return this._moveCursor(C.params[0]||1,0),!0}cursorBackward(C){return this._moveCursor(-(C.params[0]||1),0),!0}cursorNextLine(C){return this.cursorDown(C),this._activeBuffer.x=0,!0}cursorPrecedingLine(C){return this.cursorUp(C),this._activeBuffer.x=0,!0}cursorCharAbsolute(C){return this._setCursor((C.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(C){return this._setCursor(C.length>=2?(C.params[1]||1)-1:0,(C.params[0]||1)-1),!0}charPosAbsolute(C){return this._setCursor((C.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(C){return this._moveCursor(C.params[0]||1,0),!0}linePosAbsolute(C){return this._setCursor(this._activeBuffer.x,(C.params[0]||1)-1),!0}vPositionRelative(C){return this._moveCursor(0,C.params[0]||1),!0}hVPosition(C){return this.cursorPosition(C),!0}tabClear(C){const w=C.params[0];return w===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:w===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(C){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let w=C.params[0]||1;for(;w--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(C){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let w=C.params[0]||1;for(;w--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(C){const w=C.params[0];return w===1&&(this._curAttrData.bg|=536870912),w!==2&&w!==0||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(C,w,R,T=!1,U=!1){const z=this._activeBuffer.lines.get(this._activeBuffer.ybase+C);z.replaceCells(w,R,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData(),U),T&&(z.isWrapped=!1)}_resetBufferLine(C,w=!1){const R=this._activeBuffer.lines.get(this._activeBuffer.ybase+C);R.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),w),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+C),R.isWrapped=!1}eraseInDisplay(C,w=!1){let R;switch(this._restrictCursor(this._bufferService.cols),C.params[0]){case 0:for(R=this._activeBuffer.y,this._dirtyRowTracker.markDirty(R),this._eraseInBufferLine(R++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,w);R<this._bufferService.rows;R++)this._resetBufferLine(R,w);this._dirtyRowTracker.markDirty(R);break;case 1:for(R=this._activeBuffer.y,this._dirtyRowTracker.markDirty(R),this._eraseInBufferLine(R,0,this._activeBuffer.x+1,!0,w),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(R+1).isWrapped=!1);R--;)this._resetBufferLine(R,w);this._dirtyRowTracker.markDirty(0);break;case 2:for(R=this._bufferService.rows,this._dirtyRowTracker.markDirty(R-1);R--;)this._resetBufferLine(R,w);this._dirtyRowTracker.markDirty(0);break;case 3:const T=this._activeBuffer.lines.length-this._bufferService.rows;T>0&&(this._activeBuffer.lines.trimStart(T),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-T,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-T,0),this._onScroll.fire(0))}return!0}eraseInLine(C,w=!1){switch(this._restrictCursor(this._bufferService.cols),C.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,w);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,w);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,w)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(C){this._restrictCursor();let w=C.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const R=this._activeBuffer.ybase+this._activeBuffer.y,T=this._bufferService.rows-1-this._activeBuffer.scrollBottom,U=this._bufferService.rows-1+this._activeBuffer.ybase-T+1;for(;w--;)this._activeBuffer.lines.splice(U-1,1),this._activeBuffer.lines.splice(R,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(C){this._restrictCursor();let w=C.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const R=this._activeBuffer.ybase+this._activeBuffer.y;let T;for(T=this._bufferService.rows-1-this._activeBuffer.scrollBottom,T=this._bufferService.rows-1+this._activeBuffer.ybase-T;w--;)this._activeBuffer.lines.splice(R,1),this._activeBuffer.lines.splice(T,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(C){this._restrictCursor();const w=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return w&&(w.insertCells(this._activeBuffer.x,C.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(C){this._restrictCursor();const w=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return w&&(w.deleteCells(this._activeBuffer.x,C.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(C){let w=C.params[0]||1;for(;w--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(C){let w=C.params[0]||1;for(;w--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(e.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(C){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const w=C.params[0]||1;for(let R=this._activeBuffer.scrollTop;R<=this._activeBuffer.scrollBottom;++R){const T=this._activeBuffer.lines.get(this._activeBuffer.ybase+R);T.deleteCells(0,w,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),T.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(C){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const w=C.params[0]||1;for(let R=this._activeBuffer.scrollTop;R<=this._activeBuffer.scrollBottom;++R){const T=this._activeBuffer.lines.get(this._activeBuffer.ybase+R);T.insertCells(0,w,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),T.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(C){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const w=C.params[0]||1;for(let R=this._activeBuffer.scrollTop;R<=this._activeBuffer.scrollBottom;++R){const T=this._activeBuffer.lines.get(this._activeBuffer.ybase+R);T.insertCells(this._activeBuffer.x,w,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),T.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(C){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const w=C.params[0]||1;for(let R=this._activeBuffer.scrollTop;R<=this._activeBuffer.scrollBottom;++R){const T=this._activeBuffer.lines.get(this._activeBuffer.ybase+R);T.deleteCells(this._activeBuffer.x,w,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),T.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(C){this._restrictCursor();const w=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return w&&(w.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(C.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(C){if(!this._parser.precedingCodepoint)return!0;const w=C.params[0]||1,R=new Uint32Array(w);for(let T=0;T<w;++T)R[T]=this._parser.precedingCodepoint;return this.print(R,0,R.length),!0}sendDeviceAttributesPrimary(C){return C.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(c.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(c.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(C){return C.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(c.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(c.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(C.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(c.C0.ESC+"[>83;40003;0c")),!0}_is(C){return(this._optionsService.rawOptions.termName+"").indexOf(C)===0}setMode(C){for(let w=0;w<C.length;w++)switch(C.params[w]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(C){for(let w=0;w<C.length;w++)switch(C.params[w]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,u.DEFAULT_CHARSET),this._charsetService.setgCharset(1,u.DEFAULT_CHARSET),this._charsetService.setgCharset(2,u.DEFAULT_CHARSET),this._charsetService.setgCharset(3,u.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(C){for(let w=0;w<C.length;w++)switch(C.params[w]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(C){for(let w=0;w<C.length;w++)switch(C.params[w]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),C.params[w]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(C,w){const R=this._coreService.decPrivateModes,{activeProtocol:T,activeEncoding:U}=this._coreMouseService,z=this._coreService,{buffers:V,cols:W}=this._bufferService,{active:q,alt:x}=V,B=this._optionsService.rawOptions,I=K=>K?1:2,H=C.params[0];return $=H,J=w?H===2?3:H===4?I(z.modes.insertMode):H===12?4:H===20?I(B.convertEol):0:H===1?I(R.applicationCursorKeys):H===3?B.windowOptions.setWinLines?W===80?2:W===132?1:0:0:H===6?I(R.origin):H===7?I(R.wraparound):H===8?3:H===9?I(T==="X10"):H===12?I(B.cursorBlink):H===25?I(!z.isCursorHidden):H===45?I(R.reverseWraparound):H===66?I(R.applicationKeypad):H===1e3?I(T==="VT200"):H===1002?I(T==="DRAG"):H===1003?I(T==="ANY"):H===1004?I(R.sendFocus):H===1005?4:H===1006?I(U==="SGR"):H===1015?4:H===1016?I(U==="SGR_PIXELS"):H===1048?1:H===47||H===1047||H===1049?I(q===x):H===2004?I(R.bracketedPasteMode):0,z.triggerDataEvent(`${c.C0.ESC}[${w?"":"?"}${$};${J}$y`),!0;var $,J}_updateAttrColor(C,w,R,T,U){return w===2?(C|=50331648,C&=-16777216,C|=n.AttributeData.fromColorRGB([R,T,U])):w===5&&(C&=-50331904,C|=33554432|255&R),C}_extractColor(C,w,R){const T=[0,0,-1,0,0,0];let U=0,z=0;do{if(T[z+U]=C.params[w+z],C.hasSubParams(w+z)){const V=C.getSubParams(w+z);let W=0;do T[1]===5&&(U=1),T[z+W+1+U]=V[W];while(++W<V.length&&W+z+1+U<T.length);break}if(T[1]===5&&z+U>=2||T[1]===2&&z+U>=5)break;T[1]&&(U=1)}while(++z+w<C.length&&z+U<T.length);for(let V=2;V<T.length;++V)T[V]===-1&&(T[V]=0);switch(T[0]){case 38:R.fg=this._updateAttrColor(R.fg,T[1],T[3],T[4],T[5]);break;case 48:R.bg=this._updateAttrColor(R.bg,T[1],T[3],T[4],T[5]);break;case 58:R.extended=R.extended.clone(),R.extended.underlineColor=this._updateAttrColor(R.extended.underlineColor,T[1],T[3],T[4],T[5])}return z}_processUnderline(C,w){w.extended=w.extended.clone(),(!~C||C>5)&&(C=1),w.extended.underlineStyle=C,w.fg|=268435456,C===0&&(w.fg&=-268435457),w.updateExtended()}_processSGR0(C){C.fg=e.DEFAULT_ATTR_DATA.fg,C.bg=e.DEFAULT_ATTR_DATA.bg,C.extended=C.extended.clone(),C.extended.underlineStyle=0,C.extended.underlineColor&=-67108864,C.updateExtended()}charAttributes(C){if(C.length===1&&C.params[0]===0)return this._processSGR0(this._curAttrData),!0;const w=C.length;let R;const T=this._curAttrData;for(let U=0;U<w;U++)R=C.params[U],R>=30&&R<=37?(T.fg&=-50331904,T.fg|=16777216|R-30):R>=40&&R<=47?(T.bg&=-50331904,T.bg|=16777216|R-40):R>=90&&R<=97?(T.fg&=-50331904,T.fg|=16777224|R-90):R>=100&&R<=107?(T.bg&=-50331904,T.bg|=16777224|R-100):R===0?this._processSGR0(T):R===1?T.fg|=134217728:R===3?T.bg|=67108864:R===4?(T.fg|=268435456,this._processUnderline(C.hasSubParams(U)?C.getSubParams(U)[0]:1,T)):R===5?T.fg|=536870912:R===7?T.fg|=67108864:R===8?T.fg|=1073741824:R===9?T.fg|=2147483648:R===2?T.bg|=134217728:R===21?this._processUnderline(2,T):R===22?(T.fg&=-134217729,T.bg&=-134217729):R===23?T.bg&=-67108865:R===24?(T.fg&=-268435457,this._processUnderline(0,T)):R===25?T.fg&=-536870913:R===27?T.fg&=-67108865:R===28?T.fg&=-1073741825:R===29?T.fg&=2147483647:R===39?(T.fg&=-67108864,T.fg|=16777215&e.DEFAULT_ATTR_DATA.fg):R===49?(T.bg&=-67108864,T.bg|=16777215&e.DEFAULT_ATTR_DATA.bg):R===38||R===48||R===58?U+=this._extractColor(C,U,T):R===59?(T.extended=T.extended.clone(),T.extended.underlineColor=-1,T.updateExtended()):R===100?(T.fg&=-67108864,T.fg|=16777215&e.DEFAULT_ATTR_DATA.fg,T.bg&=-67108864,T.bg|=16777215&e.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",R);return!0}deviceStatus(C){switch(C.params[0]){case 5:this._coreService.triggerDataEvent(`${c.C0.ESC}[0n`);break;case 6:const w=this._activeBuffer.y+1,R=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${c.C0.ESC}[${w};${R}R`)}return!0}deviceStatusPrivate(C){if(C.params[0]===6){const w=this._activeBuffer.y+1,R=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${c.C0.ESC}[?${w};${R}R`)}return!0}softReset(C){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=e.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(C){const w=C.params[0]||1;switch(w){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}const R=w%2==1;return this._optionsService.options.cursorBlink=R,!0}setScrollRegion(C){const w=C.params[0]||1;let R;return(C.length<2||(R=C.params[1])>this._bufferService.rows||R===0)&&(R=this._bufferService.rows),R>w&&(this._activeBuffer.scrollTop=w-1,this._activeBuffer.scrollBottom=R-1,this._setCursor(0,0)),!0}windowOptions(C){if(!L(C.params[0],this._optionsService.rawOptions.windowOptions))return!0;const w=C.length>1?C.params[1]:0;switch(C.params[0]){case 14:w!==2&&this._onRequestWindowsOptionsReport.fire(A.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(A.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${c.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:w!==0&&w!==2||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),w!==0&&w!==1||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:w!==0&&w!==2||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),w!==0&&w!==1||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(C){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(C){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(C){return this._windowTitle=C,this._onTitleChange.fire(C),!0}setIconName(C){return this._iconName=C,!0}setOrReportIndexedColor(C){const w=[],R=C.split(";");for(;R.length>1;){const T=R.shift(),U=R.shift();if(/^\d+$/.exec(T)){const z=parseInt(T);if(0<=z&&z<256)if(U==="?")w.push({type:0,index:z});else{const V=(0,h.parseColor)(U);V&&w.push({type:1,index:z,color:V})}}}return w.length&&this._onColor.fire(w),!0}setHyperlink(C){const w=C.split(";");return!(w.length<2)&&(w[1]?this._createHyperlink(w[0],w[1]):!w[0]&&this._finishHyperlink())}_createHyperlink(C,w){this._getCurrentLinkId()&&this._finishHyperlink();const R=C.split(":");let T;const U=R.findIndex(z=>z.startsWith("id="));return U!==-1&&(T=R[U].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:T,uri:w}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(C,w){const R=C.split(";");for(let T=0;T<R.length&&!(w>=this._specialColors.length);++T,++w)if(R[T]==="?")this._onColor.fire([{type:0,index:this._specialColors[w]}]);else{const U=(0,h.parseColor)(R[T]);U&&this._onColor.fire([{type:1,index:this._specialColors[w],color:U}])}return!0}setOrReportFgColor(C){return this._setOrReportSpecialColor(C,0)}setOrReportBgColor(C){return this._setOrReportSpecialColor(C,1)}setOrReportCursorColor(C){return this._setOrReportSpecialColor(C,2)}restoreIndexedColor(C){if(!C)return this._onColor.fire([{type:2}]),!0;const w=[],R=C.split(";");for(let T=0;T<R.length;++T)if(/^\d+$/.exec(R[T])){const U=parseInt(R[T]);0<=U&&U<256&&w.push({type:2,index:U})}return w.length&&this._onColor.fire(w),!0}restoreFgColor(C){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(C){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(C){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,u.DEFAULT_CHARSET),!0}selectCharset(C){return C.length!==2?(this.selectDefaultCharset(),!0):(C[0]==="/"||this._charsetService.setgCharset(D[C[0]],u.CHARSETS[C[1]]||u.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){const C=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,C,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=e.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=e.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(C){return this._charsetService.setgLevel(C),!0}screenAlignmentPattern(){const C=new i.CellData;C.content=4194304|"E".charCodeAt(0),C.fg=this._curAttrData.fg,C.bg=this._curAttrData.bg,this._setCursor(0,0);for(let w=0;w<this._bufferService.rows;++w){const R=this._activeBuffer.ybase+this._activeBuffer.y+w,T=this._activeBuffer.lines.get(R);T&&(T.fill(C),T.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(C,w){const R=this._bufferService.buffer,T=this._optionsService.rawOptions;return(U=>(this._coreService.triggerDataEvent(`${c.C0.ESC}${U}${c.C0.ESC}\\`),!0))(C==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:C==='"p'?'P1$r61;1"p':C==="r"?`P1$r${R.scrollTop+1};${R.scrollBottom+1}r`:C==="m"?"P1$r0m":C===" q"?`P1$r${{block:2,underline:4,bar:6}[T.cursorStyle]-(T.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(C,w){this._dirtyRowTracker.markRangeDirty(C,w)}}t.InputHandler=P;let N=class{constructor(j){this._bufferService=j,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(j){j<this.start?this.start=j:j>this.end&&(this.end=j)}markRangeDirty(j,C){j>C&&(M=j,j=C,C=M),j<this.start&&(this.start=j),C>this.end&&(this.end=C)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};N=l([a(0,d.IBufferService)],N)},844:(F,t)=>{function r(l){for(const a of l)a.dispose();l.length=0}Object.defineProperty(t,"__esModule",{value:!0}),t.getDisposeArrayDisposable=t.disposeArray=t.toDisposable=t.Disposable=void 0,t.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const l of this._disposables)l.dispose();this._disposables.length=0}register(l){return this._disposables.push(l),l}unregister(l){const a=this._disposables.indexOf(l);a!==-1&&this._disposables.splice(a,1)}},t.toDisposable=function(l){return{dispose:l}},t.disposeArray=r,t.getDisposeArrayDisposable=function(l){return{dispose:()=>r(l)}}},1505:(F,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FourKeyMap=t.TwoKeyMap=void 0;class r{constructor(){this._data={}}set(a,c,u){this._data[a]||(this._data[a]={}),this._data[a][c]=u}get(a,c){return this._data[a]?this._data[a][c]:void 0}clear(){this._data={}}}t.TwoKeyMap=r,t.FourKeyMap=class{constructor(){this._data=new r}set(l,a,c,u,p){this._data.get(l,a)||this._data.set(l,a,new r),this._data.get(l,a).set(c,u,p)}get(l,a,c,u){var p;return(p=this._data.get(l,a))===null||p===void 0?void 0:p.get(c,u)}clear(){this._data.clear()}}},6114:(F,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isChromeOS=t.isLinux=t.isWindows=t.isIphone=t.isIpad=t.isMac=t.getSafariVersion=t.isSafari=t.isLegacyEdge=t.isFirefox=t.isNode=void 0,t.isNode=typeof navigator>"u";const r=t.isNode?"node":navigator.userAgent,l=t.isNode?"node":navigator.platform;t.isFirefox=r.includes("Firefox"),t.isLegacyEdge=r.includes("Edge"),t.isSafari=/^((?!chrome|android).)*safari/i.test(r),t.getSafariVersion=function(){if(!t.isSafari)return 0;const a=r.match(/Version\/(\d+)/);return a===null||a.length<2?0:parseInt(a[1])},t.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(l),t.isIpad=l==="iPad",t.isIphone=l==="iPhone",t.isWindows=["Windows","Win16","Win32","WinCE"].includes(l),t.isLinux=l.indexOf("Linux")>=0,t.isChromeOS=/\bCrOS\b/.test(r)},6106:(F,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SortedList=void 0;let r=0;t.SortedList=class{constructor(l){this._getKey=l,this._array=[]}clear(){this._array.length=0}insert(l){this._array.length!==0?(r=this._search(this._getKey(l),0,this._array.length-1),this._array.splice(r,0,l)):this._array.push(l)}delete(l){if(this._array.length===0)return!1;const a=this._getKey(l);if(a===void 0||(r=this._search(a,0,this._array.length-1),r===-1)||this._getKey(this._array[r])!==a)return!1;do if(this._array[r]===l)return this._array.splice(r,1),!0;while(++r<this._array.length&&this._getKey(this._array[r])===a);return!1}*getKeyIterator(l){if(this._array.length!==0&&(r=this._search(l,0,this._array.length-1),!(r<0||r>=this._array.length)&&this._getKey(this._array[r])===l))do yield this._array[r];while(++r<this._array.length&&this._getKey(this._array[r])===l)}forEachByKey(l,a){if(this._array.length!==0&&(r=this._search(l,0,this._array.length-1),!(r<0||r>=this._array.length)&&this._getKey(this._array[r])===l))do a(this._array[r]);while(++r<this._array.length&&this._getKey(this._array[r])===l)}values(){return this._array.values()}_search(l,a,c){if(c<a)return a;let u=Math.floor((a+c)/2);const p=this._getKey(this._array[u]);if(p>l)return this._search(l,a,u-1);if(p<l)return this._search(l,u+1,c);for(;u>0&&this._getKey(this._array[u-1])===l;)u--;return u}}},7226:(F,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DebouncedIdleTask=t.IdleTaskQueue=t.PriorityTaskQueue=void 0;const l=r(6114);class a{constructor(){this._tasks=[],this._i=0}enqueue(p){this._tasks.push(p),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(p){this._idleCallback=void 0;let v=0,_=0,e=p.timeRemaining(),s=0;for(;this._i<this._tasks.length;){if(v=Date.now(),this._tasks[this._i]()||this._i++,v=Math.max(1,Date.now()-v),_=Math.max(v,_),s=p.timeRemaining(),1.5*_>s)return e-v<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(e-v))}ms`),void this._start();e=s}this.clear()}}class c extends a{_requestCallback(p){return setTimeout(()=>p(this._createDeadline(16)))}_cancelCallback(p){clearTimeout(p)}_createDeadline(p){const v=Date.now()+p;return{timeRemaining:()=>Math.max(0,v-Date.now())}}}t.PriorityTaskQueue=c,t.IdleTaskQueue=!l.isNode&&"requestIdleCallback"in window?class extends a{_requestCallback(u){return requestIdleCallback(u)}_cancelCallback(u){cancelIdleCallback(u)}}:c,t.DebouncedIdleTask=class{constructor(){this._queue=new t.IdleTaskQueue}set(u){this._queue.clear(),this._queue.enqueue(u)}flush(){this._queue.flush()}}},9282:(F,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.updateWindowsModeWrappedState=void 0;const l=r(643);t.updateWindowsModeWrappedState=function(a){const c=a.buffer.lines.get(a.buffer.ybase+a.buffer.y-1),u=c?.get(a.cols-1),p=a.buffer.lines.get(a.buffer.ybase+a.buffer.y);p&&u&&(p.isWrapped=u[l.CHAR_DATA_CODE_INDEX]!==l.NULL_CELL_CODE&&u[l.CHAR_DATA_CODE_INDEX]!==l.WHITESPACE_CELL_CODE)}},3734:(F,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExtendedAttrs=t.AttributeData=void 0;class r{constructor(){this.fg=0,this.bg=0,this.extended=new l}static toColorRGB(c){return[c>>>16&255,c>>>8&255,255&c]}static fromColorRGB(c){return(255&c[0])<<16|(255&c[1])<<8|255&c[2]}clone(){const c=new r;return c.fg=this.fg,c.bg=this.bg,c.extended=this.extended.clone(),c}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}}t.AttributeData=r;class l{constructor(c=0,u=0){this._ext=0,this._urlId=0,this._ext=c,this._urlId=u}get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(c){this._ext=c}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(c){this._ext&=-469762049,this._ext|=c<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(c){this._ext&=-67108864,this._ext|=67108863&c}get urlId(){return this._urlId}set urlId(c){this._urlId=c}clone(){return new l(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}t.ExtendedAttrs=l},9092:(F,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferStringIterator=t.Buffer=t.MAX_BUFFER_SIZE=void 0;const l=r(6349),a=r(8437),c=r(511),u=r(643),p=r(4634),v=r(4863),_=r(7116),e=r(3734),s=r(7226);t.MAX_BUFFER_SIZE=4294967295,t.Buffer=class{constructor(i,n,d){this._hasScrollback=i,this._optionsService=n,this._bufferService=d,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=a.DEFAULT_ATTR_DATA.clone(),this.savedCharset=_.DEFAULT_CHARSET,this.markers=[],this._nullCell=c.CellData.fromCharData([0,u.NULL_CELL_CHAR,u.NULL_CELL_WIDTH,u.NULL_CELL_CODE]),this._whitespaceCell=c.CellData.fromCharData([0,u.WHITESPACE_CELL_CHAR,u.WHITESPACE_CELL_WIDTH,u.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new s.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new l.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(i){return i?(this._nullCell.fg=i.fg,this._nullCell.bg=i.bg,this._nullCell.extended=i.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new e.ExtendedAttrs),this._nullCell}getWhitespaceCell(i){return i?(this._whitespaceCell.fg=i.fg,this._whitespaceCell.bg=i.bg,this._whitespaceCell.extended=i.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new e.ExtendedAttrs),this._whitespaceCell}getBlankLine(i,n){return new a.BufferLine(this._bufferService.cols,this.getNullCell(i),n)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){const i=this.ybase+this.y-this.ydisp;return i>=0&&i<this._rows}_getCorrectBufferLength(i){if(!this._hasScrollback)return i;const n=i+this._optionsService.rawOptions.scrollback;return n>t.MAX_BUFFER_SIZE?t.MAX_BUFFER_SIZE:n}fillViewportRows(i){if(this.lines.length===0){i===void 0&&(i=a.DEFAULT_ATTR_DATA);let n=this._rows;for(;n--;)this.lines.push(this.getBlankLine(i))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new l.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(i,n){const d=this.getNullCell(a.DEFAULT_ATTR_DATA);let g=0;const S=this._getCorrectBufferLength(n);if(S>this.lines.maxLength&&(this.lines.maxLength=S),this.lines.length>0){if(this._cols<i)for(let D=0;D<this.lines.length;D++)g+=+this.lines.get(D).resize(i,d);let h=0;if(this._rows<n)for(let D=this._rows;D<n;D++)this.lines.length<n+this.ybase&&(this._optionsService.rawOptions.windowsMode?this.lines.push(new a.BufferLine(i,d)):this.ybase>0&&this.lines.length<=this.ybase+this.y+h+1?(this.ybase--,h++,this.ydisp>0&&this.ydisp--):this.lines.push(new a.BufferLine(i,d)));else for(let D=this._rows;D>n;D--)this.lines.length>n+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(S<this.lines.maxLength){const D=this.lines.length-S;D>0&&(this.lines.trimStart(D),this.ybase=Math.max(this.ybase-D,0),this.ydisp=Math.max(this.ydisp-D,0),this.savedY=Math.max(this.savedY-D,0)),this.lines.maxLength=S}this.x=Math.min(this.x,i-1),this.y=Math.min(this.y,n-1),h&&(this.y+=h),this.savedX=Math.min(this.savedX,i-1),this.scrollTop=0}if(this.scrollBottom=n-1,this._isReflowEnabled&&(this._reflow(i,n),this._cols>i))for(let h=0;h<this.lines.length;h++)g+=+this.lines.get(h).resize(i,d);this._cols=i,this._rows=n,this._memoryCleanupQueue.clear(),g>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let i=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,i=!1);let n=0;for(;this._memoryCleanupPosition<this.lines.length;)if(n+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),n>100)return!0;return i}get _isReflowEnabled(){return this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(i,n){this._cols!==i&&(i>this._cols?this._reflowLarger(i,n):this._reflowSmaller(i,n))}_reflowLarger(i,n){const d=(0,p.reflowLargerGetLinesToRemove)(this.lines,this._cols,i,this.ybase+this.y,this.getNullCell(a.DEFAULT_ATTR_DATA));if(d.length>0){const g=(0,p.reflowLargerCreateNewLayout)(this.lines,d);(0,p.reflowLargerApplyNewLayout)(this.lines,g.layout),this._reflowLargerAdjustViewport(i,n,g.countRemoved)}}_reflowLargerAdjustViewport(i,n,d){const g=this.getNullCell(a.DEFAULT_ATTR_DATA);let S=d;for(;S-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<n&&this.lines.push(new a.BufferLine(i,g))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-d,0)}_reflowSmaller(i,n){const d=this.getNullCell(a.DEFAULT_ATTR_DATA),g=[];let S=0;for(let h=this.lines.length-1;h>=0;h--){let D=this.lines.get(h);if(!D||!D.isWrapped&&D.getTrimmedLength()<=i)continue;const y=[D];for(;D.isWrapped&&h>0;)D=this.lines.get(--h),y.unshift(D);const L=this.ybase+this.y;if(L>=h&&L<h+y.length)continue;const A=y[y.length-1].getTrimmedLength(),M=(0,p.reflowSmallerGetNewLineLengths)(y,this._cols,i),P=M.length-y.length;let N;N=this.ybase===0&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+P):Math.max(0,this.lines.length-this.lines.maxLength+P);const j=[];for(let z=0;z<P;z++){const V=this.getBlankLine(a.DEFAULT_ATTR_DATA,!0);j.push(V)}j.length>0&&(g.push({start:h+y.length+S,newLines:j}),S+=j.length),y.push(...j);let C=M.length-1,w=M[C];w===0&&(C--,w=M[C]);let R=y.length-P-1,T=A;for(;R>=0;){const z=Math.min(T,w);if(y[C]===void 0)break;if(y[C].copyCellsFrom(y[R],T-z,w-z,z,!0),w-=z,w===0&&(C--,w=M[C]),T-=z,T===0){R--;const V=Math.max(R,0);T=(0,p.getWrappedLineTrimmedLength)(y,V,this._cols)}}for(let z=0;z<y.length;z++)M[z]<i&&y[z].setCell(M[z],d);let U=P-N;for(;U-- >0;)this.ybase===0?this.y<n-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+S)-n&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+P,this.ybase+n-1)}if(g.length>0){const h=[],D=[];for(let C=0;C<this.lines.length;C++)D.push(this.lines.get(C));const y=this.lines.length;let L=y-1,A=0,M=g[A];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+S);let P=0;for(let C=Math.min(this.lines.maxLength-1,y+S-1);C>=0;C--)if(M&&M.start>L+P){for(let w=M.newLines.length-1;w>=0;w--)this.lines.set(C--,M.newLines[w]);C++,h.push({index:L+1,amount:M.newLines.length}),P+=M.newLines.length,M=g[++A]}else this.lines.set(C,D[L--]);let N=0;for(let C=h.length-1;C>=0;C--)h[C].index+=N,this.lines.onInsertEmitter.fire(h[C]),N+=h[C].amount;const j=Math.max(0,y+S-this.lines.maxLength);j>0&&this.lines.onTrimEmitter.fire(j)}}stringIndexToBufferIndex(i,n,d=!1){for(;n;){const g=this.lines.get(i);if(!g)return[-1,-1];const S=d?g.getTrimmedLength():g.length;for(let h=0;h<S;++h)if(g.get(h)[u.CHAR_DATA_WIDTH_INDEX]&&(n-=g.get(h)[u.CHAR_DATA_CHAR_INDEX].length||1),n<0)return[i,h];i++}return[i,0]}translateBufferLineToString(i,n,d=0,g){const S=this.lines.get(i);return S?S.translateToString(n,d,g):""}getWrappedRangeForLine(i){let n=i,d=i;for(;n>0&&this.lines.get(n).isWrapped;)n--;for(;d+1<this.lines.length&&this.lines.get(d+1).isWrapped;)d++;return{first:n,last:d}}setupTabStops(i){for(i!=null?this.tabs[i]||(i=this.prevStop(i)):(this.tabs={},i=0);i<this._cols;i+=this._optionsService.rawOptions.tabStopWidth)this.tabs[i]=!0}prevStop(i){for(i==null&&(i=this.x);!this.tabs[--i]&&i>0;);return i>=this._cols?this._cols-1:i<0?0:i}nextStop(i){for(i==null&&(i=this.x);!this.tabs[++i]&&i<this._cols;);return i>=this._cols?this._cols-1:i<0?0:i}clearMarkers(i){this._isClearing=!0;for(let n=0;n<this.markers.length;n++)this.markers[n].line===i&&(this.markers[n].dispose(),this.markers.splice(n--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let i=0;i<this.markers.length;i++)this.markers[i].dispose(),this.markers.splice(i--,1);this._isClearing=!1}addMarker(i){const n=new v.Marker(i);return this.markers.push(n),n.register(this.lines.onTrim(d=>{n.line-=d,n.line<0&&n.dispose()})),n.register(this.lines.onInsert(d=>{n.line>=d.index&&(n.line+=d.amount)})),n.register(this.lines.onDelete(d=>{n.line>=d.index&&n.line<d.index+d.amount&&n.dispose(),n.line>d.index&&(n.line-=d.amount)})),n.register(n.onDispose(()=>this._removeMarker(n))),n}_removeMarker(i){this._isClearing||this.markers.splice(this.markers.indexOf(i),1)}iterator(i,n,d,g,S){return new o(this,i,n,d,g,S)}};class o{constructor(n,d,g=0,S=n.lines.length,h=0,D=0){this._buffer=n,this._trimRight=d,this._startIndex=g,this._endIndex=S,this._startOverscan=h,this._endOverscan=D,this._startIndex<0&&(this._startIndex=0),this._endIndex>this._buffer.lines.length&&(this._endIndex=this._buffer.lines.length),this._current=this._startIndex}hasNext(){return this._current<this._endIndex}next(){const n=this._buffer.getWrappedRangeForLine(this._current);n.first<this._startIndex-this._startOverscan&&(n.first=this._startIndex-this._startOverscan),n.last>this._endIndex+this._endOverscan&&(n.last=this._endIndex+this._endOverscan),n.first=Math.max(n.first,0),n.last=Math.min(n.last,this._buffer.lines.length);let d="";for(let g=n.first;g<=n.last;++g)d+=this._buffer.translateBufferLineToString(g,this._trimRight);return this._current=n.last+1,{range:n,content:d}}}t.BufferStringIterator=o},8437:(F,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferLine=t.DEFAULT_ATTR_DATA=void 0;const l=r(482),a=r(643),c=r(511),u=r(3734);t.DEFAULT_ATTR_DATA=Object.freeze(new u.AttributeData);let p=0;class v{constructor(e,s,o=!1){this.isWrapped=o,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*e);const i=s||c.CellData.fromCharData([0,a.NULL_CELL_CHAR,a.NULL_CELL_WIDTH,a.NULL_CELL_CODE]);for(let n=0;n<e;++n)this.setCell(n,i);this.length=e}get(e){const s=this._data[3*e+0],o=2097151&s;return[this._data[3*e+1],2097152&s?this._combined[e]:o?(0,l.stringFromCodePoint)(o):"",s>>22,2097152&s?this._combined[e].charCodeAt(this._combined[e].length-1):o]}set(e,s){this._data[3*e+1]=s[a.CHAR_DATA_ATTR_INDEX],s[a.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[e]=s[1],this._data[3*e+0]=2097152|e|s[a.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*e+0]=s[a.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|s[a.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(e){return this._data[3*e+0]>>22}hasWidth(e){return 12582912&this._data[3*e+0]}getFg(e){return this._data[3*e+1]}getBg(e){return this._data[3*e+2]}hasContent(e){return 4194303&this._data[3*e+0]}getCodePoint(e){const s=this._data[3*e+0];return 2097152&s?this._combined[e].charCodeAt(this._combined[e].length-1):2097151&s}isCombined(e){return 2097152&this._data[3*e+0]}getString(e){const s=this._data[3*e+0];return 2097152&s?this._combined[e]:2097151&s?(0,l.stringFromCodePoint)(2097151&s):""}isProtected(e){return 536870912&this._data[3*e+2]}loadCell(e,s){return p=3*e,s.content=this._data[p+0],s.fg=this._data[p+1],s.bg=this._data[p+2],2097152&s.content&&(s.combinedData=this._combined[e]),268435456&s.bg&&(s.extended=this._extendedAttrs[e]),s}setCell(e,s){2097152&s.content&&(this._combined[e]=s.combinedData),268435456&s.bg&&(this._extendedAttrs[e]=s.extended),this._data[3*e+0]=s.content,this._data[3*e+1]=s.fg,this._data[3*e+2]=s.bg}setCellFromCodePoint(e,s,o,i,n,d){268435456&n&&(this._extendedAttrs[e]=d),this._data[3*e+0]=s|o<<22,this._data[3*e+1]=i,this._data[3*e+2]=n}addCodepointToCell(e,s){let o=this._data[3*e+0];2097152&o?this._combined[e]+=(0,l.stringFromCodePoint)(s):(2097151&o?(this._combined[e]=(0,l.stringFromCodePoint)(2097151&o)+(0,l.stringFromCodePoint)(s),o&=-2097152,o|=2097152):o=s|4194304,this._data[3*e+0]=o)}insertCells(e,s,o,i){if((e%=this.length)&&this.getWidth(e-1)===2&&this.setCellFromCodePoint(e-1,0,1,i?.fg||0,i?.bg||0,i?.extended||new u.ExtendedAttrs),s<this.length-e){const n=new c.CellData;for(let d=this.length-e-s-1;d>=0;--d)this.setCell(e+s+d,this.loadCell(e+d,n));for(let d=0;d<s;++d)this.setCell(e+d,o)}else for(let n=e;n<this.length;++n)this.setCell(n,o);this.getWidth(this.length-1)===2&&this.setCellFromCodePoint(this.length-1,0,1,i?.fg||0,i?.bg||0,i?.extended||new u.ExtendedAttrs)}deleteCells(e,s,o,i){if(e%=this.length,s<this.length-e){const n=new c.CellData;for(let d=0;d<this.length-e-s;++d)this.setCell(e+d,this.loadCell(e+s+d,n));for(let d=this.length-s;d<this.length;++d)this.setCell(d,o)}else for(let n=e;n<this.length;++n)this.setCell(n,o);e&&this.getWidth(e-1)===2&&this.setCellFromCodePoint(e-1,0,1,i?.fg||0,i?.bg||0,i?.extended||new u.ExtendedAttrs),this.getWidth(e)!==0||this.hasContent(e)||this.setCellFromCodePoint(e,0,1,i?.fg||0,i?.bg||0,i?.extended||new u.ExtendedAttrs)}replaceCells(e,s,o,i,n=!1){if(n)for(e&&this.getWidth(e-1)===2&&!this.isProtected(e-1)&&this.setCellFromCodePoint(e-1,0,1,i?.fg||0,i?.bg||0,i?.extended||new u.ExtendedAttrs),s<this.length&&this.getWidth(s-1)===2&&!this.isProtected(s)&&this.setCellFromCodePoint(s,0,1,i?.fg||0,i?.bg||0,i?.extended||new u.ExtendedAttrs);e<s&&e<this.length;)this.isProtected(e)||this.setCell(e,o),e++;else for(e&&this.getWidth(e-1)===2&&this.setCellFromCodePoint(e-1,0,1,i?.fg||0,i?.bg||0,i?.extended||new u.ExtendedAttrs),s<this.length&&this.getWidth(s-1)===2&&this.setCellFromCodePoint(s,0,1,i?.fg||0,i?.bg||0,i?.extended||new u.ExtendedAttrs);e<s&&e<this.length;)this.setCell(e++,o)}resize(e,s){if(e===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;const o=3*e;if(e>this.length){if(this._data.buffer.byteLength>=4*o)this._data=new Uint32Array(this._data.buffer,0,o);else{const i=new Uint32Array(o);i.set(this._data),this._data=i}for(let i=this.length;i<e;++i)this.setCell(i,s)}else{this._data=this._data.subarray(0,o);const i=Object.keys(this._combined);for(let d=0;d<i.length;d++){const g=parseInt(i[d],10);g>=e&&delete this._combined[g]}const n=Object.keys(this._extendedAttrs);for(let d=0;d<n.length;d++){const g=parseInt(n[d],10);g>=e&&delete this._extendedAttrs[g]}}return this.length=e,4*o*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){const e=new Uint32Array(this._data.length);return e.set(this._data),this._data=e,1}return 0}fill(e,s=!1){if(s)for(let o=0;o<this.length;++o)this.isProtected(o)||this.setCell(o,e);else{this._combined={},this._extendedAttrs={};for(let o=0;o<this.length;++o)this.setCell(o,e)}}copyFrom(e){this.length!==e.length?this._data=new Uint32Array(e._data):this._data.set(e._data),this.length=e.length,this._combined={};for(const s in e._combined)this._combined[s]=e._combined[s];this._extendedAttrs={};for(const s in e._extendedAttrs)this._extendedAttrs[s]=e._extendedAttrs[s];this.isWrapped=e.isWrapped}clone(){const e=new v(0);e._data=new Uint32Array(this._data),e.length=this.length;for(const s in this._combined)e._combined[s]=this._combined[s];for(const s in this._extendedAttrs)e._extendedAttrs[s]=this._extendedAttrs[s];return e.isWrapped=this.isWrapped,e}getTrimmedLength(){for(let e=this.length-1;e>=0;--e)if(4194303&this._data[3*e+0])return e+(this._data[3*e+0]>>22);return 0}copyCellsFrom(e,s,o,i,n){const d=e._data;if(n)for(let S=i-1;S>=0;S--){for(let h=0;h<3;h++)this._data[3*(o+S)+h]=d[3*(s+S)+h];268435456&d[3*(s+S)+2]&&(this._extendedAttrs[o+S]=e._extendedAttrs[s+S])}else for(let S=0;S<i;S++){for(let h=0;h<3;h++)this._data[3*(o+S)+h]=d[3*(s+S)+h];268435456&d[3*(s+S)+2]&&(this._extendedAttrs[o+S]=e._extendedAttrs[s+S])}const g=Object.keys(e._combined);for(let S=0;S<g.length;S++){const h=parseInt(g[S],10);h>=s&&(this._combined[h-s+o]=e._combined[h])}}translateToString(e=!1,s=0,o=this.length){e&&(o=Math.min(o,this.getTrimmedLength()));let i="";for(;s<o;){const n=this._data[3*s+0],d=2097151&n;i+=2097152&n?this._combined[s]:d?(0,l.stringFromCodePoint)(d):a.WHITESPACE_CELL_CHAR,s+=n>>22||1}return i}}t.BufferLine=v},4841:(F,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getRangeLength=void 0,t.getRangeLength=function(r,l){if(r.start.y>r.end.y)throw new Error(`Buffer range end (${r.end.x}, ${r.end.y}) cannot be before start (${r.start.x}, ${r.start.y})`);return l*(r.end.y-r.start.y)+(r.end.x-r.start.x+1)}},4634:(F,t)=>{function r(l,a,c){if(a===l.length-1)return l[a].getTrimmedLength();const u=!l[a].hasContent(c-1)&&l[a].getWidth(c-1)===1,p=l[a+1].getWidth(0)===2;return u&&p?c-1:c}Object.defineProperty(t,"__esModule",{value:!0}),t.getWrappedLineTrimmedLength=t.reflowSmallerGetNewLineLengths=t.reflowLargerApplyNewLayout=t.reflowLargerCreateNewLayout=t.reflowLargerGetLinesToRemove=void 0,t.reflowLargerGetLinesToRemove=function(l,a,c,u,p){const v=[];for(let _=0;_<l.length-1;_++){let e=_,s=l.get(++e);if(!s.isWrapped)continue;const o=[l.get(_)];for(;e<l.length&&s.isWrapped;)o.push(s),s=l.get(++e);if(u>=_&&u<e){_+=o.length-1;continue}let i=0,n=r(o,i,a),d=1,g=0;for(;d<o.length;){const h=r(o,d,a),D=h-g,y=c-n,L=Math.min(D,y);o[i].copyCellsFrom(o[d],g,n,L,!1),n+=L,n===c&&(i++,n=0),g+=L,g===h&&(d++,g=0),n===0&&i!==0&&o[i-1].getWidth(c-1)===2&&(o[i].copyCellsFrom(o[i-1],c-1,n++,1,!1),o[i-1].setCell(c-1,p))}o[i].replaceCells(n,c,p);let S=0;for(let h=o.length-1;h>0&&(h>i||o[h].getTrimmedLength()===0);h--)S++;S>0&&(v.push(_+o.length-S),v.push(S)),_+=o.length-1}return v},t.reflowLargerCreateNewLayout=function(l,a){const c=[];let u=0,p=a[u],v=0;for(let _=0;_<l.length;_++)if(p===_){const e=a[++u];l.onDeleteEmitter.fire({index:_-v,amount:e}),_+=e-1,v+=e,p=a[++u]}else c.push(_);return{layout:c,countRemoved:v}},t.reflowLargerApplyNewLayout=function(l,a){const c=[];for(let u=0;u<a.length;u++)c.push(l.get(a[u]));for(let u=0;u<c.length;u++)l.set(u,c[u]);l.length=a.length},t.reflowSmallerGetNewLineLengths=function(l,a,c){const u=[],p=l.map((s,o)=>r(l,o,a)).reduce((s,o)=>s+o);let v=0,_=0,e=0;for(;e<p;){if(p-e<c){u.push(p-e);break}v+=c;const s=r(l,_,a);v>s&&(v-=s,_++);const o=l[_].getWidth(v-1)===2;o&&v--;const i=o?c-1:c;u.push(i),e+=i}return u},t.getWrappedLineTrimmedLength=r},5295:(F,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferSet=void 0;const l=r(9092),a=r(8460),c=r(844);class u extends c.Disposable{constructor(v,_){super(),this._optionsService=v,this._bufferService=_,this._onBufferActivate=this.register(new a.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new l.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new l.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(v){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(v),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(v,_){this._normal.resize(v,_),this._alt.resize(v,_),this.setupTabStops(v)}setupTabStops(v){this._normal.setupTabStops(v),this._alt.setupTabStops(v)}}t.BufferSet=u},511:(F,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CellData=void 0;const l=r(482),a=r(643),c=r(3734);class u extends c.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new c.ExtendedAttrs,this.combinedData=""}static fromCharData(v){const _=new u;return _.setFromCharData(v),_}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,l.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(v){this.fg=v[a.CHAR_DATA_ATTR_INDEX],this.bg=0;let _=!1;if(v[a.CHAR_DATA_CHAR_INDEX].length>2)_=!0;else if(v[a.CHAR_DATA_CHAR_INDEX].length===2){const e=v[a.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=e&&e<=56319){const s=v[a.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=s&&s<=57343?this.content=1024*(e-55296)+s-56320+65536|v[a.CHAR_DATA_WIDTH_INDEX]<<22:_=!0}else _=!0}else this.content=v[a.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|v[a.CHAR_DATA_WIDTH_INDEX]<<22;_&&(this.combinedData=v[a.CHAR_DATA_CHAR_INDEX],this.content=2097152|v[a.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}t.CellData=u},643:(F,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WHITESPACE_CELL_CODE=t.WHITESPACE_CELL_WIDTH=t.WHITESPACE_CELL_CHAR=t.NULL_CELL_CODE=t.NULL_CELL_WIDTH=t.NULL_CELL_CHAR=t.CHAR_DATA_CODE_INDEX=t.CHAR_DATA_WIDTH_INDEX=t.CHAR_DATA_CHAR_INDEX=t.CHAR_DATA_ATTR_INDEX=t.DEFAULT_EXT=t.DEFAULT_ATTR=t.DEFAULT_COLOR=void 0,t.DEFAULT_COLOR=0,t.DEFAULT_ATTR=256|t.DEFAULT_COLOR<<9,t.DEFAULT_EXT=0,t.CHAR_DATA_ATTR_INDEX=0,t.CHAR_DATA_CHAR_INDEX=1,t.CHAR_DATA_WIDTH_INDEX=2,t.CHAR_DATA_CODE_INDEX=3,t.NULL_CELL_CHAR="",t.NULL_CELL_WIDTH=1,t.NULL_CELL_CODE=0,t.WHITESPACE_CELL_CHAR=" ",t.WHITESPACE_CELL_WIDTH=1,t.WHITESPACE_CELL_CODE=32},4863:(F,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Marker=void 0;const l=r(8460),a=r(844);class c{constructor(p){this.line=p,this.isDisposed=!1,this._disposables=[],this._id=c._nextId++,this._onDispose=this.register(new l.EventEmitter),this.onDispose=this._onDispose.event}get id(){return this._id}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,a.disposeArray)(this._disposables),this._disposables.length=0)}register(p){return this._disposables.push(p),p}}t.Marker=c,c._nextId=1},7116:(F,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_CHARSET=t.CHARSETS=void 0,t.CHARSETS={},t.DEFAULT_CHARSET=t.CHARSETS.B,t.CHARSETS[0]={"`":"◆",a:"▒",b:"␉",c:"␌",d:"␍",e:"␊",f:"°",g:"±",h:"␤",i:"␋",j:"┘",k:"┐",l:"┌",m:"└",n:"┼",o:"⎺",p:"⎻",q:"─",r:"⎼",s:"⎽",t:"├",u:"┤",v:"┴",w:"┬",x:"│",y:"≤",z:"≥","{":"π","|":"≠","}":"£","~":"·"},t.CHARSETS.A={"#":"£"},t.CHARSETS.B=void 0,t.CHARSETS[4]={"#":"£","@":"¾","[":"ij","\\":"½","]":"|","{":"¨","|":"f","}":"¼","~":"´"},t.CHARSETS.C=t.CHARSETS[5]={"[":"Ä","\\":"Ö","]":"Å","^":"Ü","`":"é","{":"ä","|":"ö","}":"å","~":"ü"},t.CHARSETS.R={"#":"£","@":"à","[":"°","\\":"ç","]":"§","{":"é","|":"ù","}":"è","~":"¨"},t.CHARSETS.Q={"@":"à","[":"â","\\":"ç","]":"ê","^":"î","`":"ô","{":"é","|":"ù","}":"è","~":"û"},t.CHARSETS.K={"@":"§","[":"Ä","\\":"Ö","]":"Ü","{":"ä","|":"ö","}":"ü","~":"ß"},t.CHARSETS.Y={"#":"£","@":"§","[":"°","\\":"ç","]":"é","`":"ù","{":"à","|":"ò","}":"è","~":"ì"},t.CHARSETS.E=t.CHARSETS[6]={"@":"Ä","[":"Æ","\\":"Ø","]":"Å","^":"Ü","`":"ä","{":"æ","|":"ø","}":"å","~":"ü"},t.CHARSETS.Z={"#":"£","@":"§","[":"¡","\\":"Ñ","]":"¿","{":"°","|":"ñ","}":"ç"},t.CHARSETS.H=t.CHARSETS[7]={"@":"É","[":"Ä","\\":"Ö","]":"Å","^":"Ü","`":"é","{":"ä","|":"ö","}":"å","~":"ü"},t.CHARSETS["="]={"#":"ù","@":"à","[":"é","\\":"ç","]":"ê","^":"î",_:"è","`":"ô","{":"ä","|":"ö","}":"ü","~":"û"}},2584:(F,t)=>{var r,l;Object.defineProperty(t,"__esModule",{value:!0}),t.C1_ESCAPED=t.C1=t.C0=void 0,function(a){a.NUL="\0",a.SOH="",a.STX="",a.ETX="",a.EOT="",a.ENQ="",a.ACK="",a.BEL="\x07",a.BS="\b",a.HT="	",a.LF=`
`,a.VT="\v",a.FF="\f",a.CR="\r",a.SO="",a.SI="",a.DLE="",a.DC1="",a.DC2="",a.DC3="",a.DC4="",a.NAK="",a.SYN="",a.ETB="",a.CAN="",a.EM="",a.SUB="",a.ESC="\x1B",a.FS="",a.GS="",a.RS="",a.US="",a.SP=" ",a.DEL=""}(r=t.C0||(t.C0={})),(l=t.C1||(t.C1={})).PAD="",l.HOP="",l.BPH="",l.NBH="",l.IND="",l.NEL="",l.SSA="",l.ESA="",l.HTS="",l.HTJ="",l.VTS="",l.PLD="",l.PLU="",l.RI="",l.SS2="",l.SS3="",l.DCS="",l.PU1="",l.PU2="",l.STS="",l.CCH="",l.MW="",l.SPA="",l.EPA="",l.SOS="",l.SGCI="",l.SCI="",l.CSI="",l.ST="",l.OSC="",l.PM="",l.APC="",(t.C1_ESCAPED||(t.C1_ESCAPED={})).ST=`${r.ESC}\\`},7399:(F,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateKeyboardEvent=void 0;const l=r(2584),a={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};t.evaluateKeyboardEvent=function(c,u,p,v){const _={type:0,cancel:!1,key:void 0},e=(c.shiftKey?1:0)|(c.altKey?2:0)|(c.ctrlKey?4:0)|(c.metaKey?8:0);switch(c.keyCode){case 0:c.key==="UIKeyInputUpArrow"?_.key=u?l.C0.ESC+"OA":l.C0.ESC+"[A":c.key==="UIKeyInputLeftArrow"?_.key=u?l.C0.ESC+"OD":l.C0.ESC+"[D":c.key==="UIKeyInputRightArrow"?_.key=u?l.C0.ESC+"OC":l.C0.ESC+"[C":c.key==="UIKeyInputDownArrow"&&(_.key=u?l.C0.ESC+"OB":l.C0.ESC+"[B");break;case 8:if(c.altKey){_.key=l.C0.ESC+l.C0.DEL;break}_.key=l.C0.DEL;break;case 9:if(c.shiftKey){_.key=l.C0.ESC+"[Z";break}_.key=l.C0.HT,_.cancel=!0;break;case 13:_.key=c.altKey?l.C0.ESC+l.C0.CR:l.C0.CR,_.cancel=!0;break;case 27:_.key=l.C0.ESC,c.altKey&&(_.key=l.C0.ESC+l.C0.ESC),_.cancel=!0;break;case 37:if(c.metaKey)break;e?(_.key=l.C0.ESC+"[1;"+(e+1)+"D",_.key===l.C0.ESC+"[1;3D"&&(_.key=l.C0.ESC+(p?"b":"[1;5D"))):_.key=u?l.C0.ESC+"OD":l.C0.ESC+"[D";break;case 39:if(c.metaKey)break;e?(_.key=l.C0.ESC+"[1;"+(e+1)+"C",_.key===l.C0.ESC+"[1;3C"&&(_.key=l.C0.ESC+(p?"f":"[1;5C"))):_.key=u?l.C0.ESC+"OC":l.C0.ESC+"[C";break;case 38:if(c.metaKey)break;e?(_.key=l.C0.ESC+"[1;"+(e+1)+"A",p||_.key!==l.C0.ESC+"[1;3A"||(_.key=l.C0.ESC+"[1;5A")):_.key=u?l.C0.ESC+"OA":l.C0.ESC+"[A";break;case 40:if(c.metaKey)break;e?(_.key=l.C0.ESC+"[1;"+(e+1)+"B",p||_.key!==l.C0.ESC+"[1;3B"||(_.key=l.C0.ESC+"[1;5B")):_.key=u?l.C0.ESC+"OB":l.C0.ESC+"[B";break;case 45:c.shiftKey||c.ctrlKey||(_.key=l.C0.ESC+"[2~");break;case 46:_.key=e?l.C0.ESC+"[3;"+(e+1)+"~":l.C0.ESC+"[3~";break;case 36:_.key=e?l.C0.ESC+"[1;"+(e+1)+"H":u?l.C0.ESC+"OH":l.C0.ESC+"[H";break;case 35:_.key=e?l.C0.ESC+"[1;"+(e+1)+"F":u?l.C0.ESC+"OF":l.C0.ESC+"[F";break;case 33:c.shiftKey?_.type=2:c.ctrlKey?_.key=l.C0.ESC+"[5;"+(e+1)+"~":_.key=l.C0.ESC+"[5~";break;case 34:c.shiftKey?_.type=3:c.ctrlKey?_.key=l.C0.ESC+"[6;"+(e+1)+"~":_.key=l.C0.ESC+"[6~";break;case 112:_.key=e?l.C0.ESC+"[1;"+(e+1)+"P":l.C0.ESC+"OP";break;case 113:_.key=e?l.C0.ESC+"[1;"+(e+1)+"Q":l.C0.ESC+"OQ";break;case 114:_.key=e?l.C0.ESC+"[1;"+(e+1)+"R":l.C0.ESC+"OR";break;case 115:_.key=e?l.C0.ESC+"[1;"+(e+1)+"S":l.C0.ESC+"OS";break;case 116:_.key=e?l.C0.ESC+"[15;"+(e+1)+"~":l.C0.ESC+"[15~";break;case 117:_.key=e?l.C0.ESC+"[17;"+(e+1)+"~":l.C0.ESC+"[17~";break;case 118:_.key=e?l.C0.ESC+"[18;"+(e+1)+"~":l.C0.ESC+"[18~";break;case 119:_.key=e?l.C0.ESC+"[19;"+(e+1)+"~":l.C0.ESC+"[19~";break;case 120:_.key=e?l.C0.ESC+"[20;"+(e+1)+"~":l.C0.ESC+"[20~";break;case 121:_.key=e?l.C0.ESC+"[21;"+(e+1)+"~":l.C0.ESC+"[21~";break;case 122:_.key=e?l.C0.ESC+"[23;"+(e+1)+"~":l.C0.ESC+"[23~";break;case 123:_.key=e?l.C0.ESC+"[24;"+(e+1)+"~":l.C0.ESC+"[24~";break;default:if(!c.ctrlKey||c.shiftKey||c.altKey||c.metaKey)if(p&&!v||!c.altKey||c.metaKey)!p||c.altKey||c.ctrlKey||c.shiftKey||!c.metaKey?c.key&&!c.ctrlKey&&!c.altKey&&!c.metaKey&&c.keyCode>=48&&c.key.length===1?_.key=c.key:c.key&&c.ctrlKey&&(c.key==="_"&&(_.key=l.C0.US),c.key==="@"&&(_.key=l.C0.NUL)):c.keyCode===65&&(_.type=1);else{const s=a[c.keyCode],o=s?.[c.shiftKey?1:0];if(o)_.key=l.C0.ESC+o;else if(c.keyCode>=65&&c.keyCode<=90){const i=c.ctrlKey?c.keyCode-64:c.keyCode+32;let n=String.fromCharCode(i);c.shiftKey&&(n=n.toUpperCase()),_.key=l.C0.ESC+n}else if(c.keyCode===32)_.key=l.C0.ESC+(c.ctrlKey?l.C0.NUL:" ");else if(c.key==="Dead"&&c.code.startsWith("Key")){let i=c.code.slice(3,4);c.shiftKey||(i=i.toLowerCase()),_.key=l.C0.ESC+i,_.cancel=!0}}else c.keyCode>=65&&c.keyCode<=90?_.key=String.fromCharCode(c.keyCode-64):c.keyCode===32?_.key=l.C0.NUL:c.keyCode>=51&&c.keyCode<=55?_.key=String.fromCharCode(c.keyCode-51+27):c.keyCode===56?_.key=l.C0.DEL:c.keyCode===219?_.key=l.C0.ESC:c.keyCode===220?_.key=l.C0.FS:c.keyCode===221&&(_.key=l.C0.GS)}return _}},482:(F,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Utf8ToUtf32=t.StringToUtf32=t.utf32ToString=t.stringFromCodePoint=void 0,t.stringFromCodePoint=function(r){return r>65535?(r-=65536,String.fromCharCode(55296+(r>>10))+String.fromCharCode(r%1024+56320)):String.fromCharCode(r)},t.utf32ToString=function(r,l=0,a=r.length){let c="";for(let u=l;u<a;++u){let p=r[u];p>65535?(p-=65536,c+=String.fromCharCode(55296+(p>>10))+String.fromCharCode(p%1024+56320)):c+=String.fromCharCode(p)}return c},t.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(r,l){const a=r.length;if(!a)return 0;let c=0,u=0;if(this._interim){const p=r.charCodeAt(u++);56320<=p&&p<=57343?l[c++]=1024*(this._interim-55296)+p-56320+65536:(l[c++]=this._interim,l[c++]=p),this._interim=0}for(let p=u;p<a;++p){const v=r.charCodeAt(p);if(55296<=v&&v<=56319){if(++p>=a)return this._interim=v,c;const _=r.charCodeAt(p);56320<=_&&_<=57343?l[c++]=1024*(v-55296)+_-56320+65536:(l[c++]=v,l[c++]=_)}else v!==65279&&(l[c++]=v)}return c}},t.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(r,l){const a=r.length;if(!a)return 0;let c,u,p,v,_=0,e=0,s=0;if(this.interim[0]){let n=!1,d=this.interim[0];d&=(224&d)==192?31:(240&d)==224?15:7;let g,S=0;for(;(g=63&this.interim[++S])&&S<4;)d<<=6,d|=g;const h=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,D=h-S;for(;s<D;){if(s>=a)return 0;if(g=r[s++],(192&g)!=128){s--,n=!0;break}this.interim[S++]=g,d<<=6,d|=63&g}n||(h===2?d<128?s--:l[_++]=d:h===3?d<2048||d>=55296&&d<=57343||d===65279||(l[_++]=d):d<65536||d>1114111||(l[_++]=d)),this.interim.fill(0)}const o=a-4;let i=s;for(;i<a;){for(;!(!(i<o)||128&(c=r[i])||128&(u=r[i+1])||128&(p=r[i+2])||128&(v=r[i+3]));)l[_++]=c,l[_++]=u,l[_++]=p,l[_++]=v,i+=4;if(c=r[i++],c<128)l[_++]=c;else if((224&c)==192){if(i>=a)return this.interim[0]=c,_;if(u=r[i++],(192&u)!=128){i--;continue}if(e=(31&c)<<6|63&u,e<128){i--;continue}l[_++]=e}else if((240&c)==224){if(i>=a)return this.interim[0]=c,_;if(u=r[i++],(192&u)!=128){i--;continue}if(i>=a)return this.interim[0]=c,this.interim[1]=u,_;if(p=r[i++],(192&p)!=128){i--;continue}if(e=(15&c)<<12|(63&u)<<6|63&p,e<2048||e>=55296&&e<=57343||e===65279)continue;l[_++]=e}else if((248&c)==240){if(i>=a)return this.interim[0]=c,_;if(u=r[i++],(192&u)!=128){i--;continue}if(i>=a)return this.interim[0]=c,this.interim[1]=u,_;if(p=r[i++],(192&p)!=128){i--;continue}if(i>=a)return this.interim[0]=c,this.interim[1]=u,this.interim[2]=p,_;if(v=r[i++],(192&v)!=128){i--;continue}if(e=(7&c)<<18|(63&u)<<12|(63&p)<<6|63&v,e<65536||e>1114111)continue;l[_++]=e}}return _}}},225:(F,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeV6=void 0;const r=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],l=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]];let a;t.UnicodeV6=class{constructor(){if(this.version="6",!a){a=new Uint8Array(65536),a.fill(1),a[0]=0,a.fill(0,1,32),a.fill(0,127,160),a.fill(2,4352,4448),a[9001]=2,a[9002]=2,a.fill(2,11904,42192),a[12351]=1,a.fill(2,44032,55204),a.fill(2,63744,64256),a.fill(2,65040,65050),a.fill(2,65072,65136),a.fill(2,65280,65377),a.fill(2,65504,65511);for(let c=0;c<r.length;++c)a.fill(0,r[c][0],r[c][1]+1)}}wcwidth(c){return c<32?0:c<127?1:c<65536?a[c]:function(u,p){let v,_=0,e=p.length-1;if(u<p[0][0]||u>p[e][1])return!1;for(;e>=_;)if(v=_+e>>1,u>p[v][1])_=v+1;else{if(!(u<p[v][0]))return!0;e=v-1}return!1}(c,l)?0:c>=131072&&c<=196605||c>=196608&&c<=262141?2:1}}},5981:(F,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WriteBuffer=void 0;const l=r(8460),a=r(844);class c extends a.Disposable{constructor(p){super(),this._action=p,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new l.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(p,v){if(v!==void 0&&this._syncCalls>v)return void(this._syncCalls=0);if(this._pendingData+=p.length,this._writeBuffer.push(p),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let _;for(this._isSyncWriting=!0;_=this._writeBuffer.shift();){this._action(_);const e=this._callbacks.shift();e&&e()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(p,v){if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=p.length,this._writeBuffer.push(p),this._callbacks.push(v),void this._innerWrite();setTimeout(()=>this._innerWrite())}this._pendingData+=p.length,this._writeBuffer.push(p),this._callbacks.push(v)}_innerWrite(p=0,v=!0){const _=p||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){const e=this._writeBuffer[this._bufferOffset],s=this._action(e,v);if(s){const i=n=>Date.now()-_>=12?setTimeout(()=>this._innerWrite(0,n)):this._innerWrite(_,n);return void s.catch(n=>(queueMicrotask(()=>{throw n}),Promise.resolve(!1))).then(i)}const o=this._callbacks[this._bufferOffset];if(o&&o(),this._bufferOffset++,this._pendingData-=e.length,Date.now()-_>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}t.WriteBuffer=c},5941:(F,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toRgbString=t.parseColor=void 0;const r=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,l=/^[\da-f]+$/;function a(c,u){const p=c.toString(16),v=p.length<2?"0"+p:p;switch(u){case 4:return p[0];case 8:return v;case 12:return(v+v).slice(0,3);default:return v+v}}t.parseColor=function(c){if(!c)return;let u=c.toLowerCase();if(u.indexOf("rgb:")===0){u=u.slice(4);const p=r.exec(u);if(p){const v=p[1]?15:p[4]?255:p[7]?4095:65535;return[Math.round(parseInt(p[1]||p[4]||p[7]||p[10],16)/v*255),Math.round(parseInt(p[2]||p[5]||p[8]||p[11],16)/v*255),Math.round(parseInt(p[3]||p[6]||p[9]||p[12],16)/v*255)]}}else if(u.indexOf("#")===0&&(u=u.slice(1),l.exec(u)&&[3,6,9,12].includes(u.length))){const p=u.length/3,v=[0,0,0];for(let _=0;_<3;++_){const e=parseInt(u.slice(p*_,p*_+p),16);v[_]=p===1?e<<4:p===2?e:p===3?e>>4:e>>8}return v}},t.toRgbString=function(c,u=16){const[p,v,_]=c;return`rgb:${a(p,u)}/${a(v,u)}/${a(_,u)}`}},5770:(F,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PAYLOAD_LIMIT=void 0,t.PAYLOAD_LIMIT=1e7},6351:(F,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DcsHandler=t.DcsParser=void 0;const l=r(482),a=r(8742),c=r(5770),u=[];t.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=u,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=u}registerHandler(v,_){this._handlers[v]===void 0&&(this._handlers[v]=[]);const e=this._handlers[v];return e.push(_),{dispose:()=>{const s=e.indexOf(_);s!==-1&&e.splice(s,1)}}}clearHandler(v){this._handlers[v]&&delete this._handlers[v]}setHandlerFallback(v){this._handlerFb=v}reset(){if(this._active.length)for(let v=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;v>=0;--v)this._active[v].unhook(!1);this._stack.paused=!1,this._active=u,this._ident=0}hook(v,_){if(this.reset(),this._ident=v,this._active=this._handlers[v]||u,this._active.length)for(let e=this._active.length-1;e>=0;e--)this._active[e].hook(_);else this._handlerFb(this._ident,"HOOK",_)}put(v,_,e){if(this._active.length)for(let s=this._active.length-1;s>=0;s--)this._active[s].put(v,_,e);else this._handlerFb(this._ident,"PUT",(0,l.utf32ToString)(v,_,e))}unhook(v,_=!0){if(this._active.length){let e=!1,s=this._active.length-1,o=!1;if(this._stack.paused&&(s=this._stack.loopPosition-1,e=_,o=this._stack.fallThrough,this._stack.paused=!1),!o&&e===!1){for(;s>=0&&(e=this._active[s].unhook(v),e!==!0);s--)if(e instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=s,this._stack.fallThrough=!1,e;s--}for(;s>=0;s--)if(e=this._active[s].unhook(!1),e instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=s,this._stack.fallThrough=!0,e}else this._handlerFb(this._ident,"UNHOOK",v);this._active=u,this._ident=0}};const p=new a.Params;p.addParam(0),t.DcsHandler=class{constructor(v){this._handler=v,this._data="",this._params=p,this._hitLimit=!1}hook(v){this._params=v.length>1||v.params[0]?v.clone():p,this._data="",this._hitLimit=!1}put(v,_,e){this._hitLimit||(this._data+=(0,l.utf32ToString)(v,_,e),this._data.length>c.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(v){let _=!1;if(this._hitLimit)_=!1;else if(v&&(_=this._handler(this._data,this._params),_ instanceof Promise))return _.then(e=>(this._params=p,this._data="",this._hitLimit=!1,e));return this._params=p,this._data="",this._hitLimit=!1,_}}},2015:(F,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EscapeSequenceParser=t.VT500_TRANSITION_TABLE=t.TransitionTable=void 0;const l=r(844),a=r(8742),c=r(6242),u=r(6351);class p{constructor(s){this.table=new Uint8Array(s)}setDefault(s,o){this.table.fill(s<<4|o)}add(s,o,i,n){this.table[o<<8|s]=i<<4|n}addMany(s,o,i,n){for(let d=0;d<s.length;d++)this.table[o<<8|s[d]]=i<<4|n}}t.TransitionTable=p;const v=160;t.VT500_TRANSITION_TABLE=function(){const e=new p(4095),s=Array.apply(null,Array(256)).map((S,h)=>h),o=(S,h)=>s.slice(S,h),i=o(32,127),n=o(0,24);n.push(25),n.push.apply(n,o(28,32));const d=o(0,14);let g;for(g in e.setDefault(1,0),e.addMany(i,0,2,0),d)e.addMany([24,26,153,154],g,3,0),e.addMany(o(128,144),g,3,0),e.addMany(o(144,152),g,3,0),e.add(156,g,0,0),e.add(27,g,11,1),e.add(157,g,4,8),e.addMany([152,158,159],g,0,7),e.add(155,g,11,3),e.add(144,g,11,9);return e.addMany(n,0,3,0),e.addMany(n,1,3,1),e.add(127,1,0,1),e.addMany(n,8,0,8),e.addMany(n,3,3,3),e.add(127,3,0,3),e.addMany(n,4,3,4),e.add(127,4,0,4),e.addMany(n,6,3,6),e.addMany(n,5,3,5),e.add(127,5,0,5),e.addMany(n,2,3,2),e.add(127,2,0,2),e.add(93,1,4,8),e.addMany(i,8,5,8),e.add(127,8,5,8),e.addMany([156,27,24,26,7],8,6,0),e.addMany(o(28,32),8,0,8),e.addMany([88,94,95],1,0,7),e.addMany(i,7,0,7),e.addMany(n,7,0,7),e.add(156,7,0,0),e.add(127,7,0,7),e.add(91,1,11,3),e.addMany(o(64,127),3,7,0),e.addMany(o(48,60),3,8,4),e.addMany([60,61,62,63],3,9,4),e.addMany(o(48,60),4,8,4),e.addMany(o(64,127),4,7,0),e.addMany([60,61,62,63],4,0,6),e.addMany(o(32,64),6,0,6),e.add(127,6,0,6),e.addMany(o(64,127),6,0,0),e.addMany(o(32,48),3,9,5),e.addMany(o(32,48),5,9,5),e.addMany(o(48,64),5,0,6),e.addMany(o(64,127),5,7,0),e.addMany(o(32,48),4,9,5),e.addMany(o(32,48),1,9,2),e.addMany(o(32,48),2,9,2),e.addMany(o(48,127),2,10,0),e.addMany(o(48,80),1,10,0),e.addMany(o(81,88),1,10,0),e.addMany([89,90,92],1,10,0),e.addMany(o(96,127),1,10,0),e.add(80,1,11,9),e.addMany(n,9,0,9),e.add(127,9,0,9),e.addMany(o(28,32),9,0,9),e.addMany(o(32,48),9,9,12),e.addMany(o(48,60),9,8,10),e.addMany([60,61,62,63],9,9,10),e.addMany(n,11,0,11),e.addMany(o(32,128),11,0,11),e.addMany(o(28,32),11,0,11),e.addMany(n,10,0,10),e.add(127,10,0,10),e.addMany(o(28,32),10,0,10),e.addMany(o(48,60),10,8,10),e.addMany([60,61,62,63],10,0,11),e.addMany(o(32,48),10,9,12),e.addMany(n,12,0,12),e.add(127,12,0,12),e.addMany(o(28,32),12,0,12),e.addMany(o(32,48),12,9,12),e.addMany(o(48,64),12,0,11),e.addMany(o(64,127),12,12,13),e.addMany(o(64,127),10,12,13),e.addMany(o(64,127),9,12,13),e.addMany(n,13,13,13),e.addMany(i,13,13,13),e.add(127,13,0,13),e.addMany([27,156,24,26],13,14,0),e.add(v,0,2,0),e.add(v,8,5,8),e.add(v,6,0,6),e.add(v,11,0,11),e.add(v,13,13,13),e}();class _ extends l.Disposable{constructor(s=t.VT500_TRANSITION_TABLE){super(),this._transitions=s,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new a.Params,this._params.addParam(0),this._collect=0,this.precedingCodepoint=0,this._printHandlerFb=(o,i,n)=>{},this._executeHandlerFb=o=>{},this._csiHandlerFb=(o,i)=>{},this._escHandlerFb=o=>{},this._errorHandlerFb=o=>o,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register((0,l.toDisposable)(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this.register(new c.OscParser),this._dcsParser=this.register(new u.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier(s,o=[64,126]){let i=0;if(s.prefix){if(s.prefix.length>1)throw new Error("only one byte as prefix supported");if(i=s.prefix.charCodeAt(0),i&&60>i||i>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(s.intermediates){if(s.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let d=0;d<s.intermediates.length;++d){const g=s.intermediates.charCodeAt(d);if(32>g||g>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");i<<=8,i|=g}}if(s.final.length!==1)throw new Error("final must be a single byte");const n=s.final.charCodeAt(0);if(o[0]>n||n>o[1])throw new Error(`final must be in range ${o[0]} .. ${o[1]}`);return i<<=8,i|=n,i}identToString(s){const o=[];for(;s;)o.push(String.fromCharCode(255&s)),s>>=8;return o.reverse().join("")}setPrintHandler(s){this._printHandler=s}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(s,o){const i=this._identifier(s,[48,126]);this._escHandlers[i]===void 0&&(this._escHandlers[i]=[]);const n=this._escHandlers[i];return n.push(o),{dispose:()=>{const d=n.indexOf(o);d!==-1&&n.splice(d,1)}}}clearEscHandler(s){this._escHandlers[this._identifier(s,[48,126])]&&delete this._escHandlers[this._identifier(s,[48,126])]}setEscHandlerFallback(s){this._escHandlerFb=s}setExecuteHandler(s,o){this._executeHandlers[s.charCodeAt(0)]=o}clearExecuteHandler(s){this._executeHandlers[s.charCodeAt(0)]&&delete this._executeHandlers[s.charCodeAt(0)]}setExecuteHandlerFallback(s){this._executeHandlerFb=s}registerCsiHandler(s,o){const i=this._identifier(s);this._csiHandlers[i]===void 0&&(this._csiHandlers[i]=[]);const n=this._csiHandlers[i];return n.push(o),{dispose:()=>{const d=n.indexOf(o);d!==-1&&n.splice(d,1)}}}clearCsiHandler(s){this._csiHandlers[this._identifier(s)]&&delete this._csiHandlers[this._identifier(s)]}setCsiHandlerFallback(s){this._csiHandlerFb=s}registerDcsHandler(s,o){return this._dcsParser.registerHandler(this._identifier(s),o)}clearDcsHandler(s){this._dcsParser.clearHandler(this._identifier(s))}setDcsHandlerFallback(s){this._dcsParser.setHandlerFallback(s)}registerOscHandler(s,o){return this._oscParser.registerHandler(s,o)}clearOscHandler(s){this._oscParser.clearHandler(s)}setOscHandlerFallback(s){this._oscParser.setHandlerFallback(s)}setErrorHandler(s){this._errorHandler=s}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(s,o,i,n,d){this._parseStack.state=s,this._parseStack.handlers=o,this._parseStack.handlerPos=i,this._parseStack.transition=n,this._parseStack.chunkPos=d}parse(s,o,i){let n,d=0,g=0,S=0;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,S=this._parseStack.chunkPos+1;else{if(i===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");const h=this._parseStack.handlers;let D=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(i===!1&&D>-1){for(;D>=0&&(n=h[D](this._params),n!==!0);D--)if(n instanceof Promise)return this._parseStack.handlerPos=D,n}this._parseStack.handlers=[];break;case 4:if(i===!1&&D>-1){for(;D>=0&&(n=h[D](),n!==!0);D--)if(n instanceof Promise)return this._parseStack.handlerPos=D,n}this._parseStack.handlers=[];break;case 6:if(d=s[this._parseStack.chunkPos],n=this._dcsParser.unhook(d!==24&&d!==26,i),n)return n;d===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(d=s[this._parseStack.chunkPos],n=this._oscParser.end(d!==24&&d!==26,i),n)return n;d===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,S=this._parseStack.chunkPos+1,this.precedingCodepoint=0,this.currentState=15&this._parseStack.transition}for(let h=S;h<o;++h){switch(d=s[h],g=this._transitions.table[this.currentState<<8|(d<160?d:v)],g>>4){case 2:for(let M=h+1;;++M){if(M>=o||(d=s[M])<32||d>126&&d<v){this._printHandler(s,h,M),h=M-1;break}if(++M>=o||(d=s[M])<32||d>126&&d<v){this._printHandler(s,h,M),h=M-1;break}if(++M>=o||(d=s[M])<32||d>126&&d<v){this._printHandler(s,h,M),h=M-1;break}if(++M>=o||(d=s[M])<32||d>126&&d<v){this._printHandler(s,h,M),h=M-1;break}}break;case 3:this._executeHandlers[d]?this._executeHandlers[d]():this._executeHandlerFb(d),this.precedingCodepoint=0;break;case 0:break;case 1:if(this._errorHandler({position:h,code:d,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:const D=this._csiHandlers[this._collect<<8|d];let y=D?D.length-1:-1;for(;y>=0&&(n=D[y](this._params),n!==!0);y--)if(n instanceof Promise)return this._preserveStack(3,D,y,g,h),n;y<0&&this._csiHandlerFb(this._collect<<8|d,this._params),this.precedingCodepoint=0;break;case 8:do switch(d){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(d-48)}while(++h<o&&(d=s[h])>47&&d<60);h--;break;case 9:this._collect<<=8,this._collect|=d;break;case 10:const L=this._escHandlers[this._collect<<8|d];let A=L?L.length-1:-1;for(;A>=0&&(n=L[A](),n!==!0);A--)if(n instanceof Promise)return this._preserveStack(4,L,A,g,h),n;A<0&&this._escHandlerFb(this._collect<<8|d),this.precedingCodepoint=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|d,this._params);break;case 13:for(let M=h+1;;++M)if(M>=o||(d=s[M])===24||d===26||d===27||d>127&&d<v){this._dcsParser.put(s,h,M),h=M-1;break}break;case 14:if(n=this._dcsParser.unhook(d!==24&&d!==26),n)return this._preserveStack(6,[],0,g,h),n;d===27&&(g|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0;break;case 4:this._oscParser.start();break;case 5:for(let M=h+1;;M++)if(M>=o||(d=s[M])<32||d>127&&d<v){this._oscParser.put(s,h,M),h=M-1;break}break;case 6:if(n=this._oscParser.end(d!==24&&d!==26),n)return this._preserveStack(5,[],0,g,h),n;d===27&&(g|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0}this.currentState=15&g}}}t.EscapeSequenceParser=_},6242:(F,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OscHandler=t.OscParser=void 0;const l=r(5770),a=r(482),c=[];t.OscParser=class{constructor(){this._state=0,this._active=c,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(u,p){this._handlers[u]===void 0&&(this._handlers[u]=[]);const v=this._handlers[u];return v.push(p),{dispose:()=>{const _=v.indexOf(p);_!==-1&&v.splice(_,1)}}}clearHandler(u){this._handlers[u]&&delete this._handlers[u]}setHandlerFallback(u){this._handlerFb=u}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=c}reset(){if(this._state===2)for(let u=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;u>=0;--u)this._active[u].end(!1);this._stack.paused=!1,this._active=c,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||c,this._active.length)for(let u=this._active.length-1;u>=0;u--)this._active[u].start();else this._handlerFb(this._id,"START")}_put(u,p,v){if(this._active.length)for(let _=this._active.length-1;_>=0;_--)this._active[_].put(u,p,v);else this._handlerFb(this._id,"PUT",(0,a.utf32ToString)(u,p,v))}start(){this.reset(),this._state=1}put(u,p,v){if(this._state!==3){if(this._state===1)for(;p<v;){const _=u[p++];if(_===59){this._state=2,this._start();break}if(_<48||57<_)return void(this._state=3);this._id===-1&&(this._id=0),this._id=10*this._id+_-48}this._state===2&&v-p>0&&this._put(u,p,v)}}end(u,p=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),this._active.length){let v=!1,_=this._active.length-1,e=!1;if(this._stack.paused&&(_=this._stack.loopPosition-1,v=p,e=this._stack.fallThrough,this._stack.paused=!1),!e&&v===!1){for(;_>=0&&(v=this._active[_].end(u),v!==!0);_--)if(v instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=_,this._stack.fallThrough=!1,v;_--}for(;_>=0;_--)if(v=this._active[_].end(!1),v instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=_,this._stack.fallThrough=!0,v}else this._handlerFb(this._id,"END",u);this._active=c,this._id=-1,this._state=0}}},t.OscHandler=class{constructor(u){this._handler=u,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(u,p,v){this._hitLimit||(this._data+=(0,a.utf32ToString)(u,p,v),this._data.length>l.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(u){let p=!1;if(this._hitLimit)p=!1;else if(u&&(p=this._handler(this._data),p instanceof Promise))return p.then(v=>(this._data="",this._hitLimit=!1,v));return this._data="",this._hitLimit=!1,p}}},8742:(F,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Params=void 0;const r=2147483647;class l{constructor(c=32,u=32){if(this.maxLength=c,this.maxSubParamsLength=u,u>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(c),this.length=0,this._subParams=new Int32Array(u),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(c),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}static fromArray(c){const u=new l;if(!c.length)return u;for(let p=Array.isArray(c[0])?1:0;p<c.length;++p){const v=c[p];if(Array.isArray(v))for(let _=0;_<v.length;++_)u.addSubParam(v[_]);else u.addParam(v)}return u}clone(){const c=new l(this.maxLength,this.maxSubParamsLength);return c.params.set(this.params),c.length=this.length,c._subParams.set(this._subParams),c._subParamsLength=this._subParamsLength,c._subParamsIdx.set(this._subParamsIdx),c._rejectDigits=this._rejectDigits,c._rejectSubDigits=this._rejectSubDigits,c._digitIsSub=this._digitIsSub,c}toArray(){const c=[];for(let u=0;u<this.length;++u){c.push(this.params[u]);const p=this._subParamsIdx[u]>>8,v=255&this._subParamsIdx[u];v-p>0&&c.push(Array.prototype.slice.call(this._subParams,p,v))}return c}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(c){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(c<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=c>r?r:c}}addSubParam(c){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(c<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=c>r?r:c,this._subParamsIdx[this.length-1]++}}hasSubParams(c){return(255&this._subParamsIdx[c])-(this._subParamsIdx[c]>>8)>0}getSubParams(c){const u=this._subParamsIdx[c]>>8,p=255&this._subParamsIdx[c];return p-u>0?this._subParams.subarray(u,p):null}getSubParamsAll(){const c={};for(let u=0;u<this.length;++u){const p=this._subParamsIdx[u]>>8,v=255&this._subParamsIdx[u];v-p>0&&(c[u]=this._subParams.slice(p,v))}return c}addDigit(c){let u;if(this._rejectDigits||!(u=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;const p=this._digitIsSub?this._subParams:this.params,v=p[u-1];p[u-1]=~v?Math.min(10*v+c,r):c}}t.Params=l},5741:(F,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AddonManager=void 0,t.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let r=this._addons.length-1;r>=0;r--)this._addons[r].instance.dispose()}loadAddon(r,l){const a={instance:l,dispose:l.dispose,isDisposed:!1};this._addons.push(a),l.dispose=()=>this._wrappedAddonDispose(a),l.activate(r)}_wrappedAddonDispose(r){if(r.isDisposed)return;let l=-1;for(let a=0;a<this._addons.length;a++)if(this._addons[a]===r){l=a;break}if(l===-1)throw new Error("Could not dispose an addon that has not been loaded");r.isDisposed=!0,r.dispose.apply(r.instance),this._addons.splice(l,1)}}},8771:(F,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferApiView=void 0;const l=r(3785),a=r(511);t.BufferApiView=class{constructor(c,u){this._buffer=c,this.type=u}init(c){return this._buffer=c,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(c){const u=this._buffer.lines.get(c);if(u)return new l.BufferLineApiView(u)}getNullCell(){return new a.CellData}}},3785:(F,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferLineApiView=void 0;const l=r(511);t.BufferLineApiView=class{constructor(a){this._line=a}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(a,c){if(!(a<0||a>=this._line.length))return c?(this._line.loadCell(a,c),c):this._line.loadCell(a,new l.CellData)}translateToString(a,c,u){return this._line.translateToString(a,c,u)}}},8285:(F,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferNamespaceApi=void 0;const l=r(8771),a=r(8460);t.BufferNamespaceApi=class{constructor(c){this._core=c,this._onBufferChange=new a.EventEmitter,this.onBufferChange=this._onBufferChange.event,this._normal=new l.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new l.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}},7975:(F,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ParserApi=void 0,t.ParserApi=class{constructor(r){this._core=r}registerCsiHandler(r,l){return this._core.registerCsiHandler(r,a=>l(a.toArray()))}addCsiHandler(r,l){return this.registerCsiHandler(r,l)}registerDcsHandler(r,l){return this._core.registerDcsHandler(r,(a,c)=>l(a,c.toArray()))}addDcsHandler(r,l){return this.registerDcsHandler(r,l)}registerEscHandler(r,l){return this._core.registerEscHandler(r,l)}addEscHandler(r,l){return this.registerEscHandler(r,l)}registerOscHandler(r,l){return this._core.registerOscHandler(r,l)}addOscHandler(r,l){return this.registerOscHandler(r,l)}}},7090:(F,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeApi=void 0,t.UnicodeApi=class{constructor(r){this._core=r}register(r){this._core.unicodeService.register(r)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(r){this._core.unicodeService.activeVersion=r}}},744:function(F,t,r){var l=this&&this.__decorate||function(e,s,o,i){var n,d=arguments.length,g=d<3?s:i===null?i=Object.getOwnPropertyDescriptor(s,o):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(e,s,o,i);else for(var S=e.length-1;S>=0;S--)(n=e[S])&&(g=(d<3?n(g):d>3?n(s,o,g):n(s,o))||g);return d>3&&g&&Object.defineProperty(s,o,g),g},a=this&&this.__param||function(e,s){return function(o,i){s(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BufferService=t.MINIMUM_ROWS=t.MINIMUM_COLS=void 0;const c=r(2585),u=r(5295),p=r(8460),v=r(844);t.MINIMUM_COLS=2,t.MINIMUM_ROWS=1;let _=class extends v.Disposable{constructor(e){super(),this.isUserScrolling=!1,this._onResize=this.register(new p.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new p.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(e.rawOptions.cols||0,t.MINIMUM_COLS),this.rows=Math.max(e.rawOptions.rows||0,t.MINIMUM_ROWS),this.buffers=this.register(new u.BufferSet(e,this))}get buffer(){return this.buffers.active}resize(e,s){this.cols=e,this.rows=s,this.buffers.resize(e,s),this._onResize.fire({cols:e,rows:s})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(e,s=!1){const o=this.buffer;let i;i=this._cachedBlankLine,i&&i.length===this.cols&&i.getFg(0)===e.fg&&i.getBg(0)===e.bg||(i=o.getBlankLine(e,s),this._cachedBlankLine=i),i.isWrapped=s;const n=o.ybase+o.scrollTop,d=o.ybase+o.scrollBottom;if(o.scrollTop===0){const g=o.lines.isFull;d===o.lines.length-1?g?o.lines.recycle().copyFrom(i):o.lines.push(i.clone()):o.lines.splice(d+1,0,i.clone()),g?this.isUserScrolling&&(o.ydisp=Math.max(o.ydisp-1,0)):(o.ybase++,this.isUserScrolling||o.ydisp++)}else{const g=d-n+1;o.lines.shiftElements(n+1,g-1,-1),o.lines.set(d,i.clone())}this.isUserScrolling||(o.ydisp=o.ybase),this._onScroll.fire(o.ydisp)}scrollLines(e,s,o){const i=this.buffer;if(e<0){if(i.ydisp===0)return;this.isUserScrolling=!0}else e+i.ydisp>=i.ybase&&(this.isUserScrolling=!1);const n=i.ydisp;i.ydisp=Math.max(Math.min(i.ydisp+e,i.ybase),0),n!==i.ydisp&&(s||this._onScroll.fire(i.ydisp))}scrollPages(e){this.scrollLines(e*(this.rows-1))}scrollToTop(){this.scrollLines(-this.buffer.ydisp)}scrollToBottom(){this.scrollLines(this.buffer.ybase-this.buffer.ydisp)}scrollToLine(e){const s=e-this.buffer.ydisp;s!==0&&this.scrollLines(s)}};_=l([a(0,c.IOptionsService)],_),t.BufferService=_},7994:(F,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CharsetService=void 0,t.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(r){this.glevel=r,this.charset=this._charsets[r]}setgCharset(r,l){this._charsets[r]=l,this.glevel===r&&(this.charset=l)}}},1753:function(F,t,r){var l=this&&this.__decorate||function(i,n,d,g){var S,h=arguments.length,D=h<3?n:g===null?g=Object.getOwnPropertyDescriptor(n,d):g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")D=Reflect.decorate(i,n,d,g);else for(var y=i.length-1;y>=0;y--)(S=i[y])&&(D=(h<3?S(D):h>3?S(n,d,D):S(n,d))||D);return h>3&&D&&Object.defineProperty(n,d,D),D},a=this&&this.__param||function(i,n){return function(d,g){n(d,g,i)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CoreMouseService=void 0;const c=r(2585),u=r(8460),p=r(844),v={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:i=>i.button!==4&&i.action===1&&(i.ctrl=!1,i.alt=!1,i.shift=!1,!0)},VT200:{events:19,restrict:i=>i.action!==32},DRAG:{events:23,restrict:i=>i.action!==32||i.button!==3},ANY:{events:31,restrict:i=>!0}};function _(i,n){let d=(i.ctrl?16:0)|(i.shift?4:0)|(i.alt?8:0);return i.button===4?(d|=64,d|=i.action):(d|=3&i.button,4&i.button&&(d|=64),8&i.button&&(d|=128),i.action===32?d|=32:i.action!==0||n||(d|=3)),d}const e=String.fromCharCode,s={DEFAULT:i=>{const n=[_(i,!1)+32,i.col+32,i.row+32];return n[0]>255||n[1]>255||n[2]>255?"":`\x1B[M${e(n[0])}${e(n[1])}${e(n[2])}`},SGR:i=>{const n=i.action===0&&i.button!==4?"m":"M";return`\x1B[<${_(i,!0)};${i.col};${i.row}${n}`},SGR_PIXELS:i=>{const n=i.action===0&&i.button!==4?"m":"M";return`\x1B[<${_(i,!0)};${i.x};${i.y}${n}`}};let o=class extends p.Disposable{constructor(i,n){super(),this._bufferService=i,this._coreService=n,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new u.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(const d of Object.keys(v))this.addProtocol(d,v[d]);for(const d of Object.keys(s))this.addEncoding(d,s[d]);this.reset()}addProtocol(i,n){this._protocols[i]=n}addEncoding(i,n){this._encodings[i]=n}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(i){if(!this._protocols[i])throw new Error(`unknown protocol "${i}"`);this._activeProtocol=i,this._onProtocolChange.fire(this._protocols[i].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(i){if(!this._encodings[i])throw new Error(`unknown encoding "${i}"`);this._activeEncoding=i}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(i){if(i.col<0||i.col>=this._bufferService.cols||i.row<0||i.row>=this._bufferService.rows||i.button===4&&i.action===32||i.button===3&&i.action!==32||i.button!==4&&(i.action===2||i.action===3)||(i.col++,i.row++,i.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,i,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(i))return!1;const n=this._encodings[this._activeEncoding](i);return n&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(n):this._coreService.triggerDataEvent(n,!0)),this._lastEvent=i,!0}explainEvents(i){return{down:!!(1&i),up:!!(2&i),drag:!!(4&i),move:!!(8&i),wheel:!!(16&i)}}_equalEvents(i,n,d){if(d){if(i.x!==n.x||i.y!==n.y)return!1}else if(i.col!==n.col||i.row!==n.row)return!1;return i.button===n.button&&i.action===n.action&&i.ctrl===n.ctrl&&i.alt===n.alt&&i.shift===n.shift}};o=l([a(0,c.IBufferService),a(1,c.ICoreService)],o),t.CoreMouseService=o},6975:function(F,t,r){var l=this&&this.__decorate||function(o,i,n,d){var g,S=arguments.length,h=S<3?i:d===null?d=Object.getOwnPropertyDescriptor(i,n):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(o,i,n,d);else for(var D=o.length-1;D>=0;D--)(g=o[D])&&(h=(S<3?g(h):S>3?g(i,n,h):g(i,n))||h);return S>3&&h&&Object.defineProperty(i,n,h),h},a=this&&this.__param||function(o,i){return function(n,d){i(n,d,o)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CoreService=void 0;const c=r(2585),u=r(8460),p=r(1439),v=r(844),_=Object.freeze({insertMode:!1}),e=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0});let s=class extends v.Disposable{constructor(o,i,n){super(),this._bufferService=o,this._logService=i,this._optionsService=n,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new u.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new u.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new u.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new u.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,p.clone)(_),this.decPrivateModes=(0,p.clone)(e)}reset(){this.modes=(0,p.clone)(_),this.decPrivateModes=(0,p.clone)(e)}triggerDataEvent(o,i=!1){if(this._optionsService.rawOptions.disableStdin)return;const n=this._bufferService.buffer;i&&this._optionsService.rawOptions.scrollOnUserInput&&n.ybase!==n.ydisp&&this._onRequestScrollToBottom.fire(),i&&this._onUserInput.fire(),this._logService.debug(`sending data "${o}"`,()=>o.split("").map(d=>d.charCodeAt(0))),this._onData.fire(o)}triggerBinaryEvent(o){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${o}"`,()=>o.split("").map(i=>i.charCodeAt(0))),this._onBinary.fire(o))}};s=l([a(0,c.IBufferService),a(1,c.ILogService),a(2,c.IOptionsService)],s),t.CoreService=s},9074:(F,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DecorationService=void 0;const l=r(8055),a=r(8460),c=r(844),u=r(6106);let p=0,v=0;class _ extends c.Disposable{constructor(){super(),this._decorations=new u.SortedList(o=>o?.marker.line),this._onDecorationRegistered=this.register(new a.EventEmitter),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this.register(new a.EventEmitter),this.onDecorationRemoved=this._onDecorationRemoved.event,this.register((0,c.toDisposable)(()=>{for(const o of this._decorations.values())this._onDecorationRemoved.fire(o);this.reset()}))}get decorations(){return this._decorations.values()}registerDecoration(o){if(o.marker.isDisposed)return;const i=new e(o);if(i){const n=i.marker.onDispose(()=>i.dispose());i.onDispose(()=>{i&&(this._decorations.delete(i)&&this._onDecorationRemoved.fire(i),n.dispose())}),this._decorations.insert(i),this._onDecorationRegistered.fire(i)}return i}reset(){for(const o of this._decorations.values())o.dispose();this._decorations.clear()}*getDecorationsAtCell(o,i,n){var d,g,S;let h=0,D=0;for(const y of this._decorations.getKeyIterator(i))h=(d=y.options.x)!==null&&d!==void 0?d:0,D=h+((g=y.options.width)!==null&&g!==void 0?g:1),o>=h&&o<D&&(!n||((S=y.options.layer)!==null&&S!==void 0?S:"bottom")===n)&&(yield y)}forEachDecorationAtCell(o,i,n,d){this._decorations.forEachByKey(i,g=>{var S,h,D;p=(S=g.options.x)!==null&&S!==void 0?S:0,v=p+((h=g.options.width)!==null&&h!==void 0?h:1),o>=p&&o<v&&(!n||((D=g.options.layer)!==null&&D!==void 0?D:"bottom")===n)&&d(g)})}dispose(){for(const o of this._decorations.values())this._onDecorationRemoved.fire(o);this.reset()}}t.DecorationService=_;class e extends c.Disposable{constructor(o){super(),this.options=o,this.isDisposed=!1,this.onRenderEmitter=this.register(new a.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new a.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=o.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=l.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=l.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}dispose(){this._onDispose.fire(),super.dispose()}}},4348:(F,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InstantiationService=t.ServiceCollection=void 0;const l=r(2585),a=r(8343);class c{constructor(...p){this._entries=new Map;for(const[v,_]of p)this.set(v,_)}set(p,v){const _=this._entries.get(p);return this._entries.set(p,v),_}forEach(p){for(const[v,_]of this._entries.entries())p(v,_)}has(p){return this._entries.has(p)}get(p){return this._entries.get(p)}}t.ServiceCollection=c,t.InstantiationService=class{constructor(){this._services=new c,this._services.set(l.IInstantiationService,this)}setService(u,p){this._services.set(u,p)}getService(u){return this._services.get(u)}createInstance(u,...p){const v=(0,a.getServiceDependencies)(u).sort((s,o)=>s.index-o.index),_=[];for(const s of v){const o=this._services.get(s.id);if(!o)throw new Error(`[createInstance] ${u.name} depends on UNKNOWN service ${s.id}.`);_.push(o)}const e=v.length>0?v[0].index:p.length;if(p.length!==e)throw new Error(`[createInstance] First service dependency of ${u.name} at position ${e+1} conflicts with ${p.length} static arguments`);return new u(...p,..._)}}},7866:function(F,t,r){var l=this&&this.__decorate||function(_,e,s,o){var i,n=arguments.length,d=n<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,s):o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(_,e,s,o);else for(var g=_.length-1;g>=0;g--)(i=_[g])&&(d=(n<3?i(d):n>3?i(e,s,d):i(e,s))||d);return n>3&&d&&Object.defineProperty(e,s,d),d},a=this&&this.__param||function(_,e){return function(s,o){e(s,o,_)}};Object.defineProperty(t,"__esModule",{value:!0}),t.LogService=void 0;const c=r(844),u=r(2585),p={debug:u.LogLevelEnum.DEBUG,info:u.LogLevelEnum.INFO,warn:u.LogLevelEnum.WARN,error:u.LogLevelEnum.ERROR,off:u.LogLevelEnum.OFF};let v=class extends c.Disposable{constructor(_){super(),this._optionsService=_,this.logLevel=u.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel()))}_updateLogLevel(){this.logLevel=p[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(_){for(let e=0;e<_.length;e++)typeof _[e]=="function"&&(_[e]=_[e]())}_log(_,e,s){this._evalLazyOptionalParams(s),_.call(console,"xterm.js: "+e,...s)}debug(_,...e){this.logLevel<=u.LogLevelEnum.DEBUG&&this._log(console.log,_,e)}info(_,...e){this.logLevel<=u.LogLevelEnum.INFO&&this._log(console.info,_,e)}warn(_,...e){this.logLevel<=u.LogLevelEnum.WARN&&this._log(console.warn,_,e)}error(_,...e){this.logLevel<=u.LogLevelEnum.ERROR&&this._log(console.error,_,e)}};v=l([a(0,u.IOptionsService)],v),t.LogService=v},7302:(F,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OptionsService=t.DEFAULT_OPTIONS=void 0;const l=r(8460),a=r(6114),c=r(844);t.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,customGlyphs:!0,drawBoldTextInBrightColors:!0,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rightClickSelectsWord:a.isMac,windowOptions:{},windowsMode:!1,wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};const u=["normal","bold","100","200","300","400","500","600","700","800","900"];class p extends c.Disposable{constructor(_){super(),this._onOptionChange=this.register(new l.EventEmitter),this.onOptionChange=this._onOptionChange.event;const e=Object.assign({},t.DEFAULT_OPTIONS);for(const s in _)if(s in e)try{const o=_[s];e[s]=this._sanitizeAndValidateOption(s,o)}catch(o){console.error(o)}this.rawOptions=e,this.options=Object.assign({},e),this._setupOptions()}onSpecificOptionChange(_,e){return this.onOptionChange(s=>{s===_&&e(this.rawOptions[_])})}onMultipleOptionChange(_,e){return this.onOptionChange(s=>{_.indexOf(s)!==-1&&e()})}_setupOptions(){const _=s=>{if(!(s in t.DEFAULT_OPTIONS))throw new Error(`No option with key "${s}"`);return this.rawOptions[s]},e=(s,o)=>{if(!(s in t.DEFAULT_OPTIONS))throw new Error(`No option with key "${s}"`);o=this._sanitizeAndValidateOption(s,o),this.rawOptions[s]!==o&&(this.rawOptions[s]=o,this._onOptionChange.fire(s))};for(const s in this.rawOptions){const o={get:_.bind(this,s),set:e.bind(this,s)};Object.defineProperty(this.options,s,o)}}_sanitizeAndValidateOption(_,e){switch(_){case"cursorStyle":if(e||(e=t.DEFAULT_OPTIONS[_]),!function(s){return s==="block"||s==="underline"||s==="bar"}(e))throw new Error(`"${e}" is not a valid value for ${_}`);break;case"wordSeparator":e||(e=t.DEFAULT_OPTIONS[_]);break;case"fontWeight":case"fontWeightBold":if(typeof e=="number"&&1<=e&&e<=1e3)break;e=u.includes(e)?e:t.DEFAULT_OPTIONS[_];break;case"cursorWidth":e=Math.floor(e);case"lineHeight":case"tabStopWidth":if(e<1)throw new Error(`${_} cannot be less than 1, value: ${e}`);break;case"minimumContrastRatio":e=Math.max(1,Math.min(21,Math.round(10*e)/10));break;case"scrollback":if((e=Math.min(e,4294967295))<0)throw new Error(`${_} cannot be less than 0, value: ${e}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(e<=0)throw new Error(`${_} cannot be less than or equal to 0, value: ${e}`);case"rows":case"cols":if(!e&&e!==0)throw new Error(`${_} must be numeric, value: ${e}`)}return e}}t.OptionsService=p},2660:function(F,t,r){var l=this&&this.__decorate||function(p,v,_,e){var s,o=arguments.length,i=o<3?v:e===null?e=Object.getOwnPropertyDescriptor(v,_):e;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(p,v,_,e);else for(var n=p.length-1;n>=0;n--)(s=p[n])&&(i=(o<3?s(i):o>3?s(v,_,i):s(v,_))||i);return o>3&&i&&Object.defineProperty(v,_,i),i},a=this&&this.__param||function(p,v){return function(_,e){v(_,e,p)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OscLinkService=void 0;const c=r(2585);let u=class{constructor(p){this._bufferService=p,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(p){const v=this._bufferService.buffer;if(p.id===void 0){const n=v.addMarker(v.ybase+v.y),d={data:p,id:this._nextId++,lines:[n]};return n.onDispose(()=>this._removeMarkerFromLink(d,n)),this._dataByLinkId.set(d.id,d),d.id}const _=p,e=this._getEntryIdKey(_),s=this._entriesWithId.get(e);if(s)return this.addLineToLink(s.id,v.ybase+v.y),s.id;const o=v.addMarker(v.ybase+v.y),i={id:this._nextId++,key:this._getEntryIdKey(_),data:_,lines:[o]};return o.onDispose(()=>this._removeMarkerFromLink(i,o)),this._entriesWithId.set(i.key,i),this._dataByLinkId.set(i.id,i),i.id}addLineToLink(p,v){const _=this._dataByLinkId.get(p);if(_&&_.lines.every(e=>e.line!==v)){const e=this._bufferService.buffer.addMarker(v);_.lines.push(e),e.onDispose(()=>this._removeMarkerFromLink(_,e))}}getLinkData(p){var v;return(v=this._dataByLinkId.get(p))===null||v===void 0?void 0:v.data}_getEntryIdKey(p){return`${p.id};;${p.uri}`}_removeMarkerFromLink(p,v){const _=p.lines.indexOf(v);_!==-1&&(p.lines.splice(_,1),p.lines.length===0&&(p.data.id!==void 0&&this._entriesWithId.delete(p.key),this._dataByLinkId.delete(p.id)))}};u=l([a(0,c.IBufferService)],u),t.OscLinkService=u},8343:(F,t)=>{function r(l,a,c){a.di$target===a?a.di$dependencies.push({id:l,index:c}):(a.di$dependencies=[{id:l,index:c}],a.di$target=a)}Object.defineProperty(t,"__esModule",{value:!0}),t.createDecorator=t.getServiceDependencies=t.serviceRegistry=void 0,t.serviceRegistry=new Map,t.getServiceDependencies=function(l){return l.di$dependencies||[]},t.createDecorator=function(l){if(t.serviceRegistry.has(l))return t.serviceRegistry.get(l);const a=function(c,u,p){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");r(a,c,p)};return a.toString=()=>l,t.serviceRegistry.set(l,a),a}},2585:(F,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IDecorationService=t.IUnicodeService=t.IOscLinkService=t.IOptionsService=t.ILogService=t.LogLevelEnum=t.IInstantiationService=t.ICharsetService=t.ICoreService=t.ICoreMouseService=t.IBufferService=void 0;const l=r(8343);var a;t.IBufferService=(0,l.createDecorator)("BufferService"),t.ICoreMouseService=(0,l.createDecorator)("CoreMouseService"),t.ICoreService=(0,l.createDecorator)("CoreService"),t.ICharsetService=(0,l.createDecorator)("CharsetService"),t.IInstantiationService=(0,l.createDecorator)("InstantiationService"),(a=t.LogLevelEnum||(t.LogLevelEnum={}))[a.DEBUG=0]="DEBUG",a[a.INFO=1]="INFO",a[a.WARN=2]="WARN",a[a.ERROR=3]="ERROR",a[a.OFF=4]="OFF",t.ILogService=(0,l.createDecorator)("LogService"),t.IOptionsService=(0,l.createDecorator)("OptionsService"),t.IOscLinkService=(0,l.createDecorator)("OscLinkService"),t.IUnicodeService=(0,l.createDecorator)("UnicodeService"),t.IDecorationService=(0,l.createDecorator)("DecorationService")},1480:(F,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeService=void 0;const l=r(8460),a=r(225);t.UnicodeService=class{constructor(){this._providers=Object.create(null),this._active="",this._onChange=new l.EventEmitter,this.onChange=this._onChange.event;const c=new a.UnicodeV6;this.register(c),this._active=c.version,this._activeProvider=c}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(c){if(!this._providers[c])throw new Error(`unknown Unicode version "${c}"`);this._active=c,this._activeProvider=this._providers[c],this._onChange.fire(c)}register(c){this._providers[c.version]=c}wcwidth(c){return this._activeProvider.wcwidth(c)}getStringCellWidth(c){let u=0;const p=c.length;for(let v=0;v<p;++v){let _=c.charCodeAt(v);if(55296<=_&&_<=56319){if(++v>=p)return u+this.wcwidth(_);const e=c.charCodeAt(v);56320<=e&&e<=57343?_=1024*(_-55296)+e-56320+65536:u+=this.wcwidth(e)}u+=this.wcwidth(_)}return u}}}},E={};function k(F){var t=E[F];if(t!==void 0)return t.exports;var r=E[F]={exports:{}};return b[F].call(r.exports,r,r.exports,k),r.exports}var O={};return(()=>{var F=O;Object.defineProperty(F,"__esModule",{value:!0}),F.Terminal=void 0;const t=k(3236),r=k(9042),l=k(7975),a=k(7090),c=k(5741),u=k(8285),p=["cols","rows"];F.Terminal=class{constructor(v){this._core=new t.Terminal(v),this._addonManager=new c.AddonManager,this._publicOptions=Object.assign({},this._core.options);const _=s=>this._core.options[s],e=(s,o)=>{this._checkReadonlyOptions(s),this._core.options[s]=o};for(const s in this._core.options){const o={get:_.bind(this,s),set:e.bind(this,s)};Object.defineProperty(this._publicOptions,s,o)}}_checkReadonlyOptions(v){if(p.includes(v))throw new Error(`Option "${v}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new l.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new a.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=new u.BufferNamespaceApi(this._core)),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){const v=this._core.coreService.decPrivateModes;let _="none";switch(this._core.coreMouseService.activeProtocol){case"X10":_="x10";break;case"VT200":_="vt200";break;case"DRAG":_="drag";break;case"ANY":_="any"}return{applicationCursorKeysMode:v.applicationCursorKeys,applicationKeypadMode:v.applicationKeypad,bracketedPasteMode:v.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:_,originMode:v.origin,reverseWraparoundMode:v.reverseWraparound,sendFocusMode:v.sendFocus,wraparoundMode:v.wraparound}}get options(){return this._publicOptions}set options(v){for(const _ in v)this._publicOptions[_]=v[_]}blur(){this._core.blur()}focus(){this._core.focus()}resize(v,_){this._verifyIntegers(v,_),this._core.resize(v,_)}open(v){this._core.open(v)}attachCustomKeyEventHandler(v){this._core.attachCustomKeyEventHandler(v)}registerLinkProvider(v){return this._core.registerLinkProvider(v)}registerCharacterJoiner(v){return this._checkProposedApi(),this._core.registerCharacterJoiner(v)}deregisterCharacterJoiner(v){this._checkProposedApi(),this._core.deregisterCharacterJoiner(v)}registerMarker(v=0){return this._verifyIntegers(v),this._core.addMarker(v)}registerDecoration(v){var _,e,s;return this._checkProposedApi(),this._verifyPositiveIntegers((_=v.x)!==null&&_!==void 0?_:0,(e=v.width)!==null&&e!==void 0?e:0,(s=v.height)!==null&&s!==void 0?s:0),this._core.registerDecoration(v)}hasSelection(){return this._core.hasSelection()}select(v,_,e){this._verifyIntegers(v,_,e),this._core.select(v,_,e)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(v,_){this._verifyIntegers(v,_),this._core.selectLines(v,_)}dispose(){this._addonManager.dispose(),this._core.dispose()}scrollLines(v){this._verifyIntegers(v),this._core.scrollLines(v)}scrollPages(v){this._verifyIntegers(v),this._core.scrollPages(v)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(v){this._verifyIntegers(v),this._core.scrollToLine(v)}clear(){this._core.clear()}write(v,_){this._core.write(v,_)}writeln(v,_){this._core.write(v),this._core.write(`\r
`,_)}paste(v){this._core.paste(v)}refresh(v,_){this._verifyIntegers(v,_),this._core.refresh(v,_)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(v){return this._addonManager.loadAddon(this,v)}static get strings(){return r}_verifyIntegers(...v){for(const _ of v)if(_===1/0||isNaN(_)||_%1!=0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...v){for(const _ of v)if(_&&(_===1/0||isNaN(_)||_%1!=0||_<0))throw new Error("This API only accepts positive integers")}}})(),O})()})})(yt);var qt=yt.exports,$e={},Et={};(function(m){Object.defineProperty(m,"__esModule",{value:!0}),m.parseInput=m.InputType=void 0;var f;(function(k){k[k.Text=0]="Text",k[k.AltEnter=1]="AltEnter",k[k.ArrowUp=2]="ArrowUp",k[k.ArrowDown=3]="ArrowDown",k[k.ArrowLeft=4]="ArrowLeft",k[k.ArrowRight=5]="ArrowRight",k[k.Delete=6]="Delete",k[k.Backspace=7]="Backspace",k[k.CtrlA=8]="CtrlA",k[k.CtrlC=9]="CtrlC",k[k.CtrlD=10]="CtrlD",k[k.CtrlE=11]="CtrlE",k[k.CtrlK=12]="CtrlK",k[k.CtrlL=13]="CtrlL",k[k.CtrlQ=14]="CtrlQ",k[k.CtrlS=15]="CtrlS",k[k.CtrlU=16]="CtrlU",k[k.End=17]="End",k[k.Enter=18]="Enter",k[k.Home=19]="Home",k[k.ShiftEnter=20]="ShiftEnter",k[k.UnsupportedControlChar=21]="UnsupportedControlChar",k[k.UnsupportedEscape=22]="UnsupportedEscape"})(f=m.InputType||(m.InputType={}));function b(k){return Array.from(E(k))}m.parseInput=b;function*E(k){let O=[];const F=k[Symbol.iterator]();for(let t=F.next();!t.done;t=F.next()){const r=t.value;if(r.length>1){O.push(r);continue}const l=r.charCodeAt(0);if(O.length>0&&(l<32||l===127)&&(yield{inputType:f.Text,data:O},O=[]),l===27){const a=F.next();if(a.done){O.push("\x1B");continue}let c=f.UnsupportedEscape;if(a.value!=="["){switch(a.value){case"\r":c=f.AltEnter;break}yield{inputType:c,data:["\x1B",a.value]};continue}const u=F.next();if(u.done)continue;if(u.value>="0"&&u.value<="9"){let p=u.value;const v=F.next();if(v.done)return;if(v.value>="0"&&v.value<="9")p+=v.value;else if(v.value!=="~")continue;switch(p){case"3":c=f.Delete;break}yield{inputType:c,data:["\x1B","[",p,"~"]};continue}switch(u.value){case"A":c=f.ArrowUp;break;case"B":c=f.ArrowDown;break;case"C":c=f.ArrowRight;break;case"D":c=f.ArrowLeft;break;case"F":c=f.End;break;case"H":c=f.Home;break;case"\r":c=f.AltEnter;break}yield{inputType:c,data:["\x1B","[",u.value]};continue}if(l<32||l===127){let a=f.UnsupportedControlChar;switch(l){case 1:a=f.CtrlA;break;case 3:a=f.CtrlC;break;case 4:a=f.CtrlD;break;case 5:a=f.CtrlE;break;case 11:a=f.CtrlK;break;case 17:a=f.CtrlQ;break;case 19:a=f.CtrlS;break;case 21:a=f.CtrlU;break;case 13:a=f.Enter;break;case 127:a=f.Backspace;break;case 12:a=f.CtrlL;break}yield{inputType:a,data:[r]};continue}O.push(r)}O.length>0&&(yield{inputType:f.Text,data:O})}})(Et);var ne={},Ae={};Object.defineProperty(Ae,"__esModule",{value:!0});Ae.LineBuffer=void 0;class Vt{constructor(){this.buf="",this.pos=0}buffer(){return this.buf}pos_buffer(){return this.buf.slice(0,this.pos)}length(){return this.buf.length}char_length(){return[...this.buf].length}update(f,b){this.buf=f,this.pos=b}insert(f){const b=f.length,E=this.pos===this.buf.length;return E?this.buf=this.buf+f:this.buf=this.buf.slice(0,this.pos)+f+this.buf.slice(this.pos),this.pos+=b,E}moveBack(f){const b=this.prevPos(f);return b!==void 0?(this.pos=b,!0):!1}moveForward(f){const b=this.nextPos(f);return b!==void 0?(this.pos=b,!0):!1}moveHome(){const f=this.startOfLine();return this.pos>f?(this.pos=f,!0):!1}moveEnd(){const f=this.endOfLine();return this.pos===f?!1:(this.pos=f,!0)}startOfLine(){const f=this.buf.slice(0,this.pos).lastIndexOf(`
`);return f!==-1?f+1:0}endOfLine(){const f=this.buf.slice(this.pos).indexOf(`
`);return f!==-1?this.pos+f:this.buf.length}moveLineUp(f){const b=this.buf.slice(0,this.pos).lastIndexOf(`
`);if(b===-1)return!1;const E=[...this.buf.slice(b+1,this.pos)].length;let k=this.buf.slice(0,b).lastIndexOf(`
`);k===-1?k=0:k=k+1;let O=b;for(let r=1;r<f&&k!==0;r++)O=k-1,k=this.buf.slice(0,O).lastIndexOf(`
`),k===-1?k=0:k=k+1;const F=[...this.buf.slice(k,O)].slice(0,E);let t=b;return F.length>0&&(t=F.map(r=>r.length).reduce((r,l)=>r+l,0),t=k+t),this.pos=t,!0}moveLineDown(f){const b=this.buf.slice(this.pos).indexOf(`
`);if(b===-1)return!1;let E=this.buf.slice(0,this.pos).lastIndexOf(`
`);E===-1?E=0:E+=1;const k=[...this.buf.slice(E,this.pos)].length;let O=this.pos+b+1,F=this.buf.slice(O).indexOf(`
`);F===-1?F=this.buf.length:F=O+F;for(let r=1;r<f&&F!==this.buf.length;r++)O=F+1,F=this.buf.slice(O).indexOf(`
`),F===-1?F=this.buf.length:F=O+F;const t=[...this.buf.slice(O,F)];return k<t.length?this.pos=t.slice(0,k).map(r=>r.length).reduce((r,l)=>r+l,0)+O:this.pos=F,!0}set_pos(f){this.pos=f}prevPos(f){if(this.pos===0)return;const b=this.buf.slice(0,this.pos);return this.pos-[...b].slice(-f).map(E=>E.length).reduce((E,k)=>E+k,0)}nextPos(f){if(this.pos===this.buf.length)return;const b=this.buf.slice(this.pos);return this.pos+[...b].slice(0,f).map(E=>E.length).reduce((E,k)=>E+k,0)}backspace(f){const b=this.prevPos(f);return b===void 0?!1:(this.buf=this.buf.slice(0,b)+this.buf.slice(this.pos),this.pos=b,!0)}delete(f){const b=this.nextPos(f);return b!==void 0?(this.buf=this.buf.slice(0,this.pos)+this.buf.slice(b),!0):!1}deleteEndOfLine(){if(this.buf.length==0||this.pos==this.buf.length)return!1;const f=this.pos,b=this.endOfLine();return f==b?this.delete(1):this.buf=this.buf.slice(0,f)+this.buf.slice(b),!0}}Ae.LineBuffer=Vt;var je={exports:{}},Gt=({onlyFirst:m=!1}={})=>{const f=["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|");return new RegExp(f,m?void 0:"g")};const Xt=Gt;var Yt=m=>typeof m=="string"?m.replace(Xt(),""):m,ze={exports:{}};const kt=m=>Number.isNaN(m)?!1:m>=4352&&(m<=4447||m===9001||m===9002||11904<=m&&m<=12871&&m!==12351||12880<=m&&m<=19903||19968<=m&&m<=42182||43360<=m&&m<=43388||44032<=m&&m<=55203||63744<=m&&m<=64255||65040<=m&&m<=65049||65072<=m&&m<=65131||65281<=m&&m<=65376||65504<=m&&m<=65510||110592<=m&&m<=110593||127488<=m&&m<=127569||131072<=m&&m<=262141);ze.exports=kt;ze.exports.default=kt;var Jt=ze.exports,Zt=function(){return/\uD83C\uDFF4\uDB40\uDC67\uDB40\uDC62(?:\uDB40\uDC65\uDB40\uDC6E\uDB40\uDC67|\uDB40\uDC73\uDB40\uDC63\uDB40\uDC74|\uDB40\uDC77\uDB40\uDC6C\uDB40\uDC73)\uDB40\uDC7F|\uD83D\uDC68(?:\uD83C\uDFFC\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68\uD83C\uDFFB|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFF\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFB-\uDFFE])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFE\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFB-\uDFFD])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFD\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFB\uDFFC])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\u200D(?:\u2764\uFE0F\u200D(?:\uD83D\uDC8B\u200D)?\uD83D\uDC68|(?:\uD83D[\uDC68\uDC69])\u200D(?:\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67]))|\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67])|(?:\uD83D[\uDC68\uDC69])\u200D(?:\uD83D[\uDC66\uDC67])|[\u2695\u2696\u2708]\uFE0F|\uD83D[\uDC66\uDC67]|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|(?:\uD83C\uDFFB\u200D[\u2695\u2696\u2708]|\uD83C\uDFFF\u200D[\u2695\u2696\u2708]|\uD83C\uDFFE\u200D[\u2695\u2696\u2708]|\uD83C\uDFFD\u200D[\u2695\u2696\u2708]|\uD83C\uDFFC\u200D[\u2695\u2696\u2708])\uFE0F|\uD83C\uDFFB\u200D(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C[\uDFFB-\uDFFF])|(?:\uD83E\uDDD1\uD83C\uDFFB\u200D\uD83E\uDD1D\u200D\uD83E\uDDD1|\uD83D\uDC69\uD83C\uDFFC\u200D\uD83E\uDD1D\u200D\uD83D\uDC69)\uD83C\uDFFB|\uD83E\uDDD1(?:\uD83C\uDFFF\u200D\uD83E\uDD1D\u200D\uD83E\uDDD1(?:\uD83C[\uDFFB-\uDFFF])|\u200D\uD83E\uDD1D\u200D\uD83E\uDDD1)|(?:\uD83E\uDDD1\uD83C\uDFFE\u200D\uD83E\uDD1D\u200D\uD83E\uDDD1|\uD83D\uDC69\uD83C\uDFFF\u200D\uD83E\uDD1D\u200D(?:\uD83D[\uDC68\uDC69]))(?:\uD83C[\uDFFB-\uDFFE])|(?:\uD83E\uDDD1\uD83C\uDFFC\u200D\uD83E\uDD1D\u200D\uD83E\uDDD1|\uD83D\uDC69\uD83C\uDFFD\u200D\uD83E\uDD1D\u200D\uD83D\uDC69)(?:\uD83C[\uDFFB\uDFFC])|\uD83D\uDC69(?:\uD83C\uDFFE\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFB-\uDFFD\uDFFF])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFC\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFB\uDFFD-\uDFFF])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFB\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFC-\uDFFF])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFD\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\u200D(?:\u2764\uFE0F\u200D(?:\uD83D\uDC8B\u200D(?:\uD83D[\uDC68\uDC69])|\uD83D[\uDC68\uDC69])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFF\u200D(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD]))|\uD83D\uDC69\u200D\uD83D\uDC69\u200D(?:\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67]))|(?:\uD83E\uDDD1\uD83C\uDFFD\u200D\uD83E\uDD1D\u200D\uD83E\uDDD1|\uD83D\uDC69\uD83C\uDFFE\u200D\uD83E\uDD1D\u200D\uD83D\uDC69)(?:\uD83C[\uDFFB-\uDFFD])|\uD83D\uDC69\u200D\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC69\u200D\uD83D\uDC69\u200D(?:\uD83D[\uDC66\uDC67])|(?:\uD83D\uDC41\uFE0F\u200D\uD83D\uDDE8|\uD83D\uDC69(?:\uD83C\uDFFF\u200D[\u2695\u2696\u2708]|\uD83C\uDFFE\u200D[\u2695\u2696\u2708]|\uD83C\uDFFC\u200D[\u2695\u2696\u2708]|\uD83C\uDFFB\u200D[\u2695\u2696\u2708]|\uD83C\uDFFD\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708])|(?:(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)\uFE0F|\uD83D\uDC6F|\uD83E[\uDD3C\uDDDE\uDDDF])\u200D[\u2640\u2642]|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDCD-\uDDCF\uDDD6-\uDDDD])(?:(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]|\u200D[\u2640\u2642])|\uD83C\uDFF4\u200D\u2620)\uFE0F|\uD83D\uDC69\u200D\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67])|\uD83C\uDFF3\uFE0F\u200D\uD83C\uDF08|\uD83D\uDC15\u200D\uD83E\uDDBA|\uD83D\uDC69\u200D\uD83D\uDC66|\uD83D\uDC69\u200D\uD83D\uDC67|\uD83C\uDDFD\uD83C\uDDF0|\uD83C\uDDF4\uD83C\uDDF2|\uD83C\uDDF6\uD83C\uDDE6|[#\*0-9]\uFE0F\u20E3|\uD83C\uDDE7(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEF\uDDF1-\uDDF4\uDDF6-\uDDF9\uDDFB\uDDFC\uDDFE\uDDFF])|\uD83C\uDDF9(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDED\uDDEF-\uDDF4\uDDF7\uDDF9\uDDFB\uDDFC\uDDFF])|\uD83C\uDDEA(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDED\uDDF7-\uDDFA])|\uD83E\uDDD1(?:\uD83C[\uDFFB-\uDFFF])|\uD83C\uDDF7(?:\uD83C[\uDDEA\uDDF4\uDDF8\uDDFA\uDDFC])|\uD83D\uDC69(?:\uD83C[\uDFFB-\uDFFF])|\uD83C\uDDF2(?:\uD83C[\uDDE6\uDDE8-\uDDED\uDDF0-\uDDFF])|\uD83C\uDDE6(?:\uD83C[\uDDE8-\uDDEC\uDDEE\uDDF1\uDDF2\uDDF4\uDDF6-\uDDFA\uDDFC\uDDFD\uDDFF])|\uD83C\uDDF0(?:\uD83C[\uDDEA\uDDEC-\uDDEE\uDDF2\uDDF3\uDDF5\uDDF7\uDDFC\uDDFE\uDDFF])|\uD83C\uDDED(?:\uD83C[\uDDF0\uDDF2\uDDF3\uDDF7\uDDF9\uDDFA])|\uD83C\uDDE9(?:\uD83C[\uDDEA\uDDEC\uDDEF\uDDF0\uDDF2\uDDF4\uDDFF])|\uD83C\uDDFE(?:\uD83C[\uDDEA\uDDF9])|\uD83C\uDDEC(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEE\uDDF1-\uDDF3\uDDF5-\uDDFA\uDDFC\uDDFE])|\uD83C\uDDF8(?:\uD83C[\uDDE6-\uDDEA\uDDEC-\uDDF4\uDDF7-\uDDF9\uDDFB\uDDFD-\uDDFF])|\uD83C\uDDEB(?:\uD83C[\uDDEE-\uDDF0\uDDF2\uDDF4\uDDF7])|\uD83C\uDDF5(?:\uD83C[\uDDE6\uDDEA-\uDDED\uDDF0-\uDDF3\uDDF7-\uDDF9\uDDFC\uDDFE])|\uD83C\uDDFB(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDEE\uDDF3\uDDFA])|\uD83C\uDDF3(?:\uD83C[\uDDE6\uDDE8\uDDEA-\uDDEC\uDDEE\uDDF1\uDDF4\uDDF5\uDDF7\uDDFA\uDDFF])|\uD83C\uDDE8(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDEE\uDDF0-\uDDF5\uDDF7\uDDFA-\uDDFF])|\uD83C\uDDF1(?:\uD83C[\uDDE6-\uDDE8\uDDEE\uDDF0\uDDF7-\uDDFB\uDDFE])|\uD83C\uDDFF(?:\uD83C[\uDDE6\uDDF2\uDDFC])|\uD83C\uDDFC(?:\uD83C[\uDDEB\uDDF8])|\uD83C\uDDFA(?:\uD83C[\uDDE6\uDDEC\uDDF2\uDDF3\uDDF8\uDDFE\uDDFF])|\uD83C\uDDEE(?:\uD83C[\uDDE8-\uDDEA\uDDF1-\uDDF4\uDDF6-\uDDF9])|\uD83C\uDDEF(?:\uD83C[\uDDEA\uDDF2\uDDF4\uDDF5])|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDCD-\uDDCF\uDDD6-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uD83C[\uDFFB-\uDFFF])|(?:[\u261D\u270A-\u270D]|\uD83C[\uDF85\uDFC2\uDFC7]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66\uDC67\uDC6B-\uDC6D\uDC70\uDC72\uDC74-\uDC76\uDC78\uDC7C\uDC83\uDC85\uDCAA\uDD74\uDD7A\uDD90\uDD95\uDD96\uDE4C\uDE4F\uDEC0\uDECC]|\uD83E[\uDD0F\uDD18-\uDD1C\uDD1E\uDD1F\uDD30-\uDD36\uDDB5\uDDB6\uDDBB\uDDD2-\uDDD5])(?:\uD83C[\uDFFB-\uDFFF])|(?:[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u270A\u270B\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55]|\uD83C[\uDC04\uDCCF\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF7C\uDF7E-\uDF93\uDFA0-\uDFCA\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF4\uDFF8-\uDFFF]|\uD83D[\uDC00-\uDC3E\uDC40\uDC42-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDD7A\uDD95\uDD96\uDDA4\uDDFB-\uDE4F\uDE80-\uDEC5\uDECC\uDED0-\uDED2\uDED5\uDEEB\uDEEC\uDEF4-\uDEFA\uDFE0-\uDFEB]|\uD83E[\uDD0D-\uDD3A\uDD3C-\uDD45\uDD47-\uDD71\uDD73-\uDD76\uDD7A-\uDDA2\uDDA5-\uDDAA\uDDAE-\uDDCA\uDDCD-\uDDFF\uDE70-\uDE73\uDE78-\uDE7A\uDE80-\uDE82\uDE90-\uDE95])|(?:[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD7A\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA4\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED2\uDED5\uDEE0-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3-\uDEFA\uDFE0-\uDFEB]|\uD83E[\uDD0D-\uDD3A\uDD3C-\uDD45\uDD47-\uDD71\uDD73-\uDD76\uDD7A-\uDDA2\uDDA5-\uDDAA\uDDAE-\uDDCA\uDDCD-\uDDFF\uDE70-\uDE73\uDE78-\uDE7A\uDE80-\uDE82\uDE90-\uDE95])\uFE0F|(?:[\u261D\u26F9\u270A-\u270D]|\uD83C[\uDF85\uDFC2-\uDFC4\uDFC7\uDFCA-\uDFCC]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66-\uDC78\uDC7C\uDC81-\uDC83\uDC85-\uDC87\uDC8F\uDC91\uDCAA\uDD74\uDD75\uDD7A\uDD90\uDD95\uDD96\uDE45-\uDE47\uDE4B-\uDE4F\uDEA3\uDEB4-\uDEB6\uDEC0\uDECC]|\uD83E[\uDD0F\uDD18-\uDD1F\uDD26\uDD30-\uDD39\uDD3C-\uDD3E\uDDB5\uDDB6\uDDB8\uDDB9\uDDBB\uDDCD-\uDDCF\uDDD1-\uDDDD])/g};const Qt=Yt,ei=Jt,ti=Zt,Lt=m=>{if(typeof m!="string"||m.length===0||(m=Qt(m),m.length===0))return 0;m=m.replace(ti(),"  ");let f=0;for(let b=0;b<m.length;b++){const E=m.codePointAt(b);E<=31||E>=127&&E<=159||E>=768&&E<=879||(E>65535&&b++,f+=ei(E)?2:1)}return f};je.exports=Lt;je.exports.default=Lt;var At=je.exports,ii=we&&we.__importDefault||function(m){return m&&m.__esModule?m:{default:m}};Object.defineProperty(ne,"__esModule",{value:!0});ne.State=ne.Layout=ne.Position=void 0;const si=Ae,ri=ii(At);class he{constructor(f,b){f!==void 0?this.row=f:this.row=0,b!==void 0?this.col=b:this.col=0}}ne.Position=he;class Bt{constructor(f){this.promptSize=f,this.cursor=new he,this.end=new he}}ne.Layout=Bt;class ni{constructor(f,b,E,k){this.line=new si.LineBuffer,this.highlighting=!1,this.prompt=f,this.tty=b,this.highlighter=E,this.history=k,this.promptSize=b.calculatePosition(f,new he),this.layout=new Bt(this.promptSize)}buffer(){return this.line.buffer()}shouldHighlight(){return this.highlighter.highlightChar(this.line.buf,this.line.pos)?(this.highlighting=!0,!0):this.highlighting?(this.highlighting=!1,!0):!1}clearScreen(){this.tty.clearScreen(),this.layout.cursor=new he,this.layout.end=new he,this.refresh()}editInsert(f){const b=this.line.insert(f),E=f.includes(`
`);if(b&&!E){const k=(0,ri.default)(f);k>0&&this.layout.cursor.col+k<this.tty.col&&!this.shouldHighlight()?(this.layout.cursor.col+=k,this.layout.end.col+=k,this.tty.write(f)):this.refresh()}else this.refresh()}update(f){this.line.update(f,f.length),this.refresh()}editBackspace(f){this.line.backspace(f)&&this.refresh()}editDelete(f){this.line.delete(f)&&this.refresh()}editDeleteEndOfLine(){this.line.deleteEndOfLine()&&this.refresh()}refresh(){const f=this.tty.computeLayout(this.promptSize,this.line);this.tty.refreshLine(this.prompt,this.line,this.layout,f,this.highlighter),this.layout=f}moveCursorBack(f){this.line.moveBack(f)&&this.moveCursor()}moveCursorForward(f){this.line.moveForward(f)&&this.moveCursor()}moveCursorUp(f){this.line.moveLineUp(f)?this.moveCursor():this.previousHistory()}moveCursorDown(f){this.line.moveLineDown(f)?this.moveCursor():this.nextHistory()}moveCursorHome(){this.line.moveHome()&&this.moveCursor()}moveCursorEnd(){this.line.moveEnd()&&this.moveCursor()}moveCursorToEnd(){this.layout.cursor!==this.layout.end&&(this.tty.moveCursor(this.layout.cursor,this.layout.end),this.layout.cursor=Object.assign({},this.layout.end))}previousHistory(){if(this.history.cursor===-1&&this.line.length()>0)return;const f=this.history.prev();f!==void 0&&this.update(f)}nextHistory(){if(this.history.cursor===-1)return;const f=this.history.next();f!==void 0?this.update(f):this.update("")}moveCursor(){const f=this.tty.calculatePosition(this.line.pos_buffer(),this.promptSize);f!==this.layout.cursor&&(this.shouldHighlight()?this.refresh():(this.tty.moveCursor(this.layout.cursor,f),this.layout.promptSize=Object.assign({},this.promptSize),this.layout.cursor=Object.assign({},f)))}}ne.State=ni;var Be={};Object.defineProperty(Be,"__esModule",{value:!0});Be.History=void 0;class oi{constructor(f){this.entries=[],this.cursor=-1,this.maxEntries=f}saveToLocalStorage(){const f=window?.localStorage;f!==void 0&&f.setItem("history",JSON.stringify(this.entries))}restoreFromLocalStorage(){const f=window?.localStorage;if(f!==void 0){const b=f.getItem("history");if(b==null)return;try{const E=JSON.parse(b);!Array.isArray(E)||E.find(k=>typeof k!="string")!==void 0?(this.entries=[],f.setItem("history","[]")):this.entries=E}catch{this.entries=[],f.setItem("history","[]")}}}append(f){this.resetCursor(),this.entries.includes(f)?(this.entries.splice(this.entries.indexOf(f),1),this.entries.unshift(f)):this.entries.unshift(f),this.entries.length>this.maxEntries&&this.entries.pop(),this.saveToLocalStorage()}resetCursor(){this.cursor=-1}next(){if(this.cursor!==-1)return this.cursor-=1,this.entries[this.cursor]}prev(){if(!(this.cursor+1>=this.entries.length))return this.cursor+=1,this.entries[this.cursor]}}Be.History=oi;var Fe={},ai=we&&we.__importDefault||function(m){return m&&m.__esModule?m:{default:m}};Object.defineProperty(Fe,"__esModule",{value:!0});Fe.Tty=void 0;const hi=ai(At);class li{constructor(f,b,E,k){this.tabWidth=E,this.col=f,this.row=b,this.out=k}write(f){return this.out.write(f)}print(f){return this.out.print(f)}println(f){return this.out.println(f)}clearScreen(){this.out.write("\x1B[H\x1B[2J")}calculatePosition(f,b){const E=Object.assign({},b);let k=0;return[...f].forEach(O=>{if(O===`
`){E.row+=1,E.col=0;return}let F=0;if(O==="	")F=this.tabWidth-E.col%this.tabWidth;else{let t;[t,k]=ci(O,k),F=t}E.col+=F,E.col>this.col&&(E.row+=1,E.col=F)}),E.col===this.col&&(E.col=0,E.row+=1),E}computeLayout(f,b){const E=Object.assign({},f),k=b.pos,O=this.calculatePosition(b.buf.slice(0,b.pos),f),F=k===b.buf.length?Object.assign({},O):this.calculatePosition(b.buf.slice(k),O);return{promptSize:E,cursor:O,end:F}}refreshLine(f,b,E,k,O){const F=k.cursor,t=k.end;this.clearOldRows(E),this.write(O.highlightPrompt(f)),this.write(O.highlight(b.buf,b.pos)),t.col===0&&t.row>0&&b.buf[b.buf.length-1]!==`
`&&this.write(`
`);const r=t.row-F.row;r>0&&this.write(`\x1B[${r}A`),F.col>0?this.write(`\r\x1B[${F.col}C`):this.write("\r")}clearOldRows(f){const b=f.cursor.row,E=f.end.row,k=Math.max(E-b,0);k>0&&this.write(`\x1B[${k}B`);for(let O=0;O<E;O++)this.write("\r\x1B[0K\x1B[A");this.write("\r\x1B[0K")}moveCursor(f,b){if(b.row>f.row){const E=b.row-f.row;E===1?this.write("\x1B[B"):this.write(`\x1B[${E}B`)}else if(b.row<f.row){const E=f.row-b.row;E===1?this.write("\x1B[A"):this.write(`\x1B[${E}A`)}if(b.col>f.col){const E=b.col-f.col;E===1?this.write("\x1B[C"):this.write(`\x1B[${E}C`)}else if(b.col<f.col){const E=f.col-b.col;E===1?this.write("\x1B[D"):this.write(`\x1B[${E}D`)}}}Fe.Tty=li;function ci(m,f){return f===1?m==="["?[0,2]:[0,0]:f===2?m===";"||m[0]>="0"&&m[0]<="9"?[0,f]:[0,0]:m==="\x1B"?[0,1]:m===`
`?[0,f]:[(0,hi.default)(m),f]}var Re={};Object.defineProperty(Re,"__esModule",{value:!0});Re.IdentityHighlighter=void 0;class ui{highlight(f,b){return f}highlightPrompt(f){return f}highlightChar(f,b){return!1}}Re.IdentityHighlighter=ui;Object.defineProperty($e,"__esModule",{value:!0});var Ft=$e.Readline=void 0;const X=Et,Te=ne,_i=Be,nt=Fe,di=Re;class fi{constructor(){this.highlighter=new di.IdentityHighlighter,this.history=new _i.History(50),this.disposables=[],this.watermark=0,this.highWatermark=1e4,this.lowWatermark=1e3,this.highWater=!1,this.state=new Te.State(">",this.tty(),this.highlighter,this.history),this.checkHandler=()=>!0,this.ctrlCHandler=()=>{},this.pauseHandler=f=>{},this.history.restoreFromLocalStorage()}activate(f){this.term=f,this.term.onData(this.readData.bind(this)),this.term.attachCustomKeyEventHandler(this.handleKeyEvent.bind(this))}dispose(){this.disposables.forEach(f=>f.dispose())}appendHistory(f){this.history.append(f)}setHighlighter(f){this.highlighter=f}setCheckHandler(f){this.checkHandler=f}setCtrlCHandler(f){this.ctrlCHandler=f}setPauseHandler(f){this.pauseHandler=f}writeReady(){return!this.highWater}write(f){f===`
`?f=`\r
`:(f=f.replace(/^\n/,`\r
`),f=f.replace(/([^\r])\n/g,`$1\r
`));const b=f.length;this.watermark+=b,this.watermark>this.highWatermark&&(this.highWater=!0),this.term&&this.term.write(f,()=>{this.watermark=Math.max(this.watermark-b,0),this.highWater&&this.watermark<this.lowWatermark&&(this.highWater=!1)})}print(f){return this.write(f)}println(f){return this.write(f+`\r
`)}output(){return this}tty(){var f,b;return((b=(f=this.term)===null||f===void 0?void 0:f.options)===null||b===void 0?void 0:b.tabStopWidth)!==void 0?new nt.Tty(this.term.cols,this.term.rows,this.term.options.tabStopWidth,this.output()):new nt.Tty(0,0,8,this.output())}read(f){return new Promise((b,E)=>{if(this.term===void 0){E("addon is not active");return}this.state=new Te.State(f,this.tty(),this.highlighter,this.history),this.state.refresh(),this.activeRead={prompt:f,resolve:b,reject:E}})}handleKeyEvent(f){return f.key==="Enter"&&f.shiftKey?(f.type==="keydown"&&this.readKey({inputType:X.InputType.ShiftEnter,data:["\r"]}),!1):!0}readData(f){const b=(0,X.parseInput)(f);if(b.length>1||b[0].inputType===X.InputType.Text&&b[0].data.length>1){this.readPaste(b);return}this.readKey(b[0])}readPaste(f){const b=f.map(E=>E.inputType===X.InputType.Enter?{inputType:X.InputType.Text,data:[`
`]}:E);for(const E of b)E.inputType===X.InputType.Text?this.state.editInsert(E.data.join("")):this.readKey(E)}readKey(f){var b,E,k;if(this.activeRead===void 0){switch(f.inputType){case X.InputType.CtrlC:this.ctrlCHandler();break;case X.InputType.CtrlL:this.write("\x1B[H\x1B[2J");break}return}switch(f.inputType){case X.InputType.Text:this.state.editInsert(f.data.join(""));break;case X.InputType.AltEnter:case X.InputType.ShiftEnter:this.state.editInsert(`
`);break;case X.InputType.Enter:this.checkHandler(this.state.buffer())?(this.state.moveCursorToEnd(),(b=this.term)===null||b===void 0||b.write(`\r
`),this.history.append(this.state.buffer()),(E=this.activeRead)===null||E===void 0||E.resolve(this.state.buffer()),this.activeRead=void 0):this.state.editInsert(`
`);break;case X.InputType.CtrlC:this.state.moveCursorToEnd(),(k=this.term)===null||k===void 0||k.write(`^C\r
`),this.state=new Te.State(this.activeRead.prompt,this.tty(),this.highlighter,this.history),this.state.refresh();break;case X.InputType.CtrlS:this.pauseHandler(!1);break;case X.InputType.CtrlU:this.state.update("");break;case X.InputType.CtrlK:this.state.editDeleteEndOfLine();break;case X.InputType.CtrlQ:this.pauseHandler(!0);break;case X.InputType.CtrlL:this.state.clearScreen();break;case X.InputType.Home:case X.InputType.CtrlA:this.state.moveCursorHome();break;case X.InputType.End:case X.InputType.CtrlE:this.state.moveCursorEnd();break;case X.InputType.Backspace:this.state.editBackspace(1);break;case X.InputType.Delete:case X.InputType.CtrlD:this.state.editDelete(1);break;case X.InputType.ArrowLeft:this.state.moveCursorBack(1);break;case X.InputType.ArrowRight:this.state.moveCursorForward(1);break;case X.InputType.ArrowUp:this.state.moveCursorUp(1);break;case X.InputType.ArrowDown:this.state.moveCursorDown(1);break;case X.InputType.UnsupportedControlChar:case X.InputType.UnsupportedEscape:break}}}Ft=$e.Readline=fi;var Rt={exports:{}};(function(m,f){(function(b,E){m.exports=E()})(self,function(){return(()=>{var b={};return(()=>{var E=b;Object.defineProperty(E,"__esModule",{value:!0}),E.FitAddon=void 0,E.FitAddon=class{constructor(){}activate(k){this._terminal=k}dispose(){}fit(){const k=this.proposeDimensions();if(!k||!this._terminal||isNaN(k.cols)||isNaN(k.rows))return;const O=this._terminal._core;this._terminal.rows===k.rows&&this._terminal.cols===k.cols||(O._renderService.clear(),this._terminal.resize(k.cols,k.rows))}proposeDimensions(){if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;const k=this._terminal._core,O=k._renderService.dimensions;if(O.css.cell.width===0||O.css.cell.height===0)return;const F=this._terminal.options.scrollback===0?0:k.viewport.scrollBarWidth,t=window.getComputedStyle(this._terminal.element.parentElement),r=parseInt(t.getPropertyValue("height")),l=Math.max(0,parseInt(t.getPropertyValue("width"))),a=window.getComputedStyle(this._terminal.element),c=r-(parseInt(a.getPropertyValue("padding-top"))+parseInt(a.getPropertyValue("padding-bottom"))),u=l-(parseInt(a.getPropertyValue("padding-right"))+parseInt(a.getPropertyValue("padding-left")))-F;return{cols:Math.max(2,Math.floor(u/O.css.cell.width)),rows:Math.max(1,Math.floor(c/O.css.cell.height))}}}})(),b})()})})(Rt);var vi=Rt.exports;var pi=0;function Ke(m,f,b,E,k,O){var F,t,r={};for(t in f)t=="ref"?F=f[t]:r[t]=f[t];var l={type:m,props:r,key:b,ref:F,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:--pi,__source:k,__self:O};if(typeof m=="function"&&(F=m.defaultProps))for(t in F)r[t]===void 0&&(r[t]=F[t]);return G.vnode&&G.vnode(l),l}const gi=({onReadable:m,onSignal:f,worker:b})=>{const E=st(null),k=st("> ");return Ct(()=>{if(!E.current)throw new Error("div not found");const O=new qt.Terminal({cursorBlink:!0});O.open(E.current);const F=new Ft;O.loadAddon(F);const t=new vi.FitAddon;O.loadAddon(t),t.fit(),O.focus(),window.addEventListener("resize",()=>t.fit());const r=()=>{F.read(k.current).then(l)},l=a=>{m(a)};return O.attachCustomKeyEventHandler(a=>(a.ctrlKey&&a.key==="c"&&f(),a.key==="Tab"&&console.log(a),!0)),b.onmessage=({data:{result:a,prompt:c}})=>{a&&F.println(a),k.current=c,setTimeout(r)},r(),()=>O.dispose()},[m,f,b]),Ke("div",{id:"terminal",ref:E})};let Q;const xt=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&xt.decode();let le=null;function me(){return(le===null||le.byteLength===0)&&(le=new Uint8Array(Q.memory.buffer)),le}function Ie(m,f){return m=m>>>0,xt.decode(me().subarray(m,m+f))}const se=new Array(128).fill(void 0);se.push(void 0,null,!0,!1);let ue=se.length;function Di(m){ue===se.length&&se.push(se.length+1);const f=ue;return ue=se[f],se[f]=m,f}let Pe=0;const Ce=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},mi=typeof Ce.encodeInto=="function"?function(m,f){return Ce.encodeInto(m,f)}:function(m,f){const b=Ce.encode(m);return f.set(b),{read:m.length,written:b.length}};function Ci(m,f,b){if(b===void 0){const t=Ce.encode(m),r=f(t.length)>>>0;return me().subarray(r,r+t.length).set(t),Pe=t.length,r}let E=m.length,k=f(E)>>>0;const O=me();let F=0;for(;F<E;F++){const t=m.charCodeAt(F);if(t>127)break;O[k+F]=t}if(F!==E){F!==0&&(m=m.slice(F)),k=b(k,E,E=F+m.length*3)>>>0;const t=me().subarray(k+F,k+E),r=mi(m,t);F+=r.written}return Pe=F,k}let ce=null;function ae(){return(ce===null||ce.byteLength===0)&&(ce=new Int32Array(Q.memory.buffer)),ce}function Si(m){return se[m]}function bi(m){m<132||(se[m]=ue,ue=m)}function ot(m){const f=Si(m);return bi(m),f}class Ee{static __wrap(f){f=f>>>0;const b=Object.create(Ee.prototype);return b.__wbg_ptr=f,b}__destroy_into_raw(){const f=this.__wbg_ptr;return this.__wbg_ptr=0,f}free(){const f=this.__destroy_into_raw();Q.__wbg_reader_free(f)}static new(){const f=Q.reader_new();return Ee.__wrap(f)}push(f){try{const k=Q.__wbindgen_add_to_stack_pointer(-16),O=Ci(f,Q.__wbindgen_malloc,Q.__wbindgen_realloc),F=Pe;Q.reader_push(k,this.__wbg_ptr,O,F);var b=ae()[k/4+0],E=ae()[k/4+1];if(E)throw ot(b)}finally{Q.__wbindgen_add_to_stack_pointer(16)}}expression_complete(){return Q.reader_expression_complete(this.__wbg_ptr)!==0}new_expression(){return Q.reader_new_expression(this.__wbg_ptr)!==0}eval(){let f,b;try{const l=Q.__wbindgen_add_to_stack_pointer(-16);Q.reader_eval(l,this.__wbg_ptr);var E=ae()[l/4+0],k=ae()[l/4+1],O=ae()[l/4+2],F=ae()[l/4+3],t=E,r=k;if(F)throw t=0,r=0,ot(O);return f=t,b=r,Ie(t,r)}finally{Q.__wbindgen_add_to_stack_pointer(16),Q.__wbindgen_free(f,b)}}clear_buffer(){Q.reader_clear_buffer(this.__wbg_ptr)}}async function yi(m,f){if(typeof Response=="function"&&m instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(m,f)}catch(E){if(m.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",E);else throw E}const b=await m.arrayBuffer();return await WebAssembly.instantiate(b,f)}else{const b=await WebAssembly.instantiate(m,f);return b instanceof WebAssembly.Instance?{instance:b,module:m}:b}}function wi(){const m={};return m.wbg={},m.wbg.__wbindgen_string_new=function(f,b){const E=Ie(f,b);return Di(E)},m.wbg.__wbindgen_throw=function(f,b){throw new Error(Ie(f,b))},m}function Ei(m,f){return Q=m.exports,Tt.__wbindgen_wasm_module=f,ce=null,le=null,Q}async function Tt(m){if(Q!==void 0)return Q;typeof m>"u"&&(m=new URL("/lisp_rs/assets/lisp_rs_bg-ffbb6bb3.wasm",self.location));const f=wi();(typeof m=="string"||typeof Request=="function"&&m instanceof Request||typeof URL=="function"&&m instanceof URL)&&(m=fetch(m));const{instance:b,module:E}=await yi(await m,f);return Ei(b,E)}const ki=()=>{const[m,f]=Nt();return Ct(()=>{Tt().then(()=>{f(Ee.new())})},[]),m};function Li(){const m=ki(),f=Ne(()=>new Worker(new URL("/lisp_rs/assets/worker-70569bd5.js",self.location)),[]),b=jt(k=>{let O="";try{m?.push(k),m?.expression_complete()&&(O=m?.eval())}catch(t){O=t,m?.clear_buffer()}const F=m?.new_expression()?"> ":". ";f.postMessage({result:O,prompt:F})},[m]);return Ke(gi,{onReadable:b,onSignal:()=>{m?.clear_buffer(),f.postMessage({result:"",prompt:"> "})},worker:f})}Wt(Ke(Li,{}),document.getElementById("app"));
