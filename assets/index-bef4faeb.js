(function(){const f=document.createElement("link").relList;if(f&&f.supports&&f.supports("modulepreload"))return;for(const k of document.querySelectorAll('link[rel="modulepreload"]'))w(k);new MutationObserver(k=>{for(const O of k)if(O.type==="childList")for(const R of O.addedNodes)R.tagName==="LINK"&&R.rel==="modulepreload"&&w(R)}).observe(document,{childList:!0,subtree:!0});function b(k){const O={};return k.integrity&&(O.integrity=k.integrity),k.referrerPolicy&&(O.referrerPolicy=k.referrerPolicy),k.crossOrigin==="use-credentials"?O.credentials="include":k.crossOrigin==="anonymous"?O.credentials="omit":O.credentials="same-origin",O}function w(k){if(k.ep)return;k.ep=!0;const O=b(k);fetch(k.href,O)}})();var ke,G,at,oe,qe,ht,Me,Se={},lt=[],Mt=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,He=Array.isArray;function re(C,f){for(var b in f)C[b]=f[b];return C}function ct(C){var f=C.parentNode;f&&f.removeChild(C)}function Ot(C,f,b){var w,k,O,R={};for(O in f)O=="key"?w=f[O]:O=="ref"?k=f[O]:R[O]=f[O];if(arguments.length>2&&(R.children=arguments.length>3?ke.call(arguments,2):b),typeof C=="function"&&C.defaultProps!=null)for(O in C.defaultProps)R[O]===void 0&&(R[O]=C.defaultProps[O]);return ve(C,R,w,k,null)}function ve(C,f,b,w,k){var O={type:C,props:f,key:b,ref:w,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:k??++at};return k==null&&G.vnode!=null&&G.vnode(O),O}function Le(C){return C.children}function pe(C,f){this.props=C,this.context=f}function _e(C,f){if(f==null)return C.__?_e(C.__,C.__.__k.indexOf(C)+1):null;for(var b;f<C.__k.length;f++)if((b=C.__k[f])!=null&&b.__e!=null)return b.__e;return typeof C.type=="function"?_e(C):null}function ut(C){var f,b;if((C=C.__)!=null&&C.__c!=null){for(C.__e=C.__c.base=null,f=0;f<C.__k.length;f++)if((b=C.__k[f])!=null&&b.__e!=null){C.__e=C.__c.base=b.__e;break}return ut(C)}}function Ve(C){(!C.__d&&(C.__d=!0)&&oe.push(C)&&!be.__r++||qe!==G.debounceRendering)&&((qe=G.debounceRendering)||ht)(be)}function be(){var C,f,b,w,k,O,R,t;for(oe.sort(Me);C=oe.shift();)C.__d&&(f=oe.length,w=void 0,k=void 0,R=(O=(b=C).__v).__e,(t=b.__P)&&(w=[],(k=re({},O)).__v=O.__v+1,Ue(t,O,k,b.__n,t.ownerSVGElement!==void 0,O.__h!=null?[R]:null,w,R??_e(O),O.__h),pt(w,O),O.__e!=R&&ut(O)),oe.length>f&&oe.sort(Me));be.__r=0}function _t(C,f,b,w,k,O,R,t,n,h){var a,_,u,p,v,c,e,s=w&&w.__k||lt,o=s.length;for(b.__k=[],a=0;a<f.length;a++)if((p=b.__k[a]=(p=f[a])==null||typeof p=="boolean"||typeof p=="function"?null:typeof p=="string"||typeof p=="number"||typeof p=="bigint"?ve(null,p,null,null,p):He(p)?ve(Le,{children:p},null,null,null):p.__b>0?ve(p.type,p.props,p.key,p.ref?p.ref:null,p.__v):p)!=null){if(p.__=b,p.__b=b.__b+1,(u=s[a])===null||u&&p.key==u.key&&p.type===u.type)s[a]=void 0;else for(_=0;_<o;_++){if((u=s[_])&&p.key==u.key&&p.type===u.type){s[_]=void 0;break}u=null}Ue(C,p,u=u||Se,k,O,R,t,n,h),v=p.__e,(_=p.ref)&&u.ref!=_&&(e||(e=[]),u.ref&&e.push(u.ref,null,p),e.push(_,p.__c||v,p)),v!=null?(c==null&&(c=v),typeof p.type=="function"&&p.__k===u.__k?p.__d=n=dt(p,n,C):n=ft(C,p,u,s,v,n),typeof b.type=="function"&&(b.__d=n)):n&&u.__e==n&&n.parentNode!=C&&(n=_e(u))}for(b.__e=c,a=o;a--;)s[a]!=null&&(typeof b.type=="function"&&s[a].__e!=null&&s[a].__e==b.__d&&(b.__d=vt(w).nextSibling),Dt(s[a],s[a]));if(e)for(a=0;a<e.length;a++)gt(e[a],e[++a],e[++a])}function dt(C,f,b){for(var w,k=C.__k,O=0;k&&O<k.length;O++)(w=k[O])&&(w.__=C,f=typeof w.type=="function"?dt(w,f,b):ft(b,w,w,k,w.__e,f));return f}function ft(C,f,b,w,k,O){var R,t,n;if(f.__d!==void 0)R=f.__d,f.__d=void 0;else if(b==null||k!=O||k.parentNode==null)e:if(O==null||O.parentNode!==C)C.appendChild(k),R=null;else{for(t=O,n=0;(t=t.nextSibling)&&n<w.length;n+=1)if(t==k)break e;C.insertBefore(k,O),R=O}return R!==void 0?R:k.nextSibling}function vt(C){var f,b,w;if(C.type==null||typeof C.type=="string")return C.__e;if(C.__k){for(f=C.__k.length-1;f>=0;f--)if((b=C.__k[f])&&(w=vt(b)))return w}return null}function It(C,f,b,w,k){var O;for(O in b)O==="children"||O==="key"||O in f||ye(C,O,null,b[O],w);for(O in f)k&&typeof f[O]!="function"||O==="children"||O==="key"||O==="value"||O==="checked"||b[O]===f[O]||ye(C,O,f[O],b[O],w)}function Ge(C,f,b){f[0]==="-"?C.setProperty(f,b??""):C[f]=b==null?"":typeof b!="number"||Mt.test(f)?b:b+"px"}function ye(C,f,b,w,k){var O;e:if(f==="style")if(typeof b=="string")C.style.cssText=b;else{if(typeof w=="string"&&(C.style.cssText=w=""),w)for(f in w)b&&f in b||Ge(C.style,f,"");if(b)for(f in b)w&&b[f]===w[f]||Ge(C.style,f,b[f])}else if(f[0]==="o"&&f[1]==="n")O=f!==(f=f.replace(/Capture$/,"")),f=f.toLowerCase()in C?f.toLowerCase().slice(2):f.slice(2),C.l||(C.l={}),C.l[f+O]=b,b?w||C.addEventListener(f,O?Ye:Xe,O):C.removeEventListener(f,O?Ye:Xe,O);else if(f!=="dangerouslySetInnerHTML"){if(k)f=f.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(f!=="width"&&f!=="height"&&f!=="href"&&f!=="list"&&f!=="form"&&f!=="tabIndex"&&f!=="download"&&f!=="rowSpan"&&f!=="colSpan"&&f in C)try{C[f]=b??"";break e}catch{}typeof b=="function"||(b==null||b===!1&&f[4]!=="-"?C.removeAttribute(f):C.setAttribute(f,b))}}function Xe(C){return this.l[C.type+!1](G.event?G.event(C):C)}function Ye(C){return this.l[C.type+!0](G.event?G.event(C):C)}function Ue(C,f,b,w,k,O,R,t,n){var h,a,_,u,p,v,c,e,s,o,i,r,d,g,S,l=f.type;if(f.constructor!==void 0)return null;b.__h!=null&&(n=b.__h,t=f.__e=b.__e,f.__h=null,O=[t]),(h=G.__b)&&h(f);try{e:if(typeof l=="function"){if(e=f.props,s=(h=l.contextType)&&w[h.__c],o=h?s?s.props.value:h.__:w,b.__c?c=(a=f.__c=b.__c).__=a.__E:("prototype"in l&&l.prototype.render?f.__c=a=new l(e,o):(f.__c=a=new pe(e,o),a.constructor=l,a.render=Ht),s&&s.sub(a),a.props=e,a.state||(a.state={}),a.context=o,a.__n=w,_=a.__d=!0,a.__h=[],a._sb=[]),a.__s==null&&(a.__s=a.state),l.getDerivedStateFromProps!=null&&(a.__s==a.state&&(a.__s=re({},a.__s)),re(a.__s,l.getDerivedStateFromProps(e,a.__s))),u=a.props,p=a.state,a.__v=f,_)l.getDerivedStateFromProps==null&&a.componentWillMount!=null&&a.componentWillMount(),a.componentDidMount!=null&&a.__h.push(a.componentDidMount);else{if(l.getDerivedStateFromProps==null&&e!==u&&a.componentWillReceiveProps!=null&&a.componentWillReceiveProps(e,o),!a.__e&&a.shouldComponentUpdate!=null&&a.shouldComponentUpdate(e,a.__s,o)===!1||f.__v===b.__v){for(f.__v!==b.__v&&(a.props=e,a.state=a.__s,a.__d=!1),a.__e=!1,f.__e=b.__e,f.__k=b.__k,f.__k.forEach(function(D){D&&(D.__=f)}),i=0;i<a._sb.length;i++)a.__h.push(a._sb[i]);a._sb=[],a.__h.length&&R.push(a);break e}a.componentWillUpdate!=null&&a.componentWillUpdate(e,a.__s,o),a.componentDidUpdate!=null&&a.__h.push(function(){a.componentDidUpdate(u,p,v)})}if(a.context=o,a.props=e,a.__P=C,r=G.__r,d=0,"prototype"in l&&l.prototype.render){for(a.state=a.__s,a.__d=!1,r&&r(f),h=a.render(a.props,a.state,a.context),g=0;g<a._sb.length;g++)a.__h.push(a._sb[g]);a._sb=[]}else do a.__d=!1,r&&r(f),h=a.render(a.props,a.state,a.context),a.state=a.__s;while(a.__d&&++d<25);a.state=a.__s,a.getChildContext!=null&&(w=re(re({},w),a.getChildContext())),_||a.getSnapshotBeforeUpdate==null||(v=a.getSnapshotBeforeUpdate(u,p)),_t(C,He(S=h!=null&&h.type===Le&&h.key==null?h.props.children:h)?S:[S],f,b,w,k,O,R,t,n),a.base=f.__e,f.__h=null,a.__h.length&&R.push(a),c&&(a.__E=a.__=null),a.__e=!1}else O==null&&f.__v===b.__v?(f.__k=b.__k,f.__e=b.__e):f.__e=Pt(b.__e,f,b,w,k,O,R,n);(h=G.diffed)&&h(f)}catch(D){f.__v=null,(n||O!=null)&&(f.__e=t,f.__h=!!n,O[O.indexOf(t)]=null),G.__e(D,f,b)}}function pt(C,f){G.__c&&G.__c(f,C),C.some(function(b){try{C=b.__h,b.__h=[],C.some(function(w){w.call(b)})}catch(w){G.__e(w,b.__v)}})}function Pt(C,f,b,w,k,O,R,t){var n,h,a,_=b.props,u=f.props,p=f.type,v=0;if(p==="svg"&&(k=!0),O!=null){for(;v<O.length;v++)if((n=O[v])&&"setAttribute"in n==!!p&&(p?n.localName===p:n.nodeType===3)){C=n,O[v]=null;break}}if(C==null){if(p===null)return document.createTextNode(u);C=k?document.createElementNS("http://www.w3.org/2000/svg",p):document.createElement(p,u.is&&u),O=null,t=!1}if(p===null)_===u||t&&C.data===u||(C.data=u);else{if(O=O&&ke.call(C.childNodes),h=(_=b.props||Se).dangerouslySetInnerHTML,a=u.dangerouslySetInnerHTML,!t){if(O!=null)for(_={},v=0;v<C.attributes.length;v++)_[C.attributes[v].name]=C.attributes[v].value;(a||h)&&(a&&(h&&a.__html==h.__html||a.__html===C.innerHTML)||(C.innerHTML=a&&a.__html||""))}if(It(C,u,_,k,t),a)f.__k=[];else if(_t(C,He(v=f.props.children)?v:[v],f,b,w,k&&p!=="foreignObject",O,R,O?O[0]:b.__k&&_e(b,0),t),O!=null)for(v=O.length;v--;)O[v]!=null&&ct(O[v]);t||("value"in u&&(v=u.value)!==void 0&&(v!==C.value||p==="progress"&&!v||p==="option"&&v!==_.value)&&ye(C,"value",v,_.value,!1),"checked"in u&&(v=u.checked)!==void 0&&v!==C.checked&&ye(C,"checked",v,_.checked,!1))}return C}function gt(C,f,b){try{typeof C=="function"?C(f):C.current=f}catch(w){G.__e(w,b)}}function Dt(C,f,b){var w,k;if(G.unmount&&G.unmount(C),(w=C.ref)&&(w.current&&w.current!==C.__e||gt(w,null,f)),(w=C.__c)!=null){if(w.componentWillUnmount)try{w.componentWillUnmount()}catch(O){G.__e(O,f)}w.base=w.__P=null,C.__c=void 0}if(w=C.__k)for(k=0;k<w.length;k++)w[k]&&Dt(w[k],f,b||typeof C.type!="function");b||C.__e==null||ct(C.__e),C.__=C.__e=C.__d=void 0}function Ht(C,f,b){return this.constructor(C,b)}function Ut(C,f,b){var w,k,O;G.__&&G.__(C,f),k=(w=typeof b=="function")?null:b&&b.__k||f.__k,O=[],Ue(f,C=(!w&&b||f).__k=Ot(Le,null,[C]),k||Se,Se,f.ownerSVGElement!==void 0,!w&&b?[b]:k?null:f.firstChild?ke.call(f.childNodes):null,O,!w&&b?b:k?k.__e:f.firstChild,w),pt(O,C)}ke=lt.slice,G={__e:function(C,f,b,w){for(var k,O,R;f=f.__;)if((k=f.__c)&&!k.__)try{if((O=k.constructor)&&O.getDerivedStateFromError!=null&&(k.setState(O.getDerivedStateFromError(C)),R=k.__d),k.componentDidCatch!=null&&(k.componentDidCatch(C,w||{}),R=k.__d),R)return k.__E=k}catch(t){C=t}throw C}},at=0,pe.prototype.setState=function(C,f){var b;b=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=re({},this.state),typeof C=="function"&&(C=C(re({},b),this.props)),C&&re(b,C),C!=null&&this.__v&&(f&&this._sb.push(f),Ve(this))},pe.prototype.forceUpdate=function(C){this.__v&&(this.__e=!0,C&&this.__h.push(C),Ve(this))},pe.prototype.render=Le,oe=[],ht=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Me=function(C,f){return C.__v.__b-f.__v.__b},be.__r=0;var de,Z,xe,Je,fe=0,Ct=[],ge=[],Ze=G.__b,Qe=G.__r,et=G.diffed,tt=G.__c,it=G.unmount;function We(C,f){G.__h&&G.__h(Z,C,fe||f),fe=0;var b=Z.__H||(Z.__H={__:[],__h:[]});return C>=b.__.length&&b.__.push({__V:ge}),b.__[C]}function Wt(C){return fe=1,Nt(bt,C)}function Nt(C,f,b){var w=We(de++,2);if(w.t=C,!w.__c&&(w.__=[b?b(f):bt(void 0,f),function(t){var n=w.__N?w.__N[0]:w.__[0],h=w.t(n,t);n!==h&&(w.__N=[h,w.__[1]],w.__c.setState({}))}],w.__c=Z,!Z.u)){var k=function(t,n,h){if(!w.__c.__H)return!0;var a=w.__c.__H.__.filter(function(u){return u.__c});if(a.every(function(u){return!u.__N}))return!O||O.call(this,t,n,h);var _=!1;return a.forEach(function(u){if(u.__N){var p=u.__[0];u.__=u.__N,u.__N=void 0,p!==u.__[0]&&(_=!0)}}),!(!_&&w.__c.props===t)&&(!O||O.call(this,t,n,h))};Z.u=!0;var O=Z.shouldComponentUpdate,R=Z.componentWillUpdate;Z.componentWillUpdate=function(t,n,h){if(this.__e){var a=O;O=void 0,k(t,n,h),O=a}R&&R.call(this,t,n,h)},Z.shouldComponentUpdate=k}return w.__N||w.__}function mt(C,f){var b=We(de++,3);!G.__s&&St(b.__H,f)&&(b.__=C,b.i=f,Z.__H.__h.push(b))}function st(C){return fe=5,Ne(function(){return{current:C}},[])}function Ne(C,f){var b=We(de++,7);return St(b.__H,f)?(b.__V=C(),b.i=f,b.__h=C,b.__V):b.__}function $t(C,f){return fe=8,Ne(function(){return C},f)}function jt(){for(var C;C=Ct.shift();)if(C.__P&&C.__H)try{C.__H.__h.forEach(De),C.__H.__h.forEach(Oe),C.__H.__h=[]}catch(f){C.__H.__h=[],G.__e(f,C.__v)}}G.__b=function(C){Z=null,Ze&&Ze(C)},G.__r=function(C){Qe&&Qe(C),de=0;var f=(Z=C.__c).__H;f&&(xe===Z?(f.__h=[],Z.__h=[],f.__.forEach(function(b){b.__N&&(b.__=b.__N),b.__V=ge,b.__N=b.i=void 0})):(f.__h.forEach(De),f.__h.forEach(Oe),f.__h=[],de=0)),xe=Z},G.diffed=function(C){et&&et(C);var f=C.__c;f&&f.__H&&(f.__H.__h.length&&(Ct.push(f)!==1&&Je===G.requestAnimationFrame||((Je=G.requestAnimationFrame)||zt)(jt)),f.__H.__.forEach(function(b){b.i&&(b.__H=b.i),b.__V!==ge&&(b.__=b.__V),b.i=void 0,b.__V=ge})),xe=Z=null},G.__c=function(C,f){f.some(function(b){try{b.__h.forEach(De),b.__h=b.__h.filter(function(w){return!w.__||Oe(w)})}catch(w){f.some(function(k){k.__h&&(k.__h=[])}),f=[],G.__e(w,b.__v)}}),tt&&tt(C,f)},G.unmount=function(C){it&&it(C);var f,b=C.__c;b&&b.__H&&(b.__H.__.forEach(function(w){try{De(w)}catch(k){f=k}}),b.__H=void 0,f&&G.__e(f,b.__v))};var rt=typeof requestAnimationFrame=="function";function zt(C){var f,b=function(){clearTimeout(w),rt&&cancelAnimationFrame(f),setTimeout(C)},w=setTimeout(b,100);rt&&(f=requestAnimationFrame(b))}function De(C){var f=Z,b=C.__c;typeof b=="function"&&(C.__c=void 0,b()),Z=f}function Oe(C){var f=Z;C.__c=C.__(),Z=f}function St(C,f){return!C||C.length!==f.length||f.some(function(b,w){return b!==C[w]})}function bt(C,f){return typeof f=="function"?f(C):f}var Ee=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},yt={exports:{}};(function(C,f){(function(b,w){C.exports=w()})(self,function(){return(()=>{var b={4567:(R,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AccessibilityManager=void 0;const h=n(9042),a=n(6114),_=n(9924),u=n(3656),p=n(844),v=n(5596),c=n(9631);class e extends p.Disposable{constructor(o,i){super(),this._terminal=o,this._renderService=i,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityTreeRoot=document.createElement("div"),this._accessibilityTreeRoot.classList.add("xterm-accessibility"),this._accessibilityTreeRoot.tabIndex=0,this._rowContainer=document.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let r=0;r<this._terminal.rows;r++)this._rowElements[r]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[r]);if(this._topBoundaryFocusListener=r=>this._handleBoundaryFocus(r,0),this._bottomBoundaryFocusListener=r=>this._handleBoundaryFocus(r,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityTreeRoot.appendChild(this._rowContainer),this._renderRowsDebouncer=new _.TimeBasedDebouncer(this._renderRows.bind(this)),this._refreshRows(),this._liveRegion=document.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityTreeRoot.appendChild(this._liveRegion),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityTreeRoot),this.register(this._renderRowsDebouncer),this.register(this._terminal.onResize(r=>this._handleResize(r.rows))),this.register(this._terminal.onRender(r=>this._refreshRows(r.start,r.end))),this.register(this._terminal.onScroll(()=>this._refreshRows())),this.register(this._terminal.onA11yChar(r=>this._handleChar(r))),this.register(this._terminal.onLineFeed(()=>this._handleChar(`
`))),this.register(this._terminal.onA11yTab(r=>this._handleTab(r))),this.register(this._terminal.onKey(r=>this._handleKey(r.key))),this.register(this._terminal.onBlur(()=>this._clearLiveRegion())),this.register(this._renderService.onDimensionsChange(()=>this._refreshRowsDimensions())),this._screenDprMonitor=new v.ScreenDprMonitor(window),this.register(this._screenDprMonitor),this._screenDprMonitor.setListener(()=>this._refreshRowsDimensions()),this.register((0,u.addDisposableDomListener)(window,"resize",()=>this._refreshRowsDimensions())),this.register((0,p.toDisposable)(()=>{(0,c.removeElementFromParent)(this._accessibilityTreeRoot),this._rowElements.length=0}))}_handleBoundaryFocus(o,i){const r=o.target,d=this._rowElements[i===0?1:this._rowElements.length-2];if(r.getAttribute("aria-posinset")===(i===0?"1":`${this._terminal.buffer.lines.length}`)||o.relatedTarget!==d)return;let g,S;if(i===0?(g=r,S=this._rowElements.pop(),this._rowContainer.removeChild(S)):(g=this._rowElements.shift(),S=r,this._rowContainer.removeChild(g)),g.removeEventListener("focus",this._topBoundaryFocusListener),S.removeEventListener("focus",this._bottomBoundaryFocusListener),i===0){const l=this._createAccessibilityTreeNode();this._rowElements.unshift(l),this._rowContainer.insertAdjacentElement("afterbegin",l)}else{const l=this._createAccessibilityTreeNode();this._rowElements.push(l),this._rowContainer.appendChild(l)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(i===0?-1:1),this._rowElements[i===0?1:this._rowElements.length-2].focus(),o.preventDefault(),o.stopImmediatePropagation()}_handleResize(o){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let i=this._rowContainer.children.length;i<this._terminal.rows;i++)this._rowElements[i]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[i]);for(;this._rowElements.length>o;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){const o=document.createElement("div");return o.setAttribute("role","listitem"),o.tabIndex=-1,this._refreshRowDimensions(o),o}_handleTab(o){for(let i=0;i<o;i++)this._handleChar(" ")}_handleChar(o){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==o&&(this._charsToAnnounce+=o):this._charsToAnnounce+=o,o===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===21&&(this._liveRegion.textContent+=h.tooMuchOutput)),a.isMac&&this._liveRegion.textContent&&this._liveRegion.textContent.length>0&&!this._liveRegion.parentNode&&setTimeout(()=>{this._accessibilityTreeRoot.appendChild(this._liveRegion)},0))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0,a.isMac&&(0,c.removeElementFromParent)(this._liveRegion)}_handleKey(o){this._clearLiveRegion(),/\p{Control}/u.test(o)||this._charsToConsume.push(o)}_refreshRows(o,i){this._renderRowsDebouncer.refresh(o,i,this._terminal.rows)}_renderRows(o,i){const r=this._terminal.buffer,d=r.lines.length.toString();for(let g=o;g<=i;g++){const S=r.translateBufferLineToString(r.ydisp+g,!0),l=(r.ydisp+g+1).toString(),D=this._rowElements[g];D&&(S.length===0?D.innerText=" ":D.textContent=S,D.setAttribute("aria-posinset",l),D.setAttribute("aria-setsize",d))}this._announceCharacters()}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){this._accessibilityTreeRoot.style.width=`${this._renderService.dimensions.css.canvas.width}px`,this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let o=0;o<this._terminal.rows;o++)this._refreshRowDimensions(this._rowElements[o])}}_refreshRowDimensions(o){o.style.height=`${this._renderService.dimensions.css.cell.height}px`}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}}t.AccessibilityManager=e},3614:(R,t)=>{function n(u){return u.replace(/\r?\n/g,"\r")}function h(u,p){return p?"\x1B[200~"+u+"\x1B[201~":u}function a(u,p,v){u=h(u=n(u),v.decPrivateModes.bracketedPasteMode),v.triggerDataEvent(u,!0),p.value=""}function _(u,p,v){const c=v.getBoundingClientRect(),e=u.clientX-c.left-10,s=u.clientY-c.top-10;p.style.width="20px",p.style.height="20px",p.style.left=`${e}px`,p.style.top=`${s}px`,p.style.zIndex="1000",p.focus()}Object.defineProperty(t,"__esModule",{value:!0}),t.rightClickHandler=t.moveTextAreaUnderMouseCursor=t.paste=t.handlePasteEvent=t.copyHandler=t.bracketTextForPaste=t.prepareTextForTerminal=void 0,t.prepareTextForTerminal=n,t.bracketTextForPaste=h,t.copyHandler=function(u,p){u.clipboardData&&u.clipboardData.setData("text/plain",p.selectionText),u.preventDefault()},t.handlePasteEvent=function(u,p,v){u.stopPropagation(),u.clipboardData&&a(u.clipboardData.getData("text/plain"),p,v)},t.paste=a,t.moveTextAreaUnderMouseCursor=_,t.rightClickHandler=function(u,p,v,c,e){_(u,p,v),e&&c.rightClickSelect(u),p.value=c.selectionText,p.select()}},7239:(R,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ColorContrastCache=void 0;const h=n(1505);t.ColorContrastCache=class{constructor(){this._color=new h.TwoKeyMap,this._css=new h.TwoKeyMap}setCss(a,_,u){this._css.set(a,_,u)}getCss(a,_){return this._css.get(a,_)}setColor(a,_,u){this._color.set(a,_,u)}getColor(a,_){return this._color.get(a,_)}clear(){this._color.clear(),this._css.clear()}}},9631:(R,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.removeElementFromParent=void 0,t.removeElementFromParent=function(...n){var h;for(const a of n)(h=a?.parentElement)===null||h===void 0||h.removeChild(a)}},3656:(R,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addDisposableDomListener=void 0,t.addDisposableDomListener=function(n,h,a,_){n.addEventListener(h,a,_);let u=!1;return{dispose:()=>{u||(u=!0,n.removeEventListener(h,a,_))}}}},6465:function(R,t,n){var h=this&&this.__decorate||function(e,s,o,i){var r,d=arguments.length,g=d<3?s:i===null?i=Object.getOwnPropertyDescriptor(s,o):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(e,s,o,i);else for(var S=e.length-1;S>=0;S--)(r=e[S])&&(g=(d<3?r(g):d>3?r(s,o,g):r(s,o))||g);return d>3&&g&&Object.defineProperty(s,o,g),g},a=this&&this.__param||function(e,s){return function(o,i){s(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Linkifier2=void 0;const _=n(2585),u=n(8460),p=n(844),v=n(3656);let c=class extends p.Disposable{constructor(e){super(),this._bufferService=e,this._linkProviders=[],this._linkCacheDisposables=[],this._isMouseOut=!0,this._activeLine=-1,this._onShowLinkUnderline=this.register(new u.EventEmitter),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this.register(new u.EventEmitter),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this.register((0,p.getDisposeArrayDisposable)(this._linkCacheDisposables)),this.register((0,p.toDisposable)(()=>{this._lastMouseEvent=void 0}))}get currentLink(){return this._currentLink}registerLinkProvider(e){return this._linkProviders.push(e),{dispose:()=>{const s=this._linkProviders.indexOf(e);s!==-1&&this._linkProviders.splice(s,1)}}}attachToDom(e,s,o){this._element=e,this._mouseService=s,this._renderService=o,this.register((0,v.addDisposableDomListener)(this._element,"mouseleave",()=>{this._isMouseOut=!0,this._clearCurrentLink()})),this.register((0,v.addDisposableDomListener)(this._element,"mousemove",this._handleMouseMove.bind(this))),this.register((0,v.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,v.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))}_handleMouseMove(e){if(this._lastMouseEvent=e,!this._element||!this._mouseService)return;const s=this._positionFromMouseEvent(e,this._element,this._mouseService);if(!s)return;this._isMouseOut=!1;const o=e.composedPath();for(let i=0;i<o.length;i++){const r=o[i];if(r.classList.contains("xterm"))break;if(r.classList.contains("xterm-hover"))return}this._lastBufferCell&&s.x===this._lastBufferCell.x&&s.y===this._lastBufferCell.y||(this._handleHover(s),this._lastBufferCell=s)}_handleHover(e){if(this._activeLine!==e.y)return this._clearCurrentLink(),void this._askForLink(e,!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,e)||(this._clearCurrentLink(),this._askForLink(e,!0))}_askForLink(e,s){var o,i;this._activeProviderReplies&&s||((o=this._activeProviderReplies)===null||o===void 0||o.forEach(d=>{d?.forEach(g=>{g.link.dispose&&g.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=e.y);let r=!1;for(const[d,g]of this._linkProviders.entries())s?!((i=this._activeProviderReplies)===null||i===void 0)&&i.get(d)&&(r=this._checkLinkProviderResult(d,e,r)):g.provideLinks(e.y,S=>{var l,D;if(this._isMouseOut)return;const y=S?.map(L=>({link:L}));(l=this._activeProviderReplies)===null||l===void 0||l.set(d,y),r=this._checkLinkProviderResult(d,e,r),((D=this._activeProviderReplies)===null||D===void 0?void 0:D.size)===this._linkProviders.length&&this._removeIntersectingLinks(e.y,this._activeProviderReplies)})}_removeIntersectingLinks(e,s){const o=new Set;for(let i=0;i<s.size;i++){const r=s.get(i);if(r)for(let d=0;d<r.length;d++){const g=r[d],S=g.link.range.start.y<e?0:g.link.range.start.x,l=g.link.range.end.y>e?this._bufferService.cols:g.link.range.end.x;for(let D=S;D<=l;D++){if(o.has(D)){r.splice(d--,1);break}o.add(D)}}}}_checkLinkProviderResult(e,s,o){var i;if(!this._activeProviderReplies)return o;const r=this._activeProviderReplies.get(e);let d=!1;for(let g=0;g<e;g++)this._activeProviderReplies.has(g)&&!this._activeProviderReplies.get(g)||(d=!0);if(!d&&r){const g=r.find(S=>this._linkAtPosition(S.link,s));g&&(o=!0,this._handleNewLink(g))}if(this._activeProviderReplies.size===this._linkProviders.length&&!o)for(let g=0;g<this._activeProviderReplies.size;g++){const S=(i=this._activeProviderReplies.get(g))===null||i===void 0?void 0:i.find(l=>this._linkAtPosition(l.link,s));if(S){o=!0,this._handleNewLink(S);break}}return o}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(e){if(!this._element||!this._mouseService||!this._currentLink)return;const s=this._positionFromMouseEvent(e,this._element,this._mouseService);s&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,s)&&this._currentLink.link.activate(e,this._currentLink.link.text)}_clearCurrentLink(e,s){this._element&&this._currentLink&&this._lastMouseEvent&&(!e||!s||this._currentLink.link.range.start.y>=e&&this._currentLink.link.range.end.y<=s)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,p.disposeArray)(this._linkCacheDisposables))}_handleNewLink(e){if(!this._element||!this._lastMouseEvent||!this._mouseService)return;const s=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);s&&this._linkAtPosition(e.link,s)&&(this._currentLink=e,this._currentLink.state={decorations:{underline:e.link.decorations===void 0||e.link.decorations.underline,pointerCursor:e.link.decorations===void 0||e.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,e.link,this._lastMouseEvent),e.link.decorations={},Object.defineProperties(e.link.decorations,{pointerCursor:{get:()=>{var o,i;return(i=(o=this._currentLink)===null||o===void 0?void 0:o.state)===null||i===void 0?void 0:i.decorations.pointerCursor},set:o=>{var i,r;!((i=this._currentLink)===null||i===void 0)&&i.state&&this._currentLink.state.decorations.pointerCursor!==o&&(this._currentLink.state.decorations.pointerCursor=o,this._currentLink.state.isHovered&&((r=this._element)===null||r===void 0||r.classList.toggle("xterm-cursor-pointer",o)))}},underline:{get:()=>{var o,i;return(i=(o=this._currentLink)===null||o===void 0?void 0:o.state)===null||i===void 0?void 0:i.decorations.underline},set:o=>{var i,r,d;!((i=this._currentLink)===null||i===void 0)&&i.state&&((d=(r=this._currentLink)===null||r===void 0?void 0:r.state)===null||d===void 0?void 0:d.decorations.underline)!==o&&(this._currentLink.state.decorations.underline=o,this._currentLink.state.isHovered&&this._fireUnderlineEvent(e.link,o))}}}),this._renderService&&this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange(o=>{const i=o.start===0?0:o.start+1+this._bufferService.buffer.ydisp,r=this._currentLink?this._lastMouseEvent:void 0;if(this._clearCurrentLink(i,o.end+1+this._bufferService.buffer.ydisp),r&&this._element){const d=this._positionFromMouseEvent(r,this._element,this._mouseService);d&&this._askForLink(d,!1)}})))}_linkHover(e,s,o){var i;!((i=this._currentLink)===null||i===void 0)&&i.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(s,!0),this._currentLink.state.decorations.pointerCursor&&e.classList.add("xterm-cursor-pointer")),s.hover&&s.hover(o,s.text)}_fireUnderlineEvent(e,s){const o=e.range,i=this._bufferService.buffer.ydisp,r=this._createLinkUnderlineEvent(o.start.x-1,o.start.y-i-1,o.end.x,o.end.y-i-1,void 0);(s?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(r)}_linkLeave(e,s,o){var i;!((i=this._currentLink)===null||i===void 0)&&i.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(s,!1),this._currentLink.state.decorations.pointerCursor&&e.classList.remove("xterm-cursor-pointer")),s.leave&&s.leave(o,s.text)}_linkAtPosition(e,s){const o=e.range.start.y*this._bufferService.cols+e.range.start.x,i=e.range.end.y*this._bufferService.cols+e.range.end.x,r=s.y*this._bufferService.cols+s.x;return o<=r&&r<=i}_positionFromMouseEvent(e,s,o){const i=o.getCoords(e,s,this._bufferService.cols,this._bufferService.rows);if(i)return{x:i[0],y:i[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(e,s,o,i,r){return{x1:e,y1:s,x2:o,y2:i,cols:this._bufferService.cols,fg:r}}};c=h([a(0,_.IBufferService)],c),t.Linkifier2=c},9042:(R,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.tooMuchOutput=t.promptLabel=void 0,t.promptLabel="Terminal input",t.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},3730:function(R,t,n){var h=this&&this.__decorate||function(c,e,s,o){var i,r=arguments.length,d=r<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,s):o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,s,o);else for(var g=c.length-1;g>=0;g--)(i=c[g])&&(d=(r<3?i(d):r>3?i(e,s,d):i(e,s))||d);return r>3&&d&&Object.defineProperty(e,s,d),d},a=this&&this.__param||function(c,e){return function(s,o){e(s,o,c)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OscLinkProvider=void 0;const _=n(511),u=n(2585);let p=class{constructor(c,e,s){this._bufferService=c,this._optionsService=e,this._oscLinkService=s}provideLinks(c,e){var s;const o=this._bufferService.buffer.lines.get(c-1);if(!o)return void e(void 0);const i=[],r=this._optionsService.rawOptions.linkHandler,d=new _.CellData,g=o.getTrimmedLength();let S=-1,l=-1,D=!1;for(let y=0;y<g;y++)if(l!==-1||o.hasContent(y)){if(o.loadCell(y,d),d.hasExtendedAttrs()&&d.extended.urlId){if(l===-1){l=y,S=d.extended.urlId;continue}D=d.extended.urlId!==S}else l!==-1&&(D=!0);if(D||l!==-1&&y===g-1){const L=(s=this._oscLinkService.getLinkData(S))===null||s===void 0?void 0:s.uri;if(L){const A={start:{x:l+1,y:c},end:{x:y+(D||y!==g-1?0:1),y:c}};let M=!1;if(!r?.allowNonHttpProtocols)try{const P=new URL(L);["http:","https:"].includes(P.protocol)||(M=!0)}catch{M=!0}M||i.push({text:L,range:A,activate:(P,N)=>r?r.activate(P,N,A):v(0,N),hover:(P,N)=>{var j;return(j=r?.hover)===null||j===void 0?void 0:j.call(r,P,N,A)},leave:(P,N)=>{var j;return(j=r?.leave)===null||j===void 0?void 0:j.call(r,P,N,A)}})}D=!1,d.hasExtendedAttrs()&&d.extended.urlId?(l=y,S=d.extended.urlId):(l=-1,S=-1)}}e(i)}};function v(c,e){if(confirm(`Do you want to navigate to ${e}?

WARNING: This link could potentially be dangerous`)){const s=window.open();if(s){try{s.opener=null}catch{}s.location.href=e}else console.warn("Opening link blocked as opener could not be cleared")}}p=h([a(0,u.IBufferService),a(1,u.IOptionsService),a(2,u.IOscLinkService)],p),t.OscLinkProvider=p},6193:(R,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RenderDebouncer=void 0,t.RenderDebouncer=class{constructor(n,h){this._parentWindow=n,this._renderCallback=h,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._parentWindow.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(n){return this._refreshCallbacks.push(n),this._animationFrame||(this._animationFrame=this._parentWindow.requestAnimationFrame(()=>this._innerRefresh())),this._animationFrame}refresh(n,h,a){this._rowCount=a,n=n!==void 0?n:0,h=h!==void 0?h:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,n):n,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,h):h,this._animationFrame||(this._animationFrame=this._parentWindow.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return void this._runRefreshCallbacks();const n=Math.max(this._rowStart,0),h=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(n,h),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(const n of this._refreshCallbacks)n(0);this._refreshCallbacks=[]}}},5596:(R,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenDprMonitor=void 0;const h=n(844);class a extends h.Disposable{constructor(u){super(),this._parentWindow=u,this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this.register((0,h.toDisposable)(()=>{this.clearListener()}))}setListener(u){this._listener&&this.clearListener(),this._listener=u,this._outerListener=()=>{this._listener&&(this._listener(this._parentWindow.devicePixelRatio,this._currentDevicePixelRatio),this._updateDpr())},this._updateDpr()}_updateDpr(){var u;this._outerListener&&((u=this._resolutionMediaMatchList)===null||u===void 0||u.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._listener&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._listener=void 0,this._outerListener=void 0)}}t.ScreenDprMonitor=a},3236:(R,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Terminal=void 0;const h=n(2950),a=n(1680),_=n(3614),u=n(2584),p=n(5435),v=n(9312),c=n(6114),e=n(3656),s=n(9042),o=n(4567),i=n(1296),r=n(7399),d=n(8460),g=n(8437),S=n(3230),l=n(4725),D=n(428),y=n(8934),L=n(6465),A=n(5114),M=n(8969),P=n(8055),N=n(4269),j=n(5941),m=n(3107),E=n(5744),F=n(9074),T=n(2585),U=n(3730),z=n(844),V=n(6731),W=typeof window<"u"?window.document:null;class q extends M.CoreTerminal{constructor(B={}){super(B),this.browser=c,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._onCursorMove=this.register(new d.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onKey=this.register(new d.EventEmitter),this.onKey=this._onKey.event,this._onRender=this.register(new d.EventEmitter),this.onRender=this._onRender.event,this._onSelectionChange=this.register(new d.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this.register(new d.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onBell=this.register(new d.EventEmitter),this.onBell=this._onBell.event,this._onFocus=this.register(new d.EventEmitter),this._onBlur=this.register(new d.EventEmitter),this._onA11yCharEmitter=this.register(new d.EventEmitter),this._onA11yTabEmitter=this.register(new d.EventEmitter),this._onWillOpen=this.register(new d.EventEmitter),this._setup(),this.linkifier2=this.register(this._instantiationService.createInstance(L.Linkifier2)),this.linkifier2.registerLinkProvider(this._instantiationService.createInstance(U.OscLinkProvider)),this._decorationService=this._instantiationService.createInstance(F.DecorationService),this._instantiationService.setService(T.IDecorationService,this._decorationService),this.register(this._inputHandler.onRequestBell(()=>this._onBell.fire())),this.register(this._inputHandler.onRequestRefreshRows((I,H)=>this.refresh(I,H))),this.register(this._inputHandler.onRequestSendFocus(()=>this._reportFocus())),this.register(this._inputHandler.onRequestReset(()=>this.reset())),this.register(this._inputHandler.onRequestWindowsOptionsReport(I=>this._reportWindowsOptions(I))),this.register(this._inputHandler.onColor(I=>this._handleColorEvent(I))),this.register((0,d.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,d.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,d.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,d.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize(I=>this._afterResize(I.cols,I.rows))),this.register((0,z.toDisposable)(()=>{var I,H;this._customKeyEventHandler=void 0,(H=(I=this.element)===null||I===void 0?void 0:I.parentNode)===null||H===void 0||H.removeChild(this.element)}))}get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}_handleColorEvent(B){if(this._themeService)for(const I of B){let H,$="";switch(I.index){case 256:H="foreground",$="10";break;case 257:H="background",$="11";break;case 258:H="cursor",$="12";break;default:H="ansi",$="4;"+I.index}switch(I.type){case 0:const J=P.color.toColorRGB(H==="ansi"?this._themeService.colors.ansi[I.index]:this._themeService.colors[H]);this.coreService.triggerDataEvent(`${u.C0.ESC}]${$};${(0,j.toRgbString)(J)}${u.C1_ESCAPED.ST}`);break;case 1:if(H==="ansi")this._themeService.modifyColors(K=>K.ansi[I.index]=P.rgba.toColor(...I.color));else{const K=H;this._themeService.modifyColors(ee=>ee[K]=P.rgba.toColor(...I.color))}break;case 2:this._themeService.restoreColor(I.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(B){var I;B?!this._accessibilityManager&&this._renderService&&(this._accessibilityManager=new o.AccessibilityManager(this,this._renderService)):((I=this._accessibilityManager)===null||I===void 0||I.dispose(),this._accessibilityManager=void 0)}_handleTextAreaFocus(B){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(u.C0.ESC+"[I"),this.updateCursorStyle(B),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){var B;return(B=this.textarea)===null||B===void 0?void 0:B.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(u.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;const B=this.buffer.ybase+this.buffer.y,I=this.buffer.lines.get(B);if(!I)return;const H=Math.min(this.buffer.x,this.cols-1),$=this._renderService.dimensions.css.cell.height,J=I.getWidth(H),K=this._renderService.dimensions.css.cell.width*J,ee=this.buffer.y*this._renderService.dimensions.css.cell.height,ie=H*this._renderService.dimensions.css.cell.width;this.textarea.style.left=ie+"px",this.textarea.style.top=ee+"px",this.textarea.style.width=K+"px",this.textarea.style.height=$+"px",this.textarea.style.lineHeight=$+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register((0,e.addDisposableDomListener)(this.element,"copy",I=>{this.hasSelection()&&(0,_.copyHandler)(I,this._selectionService)}));const B=I=>(0,_.handlePasteEvent)(I,this.textarea,this.coreService);this.register((0,e.addDisposableDomListener)(this.textarea,"paste",B)),this.register((0,e.addDisposableDomListener)(this.element,"paste",B)),c.isFirefox?this.register((0,e.addDisposableDomListener)(this.element,"mousedown",I=>{I.button===2&&(0,_.rightClickHandler)(I,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})):this.register((0,e.addDisposableDomListener)(this.element,"contextmenu",I=>{(0,_.rightClickHandler)(I,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})),c.isLinux&&this.register((0,e.addDisposableDomListener)(this.element,"auxclick",I=>{I.button===1&&(0,_.moveTextAreaUnderMouseCursor)(I,this.textarea,this.screenElement)}))}_bindKeys(){this.register((0,e.addDisposableDomListener)(this.textarea,"keyup",B=>this._keyUp(B),!0)),this.register((0,e.addDisposableDomListener)(this.textarea,"keydown",B=>this._keyDown(B),!0)),this.register((0,e.addDisposableDomListener)(this.textarea,"keypress",B=>this._keyPress(B),!0)),this.register((0,e.addDisposableDomListener)(this.textarea,"compositionstart",()=>this._compositionHelper.compositionstart())),this.register((0,e.addDisposableDomListener)(this.textarea,"compositionupdate",B=>this._compositionHelper.compositionupdate(B))),this.register((0,e.addDisposableDomListener)(this.textarea,"compositionend",()=>this._compositionHelper.compositionend())),this.register((0,e.addDisposableDomListener)(this.textarea,"input",B=>this._inputEvent(B),!0)),this.register(this.onRender(()=>this._compositionHelper.updateCompositionElements()))}open(B){var I;if(!B)throw new Error("Terminal requires a parent element.");B.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this._document=B.ownerDocument,this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),this.element.setAttribute("tabindex","0"),B.appendChild(this.element);const H=W.createDocumentFragment();this._viewportElement=W.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),H.appendChild(this._viewportElement),this._viewportScrollArea=W.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=W.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._helperContainer=W.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),H.appendChild(this.screenElement),this.textarea=W.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",s.promptLabel),c.isChromeOS||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._coreBrowserService=this._instantiationService.createInstance(A.CoreBrowserService,this.textarea,(I=this._document.defaultView)!==null&&I!==void 0?I:window),this._instantiationService.setService(l.ICoreBrowserService,this._coreBrowserService),this.register((0,e.addDisposableDomListener)(this.textarea,"focus",$=>this._handleTextAreaFocus($))),this.register((0,e.addDisposableDomListener)(this.textarea,"blur",()=>this._handleTextAreaBlur())),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(D.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(l.ICharSizeService,this._charSizeService),this._themeService=this._instantiationService.createInstance(V.ThemeService),this._instantiationService.setService(l.IThemeService,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(N.CharacterJoinerService),this._instantiationService.setService(l.ICharacterJoinerService,this._characterJoinerService),this._renderService=this.register(this._instantiationService.createInstance(S.RenderService,this.rows,this.screenElement)),this._instantiationService.setService(l.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange($=>this._onRender.fire($))),this.onResize($=>this._renderService.resize($.cols,$.rows)),this._compositionView=W.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(h.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this.element.appendChild(H);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this._mouseService=this._instantiationService.createInstance(y.MouseService),this._instantiationService.setService(l.IMouseService,this._mouseService),this.viewport=this._instantiationService.createInstance(a.Viewport,$=>this.scrollLines($,!0,1),this._viewportElement,this._viewportScrollArea),this.register(this._inputHandler.onRequestSyncScrollBar(()=>this.viewport.syncScrollArea())),this.register(this.viewport),this.register(this.onCursorMove(()=>{this._renderService.handleCursorMove(),this._syncTextArea()})),this.register(this.onResize(()=>this._renderService.handleResize(this.cols,this.rows))),this.register(this.onBlur(()=>this._renderService.handleBlur())),this.register(this.onFocus(()=>this._renderService.handleFocus())),this.register(this._renderService.onDimensionsChange(()=>this.viewport.syncScrollArea())),this._selectionService=this.register(this._instantiationService.createInstance(v.SelectionService,this.element,this.screenElement,this.linkifier2)),this._instantiationService.setService(l.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines($=>this.scrollLines($.amount,$.suppressScrollEvent))),this.register(this._selectionService.onSelectionChange(()=>this._onSelectionChange.fire())),this.register(this._selectionService.onRequestRedraw($=>this._renderService.handleSelectionChanged($.start,$.end,$.columnSelectMode))),this.register(this._selectionService.onLinuxMouseSelection($=>{this.textarea.value=$,this.textarea.focus(),this.textarea.select()})),this.register(this._onScroll.event($=>{this.viewport.syncScrollArea(),this._selectionService.refresh()})),this.register((0,e.addDisposableDomListener)(this._viewportElement,"scroll",()=>this._selectionService.refresh())),this.linkifier2.attachToDom(this.screenElement,this._mouseService,this._renderService),this.register(this._instantiationService.createInstance(m.BufferDecorationRenderer,this.screenElement)),this.register((0,e.addDisposableDomListener)(this.element,"mousedown",$=>this._selectionService.handleMouseDown($))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager=new o.AccessibilityManager(this,this._renderService)),this.register(this.optionsService.onSpecificOptionChange("screenReaderMode",$=>this._handleScreenReaderModeOptionChange($))),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(E.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRulerWidth",$=>{!this._overviewRulerRenderer&&$&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(E.OverviewRulerRenderer,this._viewportElement,this.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(i.DomRenderer,this.element,this.screenElement,this._viewportElement,this.linkifier2)}bindMouse(){const B=this,I=this.element;function H(K){const ee=B._mouseService.getMouseReportCoords(K,B.screenElement);if(!ee)return!1;let ie,te;switch(K.overrideType||K.type){case"mousemove":te=32,K.buttons===void 0?(ie=3,K.button!==void 0&&(ie=K.button<3?K.button:3)):ie=1&K.buttons?0:4&K.buttons?1:2&K.buttons?2:3;break;case"mouseup":te=0,ie=K.button<3?K.button:3;break;case"mousedown":te=1,ie=K.button<3?K.button:3;break;case"wheel":if(B.viewport.getLinesScrolled(K)===0)return!1;te=K.deltaY<0?0:1,ie=4;break;default:return!1}return!(te===void 0||ie===void 0||ie>4)&&B.coreMouseService.triggerMouseEvent({col:ee.col,row:ee.row,x:ee.x,y:ee.y,button:ie,action:te,ctrl:K.ctrlKey,alt:K.altKey,shift:K.shiftKey})}const $={mouseup:null,wheel:null,mousedrag:null,mousemove:null},J={mouseup:K=>(H(K),K.buttons||(this._document.removeEventListener("mouseup",$.mouseup),$.mousedrag&&this._document.removeEventListener("mousemove",$.mousedrag)),this.cancel(K)),wheel:K=>(H(K),this.cancel(K,!0)),mousedrag:K=>{K.buttons&&H(K)},mousemove:K=>{K.buttons||H(K)}};this.register(this.coreMouseService.onProtocolChange(K=>{K?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(K)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&K?$.mousemove||(I.addEventListener("mousemove",J.mousemove),$.mousemove=J.mousemove):(I.removeEventListener("mousemove",$.mousemove),$.mousemove=null),16&K?$.wheel||(I.addEventListener("wheel",J.wheel,{passive:!1}),$.wheel=J.wheel):(I.removeEventListener("wheel",$.wheel),$.wheel=null),2&K?$.mouseup||($.mouseup=J.mouseup):(this._document.removeEventListener("mouseup",$.mouseup),$.mouseup=null),4&K?$.mousedrag||($.mousedrag=J.mousedrag):(this._document.removeEventListener("mousemove",$.mousedrag),$.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,e.addDisposableDomListener)(I,"mousedown",K=>{if(K.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection(K))return H(K),$.mouseup&&this._document.addEventListener("mouseup",$.mouseup),$.mousedrag&&this._document.addEventListener("mousemove",$.mousedrag),this.cancel(K)})),this.register((0,e.addDisposableDomListener)(I,"wheel",K=>{if(!$.wheel){if(!this.buffer.hasScrollback){const ee=this.viewport.getLinesScrolled(K);if(ee===0)return;const ie=u.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(K.deltaY<0?"A":"B");let te="";for(let Y=0;Y<Math.abs(ee);Y++)te+=ie;return this.coreService.triggerDataEvent(te,!0),this.cancel(K,!0)}return this.viewport.handleWheel(K)?this.cancel(K):void 0}},{passive:!1})),this.register((0,e.addDisposableDomListener)(I,"touchstart",K=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchStart(K),this.cancel(K)},{passive:!0})),this.register((0,e.addDisposableDomListener)(I,"touchmove",K=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchMove(K)?void 0:this.cancel(K)},{passive:!1}))}refresh(B,I){var H;(H=this._renderService)===null||H===void 0||H.refreshRows(B,I)}updateCursorStyle(B){var I;!((I=this._selectionService)===null||I===void 0)&&I.shouldColumnSelect(B)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(B,I,H=0){super.scrollLines(B,I,H),this.refresh(0,this.rows-1)}paste(B){(0,_.paste)(B,this.textarea,this.coreService)}attachCustomKeyEventHandler(B){this._customKeyEventHandler=B}registerLinkProvider(B){return this.linkifier2.registerLinkProvider(B)}registerCharacterJoiner(B){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");const I=this._characterJoinerService.register(B);return this.refresh(0,this.rows-1),I}deregisterCharacterJoiner(B){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(B)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}addMarker(B){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+B)}registerDecoration(B){return this._decorationService.registerDecoration(B)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(B,I,H){this._selectionService.setSelection(B,I,H)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){var B;(B=this._selectionService)===null||B===void 0||B.clearSelection()}selectAll(){var B;(B=this._selectionService)===null||B===void 0||B.selectAll()}selectLines(B,I){var H;(H=this._selectionService)===null||H===void 0||H.selectLines(B,I)}_keyDown(B){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(B)===!1)return!1;const I=this.browser.isMac&&this.options.macOptionIsMeta&&B.altKey;if(!I&&!this._compositionHelper.keydown(B))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this._bufferService.scrollToBottom(),!1;I||B.key!=="Dead"&&B.key!=="AltGraph"||(this._unprocessedDeadKey=!0);const H=(0,r.evaluateKeyboardEvent)(B,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(B),H.type===3||H.type===2){const $=this.rows-1;return this.scrollLines(H.type===2?-$:$),this.cancel(B,!0)}return H.type===1&&this.selectAll(),!!this._isThirdLevelShift(this.browser,B)||(H.cancel&&this.cancel(B,!0),!H.key||!!(B.key&&!B.ctrlKey&&!B.altKey&&!B.metaKey&&B.key.length===1&&B.key.charCodeAt(0)>=65&&B.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(H.key!==u.C0.ETX&&H.key!==u.C0.CR||(this.textarea.value=""),this._onKey.fire({key:H.key,domEvent:B}),this._showCursor(),this.coreService.triggerDataEvent(H.key,!0),!this.optionsService.rawOptions.screenReaderMode||B.altKey||B.ctrlKey?this.cancel(B,!0):void(this._keyDownHandled=!0))))}_isThirdLevelShift(B,I){const H=B.isMac&&!this.options.macOptionIsMeta&&I.altKey&&!I.ctrlKey&&!I.metaKey||B.isWindows&&I.altKey&&I.ctrlKey&&!I.metaKey||B.isWindows&&I.getModifierState("AltGraph");return I.type==="keypress"?H:H&&(!I.keyCode||I.keyCode>47)}_keyUp(B){this._keyDownSeen=!1,this._customKeyEventHandler&&this._customKeyEventHandler(B)===!1||(function(I){return I.keyCode===16||I.keyCode===17||I.keyCode===18}(B)||this.focus(),this.updateCursorStyle(B),this._keyPressHandled=!1)}_keyPress(B){let I;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(B)===!1)return!1;if(this.cancel(B),B.charCode)I=B.charCode;else if(B.which===null||B.which===void 0)I=B.keyCode;else{if(B.which===0||B.charCode===0)return!1;I=B.which}return!(!I||(B.altKey||B.ctrlKey||B.metaKey)&&!this._isThirdLevelShift(this.browser,B)||(I=String.fromCharCode(I),this._onKey.fire({key:I,domEvent:B}),this._showCursor(),this.coreService.triggerDataEvent(I,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(B){if(B.data&&B.inputType==="insertText"&&(!B.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;const I=B.data;return this.coreService.triggerDataEvent(I,!0),this.cancel(B),!0}return!1}resize(B,I){B!==this.cols||I!==this.rows?super.resize(B,I):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(B,I){var H,$;(H=this._charSizeService)===null||H===void 0||H.measure(),($=this.viewport)===null||$===void 0||$.syncScrollArea(!0)}clear(){if(this.buffer.ybase!==0||this.buffer.y!==0){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let B=1;B<this.rows;B++)this.buffer.lines.push(this.buffer.getBlankLine(g.DEFAULT_ATTR_DATA));this.refresh(0,this.rows-1),this._onScroll.fire({position:this.buffer.ydisp,source:0})}}reset(){var B,I;this.options.rows=this.rows,this.options.cols=this.cols;const H=this._customKeyEventHandler;this._setup(),super.reset(),(B=this._selectionService)===null||B===void 0||B.reset(),this._decorationService.reset(),this._customKeyEventHandler=H,this.refresh(0,this.rows-1),(I=this.viewport)===null||I===void 0||I.syncScrollArea()}clearTextureAtlas(){var B;(B=this._renderService)===null||B===void 0||B.clearTextureAtlas()}_reportFocus(){var B;!((B=this.element)===null||B===void 0)&&B.classList.contains("focus")?this.coreService.triggerDataEvent(u.C0.ESC+"[I"):this.coreService.triggerDataEvent(u.C0.ESC+"[O")}_reportWindowsOptions(B){if(this._renderService)switch(B){case p.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:const I=this._renderService.dimensions.css.canvas.width.toFixed(0),H=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${u.C0.ESC}[4;${H};${I}t`);break;case p.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:const $=this._renderService.dimensions.css.cell.width.toFixed(0),J=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${u.C0.ESC}[6;${J};${$}t`)}}cancel(B,I){if(this.options.cancelEvents||I)return B.preventDefault(),B.stopPropagation(),!1}}t.Terminal=q},9924:(R,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TimeBasedDebouncer=void 0,t.TimeBasedDebouncer=class{constructor(n,h=1e3){this._renderCallback=n,this._debounceThresholdMS=h,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(n,h,a){this._rowCount=a,n=n!==void 0?n:0,h=h!==void 0?h:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,n):n,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,h):h;const _=Date.now();if(_-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=_,this._innerRefresh();else if(!this._additionalRefreshRequested){const u=_-this._lastRefreshMs,p=this._debounceThresholdMS-u;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0},p)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;const n=Math.max(this._rowStart,0),h=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(n,h)}}},1680:function(R,t,n){var h=this&&this.__decorate||function(e,s,o,i){var r,d=arguments.length,g=d<3?s:i===null?i=Object.getOwnPropertyDescriptor(s,o):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(e,s,o,i);else for(var S=e.length-1;S>=0;S--)(r=e[S])&&(g=(d<3?r(g):d>3?r(s,o,g):r(s,o))||g);return d>3&&g&&Object.defineProperty(s,o,g),g},a=this&&this.__param||function(e,s){return function(o,i){s(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Viewport=void 0;const _=n(844),u=n(3656),p=n(4725),v=n(2585);let c=class extends _.Disposable{constructor(e,s,o,i,r,d,g,S,l){super(),this._scrollLines=e,this._viewportElement=s,this._scrollArea=o,this._bufferService=i,this._optionsService=r,this._charSizeService=d,this._renderService=g,this._coreBrowserService=S,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register((0,u.addDisposableDomListener)(this._viewportElement,"scroll",this._handleScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(D=>this._activeBuffer=D.activeBuffer)),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange(D=>this._renderDimensions=D)),this._handleThemeChange(l.colors),this.register(l.onChangeColors(D=>this._handleThemeChange(D))),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.syncScrollArea())),setTimeout(()=>this.syncScrollArea(),0)}_handleThemeChange(e){this._viewportElement.style.backgroundColor=e.background.css}_refresh(e){if(e)return this._innerRefresh(),void(this._refreshAnimationFrame!==null&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));this._refreshAnimationFrame===null&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderService.dimensions.device.cell.height/this._coreBrowserService.dpr,this._currentDeviceCellHeight=this._renderService.dimensions.device.cell.height,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;const s=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderService.dimensions.css.canvas.height);this._lastRecordedBufferHeight!==s&&(this._lastRecordedBufferHeight=s,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}const e=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==e&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=e),this._refreshAnimationFrame=null}syncScrollArea(e=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(e);this._lastRecordedViewportHeight===this._renderService.dimensions.css.canvas.height&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.device.cell.height===this._currentDeviceCellHeight||this._refresh(e)}_handleScroll(e){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._scrollLines(0);const s=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._scrollLines(s)}_smoothScroll(){if(this._isDisposed||this._smoothScrollState.origin===-1||this._smoothScrollState.target===-1)return;const e=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(e*(this._smoothScrollState.target-this._smoothScrollState.origin)),e<1?this._coreBrowserService.window.requestAnimationFrame(()=>this._smoothScroll()):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(e,s){const o=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(s<0&&this._viewportElement.scrollTop!==0||s>0&&o<this._lastRecordedBufferHeight)||(e.cancelable&&e.preventDefault(),!1)}handleWheel(e){const s=this._getPixelsScrolled(e);return s!==0&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target===-1?this._smoothScrollState.target=this._viewportElement.scrollTop+s:this._smoothScrollState.target+=s,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=s,this._bubbleScroll(e,s))}_getPixelsScrolled(e){if(e.deltaY===0||e.shiftKey)return 0;let s=this._applyScrollModifier(e.deltaY,e);return e.deltaMode===WheelEvent.DOM_DELTA_LINE?s*=this._currentRowHeight:e.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(s*=this._currentRowHeight*this._bufferService.rows),s}getLinesScrolled(e){if(e.deltaY===0||e.shiftKey)return 0;let s=this._applyScrollModifier(e.deltaY,e);return e.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(s/=this._currentRowHeight+0,this._wheelPartialScroll+=s,s=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):e.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(s*=this._bufferService.rows),s}_applyScrollModifier(e,s){const o=this._optionsService.rawOptions.fastScrollModifier;return o==="alt"&&s.altKey||o==="ctrl"&&s.ctrlKey||o==="shift"&&s.shiftKey?e*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:e*this._optionsService.rawOptions.scrollSensitivity}handleTouchStart(e){this._lastTouchY=e.touches[0].pageY}handleTouchMove(e){const s=this._lastTouchY-e.touches[0].pageY;return this._lastTouchY=e.touches[0].pageY,s!==0&&(this._viewportElement.scrollTop+=s,this._bubbleScroll(e,s))}};c=h([a(3,v.IBufferService),a(4,v.IOptionsService),a(5,p.ICharSizeService),a(6,p.IRenderService),a(7,p.ICoreBrowserService),a(8,p.IThemeService)],c),t.Viewport=c},3107:function(R,t,n){var h=this&&this.__decorate||function(e,s,o,i){var r,d=arguments.length,g=d<3?s:i===null?i=Object.getOwnPropertyDescriptor(s,o):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(e,s,o,i);else for(var S=e.length-1;S>=0;S--)(r=e[S])&&(g=(d<3?r(g):d>3?r(s,o,g):r(s,o))||g);return d>3&&g&&Object.defineProperty(s,o,g),g},a=this&&this.__param||function(e,s){return function(o,i){s(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BufferDecorationRenderer=void 0;const _=n(3656),u=n(4725),p=n(844),v=n(2585);let c=class extends p.Disposable{constructor(e,s,o,i){super(),this._screenElement=e,this._bufferService=s,this._decorationService=o,this._renderService=i,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange(()=>this._doRefreshDecorations())),this.register(this._renderService.onDimensionsChange(()=>{this._dimensionsChanged=!0,this._queueRefresh()})),this.register((0,_.addDisposableDomListener)(window,"resize",()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt})),this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh())),this.register(this._decorationService.onDecorationRemoved(r=>this._removeDecoration(r))),this.register((0,p.toDisposable)(()=>{this._container.remove(),this._decorationElements.clear()}))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback(()=>{this._doRefreshDecorations(),this._animationFrame=void 0}))}_doRefreshDecorations(){for(const e of this._decorationService.decorations)this._renderDecoration(e);this._dimensionsChanged=!1}_renderDecoration(e){this._refreshStyle(e),this._dimensionsChanged&&this._refreshXPosition(e)}_createElement(e){var s;const o=document.createElement("div");o.classList.add("xterm-decoration"),o.style.width=`${Math.round((e.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,o.style.height=(e.options.height||1)*this._renderService.dimensions.css.cell.height+"px",o.style.top=(e.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height+"px",o.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;const i=(s=e.options.x)!==null&&s!==void 0?s:0;return i&&i>this._bufferService.cols&&(o.style.display="none"),this._refreshXPosition(e,o),o}_refreshStyle(e){const s=e.marker.line-this._bufferService.buffers.active.ydisp;if(s<0||s>=this._bufferService.rows)e.element&&(e.element.style.display="none",e.onRenderEmitter.fire(e.element));else{let o=this._decorationElements.get(e);o||(o=this._createElement(e),e.element=o,this._decorationElements.set(e,o),this._container.appendChild(o)),o.style.top=s*this._renderService.dimensions.css.cell.height+"px",o.style.display=this._altBufferIsActive?"none":"block",e.onRenderEmitter.fire(o)}}_refreshXPosition(e,s=e.element){var o;if(!s)return;const i=(o=e.options.x)!==null&&o!==void 0?o:0;(e.options.anchor||"left")==="right"?s.style.right=i?i*this._renderService.dimensions.css.cell.width+"px":"":s.style.left=i?i*this._renderService.dimensions.css.cell.width+"px":""}_removeDecoration(e){var s;(s=this._decorationElements.get(e))===null||s===void 0||s.remove(),this._decorationElements.delete(e),e.dispose()}};c=h([a(1,v.IBufferService),a(2,v.IDecorationService),a(3,u.IRenderService)],c),t.BufferDecorationRenderer=c},5871:(R,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ColorZoneStore=void 0,t.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(n){if(n.options.overviewRulerOptions){for(const h of this._zones)if(h.color===n.options.overviewRulerOptions.color&&h.position===n.options.overviewRulerOptions.position){if(this._lineIntersectsZone(h,n.marker.line))return;if(this._lineAdjacentToZone(h,n.marker.line,n.options.overviewRulerOptions.position))return void this._addLineToZone(h,n.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=n.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=n.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=n.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=n.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:n.options.overviewRulerOptions.color,position:n.options.overviewRulerOptions.position,startBufferLine:n.marker.line,endBufferLine:n.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(n){this._linePadding=n}_lineIntersectsZone(n,h){return h>=n.startBufferLine&&h<=n.endBufferLine}_lineAdjacentToZone(n,h,a){return h>=n.startBufferLine-this._linePadding[a||"full"]&&h<=n.endBufferLine+this._linePadding[a||"full"]}_addLineToZone(n,h){n.startBufferLine=Math.min(n.startBufferLine,h),n.endBufferLine=Math.max(n.endBufferLine,h)}}},5744:function(R,t,n){var h=this&&this.__decorate||function(r,d,g,S){var l,D=arguments.length,y=D<3?d:S===null?S=Object.getOwnPropertyDescriptor(d,g):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(r,d,g,S);else for(var L=r.length-1;L>=0;L--)(l=r[L])&&(y=(D<3?l(y):D>3?l(d,g,y):l(d,g))||y);return D>3&&y&&Object.defineProperty(d,g,y),y},a=this&&this.__param||function(r,d){return function(g,S){d(g,S,r)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OverviewRulerRenderer=void 0;const _=n(5871),u=n(3656),p=n(4725),v=n(844),c=n(2585),e={full:0,left:0,center:0,right:0},s={full:0,left:0,center:0,right:0},o={full:0,left:0,center:0,right:0};let i=class extends v.Disposable{constructor(r,d,g,S,l,D,y){var L;super(),this._viewportElement=r,this._screenElement=d,this._bufferService=g,this._decorationService=S,this._renderService=l,this._optionsService=D,this._coreBrowseService=y,this._colorZoneStore=new _.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=document.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),(L=this._viewportElement.parentElement)===null||L===void 0||L.insertBefore(this._canvas,this._viewportElement);const A=this._canvas.getContext("2d");if(!A)throw new Error("Ctx cannot be null");this._ctx=A,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners(),this.register((0,v.toDisposable)(()=>{var M;(M=this._canvas)===null||M===void 0||M.remove()}))}get _width(){return this._optionsService.options.overviewRulerWidth||0}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh(void 0,!0))),this.register(this._decorationService.onDecorationRemoved(()=>this._queueRefresh(void 0,!0)))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange(()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"})),this.register(this._bufferService.onScroll(()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())}))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender(()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)})),this.register(this._optionsService.onSpecificOptionChange("overviewRulerWidth",()=>this._queueRefresh(!0))),this.register((0,u.addDisposableDomListener)(this._coreBrowseService.window,"resize",()=>this._queueRefresh(!0))),this._queueRefresh(!0)}_refreshDrawConstants(){const r=Math.floor(this._canvas.width/3),d=Math.ceil(this._canvas.width/3);s.full=this._canvas.width,s.left=r,s.center=d,s.right=r,this._refreshDrawHeightConstants(),o.full=0,o.left=0,o.center=s.left,o.right=s.left+s.center}_refreshDrawHeightConstants(){e.full=Math.round(2*this._coreBrowseService.dpr);const r=this._canvas.height/this._bufferService.buffer.lines.length,d=Math.round(Math.max(Math.min(r,12),6)*this._coreBrowseService.dpr);e.left=d,e.center=d,e.right=d}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*e.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*e.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*e.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*e.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowseService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowseService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(const d of this._decorationService.decorations)this._colorZoneStore.addDecoration(d);this._ctx.lineWidth=1;const r=this._colorZoneStore.zones;for(const d of r)d.position!=="full"&&this._renderColorZone(d);for(const d of r)d.position==="full"&&this._renderColorZone(d);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(r){this._ctx.fillStyle=r.color,this._ctx.fillRect(o[r.position||"full"],Math.round((this._canvas.height-1)*(r.startBufferLine/this._bufferService.buffers.active.lines.length)-e[r.position||"full"]/2),s[r.position||"full"],Math.round((this._canvas.height-1)*((r.endBufferLine-r.startBufferLine)/this._bufferService.buffers.active.lines.length)+e[r.position||"full"]))}_queueRefresh(r,d){this._shouldUpdateDimensions=r||this._shouldUpdateDimensions,this._shouldUpdateAnchor=d||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowseService.window.requestAnimationFrame(()=>{this._refreshDecorations(),this._animationFrame=void 0}))}};i=h([a(2,c.IBufferService),a(3,c.IDecorationService),a(4,p.IRenderService),a(5,c.IOptionsService),a(6,p.ICoreBrowserService)],i),t.OverviewRulerRenderer=i},2950:function(R,t,n){var h=this&&this.__decorate||function(c,e,s,o){var i,r=arguments.length,d=r<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,s):o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,s,o);else for(var g=c.length-1;g>=0;g--)(i=c[g])&&(d=(r<3?i(d):r>3?i(e,s,d):i(e,s))||d);return r>3&&d&&Object.defineProperty(e,s,d),d},a=this&&this.__param||function(c,e){return function(s,o){e(s,o,c)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CompositionHelper=void 0;const _=n(4725),u=n(2585),p=n(2584);let v=class{constructor(c,e,s,o,i,r){this._textarea=c,this._compositionView=e,this._bufferService=s,this._optionsService=o,this._coreService=i,this._renderService=r,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}get isComposing(){return this._isComposing}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(c){this._compositionView.textContent=c.data,this.updateCompositionElements(),setTimeout(()=>{this._compositionPosition.end=this._textarea.value.length},0)}compositionend(){this._finalizeComposition(!0)}keydown(c){if(this._isComposing||this._isSendingComposition){if(c.keyCode===229||c.keyCode===16||c.keyCode===17||c.keyCode===18)return!1;this._finalizeComposition(!1)}return c.keyCode!==229||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(c){if(this._compositionView.classList.remove("active"),this._isComposing=!1,c){const e={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(()=>{if(this._isSendingComposition){let s;this._isSendingComposition=!1,e.start+=this._dataAlreadySent.length,s=this._isComposing?this._textarea.value.substring(e.start,e.end):this._textarea.value.substring(e.start),s.length>0&&this._coreService.triggerDataEvent(s,!0)}},0)}else{this._isSendingComposition=!1;const e=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(e,!0)}}_handleAnyTextareaChanges(){const c=this._textarea.value;setTimeout(()=>{if(!this._isComposing){const e=this._textarea.value,s=e.replace(c,"");this._dataAlreadySent=s,e.length>c.length?this._coreService.triggerDataEvent(s,!0):e.length<c.length?this._coreService.triggerDataEvent(`${p.C0.DEL}`,!0):e.length===c.length&&e!==c&&this._coreService.triggerDataEvent(e,!0)}},0)}updateCompositionElements(c){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){const e=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),s=this._renderService.dimensions.css.cell.height,o=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,i=e*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=i+"px",this._compositionView.style.top=o+"px",this._compositionView.style.height=s+"px",this._compositionView.style.lineHeight=s+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";const r=this._compositionView.getBoundingClientRect();this._textarea.style.left=i+"px",this._textarea.style.top=o+"px",this._textarea.style.width=Math.max(r.width,1)+"px",this._textarea.style.height=Math.max(r.height,1)+"px",this._textarea.style.lineHeight=r.height+"px"}c||setTimeout(()=>this.updateCompositionElements(!0),0)}}};v=h([a(2,u.IBufferService),a(3,u.IOptionsService),a(4,u.ICoreService),a(5,_.IRenderService)],v),t.CompositionHelper=v},9806:(R,t)=>{function n(h,a,_){const u=_.getBoundingClientRect(),p=h.getComputedStyle(_),v=parseInt(p.getPropertyValue("padding-left")),c=parseInt(p.getPropertyValue("padding-top"));return[a.clientX-u.left-v,a.clientY-u.top-c]}Object.defineProperty(t,"__esModule",{value:!0}),t.getCoords=t.getCoordsRelativeToElement=void 0,t.getCoordsRelativeToElement=n,t.getCoords=function(h,a,_,u,p,v,c,e,s){if(!v)return;const o=n(h,a,_);return o?(o[0]=Math.ceil((o[0]+(s?c/2:0))/c),o[1]=Math.ceil(o[1]/e),o[0]=Math.min(Math.max(o[0],1),u+(s?1:0)),o[1]=Math.min(Math.max(o[1],1),p),o):void 0}},9504:(R,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.moveToCellSequence=void 0;const h=n(2584);function a(e,s,o,i){const r=e-_(e,o),d=s-_(s,o),g=Math.abs(r-d)-function(S,l,D){let y=0;const L=S-_(S,D),A=l-_(l,D);for(let M=0;M<Math.abs(L-A);M++){const P=u(S,l)==="A"?-1:1,N=D.buffer.lines.get(L+P*M);N?.isWrapped&&y++}return y}(e,s,o);return c(g,v(u(e,s),i))}function _(e,s){let o=0,i=s.buffer.lines.get(e),r=i?.isWrapped;for(;r&&e>=0&&e<s.rows;)o++,i=s.buffer.lines.get(--e),r=i?.isWrapped;return o}function u(e,s){return e>s?"A":"B"}function p(e,s,o,i,r,d){let g=e,S=s,l="";for(;g!==o||S!==i;)g+=r?1:-1,r&&g>d.cols-1?(l+=d.buffer.translateBufferLineToString(S,!1,e,g),g=0,e=0,S++):!r&&g<0&&(l+=d.buffer.translateBufferLineToString(S,!1,0,e+1),g=d.cols-1,e=g,S--);return l+d.buffer.translateBufferLineToString(S,!1,e,g)}function v(e,s){const o=s?"O":"[";return h.C0.ESC+o+e}function c(e,s){e=Math.floor(e);let o="";for(let i=0;i<e;i++)o+=s;return o}t.moveToCellSequence=function(e,s,o,i){const r=o.buffer.x,d=o.buffer.y;if(!o.buffer.hasScrollback)return function(l,D,y,L,A,M){return a(D,L,A,M).length===0?"":c(p(l,D,l,D-_(D,A),!1,A).length,v("D",M))}(r,d,0,s,o,i)+a(d,s,o,i)+function(l,D,y,L,A,M){let P;P=a(D,L,A,M).length>0?L-_(L,A):D;const N=L,j=function(m,E,F,T,U,z){let V;return V=a(F,T,U,z).length>0?T-_(T,U):E,m<F&&V<=T||m>=F&&V<T?"C":"D"}(l,D,y,L,A,M);return c(p(l,P,y,N,j==="C",A).length,v(j,M))}(r,d,e,s,o,i);let g;if(d===s)return g=r>e?"D":"C",c(Math.abs(r-e),v(g,i));g=d>s?"D":"C";const S=Math.abs(d-s);return c(function(l,D){return D.cols-l}(d>s?e:r,o)+(S-1)*o.cols+1+((d>s?r:e)-1),v(g,i))}},1296:function(R,t,n){var h=this&&this.__decorate||function(l,D,y,L){var A,M=arguments.length,P=M<3?D:L===null?L=Object.getOwnPropertyDescriptor(D,y):L;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")P=Reflect.decorate(l,D,y,L);else for(var N=l.length-1;N>=0;N--)(A=l[N])&&(P=(M<3?A(P):M>3?A(D,y,P):A(D,y))||P);return M>3&&P&&Object.defineProperty(D,y,P),P},a=this&&this.__param||function(l,D){return function(y,L){D(y,L,l)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DomRenderer=void 0;const _=n(9631),u=n(3787),p=n(2223),v=n(6171),c=n(4725),e=n(8055),s=n(8460),o=n(844),i=n(2585),r="xterm-dom-renderer-owner-",d="xterm-focus";let g=1,S=class extends o.Disposable{constructor(l,D,y,L,A,M,P,N,j,m){super(),this._element=l,this._screenElement=D,this._viewportElement=y,this._linkifier2=L,this._charSizeService=M,this._optionsService=P,this._bufferService=N,this._coreBrowserService=j,this._terminalClass=g++,this._rowElements=[],this._cellToRowElements=[],this.onRequestRedraw=this.register(new s.EventEmitter).event,this._rowContainer=document.createElement("div"),this._rowContainer.classList.add("xterm-rows"),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=document.createElement("div"),this._selectionContainer.classList.add("xterm-selection"),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=(0,v.createRenderDimensions)(),this._updateDimensions(),this.register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this.register(m.onChangeColors(E=>this._injectCss(E))),this._injectCss(m.colors),this._rowFactory=A.createInstance(u.DomRendererRowFactory,document),this._element.classList.add(r+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline(E=>this._handleLinkHover(E))),this.register(this._linkifier2.onHideLinkUnderline(E=>this._handleLinkLeave(E))),this.register((0,o.toDisposable)(()=>{this._element.classList.remove(r+this._terminalClass),(0,_.removeElementFromParent)(this._rowContainer,this._selectionContainer,this._themeStyleElement,this._dimensionsStyleElement)}))}_updateDimensions(){const l=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*l,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*l),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/l),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/l),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(const y of this._rowElements)y.style.width=`${this.dimensions.css.canvas.width}px`,y.style.height=`${this.dimensions.css.cell.height}px`,y.style.lineHeight=`${this.dimensions.css.cell.height}px`,y.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));const D=`${this._terminalSelector} .xterm-rows span { display: inline-block; height: 100%; vertical-align: top; width: ${this.dimensions.css.cell.width}px}`;this._dimensionsStyleElement.textContent=D,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(l){this._themeStyleElement||(this._themeStyleElement=document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let D=`${this._terminalSelector} .xterm-rows { color: ${l.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px;}`;D+=`${this._terminalSelector} span:not(.${u.BOLD_CLASS}) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.${u.BOLD_CLASS} { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.${u.ITALIC_CLASS} { font-style: italic;}`,D+="@keyframes blink_box_shadow_"+this._terminalClass+" { 50% {  box-shadow: none; }}",D+="@keyframes blink_block_"+this._terminalClass+` { 0% {  background-color: ${l.cursor.css};  color: ${l.cursorAccent.css}; } 50% {  background-color: ${l.cursorAccent.css};  color: ${l.cursor.css}; }}`,D+=`${this._terminalSelector} .xterm-rows:not(.xterm-focus) .${u.CURSOR_CLASS}.${u.CURSOR_STYLE_BLOCK_CLASS} { outline: 1px solid ${l.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .xterm-rows.xterm-focus .${u.CURSOR_CLASS}.${u.CURSOR_BLINK_CLASS}:not(.${u.CURSOR_STYLE_BLOCK_CLASS}) { animation: blink_box_shadow_`+this._terminalClass+` 1s step-end infinite;}${this._terminalSelector} .xterm-rows.xterm-focus .${u.CURSOR_CLASS}.${u.CURSOR_BLINK_CLASS}.${u.CURSOR_STYLE_BLOCK_CLASS} { animation: blink_block_`+this._terminalClass+` 1s step-end infinite;}${this._terminalSelector} .xterm-rows.xterm-focus .${u.CURSOR_CLASS}.${u.CURSOR_STYLE_BLOCK_CLASS} { background-color: ${l.cursor.css}; color: ${l.cursorAccent.css};}${this._terminalSelector} .xterm-rows .${u.CURSOR_CLASS}.${u.CURSOR_STYLE_BAR_CLASS} { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${l.cursor.css} inset;}${this._terminalSelector} .xterm-rows .${u.CURSOR_CLASS}.${u.CURSOR_STYLE_UNDERLINE_CLASS} { box-shadow: 0 -1px 0 ${l.cursor.css} inset;}`,D+=`${this._terminalSelector} .xterm-selection { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .xterm-selection div { position: absolute; background-color: ${l.selectionBackgroundOpaque.css};}${this._terminalSelector} .xterm-selection div { position: absolute; background-color: ${l.selectionInactiveBackgroundOpaque.css};}`;for(const[y,L]of l.ansi.entries())D+=`${this._terminalSelector} .xterm-fg-${y} { color: ${L.css}; }${this._terminalSelector} .xterm-bg-${y} { background-color: ${L.css}; }`;D+=`${this._terminalSelector} .xterm-fg-${p.INVERTED_DEFAULT_COLOR} { color: ${e.color.opaque(l.background).css}; }${this._terminalSelector} .xterm-bg-${p.INVERTED_DEFAULT_COLOR} { background-color: ${l.foreground.css}; }`,this._themeStyleElement.textContent=D}handleDevicePixelRatioChange(){this._updateDimensions()}_refreshRowElements(l,D){for(let y=this._rowElements.length;y<=D;y++){const L=document.createElement("div");this._rowContainer.appendChild(L),this._rowElements.push(L)}for(;this._rowElements.length>D;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(l,D){this._refreshRowElements(l,D),this._updateDimensions()}handleCharSizeChanged(){this._updateDimensions()}handleBlur(){this._rowContainer.classList.remove(d)}handleFocus(){this._rowContainer.classList.add(d)}handleSelectionChanged(l,D,y){for(;this._selectionContainer.children.length;)this._selectionContainer.removeChild(this._selectionContainer.children[0]);if(this._rowFactory.handleSelectionChanged(l,D,y),this.renderRows(0,this._bufferService.rows-1),!l||!D)return;const L=l[1]-this._bufferService.buffer.ydisp,A=D[1]-this._bufferService.buffer.ydisp,M=Math.max(L,0),P=Math.min(A,this._bufferService.rows-1);if(M>=this._bufferService.rows||P<0)return;const N=document.createDocumentFragment();if(y){const j=l[0]>D[0];N.appendChild(this._createSelectionElement(M,j?D[0]:l[0],j?l[0]:D[0],P-M+1))}else{const j=L===M?l[0]:0,m=M===A?D[0]:this._bufferService.cols;N.appendChild(this._createSelectionElement(M,j,m));const E=P-M-1;if(N.appendChild(this._createSelectionElement(M+1,0,this._bufferService.cols,E)),M!==P){const F=A===P?D[0]:this._bufferService.cols;N.appendChild(this._createSelectionElement(P,0,F))}}this._selectionContainer.appendChild(N)}_createSelectionElement(l,D,y,L=1){const A=document.createElement("div");return A.style.height=L*this.dimensions.css.cell.height+"px",A.style.top=l*this.dimensions.css.cell.height+"px",A.style.left=D*this.dimensions.css.cell.width+"px",A.style.width=this.dimensions.css.cell.width*(y-D)+"px",A}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions()}clear(){for(const l of this._rowElements)l.replaceChildren()}renderRows(l,D){const y=this._bufferService.buffer.ybase+this._bufferService.buffer.y,L=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),A=this._optionsService.rawOptions.cursorBlink;for(let M=l;M<=D;M++){const P=this._rowElements[M],N=M+this._bufferService.buffer.ydisp,j=this._bufferService.buffer.lines.get(N),m=this._optionsService.rawOptions.cursorStyle;this._cellToRowElements[M]&&this._cellToRowElements[M].length===this._bufferService.cols||(this._cellToRowElements[M]=new Int16Array(this._bufferService.cols)),P.replaceChildren(this._rowFactory.createRow(j,N,N===y,m,L,A,this.dimensions.css.cell.width,this._bufferService.cols,this._cellToRowElements[M]))}}get _terminalSelector(){return`.${r}${this._terminalClass}`}_handleLinkHover(l){this._setCellUnderline(l.x1,l.x2,l.y1,l.y2,l.cols,!0)}_handleLinkLeave(l){this._setCellUnderline(l.x1,l.x2,l.y1,l.y2,l.cols,!1)}_setCellUnderline(l,D,y,L,A,M){if(l=this._cellToRowElements[y][l],D=this._cellToRowElements[L][D],l!==-1&&D!==-1)for(;l!==D||y!==L;){const P=this._rowElements[y];if(!P)return;const N=P.children[l];N&&(N.style.textDecoration=M?"underline":"none"),++l>=A&&(l=0,y++)}}};S=h([a(4,i.IInstantiationService),a(5,c.ICharSizeService),a(6,i.IOptionsService),a(7,i.IBufferService),a(8,c.ICoreBrowserService),a(9,c.IThemeService)],S),t.DomRenderer=S},3787:function(R,t,n){var h=this&&this.__decorate||function(g,S,l,D){var y,L=arguments.length,A=L<3?S:D===null?D=Object.getOwnPropertyDescriptor(S,l):D;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")A=Reflect.decorate(g,S,l,D);else for(var M=g.length-1;M>=0;M--)(y=g[M])&&(A=(L<3?y(A):L>3?y(S,l,A):y(S,l))||A);return L>3&&A&&Object.defineProperty(S,l,A),A},a=this&&this.__param||function(g,S){return function(l,D){S(l,D,g)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DomRendererRowFactory=t.CURSOR_STYLE_UNDERLINE_CLASS=t.CURSOR_STYLE_BAR_CLASS=t.CURSOR_STYLE_BLOCK_CLASS=t.CURSOR_BLINK_CLASS=t.CURSOR_CLASS=t.STRIKETHROUGH_CLASS=t.UNDERLINE_CLASS=t.ITALIC_CLASS=t.DIM_CLASS=t.BOLD_CLASS=void 0;const _=n(2223),u=n(643),p=n(511),v=n(2585),c=n(8055),e=n(4725),s=n(4269),o=n(6171),i=n(3734);t.BOLD_CLASS="xterm-bold",t.DIM_CLASS="xterm-dim",t.ITALIC_CLASS="xterm-italic",t.UNDERLINE_CLASS="xterm-underline",t.STRIKETHROUGH_CLASS="xterm-strikethrough",t.CURSOR_CLASS="xterm-cursor",t.CURSOR_BLINK_CLASS="xterm-cursor-blink",t.CURSOR_STYLE_BLOCK_CLASS="xterm-cursor-block",t.CURSOR_STYLE_BAR_CLASS="xterm-cursor-bar",t.CURSOR_STYLE_UNDERLINE_CLASS="xterm-cursor-underline";let r=class{constructor(g,S,l,D,y,L,A){this._document=g,this._characterJoinerService=S,this._optionsService=l,this._coreBrowserService=D,this._coreService=y,this._decorationService=L,this._themeService=A,this._workCell=new p.CellData,this._columnSelectMode=!1}handleSelectionChanged(g,S,l){this._selectionStart=g,this._selectionEnd=S,this._columnSelectMode=l}createRow(g,S,l,D,y,L,A,M,P){const N=this._document.createDocumentFragment(),j=this._characterJoinerService.getJoinedCharacters(S);let m=0;for(let U=Math.min(g.length,M)-1;U>=0;U--)if(g.loadCell(U,this._workCell).getCode()!==u.NULL_CELL_CODE||l&&U===y){m=U+1;break}const E=this._themeService.colors;let F=-1,T=0;for(;T<m;T++){g.loadCell(T,this._workCell);let U=this._workCell.getWidth();if(U===0){P[T]=F;continue}let z=!1,V=T,W=this._workCell;if(j.length>0&&T===j[0][0]){z=!0;const Y=j.shift();W=new s.JoinedCellData(this._workCell,g.translateToString(!0,Y[0],Y[1]),Y[1]-Y[0]),V=Y[1]-1,U=W.getWidth()}const q=this._document.createElement("span");if(U>1&&(q.style.width=A*U+"px"),z&&(q.style.display="inline",y>=T&&y<=V&&(y=T)),!this._coreService.isCursorHidden&&l&&T===y)switch(q.classList.add(t.CURSOR_CLASS),L&&q.classList.add(t.CURSOR_BLINK_CLASS),D){case"bar":q.classList.add(t.CURSOR_STYLE_BAR_CLASS);break;case"underline":q.classList.add(t.CURSOR_STYLE_UNDERLINE_CLASS);break;default:q.classList.add(t.CURSOR_STYLE_BLOCK_CLASS)}if(W.isBold()&&q.classList.add(t.BOLD_CLASS),W.isItalic()&&q.classList.add(t.ITALIC_CLASS),W.isDim()&&q.classList.add(t.DIM_CLASS),W.isInvisible()?q.textContent=u.WHITESPACE_CELL_CHAR:q.textContent=W.getChars()||u.WHITESPACE_CELL_CHAR,W.isUnderline()&&(q.classList.add(`${t.UNDERLINE_CLASS}-${W.extended.underlineStyle}`),q.textContent===" "&&(q.textContent=" "),!W.isUnderlineColorDefault()))if(W.isUnderlineColorRGB())q.style.textDecorationColor=`rgb(${i.AttributeData.toColorRGB(W.getUnderlineColor()).join(",")})`;else{let Y=W.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&W.isBold()&&Y<8&&(Y+=8),q.style.textDecorationColor=E.ansi[Y].css}W.isStrikethrough()&&q.classList.add(t.STRIKETHROUGH_CLASS);let x=W.getFgColor(),B=W.getFgColorMode(),I=W.getBgColor(),H=W.getBgColorMode();const $=!!W.isInverse();if($){const Y=x;x=I,I=Y;const Tt=B;B=H,H=Tt}let J,K,ee=!1;this._decorationService.forEachDecorationAtCell(T,S,void 0,Y=>{Y.options.layer!=="top"&&ee||(Y.backgroundColorRGB&&(H=50331648,I=Y.backgroundColorRGB.rgba>>8&16777215,J=Y.backgroundColorRGB),Y.foregroundColorRGB&&(B=50331648,x=Y.foregroundColorRGB.rgba>>8&16777215,K=Y.foregroundColorRGB),ee=Y.options.layer==="top")});const ie=this._isCellInSelection(T,S);let te;switch(ee||E.selectionForeground&&ie&&(B=50331648,x=E.selectionForeground.rgba>>8&16777215,K=E.selectionForeground),ie&&(J=this._coreBrowserService.isFocused?E.selectionBackgroundOpaque:E.selectionInactiveBackgroundOpaque,ee=!0),ee&&q.classList.add("xterm-decoration-top"),H){case 16777216:case 33554432:te=E.ansi[I],q.classList.add(`xterm-bg-${I}`);break;case 50331648:te=c.rgba.toColor(I>>16,I>>8&255,255&I),this._addStyle(q,`background-color:#${d((I>>>0).toString(16),"0",6)}`);break;default:$?(te=E.foreground,q.classList.add(`xterm-bg-${_.INVERTED_DEFAULT_COLOR}`)):te=E.background}switch(J||W.isDim()&&(J=c.color.multiplyOpacity(te,.5)),B){case 16777216:case 33554432:W.isBold()&&x<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(x+=8),this._applyMinimumContrast(q,te,E.ansi[x],W,J,void 0)||q.classList.add(`xterm-fg-${x}`);break;case 50331648:const Y=c.rgba.toColor(x>>16&255,x>>8&255,255&x);this._applyMinimumContrast(q,te,Y,W,J,K)||this._addStyle(q,`color:#${d(x.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(q,te,E.foreground,W,J,void 0)||$&&q.classList.add(`xterm-fg-${_.INVERTED_DEFAULT_COLOR}`)}N.appendChild(q),P[T]=++F,T=V}return T<M-1&&P.subarray(T).fill(++F),N}_applyMinimumContrast(g,S,l,D,y,L){if(this._optionsService.rawOptions.minimumContrastRatio===1||(0,o.excludeFromContrastRatioDemands)(D.getCode()))return!1;let A;return y||L||(A=this._themeService.colors.contrastCache.getColor(S.rgba,l.rgba)),A===void 0&&(A=c.color.ensureContrastRatio(y||S,L||l,this._optionsService.rawOptions.minimumContrastRatio),this._themeService.colors.contrastCache.setColor((y||S).rgba,(L||l).rgba,A??null)),!!A&&(this._addStyle(g,`color:${A.css}`),!0)}_addStyle(g,S){g.setAttribute("style",`${g.getAttribute("style")||""}${S};`)}_isCellInSelection(g,S){const l=this._selectionStart,D=this._selectionEnd;return!(!l||!D)&&(this._columnSelectMode?l[0]<=D[0]?g>=l[0]&&S>=l[1]&&g<D[0]&&S<=D[1]:g<l[0]&&S>=l[1]&&g>=D[0]&&S<=D[1]:S>l[1]&&S<D[1]||l[1]===D[1]&&S===l[1]&&g>=l[0]&&g<D[0]||l[1]<D[1]&&S===D[1]&&g<D[0]||l[1]<D[1]&&S===l[1]&&g>=l[0])}};function d(g,S,l){for(;g.length<l;)g=S+g;return g}r=h([a(1,e.ICharacterJoinerService),a(2,v.IOptionsService),a(3,e.ICoreBrowserService),a(4,v.ICoreService),a(5,v.IDecorationService),a(6,e.IThemeService)],r),t.DomRendererRowFactory=r},2223:(R,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TEXT_BASELINE=t.DIM_OPACITY=t.INVERTED_DEFAULT_COLOR=void 0;const h=n(6114);t.INVERTED_DEFAULT_COLOR=257,t.DIM_OPACITY=.5,t.TEXT_BASELINE=h.isFirefox||h.isLegacyEdge?"bottom":"ideographic"},6171:(R,t)=>{function n(h){return 57508<=h&&h<=57558}Object.defineProperty(t,"__esModule",{value:!0}),t.createRenderDimensions=t.excludeFromContrastRatioDemands=t.isRestrictedPowerlineGlyph=t.isPowerlineGlyph=t.throwIfFalsy=void 0,t.throwIfFalsy=function(h){if(!h)throw new Error("value must not be falsy");return h},t.isPowerlineGlyph=n,t.isRestrictedPowerlineGlyph=function(h){return 57520<=h&&h<=57527},t.excludeFromContrastRatioDemands=function(h){return n(h)||function(a){return 9472<=a&&a<=9631}(h)},t.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}}},456:(R,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionModel=void 0,t.SelectionModel=class{constructor(n){this._bufferService=n,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){const n=this.selectionStart[0]+this.selectionStartLength;return n>this._bufferService.cols?n%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(n/this._bufferService.cols)-1]:[n%this._bufferService.cols,this.selectionStart[1]+Math.floor(n/this._bufferService.cols)]:[n,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){const n=this.selectionStart[0]+this.selectionStartLength;return n>this._bufferService.cols?[n%this._bufferService.cols,this.selectionStart[1]+Math.floor(n/this._bufferService.cols)]:[Math.max(n,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){const n=this.selectionStart,h=this.selectionEnd;return!(!n||!h)&&(n[1]>h[1]||n[1]===h[1]&&n[0]>h[0])}handleTrim(n){return this.selectionStart&&(this.selectionStart[1]-=n),this.selectionEnd&&(this.selectionEnd[1]-=n),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(R,t,n){var h=this&&this.__decorate||function(e,s,o,i){var r,d=arguments.length,g=d<3?s:i===null?i=Object.getOwnPropertyDescriptor(s,o):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(e,s,o,i);else for(var S=e.length-1;S>=0;S--)(r=e[S])&&(g=(d<3?r(g):d>3?r(s,o,g):r(s,o))||g);return d>3&&g&&Object.defineProperty(s,o,g),g},a=this&&this.__param||function(e,s){return function(o,i){s(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CharSizeService=void 0;const _=n(2585),u=n(8460),p=n(844);let v=class extends p.Disposable{constructor(e,s,o){super(),this._optionsService=o,this.width=0,this.height=0,this._onCharSizeChange=this.register(new u.EventEmitter),this.onCharSizeChange=this._onCharSizeChange.event,this._measureStrategy=new c(e,s,this._optionsService),this.register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],()=>this.measure()))}get hasValidSize(){return this.width>0&&this.height>0}measure(){const e=this._measureStrategy.measure();e.width===this.width&&e.height===this.height||(this.width=e.width,this.height=e.height,this._onCharSizeChange.fire())}};v=h([a(2,_.IOptionsService)],v),t.CharSizeService=v;class c{constructor(s,o,i){this._document=s,this._parentElement=o,this._optionsService=i,this._result={width:0,height:0},this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W",this._measureElement.setAttribute("aria-hidden","true"),this._parentElement.appendChild(this._measureElement)}measure(){this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`;const s=this._measureElement.getBoundingClientRect();return s.width!==0&&s.height!==0&&(this._result.width=s.width,this._result.height=Math.ceil(s.height)),this._result}}},4269:function(R,t,n){var h=this&&this.__decorate||function(s,o,i,r){var d,g=arguments.length,S=g<3?o:r===null?r=Object.getOwnPropertyDescriptor(o,i):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(s,o,i,r);else for(var l=s.length-1;l>=0;l--)(d=s[l])&&(S=(g<3?d(S):g>3?d(o,i,S):d(o,i))||S);return g>3&&S&&Object.defineProperty(o,i,S),S},a=this&&this.__param||function(s,o){return function(i,r){o(i,r,s)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CharacterJoinerService=t.JoinedCellData=void 0;const _=n(3734),u=n(643),p=n(511),v=n(2585);class c extends _.AttributeData{constructor(o,i,r){super(),this.content=0,this.combinedData="",this.fg=o.fg,this.bg=o.bg,this.combinedData=i,this._width=r}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(o){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}t.JoinedCellData=c;let e=class Et{constructor(o){this._bufferService=o,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new p.CellData}register(o){const i={id:this._nextCharacterJoinerId++,handler:o};return this._characterJoiners.push(i),i.id}deregister(o){for(let i=0;i<this._characterJoiners.length;i++)if(this._characterJoiners[i].id===o)return this._characterJoiners.splice(i,1),!0;return!1}getJoinedCharacters(o){if(this._characterJoiners.length===0)return[];const i=this._bufferService.buffer.lines.get(o);if(!i||i.length===0)return[];const r=[],d=i.translateToString(!0);let g=0,S=0,l=0,D=i.getFg(0),y=i.getBg(0);for(let L=0;L<i.getTrimmedLength();L++)if(i.loadCell(L,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==D||this._workCell.bg!==y){if(L-g>1){const A=this._getJoinedRanges(d,l,S,i,g);for(let M=0;M<A.length;M++)r.push(A[M])}g=L,l=S,D=this._workCell.fg,y=this._workCell.bg}S+=this._workCell.getChars().length||u.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-g>1){const L=this._getJoinedRanges(d,l,S,i,g);for(let A=0;A<L.length;A++)r.push(L[A])}return r}_getJoinedRanges(o,i,r,d,g){const S=o.substring(i,r);let l=[];try{l=this._characterJoiners[0].handler(S)}catch(D){console.error(D)}for(let D=1;D<this._characterJoiners.length;D++)try{const y=this._characterJoiners[D].handler(S);for(let L=0;L<y.length;L++)Et._mergeRanges(l,y[L])}catch(y){console.error(y)}return this._stringRangesToCellRanges(l,d,g),l}_stringRangesToCellRanges(o,i,r){let d=0,g=!1,S=0,l=o[d];if(l){for(let D=r;D<this._bufferService.cols;D++){const y=i.getWidth(D),L=i.getString(D).length||u.WHITESPACE_CELL_CHAR.length;if(y!==0){if(!g&&l[0]<=S&&(l[0]=D,g=!0),l[1]<=S){if(l[1]=D,l=o[++d],!l)break;l[0]<=S?(l[0]=D,g=!0):g=!1}S+=L}}l&&(l[1]=this._bufferService.cols)}}static _mergeRanges(o,i){let r=!1;for(let d=0;d<o.length;d++){const g=o[d];if(r){if(i[1]<=g[0])return o[d-1][1]=i[1],o;if(i[1]<=g[1])return o[d-1][1]=Math.max(i[1],g[1]),o.splice(d,1),o;o.splice(d,1),d--}else{if(i[1]<=g[0])return o.splice(d,0,i),o;if(i[1]<=g[1])return g[0]=Math.min(i[0],g[0]),o;i[0]<g[1]&&(g[0]=Math.min(i[0],g[0]),r=!0)}}return r?o[o.length-1][1]=i[1]:o.push(i),o}};e=h([a(0,v.IBufferService)],e),t.CharacterJoinerService=e},5114:(R,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CoreBrowserService=void 0,t.CoreBrowserService=class{constructor(n,h){this._textarea=n,this.window=h,this._isFocused=!1,this._cachedIsFocused=void 0,this._textarea.addEventListener("focus",()=>this._isFocused=!0),this._textarea.addEventListener("blur",()=>this._isFocused=!1)}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(()=>this._cachedIsFocused=void 0)),this._cachedIsFocused}}},8934:function(R,t,n){var h=this&&this.__decorate||function(v,c,e,s){var o,i=arguments.length,r=i<3?c:s===null?s=Object.getOwnPropertyDescriptor(c,e):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(v,c,e,s);else for(var d=v.length-1;d>=0;d--)(o=v[d])&&(r=(i<3?o(r):i>3?o(c,e,r):o(c,e))||r);return i>3&&r&&Object.defineProperty(c,e,r),r},a=this&&this.__param||function(v,c){return function(e,s){c(e,s,v)}};Object.defineProperty(t,"__esModule",{value:!0}),t.MouseService=void 0;const _=n(4725),u=n(9806);let p=class{constructor(v,c){this._renderService=v,this._charSizeService=c}getCoords(v,c,e,s,o){return(0,u.getCoords)(window,v,c,e,s,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,o)}getMouseReportCoords(v,c){const e=(0,u.getCoordsRelativeToElement)(window,v,c);if(!(!this._charSizeService.hasValidSize||e[0]<0||e[1]<0||e[0]>=this._renderService.dimensions.css.canvas.width||e[1]>=this._renderService.dimensions.css.canvas.height))return{col:Math.floor(e[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(e[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(e[0]),y:Math.floor(e[1])}}};p=h([a(0,_.IRenderService),a(1,_.ICharSizeService)],p),t.MouseService=p},3230:function(R,t,n){var h=this&&this.__decorate||function(r,d,g,S){var l,D=arguments.length,y=D<3?d:S===null?S=Object.getOwnPropertyDescriptor(d,g):S;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(r,d,g,S);else for(var L=r.length-1;L>=0;L--)(l=r[L])&&(y=(D<3?l(y):D>3?l(d,g,y):l(d,g))||y);return D>3&&y&&Object.defineProperty(d,g,y),y},a=this&&this.__param||function(r,d){return function(g,S){d(g,S,r)}};Object.defineProperty(t,"__esModule",{value:!0}),t.RenderService=void 0;const _=n(6193),u=n(8460),p=n(844),v=n(5596),c=n(3656),e=n(2585),s=n(4725),o=n(7226);let i=class extends p.Disposable{constructor(r,d,g,S,l,D,y,L){if(super(),this._rowCount=r,this._charSizeService=S,this._pausedResizeTask=new o.DebouncedIdleTask,this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this.register(new u.EventEmitter),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this.register(new u.EventEmitter),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this.register(new u.EventEmitter),this.onRender=this._onRender.event,this._onRefreshRequest=this.register(new u.EventEmitter),this.onRefreshRequest=this._onRefreshRequest.event,this.register({dispose:()=>{var A;return(A=this._renderer)===null||A===void 0?void 0:A.dispose()}}),this._renderDebouncer=new _.RenderDebouncer(y.window,(A,M)=>this._renderRows(A,M)),this.register(this._renderDebouncer),this._screenDprMonitor=new v.ScreenDprMonitor(y.window),this._screenDprMonitor.setListener(()=>this.handleDevicePixelRatioChange()),this.register(this._screenDprMonitor),this.register(D.onResize(()=>this._fullRefresh())),this.register(D.buffers.onBufferActivate(()=>{var A;return(A=this._renderer)===null||A===void 0?void 0:A.clear()})),this.register(g.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._charSizeService.onCharSizeChange(()=>this.handleCharSizeChanged())),this.register(l.onDecorationRegistered(()=>this._fullRefresh())),this.register(l.onDecorationRemoved(()=>this._fullRefresh())),this.register(g.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio"],()=>{this.clear(),this.handleResize(D.cols,D.rows),this._fullRefresh()})),this.register(g.onMultipleOptionChange(["cursorBlink","cursorStyle"],()=>this.refreshRows(D.buffer.y,D.buffer.y,!0))),this.register((0,c.addDisposableDomListener)(y.window,"resize",()=>this.handleDevicePixelRatioChange())),this.register(L.onChangeColors(()=>this._fullRefresh())),"IntersectionObserver"in y.window){const A=new y.window.IntersectionObserver(M=>this._handleIntersectionChange(M[M.length-1]),{threshold:0});A.observe(d),this.register({dispose:()=>A.disconnect()})}}get dimensions(){return this._renderer.dimensions}_handleIntersectionChange(r){this._isPaused=r.isIntersecting===void 0?r.intersectionRatio===0:!r.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(r,d,g=!1){this._isPaused?this._needsFullRefresh=!0:(g||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(r,d,this._rowCount))}_renderRows(r,d){this._renderer&&(this._renderer.renderRows(r,d),this._needsSelectionRefresh&&(this._renderer.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:r,end:d}),this._onRender.fire({start:r,end:d}),this._isNextRenderRedrawOnly=!0)}resize(r,d){this._rowCount=d,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer&&(this._renderer.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.dimensions))}hasRenderer(){return!!this._renderer}setRenderer(r){var d;(d=this._renderer)===null||d===void 0||d.dispose(),this._renderer=r,this._renderer.onRequestRedraw(g=>this.refreshRows(g.start,g.end,!0)),this._needsSelectionRefresh=!0,this._fullRefresh()}addRefreshCallback(r){return this._renderDebouncer.addRefreshCallback(r)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){var r,d;this._renderer&&((d=(r=this._renderer).clearTextureAtlas)===null||d===void 0||d.call(r),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer&&(this._renderer.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(r,d){this._renderer&&(this._isPaused?this._pausedResizeTask.set(()=>this._renderer.handleResize(r,d)):this._renderer.handleResize(r,d),this._fullRefresh())}handleCharSizeChanged(){var r;(r=this._renderer)===null||r===void 0||r.handleCharSizeChanged()}handleBlur(){var r;(r=this._renderer)===null||r===void 0||r.handleBlur()}handleFocus(){var r;(r=this._renderer)===null||r===void 0||r.handleFocus()}handleSelectionChanged(r,d,g){var S;this._selectionState.start=r,this._selectionState.end=d,this._selectionState.columnSelectMode=g,(S=this._renderer)===null||S===void 0||S.handleSelectionChanged(r,d,g)}handleCursorMove(){var r;(r=this._renderer)===null||r===void 0||r.handleCursorMove()}clear(){var r;(r=this._renderer)===null||r===void 0||r.clear()}};i=h([a(2,e.IOptionsService),a(3,s.ICharSizeService),a(4,e.IDecorationService),a(5,e.IBufferService),a(6,s.ICoreBrowserService),a(7,s.IThemeService)],i),t.RenderService=i},9312:function(R,t,n){var h=this&&this.__decorate||function(l,D,y,L){var A,M=arguments.length,P=M<3?D:L===null?L=Object.getOwnPropertyDescriptor(D,y):L;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")P=Reflect.decorate(l,D,y,L);else for(var N=l.length-1;N>=0;N--)(A=l[N])&&(P=(M<3?A(P):M>3?A(D,y,P):A(D,y))||P);return M>3&&P&&Object.defineProperty(D,y,P),P},a=this&&this.__param||function(l,D){return function(y,L){D(y,L,l)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionService=void 0;const _=n(6114),u=n(456),p=n(511),v=n(8460),c=n(4725),e=n(2585),s=n(9806),o=n(9504),i=n(844),r=n(4841),d=String.fromCharCode(160),g=new RegExp(d,"g");let S=class extends i.Disposable{constructor(l,D,y,L,A,M,P,N,j){super(),this._element=l,this._screenElement=D,this._linkifier=y,this._bufferService=L,this._coreService=A,this._mouseService=M,this._optionsService=P,this._renderService=N,this._coreBrowserService=j,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new p.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new v.EventEmitter),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this.register(new v.EventEmitter),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this.register(new v.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this.register(new v.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=m=>this._handleMouseMove(m),this._mouseUpListener=m=>this._handleMouseUp(m),this._coreService.onUserInput(()=>{this.hasSelection&&this.clearSelection()}),this._trimListener=this._bufferService.buffer.lines.onTrim(m=>this._handleTrim(m)),this.register(this._bufferService.buffers.onBufferActivate(m=>this._handleBufferActivate(m))),this.enable(),this._model=new u.SelectionModel(this._bufferService),this._activeSelectionMode=0,this.register((0,i.toDisposable)(()=>{this._removeMouseDownListeners()}))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){const l=this._model.finalSelectionStart,D=this._model.finalSelectionEnd;return!(!l||!D||l[0]===D[0]&&l[1]===D[1])}get selectionText(){const l=this._model.finalSelectionStart,D=this._model.finalSelectionEnd;if(!l||!D)return"";const y=this._bufferService.buffer,L=[];if(this._activeSelectionMode===3){if(l[0]===D[0])return"";const A=l[0]<D[0]?l[0]:D[0],M=l[0]<D[0]?D[0]:l[0];for(let P=l[1];P<=D[1];P++){const N=y.translateBufferLineToString(P,!0,A,M);L.push(N)}}else{const A=l[1]===D[1]?D[0]:void 0;L.push(y.translateBufferLineToString(l[1],!0,l[0],A));for(let M=l[1]+1;M<=D[1]-1;M++){const P=y.lines.get(M),N=y.translateBufferLineToString(M,!0);P?.isWrapped?L[L.length-1]+=N:L.push(N)}if(l[1]!==D[1]){const M=y.lines.get(D[1]),P=y.translateBufferLineToString(D[1],!0,0,D[0]);M&&M.isWrapped?L[L.length-1]+=P:L.push(P)}}return L.map(A=>A.replace(g," ")).join(_.isWindows?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(l){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._refresh())),_.isLinux&&l&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(l){const D=this._getMouseBufferCoords(l),y=this._model.finalSelectionStart,L=this._model.finalSelectionEnd;return!!(y&&L&&D)&&this._areCoordsInSelection(D,y,L)}isCellInSelection(l,D){const y=this._model.finalSelectionStart,L=this._model.finalSelectionEnd;return!(!y||!L)&&this._areCoordsInSelection([l,D],y,L)}_areCoordsInSelection(l,D,y){return l[1]>D[1]&&l[1]<y[1]||D[1]===y[1]&&l[1]===D[1]&&l[0]>=D[0]&&l[0]<y[0]||D[1]<y[1]&&l[1]===y[1]&&l[0]<y[0]||D[1]<y[1]&&l[1]===D[1]&&l[0]>=D[0]}_selectWordAtCursor(l,D){var y,L;const A=(L=(y=this._linkifier.currentLink)===null||y===void 0?void 0:y.link)===null||L===void 0?void 0:L.range;if(A)return this._model.selectionStart=[A.start.x-1,A.start.y-1],this._model.selectionStartLength=(0,r.getRangeLength)(A,this._bufferService.cols),this._model.selectionEnd=void 0,!0;const M=this._getMouseBufferCoords(l);return!!M&&(this._selectWordAt(M,D),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(l,D){this._model.clearSelection(),l=Math.max(l,0),D=Math.min(D,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,l],this._model.selectionEnd=[this._bufferService.cols,D],this.refresh(),this._onSelectionChange.fire()}_handleTrim(l){this._model.handleTrim(l)&&this.refresh()}_getMouseBufferCoords(l){const D=this._mouseService.getCoords(l,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(D)return D[0]--,D[1]--,D[1]+=this._bufferService.buffer.ydisp,D}_getMouseEventScrollAmount(l){let D=(0,s.getCoordsRelativeToElement)(this._coreBrowserService.window,l,this._screenElement)[1];const y=this._renderService.dimensions.css.canvas.height;return D>=0&&D<=y?0:(D>y&&(D-=y),D=Math.min(Math.max(D,-50),50),D/=50,D/Math.abs(D)+Math.round(14*D))}shouldForceSelection(l){return _.isMac?l.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:l.shiftKey}handleMouseDown(l){if(this._mouseDownTimeStamp=l.timeStamp,(l.button!==2||!this.hasSelection)&&l.button===0){if(!this._enabled){if(!this.shouldForceSelection(l))return;l.stopPropagation()}l.preventDefault(),this._dragScrollAmount=0,this._enabled&&l.shiftKey?this._handleIncrementalClick(l):l.detail===1?this._handleSingleClick(l):l.detail===2?this._handleDoubleClick(l):l.detail===3&&this._handleTripleClick(l),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(()=>this._dragScroll(),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(l){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(l))}_handleSingleClick(l){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(l)?3:0,this._model.selectionStart=this._getMouseBufferCoords(l),!this._model.selectionStart)return;this._model.selectionEnd=void 0;const D=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);D&&D.length!==this._model.selectionStart[0]&&D.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(l){this._selectWordAtCursor(l,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(l){const D=this._getMouseBufferCoords(l);D&&(this._activeSelectionMode=2,this._selectLineAt(D[1]))}shouldColumnSelect(l){return l.altKey&&!(_.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(l){if(l.stopImmediatePropagation(),!this._model.selectionStart)return;const D=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(l),!this._model.selectionEnd)return void this.refresh(!0);this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(l),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));const y=this._bufferService.buffer;if(this._model.selectionEnd[1]<y.lines.length){const L=y.lines.get(this._model.selectionEnd[1]);L&&L.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]++}D&&D[0]===this._model.selectionEnd[0]&&D[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});const l=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(l.ydisp+this._bufferService.rows,l.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=l.ydisp),this.refresh()}}_handleMouseUp(l){const D=l.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&D<500&&l.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){const y=this._mouseService.getCoords(l,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(y&&y[0]!==void 0&&y[1]!==void 0){const L=(0,o.moveToCellSequence)(y[0]-1,y[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(L,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){const l=this._model.finalSelectionStart,D=this._model.finalSelectionEnd,y=!(!l||!D||l[0]===D[0]&&l[1]===D[1]);y?l&&D&&(this._oldSelectionStart&&this._oldSelectionEnd&&l[0]===this._oldSelectionStart[0]&&l[1]===this._oldSelectionStart[1]&&D[0]===this._oldSelectionEnd[0]&&D[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(l,D,y)):this._oldHasSelection&&this._fireOnSelectionChange(l,D,y)}_fireOnSelectionChange(l,D,y){this._oldSelectionStart=l,this._oldSelectionEnd=D,this._oldHasSelection=y,this._onSelectionChange.fire()}_handleBufferActivate(l){this.clearSelection(),this._trimListener.dispose(),this._trimListener=l.activeBuffer.lines.onTrim(D=>this._handleTrim(D))}_convertViewportColToCharacterIndex(l,D){let y=D;for(let L=0;D>=L;L++){const A=l.loadCell(L,this._workCell).getChars().length;this._workCell.getWidth()===0?y--:A>1&&D!==L&&(y+=A-1)}return y}setSelection(l,D,y){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[l,D],this._model.selectionStartLength=y,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(l){this._isClickInSelection(l)||(this._selectWordAtCursor(l,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(l,D,y=!0,L=!0){if(l[0]>=this._bufferService.cols)return;const A=this._bufferService.buffer,M=A.lines.get(l[1]);if(!M)return;const P=A.translateBufferLineToString(l[1],!1);let N=this._convertViewportColToCharacterIndex(M,l[0]),j=N;const m=l[0]-N;let E=0,F=0,T=0,U=0;if(P.charAt(N)===" "){for(;N>0&&P.charAt(N-1)===" ";)N--;for(;j<P.length&&P.charAt(j+1)===" ";)j++}else{let W=l[0],q=l[0];M.getWidth(W)===0&&(E++,W--),M.getWidth(q)===2&&(F++,q++);const x=M.getString(q).length;for(x>1&&(U+=x-1,j+=x-1);W>0&&N>0&&!this._isCharWordSeparator(M.loadCell(W-1,this._workCell));){M.loadCell(W-1,this._workCell);const B=this._workCell.getChars().length;this._workCell.getWidth()===0?(E++,W--):B>1&&(T+=B-1,N-=B-1),N--,W--}for(;q<M.length&&j+1<P.length&&!this._isCharWordSeparator(M.loadCell(q+1,this._workCell));){M.loadCell(q+1,this._workCell);const B=this._workCell.getChars().length;this._workCell.getWidth()===2?(F++,q++):B>1&&(U+=B-1,j+=B-1),j++,q++}}j++;let z=N+m-E+T,V=Math.min(this._bufferService.cols,j-N+E+F-T-U);if(D||P.slice(N,j).trim()!==""){if(y&&z===0&&M.getCodePoint(0)!==32){const W=A.lines.get(l[1]-1);if(W&&M.isWrapped&&W.getCodePoint(this._bufferService.cols-1)!==32){const q=this._getWordAt([this._bufferService.cols-1,l[1]-1],!1,!0,!1);if(q){const x=this._bufferService.cols-q.start;z-=x,V+=x}}}if(L&&z+V===this._bufferService.cols&&M.getCodePoint(this._bufferService.cols-1)!==32){const W=A.lines.get(l[1]+1);if(W?.isWrapped&&W.getCodePoint(0)!==32){const q=this._getWordAt([0,l[1]+1],!1,!1,!0);q&&(V+=q.length)}}return{start:z,length:V}}}_selectWordAt(l,D){const y=this._getWordAt(l,D);if(y){for(;y.start<0;)y.start+=this._bufferService.cols,l[1]--;this._model.selectionStart=[y.start,l[1]],this._model.selectionStartLength=y.length}}_selectToWordAt(l){const D=this._getWordAt(l,!0);if(D){let y=l[1];for(;D.start<0;)D.start+=this._bufferService.cols,y--;if(!this._model.areSelectionValuesReversed())for(;D.start+D.length>this._bufferService.cols;)D.length-=this._bufferService.cols,y++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?D.start:D.start+D.length,y]}}_isCharWordSeparator(l){return l.getWidth()!==0&&this._optionsService.rawOptions.wordSeparator.indexOf(l.getChars())>=0}_selectLineAt(l){const D=this._bufferService.buffer.getWrappedRangeForLine(l),y={start:{x:0,y:D.first},end:{x:this._bufferService.cols-1,y:D.last}};this._model.selectionStart=[0,D.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,r.getRangeLength)(y,this._bufferService.cols)}};S=h([a(3,e.IBufferService),a(4,e.ICoreService),a(5,c.IMouseService),a(6,e.IOptionsService),a(7,c.IRenderService),a(8,c.ICoreBrowserService)],S),t.SelectionService=S},4725:(R,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IThemeService=t.ICharacterJoinerService=t.ISelectionService=t.IRenderService=t.IMouseService=t.ICoreBrowserService=t.ICharSizeService=void 0;const h=n(8343);t.ICharSizeService=(0,h.createDecorator)("CharSizeService"),t.ICoreBrowserService=(0,h.createDecorator)("CoreBrowserService"),t.IMouseService=(0,h.createDecorator)("MouseService"),t.IRenderService=(0,h.createDecorator)("RenderService"),t.ISelectionService=(0,h.createDecorator)("SelectionService"),t.ICharacterJoinerService=(0,h.createDecorator)("CharacterJoinerService"),t.IThemeService=(0,h.createDecorator)("ThemeService")},6731:function(R,t,n){var h=this&&this.__decorate||function(S,l,D,y){var L,A=arguments.length,M=A<3?l:y===null?y=Object.getOwnPropertyDescriptor(l,D):y;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")M=Reflect.decorate(S,l,D,y);else for(var P=S.length-1;P>=0;P--)(L=S[P])&&(M=(A<3?L(M):A>3?L(l,D,M):L(l,D))||M);return A>3&&M&&Object.defineProperty(l,D,M),M},a=this&&this.__param||function(S,l){return function(D,y){l(D,y,S)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ThemeService=t.DEFAULT_ANSI_COLORS=void 0;const _=n(7239),u=n(8055),p=n(8460),v=n(844),c=n(2585),e=u.css.toColor("#ffffff"),s=u.css.toColor("#000000"),o=u.css.toColor("#ffffff"),i=u.css.toColor("#000000"),r={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};t.DEFAULT_ANSI_COLORS=Object.freeze((()=>{const S=[u.css.toColor("#2e3436"),u.css.toColor("#cc0000"),u.css.toColor("#4e9a06"),u.css.toColor("#c4a000"),u.css.toColor("#3465a4"),u.css.toColor("#75507b"),u.css.toColor("#06989a"),u.css.toColor("#d3d7cf"),u.css.toColor("#555753"),u.css.toColor("#ef2929"),u.css.toColor("#8ae234"),u.css.toColor("#fce94f"),u.css.toColor("#729fcf"),u.css.toColor("#ad7fa8"),u.css.toColor("#34e2e2"),u.css.toColor("#eeeeec")],l=[0,95,135,175,215,255];for(let D=0;D<216;D++){const y=l[D/36%6|0],L=l[D/6%6|0],A=l[D%6];S.push({css:u.channels.toCss(y,L,A),rgba:u.channels.toRgba(y,L,A)})}for(let D=0;D<24;D++){const y=8+10*D;S.push({css:u.channels.toCss(y,y,y),rgba:u.channels.toRgba(y,y,y)})}return S})());let d=class extends v.Disposable{constructor(S){super(),this._optionsService=S,this._onChangeColors=this.register(new p.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._contrastCache=new _.ColorContrastCache,this._colors={foreground:e,background:s,cursor:o,cursorAccent:i,selectionForeground:void 0,selectionBackgroundTransparent:r,selectionBackgroundOpaque:u.color.blend(s,r),selectionInactiveBackgroundTransparent:r,selectionInactiveBackgroundOpaque:u.color.blend(s,r),ansi:t.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",()=>this._contrastCache.clear())),this.register(this._optionsService.onSpecificOptionChange("theme",()=>this._setTheme(this._optionsService.rawOptions.theme)))}get colors(){return this._colors}_setTheme(S={}){const l=this._colors;if(l.foreground=g(S.foreground,e),l.background=g(S.background,s),l.cursor=g(S.cursor,o),l.cursorAccent=g(S.cursorAccent,i),l.selectionBackgroundTransparent=g(S.selectionBackground,r),l.selectionBackgroundOpaque=u.color.blend(l.background,l.selectionBackgroundTransparent),l.selectionInactiveBackgroundTransparent=g(S.selectionInactiveBackground,l.selectionBackgroundTransparent),l.selectionInactiveBackgroundOpaque=u.color.blend(l.background,l.selectionInactiveBackgroundTransparent),l.selectionForeground=S.selectionForeground?g(S.selectionForeground,u.NULL_COLOR):void 0,l.selectionForeground===u.NULL_COLOR&&(l.selectionForeground=void 0),u.color.isOpaque(l.selectionBackgroundTransparent)&&(l.selectionBackgroundTransparent=u.color.opacity(l.selectionBackgroundTransparent,.3)),u.color.isOpaque(l.selectionInactiveBackgroundTransparent)&&(l.selectionInactiveBackgroundTransparent=u.color.opacity(l.selectionInactiveBackgroundTransparent,.3)),l.ansi=t.DEFAULT_ANSI_COLORS.slice(),l.ansi[0]=g(S.black,t.DEFAULT_ANSI_COLORS[0]),l.ansi[1]=g(S.red,t.DEFAULT_ANSI_COLORS[1]),l.ansi[2]=g(S.green,t.DEFAULT_ANSI_COLORS[2]),l.ansi[3]=g(S.yellow,t.DEFAULT_ANSI_COLORS[3]),l.ansi[4]=g(S.blue,t.DEFAULT_ANSI_COLORS[4]),l.ansi[5]=g(S.magenta,t.DEFAULT_ANSI_COLORS[5]),l.ansi[6]=g(S.cyan,t.DEFAULT_ANSI_COLORS[6]),l.ansi[7]=g(S.white,t.DEFAULT_ANSI_COLORS[7]),l.ansi[8]=g(S.brightBlack,t.DEFAULT_ANSI_COLORS[8]),l.ansi[9]=g(S.brightRed,t.DEFAULT_ANSI_COLORS[9]),l.ansi[10]=g(S.brightGreen,t.DEFAULT_ANSI_COLORS[10]),l.ansi[11]=g(S.brightYellow,t.DEFAULT_ANSI_COLORS[11]),l.ansi[12]=g(S.brightBlue,t.DEFAULT_ANSI_COLORS[12]),l.ansi[13]=g(S.brightMagenta,t.DEFAULT_ANSI_COLORS[13]),l.ansi[14]=g(S.brightCyan,t.DEFAULT_ANSI_COLORS[14]),l.ansi[15]=g(S.brightWhite,t.DEFAULT_ANSI_COLORS[15]),S.extendedAnsi){const D=Math.min(l.ansi.length-16,S.extendedAnsi.length);for(let y=0;y<D;y++)l.ansi[y+16]=g(S.extendedAnsi[y],t.DEFAULT_ANSI_COLORS[y+16])}this._contrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(S){this._restoreColor(S),this._onChangeColors.fire(this.colors)}_restoreColor(S){if(S!==void 0)switch(S){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[S]=this._restoreColors.ansi[S]}else for(let l=0;l<this._restoreColors.ansi.length;++l)this._colors.ansi[l]=this._restoreColors.ansi[l]}modifyColors(S){S(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function g(S,l){if(S!==void 0)try{return u.css.toColor(S)}catch{}return l}d=h([a(0,c.IOptionsService)],d),t.ThemeService=d},6349:(R,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CircularList=void 0;const h=n(8460),a=n(844);class _ extends a.Disposable{constructor(p){super(),this._maxLength=p,this.onDeleteEmitter=this.register(new h.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new h.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new h.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(p){if(this._maxLength===p)return;const v=new Array(p);for(let c=0;c<Math.min(p,this.length);c++)v[c]=this._array[this._getCyclicIndex(c)];this._array=v,this._maxLength=p,this._startIndex=0}get length(){return this._length}set length(p){if(p>this._length)for(let v=this._length;v<p;v++)this._array[v]=void 0;this._length=p}get(p){return this._array[this._getCyclicIndex(p)]}set(p,v){this._array[this._getCyclicIndex(p)]=v}push(p){this._array[this._getCyclicIndex(this._length)]=p,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(p,v,...c){if(v){for(let e=p;e<this._length-v;e++)this._array[this._getCyclicIndex(e)]=this._array[this._getCyclicIndex(e+v)];this._length-=v,this.onDeleteEmitter.fire({index:p,amount:v})}for(let e=this._length-1;e>=p;e--)this._array[this._getCyclicIndex(e+c.length)]=this._array[this._getCyclicIndex(e)];for(let e=0;e<c.length;e++)this._array[this._getCyclicIndex(p+e)]=c[e];if(c.length&&this.onInsertEmitter.fire({index:p,amount:c.length}),this._length+c.length>this._maxLength){const e=this._length+c.length-this._maxLength;this._startIndex+=e,this._length=this._maxLength,this.onTrimEmitter.fire(e)}else this._length+=c.length}trimStart(p){p>this._length&&(p=this._length),this._startIndex+=p,this._length-=p,this.onTrimEmitter.fire(p)}shiftElements(p,v,c){if(!(v<=0)){if(p<0||p>=this._length)throw new Error("start argument out of range");if(p+c<0)throw new Error("Cannot shift elements in list beyond index 0");if(c>0){for(let s=v-1;s>=0;s--)this.set(p+s+c,this.get(p+s));const e=p+v+c-this._length;if(e>0)for(this._length+=e;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let e=0;e<v;e++)this.set(p+e+c,this.get(p+e))}}_getCyclicIndex(p){return(this._startIndex+p)%this._maxLength}}t.CircularList=_},1439:(R,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.clone=void 0,t.clone=function n(h,a=5){if(typeof h!="object")return h;const _=Array.isArray(h)?[]:{};for(const u in h)_[u]=a<=1?h[u]:h[u]&&n(h[u],a-1);return _}},8055:(R,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.contrastRatio=t.toPaddedHex=t.rgba=t.rgb=t.css=t.color=t.channels=t.NULL_COLOR=void 0;const h=n(6114);let a=0,_=0,u=0,p=0;var v,c,e;function s(i){const r=i.toString(16);return r.length<2?"0"+r:r}function o(i,r){return i<r?(r+.05)/(i+.05):(i+.05)/(r+.05)}t.NULL_COLOR={css:"#00000000",rgba:0},function(i){i.toCss=function(r,d,g,S){return S!==void 0?`#${s(r)}${s(d)}${s(g)}${s(S)}`:`#${s(r)}${s(d)}${s(g)}`},i.toRgba=function(r,d,g,S=255){return(r<<24|d<<16|g<<8|S)>>>0}}(v=t.channels||(t.channels={})),function(i){function r(d,g){return p=Math.round(255*g),[a,_,u]=e.toChannels(d.rgba),{css:v.toCss(a,_,u,p),rgba:v.toRgba(a,_,u,p)}}i.blend=function(d,g){if(p=(255&g.rgba)/255,p===1)return{css:g.css,rgba:g.rgba};const S=g.rgba>>24&255,l=g.rgba>>16&255,D=g.rgba>>8&255,y=d.rgba>>24&255,L=d.rgba>>16&255,A=d.rgba>>8&255;return a=y+Math.round((S-y)*p),_=L+Math.round((l-L)*p),u=A+Math.round((D-A)*p),{css:v.toCss(a,_,u),rgba:v.toRgba(a,_,u)}},i.isOpaque=function(d){return(255&d.rgba)==255},i.ensureContrastRatio=function(d,g,S){const l=e.ensureContrastRatio(d.rgba,g.rgba,S);if(l)return e.toColor(l>>24&255,l>>16&255,l>>8&255)},i.opaque=function(d){const g=(255|d.rgba)>>>0;return[a,_,u]=e.toChannels(g),{css:v.toCss(a,_,u),rgba:g}},i.opacity=r,i.multiplyOpacity=function(d,g){return p=255&d.rgba,r(d,p*g/255)},i.toColorRGB=function(d){return[d.rgba>>24&255,d.rgba>>16&255,d.rgba>>8&255]}}(t.color||(t.color={})),function(i){let r,d;if(!h.isNode){const g=document.createElement("canvas");g.width=1,g.height=1;const S=g.getContext("2d",{willReadFrequently:!0});S&&(r=S,r.globalCompositeOperation="copy",d=r.createLinearGradient(0,0,1,1))}i.toColor=function(g){if(g.match(/#[\da-f]{3,8}/i))switch(g.length){case 4:return a=parseInt(g.slice(1,2).repeat(2),16),_=parseInt(g.slice(2,3).repeat(2),16),u=parseInt(g.slice(3,4).repeat(2),16),e.toColor(a,_,u);case 5:return a=parseInt(g.slice(1,2).repeat(2),16),_=parseInt(g.slice(2,3).repeat(2),16),u=parseInt(g.slice(3,4).repeat(2),16),p=parseInt(g.slice(4,5).repeat(2),16),e.toColor(a,_,u,p);case 7:return{css:g,rgba:(parseInt(g.slice(1),16)<<8|255)>>>0};case 9:return{css:g,rgba:parseInt(g.slice(1),16)>>>0}}const S=g.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(S)return a=parseInt(S[1]),_=parseInt(S[2]),u=parseInt(S[3]),p=Math.round(255*(S[5]===void 0?1:parseFloat(S[5]))),e.toColor(a,_,u,p);if(!r||!d)throw new Error("css.toColor: Unsupported css format");if(r.fillStyle=d,r.fillStyle=g,typeof r.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(r.fillRect(0,0,1,1),[a,_,u,p]=r.getImageData(0,0,1,1).data,p!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:v.toRgba(a,_,u,p),css:g}}}(t.css||(t.css={})),function(i){function r(d,g,S){const l=d/255,D=g/255,y=S/255;return .2126*(l<=.03928?l/12.92:Math.pow((l+.055)/1.055,2.4))+.7152*(D<=.03928?D/12.92:Math.pow((D+.055)/1.055,2.4))+.0722*(y<=.03928?y/12.92:Math.pow((y+.055)/1.055,2.4))}i.relativeLuminance=function(d){return r(d>>16&255,d>>8&255,255&d)},i.relativeLuminance2=r}(c=t.rgb||(t.rgb={})),function(i){function r(g,S,l){const D=g>>24&255,y=g>>16&255,L=g>>8&255;let A=S>>24&255,M=S>>16&255,P=S>>8&255,N=o(c.relativeLuminance2(A,M,P),c.relativeLuminance2(D,y,L));for(;N<l&&(A>0||M>0||P>0);)A-=Math.max(0,Math.ceil(.1*A)),M-=Math.max(0,Math.ceil(.1*M)),P-=Math.max(0,Math.ceil(.1*P)),N=o(c.relativeLuminance2(A,M,P),c.relativeLuminance2(D,y,L));return(A<<24|M<<16|P<<8|255)>>>0}function d(g,S,l){const D=g>>24&255,y=g>>16&255,L=g>>8&255;let A=S>>24&255,M=S>>16&255,P=S>>8&255,N=o(c.relativeLuminance2(A,M,P),c.relativeLuminance2(D,y,L));for(;N<l&&(A<255||M<255||P<255);)A=Math.min(255,A+Math.ceil(.1*(255-A))),M=Math.min(255,M+Math.ceil(.1*(255-M))),P=Math.min(255,P+Math.ceil(.1*(255-P))),N=o(c.relativeLuminance2(A,M,P),c.relativeLuminance2(D,y,L));return(A<<24|M<<16|P<<8|255)>>>0}i.ensureContrastRatio=function(g,S,l){const D=c.relativeLuminance(g>>8),y=c.relativeLuminance(S>>8);if(o(D,y)<l){if(y<D){const M=r(g,S,l),P=o(D,c.relativeLuminance(M>>8));if(P<l){const N=d(g,S,l);return P>o(D,c.relativeLuminance(N>>8))?M:N}return M}const L=d(g,S,l),A=o(D,c.relativeLuminance(L>>8));if(A<l){const M=r(g,S,l);return A>o(D,c.relativeLuminance(M>>8))?L:M}return L}},i.reduceLuminance=r,i.increaseLuminance=d,i.toChannels=function(g){return[g>>24&255,g>>16&255,g>>8&255,255&g]},i.toColor=function(g,S,l,D){return{css:v.toCss(g,S,l,D),rgba:v.toRgba(g,S,l,D)}}}(e=t.rgba||(t.rgba={})),t.toPaddedHex=s,t.contrastRatio=o},8969:(R,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CoreTerminal=void 0;const h=n(844),a=n(2585),_=n(4348),u=n(7866),p=n(744),v=n(7302),c=n(6975),e=n(8460),s=n(1753),o=n(1480),i=n(7994),r=n(9282),d=n(5435),g=n(5981),S=n(2660);let l=!1;class D extends h.Disposable{constructor(L){super(),this._onBinary=this.register(new e.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new e.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new e.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new e.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new e.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new e.EventEmitter),this._instantiationService=new _.InstantiationService,this.optionsService=this.register(new v.OptionsService(L)),this._instantiationService.setService(a.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(p.BufferService)),this._instantiationService.setService(a.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(u.LogService)),this._instantiationService.setService(a.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(c.CoreService)),this._instantiationService.setService(a.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(s.CoreMouseService)),this._instantiationService.setService(a.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(o.UnicodeService)),this._instantiationService.setService(a.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(i.CharsetService),this._instantiationService.setService(a.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(S.OscLinkService),this._instantiationService.setService(a.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new d.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,e.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,e.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,e.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,e.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom())),this.register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this.register(this.optionsService.onSpecificOptionChange("windowsMode",A=>this._handleWindowsModeOptionChange(A))),this.register(this._bufferService.onScroll(A=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this.register(this._inputHandler.onScroll(A=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this.register(new g.WriteBuffer((A,M)=>this._inputHandler.parse(A,M))),this.register((0,e.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed)),this.register((0,h.toDisposable)(()=>{var A;(A=this._windowsMode)===null||A===void 0||A.dispose(),this._windowsMode=void 0}))}get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new e.EventEmitter),this._onScroll.event(L=>{var A;(A=this._onScrollApi)===null||A===void 0||A.fire(L.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(L){for(const A in L)this.optionsService.options[A]=L[A]}write(L,A){this._writeBuffer.write(L,A)}writeSync(L,A){this._logService.logLevel<=a.LogLevelEnum.WARN&&!l&&(this._logService.warn("writeSync is unreliable and will be removed soon."),l=!0),this._writeBuffer.writeSync(L,A)}resize(L,A){isNaN(L)||isNaN(A)||(L=Math.max(L,p.MINIMUM_COLS),A=Math.max(A,p.MINIMUM_ROWS),this._bufferService.resize(L,A))}scroll(L,A=!1){this._bufferService.scroll(L,A)}scrollLines(L,A,M){this._bufferService.scrollLines(L,A,M)}scrollPages(L){this._bufferService.scrollPages(L)}scrollToTop(){this._bufferService.scrollToTop()}scrollToBottom(){this._bufferService.scrollToBottom()}scrollToLine(L){this._bufferService.scrollToLine(L)}registerEscHandler(L,A){return this._inputHandler.registerEscHandler(L,A)}registerDcsHandler(L,A){return this._inputHandler.registerDcsHandler(L,A)}registerCsiHandler(L,A){return this._inputHandler.registerCsiHandler(L,A)}registerOscHandler(L,A){return this._inputHandler.registerOscHandler(L,A)}_setup(){this.optionsService.rawOptions.windowsMode&&this._enableWindowsMode()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsModeOptionChange(L){var A;L?this._enableWindowsMode():((A=this._windowsMode)===null||A===void 0||A.dispose(),this._windowsMode=void 0)}_enableWindowsMode(){if(!this._windowsMode){const L=[];L.push(this.onLineFeed(r.updateWindowsModeWrappedState.bind(null,this._bufferService))),L.push(this.registerCsiHandler({final:"H"},()=>((0,r.updateWindowsModeWrappedState)(this._bufferService),!1))),this._windowsMode={dispose:()=>{for(const A of L)A.dispose()}}}}}t.CoreTerminal=D},8460:(R,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.forwardEvent=t.EventEmitter=void 0,t.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=n=>(this._listeners.push(n),{dispose:()=>{if(!this._disposed){for(let h=0;h<this._listeners.length;h++)if(this._listeners[h]===n)return void this._listeners.splice(h,1)}}})),this._event}fire(n,h){const a=[];for(let _=0;_<this._listeners.length;_++)a.push(this._listeners[_]);for(let _=0;_<a.length;_++)a[_].call(void 0,n,h)}dispose(){this._listeners&&(this._listeners.length=0),this._disposed=!0}},t.forwardEvent=function(n,h){return n(a=>h.fire(a))}},5435:function(R,t,n){var h=this&&this.__decorate||function(j,m,E,F){var T,U=arguments.length,z=U<3?m:F===null?F=Object.getOwnPropertyDescriptor(m,E):F;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")z=Reflect.decorate(j,m,E,F);else for(var V=j.length-1;V>=0;V--)(T=j[V])&&(z=(U<3?T(z):U>3?T(m,E,z):T(m,E))||z);return U>3&&z&&Object.defineProperty(m,E,z),z},a=this&&this.__param||function(j,m){return function(E,F){m(E,F,j)}};Object.defineProperty(t,"__esModule",{value:!0}),t.InputHandler=t.WindowsOptionsReportType=void 0;const _=n(2584),u=n(7116),p=n(2015),v=n(844),c=n(482),e=n(8437),s=n(8460),o=n(643),i=n(511),r=n(3734),d=n(2585),g=n(6242),S=n(6351),l=n(5941),D={"(":0,")":1,"*":2,"+":3,"-":1,".":2},y=131072;function L(j,m){if(j>24)return m.setWinLines||!1;switch(j){case 1:return!!m.restoreWin;case 2:return!!m.minimizeWin;case 3:return!!m.setWinPosition;case 4:return!!m.setWinSizePixels;case 5:return!!m.raiseWin;case 6:return!!m.lowerWin;case 7:return!!m.refreshWin;case 8:return!!m.setWinSizeChars;case 9:return!!m.maximizeWin;case 10:return!!m.fullscreenWin;case 11:return!!m.getWinState;case 13:return!!m.getWinPosition;case 14:return!!m.getWinSizePixels;case 15:return!!m.getScreenSizePixels;case 16:return!!m.getCellSizePixels;case 18:return!!m.getWinSizeChars;case 19:return!!m.getScreenSizeChars;case 20:return!!m.getIconTitle;case 21:return!!m.getWinTitle;case 22:return!!m.pushTitle;case 23:return!!m.popTitle;case 24:return!!m.setWinLines}return!1}var A;(function(j){j[j.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",j[j.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"})(A=t.WindowsOptionsReportType||(t.WindowsOptionsReportType={}));let M=0;class P extends v.Disposable{constructor(m,E,F,T,U,z,V,W,q=new p.EscapeSequenceParser){super(),this._bufferService=m,this._charsetService=E,this._coreService=F,this._logService=T,this._optionsService=U,this._oscLinkService=z,this._coreMouseService=V,this._unicodeService=W,this._parser=q,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new c.StringToUtf32,this._utf8Decoder=new c.Utf8ToUtf32,this._workCell=new i.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=e.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=e.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new s.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new s.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new s.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new s.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new s.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new s.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new s.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new s.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new s.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new s.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new s.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new s.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new s.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new N(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(x=>this._activeBuffer=x.activeBuffer)),this._parser.setCsiHandlerFallback((x,B)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(x),params:B.toArray()})}),this._parser.setEscHandlerFallback(x=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(x)})}),this._parser.setExecuteHandlerFallback(x=>{this._logService.debug("Unknown EXECUTE code: ",{code:x})}),this._parser.setOscHandlerFallback((x,B,I)=>{this._logService.debug("Unknown OSC code: ",{identifier:x,action:B,data:I})}),this._parser.setDcsHandlerFallback((x,B,I)=>{B==="HOOK"&&(I=I.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(x),action:B,payload:I})}),this._parser.setPrintHandler((x,B,I)=>this.print(x,B,I)),this._parser.registerCsiHandler({final:"@"},x=>this.insertChars(x)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},x=>this.scrollLeft(x)),this._parser.registerCsiHandler({final:"A"},x=>this.cursorUp(x)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},x=>this.scrollRight(x)),this._parser.registerCsiHandler({final:"B"},x=>this.cursorDown(x)),this._parser.registerCsiHandler({final:"C"},x=>this.cursorForward(x)),this._parser.registerCsiHandler({final:"D"},x=>this.cursorBackward(x)),this._parser.registerCsiHandler({final:"E"},x=>this.cursorNextLine(x)),this._parser.registerCsiHandler({final:"F"},x=>this.cursorPrecedingLine(x)),this._parser.registerCsiHandler({final:"G"},x=>this.cursorCharAbsolute(x)),this._parser.registerCsiHandler({final:"H"},x=>this.cursorPosition(x)),this._parser.registerCsiHandler({final:"I"},x=>this.cursorForwardTab(x)),this._parser.registerCsiHandler({final:"J"},x=>this.eraseInDisplay(x,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},x=>this.eraseInDisplay(x,!0)),this._parser.registerCsiHandler({final:"K"},x=>this.eraseInLine(x,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},x=>this.eraseInLine(x,!0)),this._parser.registerCsiHandler({final:"L"},x=>this.insertLines(x)),this._parser.registerCsiHandler({final:"M"},x=>this.deleteLines(x)),this._parser.registerCsiHandler({final:"P"},x=>this.deleteChars(x)),this._parser.registerCsiHandler({final:"S"},x=>this.scrollUp(x)),this._parser.registerCsiHandler({final:"T"},x=>this.scrollDown(x)),this._parser.registerCsiHandler({final:"X"},x=>this.eraseChars(x)),this._parser.registerCsiHandler({final:"Z"},x=>this.cursorBackwardTab(x)),this._parser.registerCsiHandler({final:"`"},x=>this.charPosAbsolute(x)),this._parser.registerCsiHandler({final:"a"},x=>this.hPositionRelative(x)),this._parser.registerCsiHandler({final:"b"},x=>this.repeatPrecedingCharacter(x)),this._parser.registerCsiHandler({final:"c"},x=>this.sendDeviceAttributesPrimary(x)),this._parser.registerCsiHandler({prefix:">",final:"c"},x=>this.sendDeviceAttributesSecondary(x)),this._parser.registerCsiHandler({final:"d"},x=>this.linePosAbsolute(x)),this._parser.registerCsiHandler({final:"e"},x=>this.vPositionRelative(x)),this._parser.registerCsiHandler({final:"f"},x=>this.hVPosition(x)),this._parser.registerCsiHandler({final:"g"},x=>this.tabClear(x)),this._parser.registerCsiHandler({final:"h"},x=>this.setMode(x)),this._parser.registerCsiHandler({prefix:"?",final:"h"},x=>this.setModePrivate(x)),this._parser.registerCsiHandler({final:"l"},x=>this.resetMode(x)),this._parser.registerCsiHandler({prefix:"?",final:"l"},x=>this.resetModePrivate(x)),this._parser.registerCsiHandler({final:"m"},x=>this.charAttributes(x)),this._parser.registerCsiHandler({final:"n"},x=>this.deviceStatus(x)),this._parser.registerCsiHandler({prefix:"?",final:"n"},x=>this.deviceStatusPrivate(x)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},x=>this.softReset(x)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},x=>this.setCursorStyle(x)),this._parser.registerCsiHandler({final:"r"},x=>this.setScrollRegion(x)),this._parser.registerCsiHandler({final:"s"},x=>this.saveCursor(x)),this._parser.registerCsiHandler({final:"t"},x=>this.windowOptions(x)),this._parser.registerCsiHandler({final:"u"},x=>this.restoreCursor(x)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},x=>this.insertColumns(x)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},x=>this.deleteColumns(x)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},x=>this.selectProtected(x)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},x=>this.requestMode(x,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},x=>this.requestMode(x,!1)),this._parser.setExecuteHandler(_.C0.BEL,()=>this.bell()),this._parser.setExecuteHandler(_.C0.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(_.C0.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(_.C0.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(_.C0.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(_.C0.BS,()=>this.backspace()),this._parser.setExecuteHandler(_.C0.HT,()=>this.tab()),this._parser.setExecuteHandler(_.C0.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(_.C0.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(_.C1.IND,()=>this.index()),this._parser.setExecuteHandler(_.C1.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(_.C1.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new g.OscHandler(x=>(this.setTitle(x),this.setIconName(x),!0))),this._parser.registerOscHandler(1,new g.OscHandler(x=>this.setIconName(x))),this._parser.registerOscHandler(2,new g.OscHandler(x=>this.setTitle(x))),this._parser.registerOscHandler(4,new g.OscHandler(x=>this.setOrReportIndexedColor(x))),this._parser.registerOscHandler(8,new g.OscHandler(x=>this.setHyperlink(x))),this._parser.registerOscHandler(10,new g.OscHandler(x=>this.setOrReportFgColor(x))),this._parser.registerOscHandler(11,new g.OscHandler(x=>this.setOrReportBgColor(x))),this._parser.registerOscHandler(12,new g.OscHandler(x=>this.setOrReportCursorColor(x))),this._parser.registerOscHandler(104,new g.OscHandler(x=>this.restoreIndexedColor(x))),this._parser.registerOscHandler(110,new g.OscHandler(x=>this.restoreFgColor(x))),this._parser.registerOscHandler(111,new g.OscHandler(x=>this.restoreBgColor(x))),this._parser.registerOscHandler(112,new g.OscHandler(x=>this.restoreCursorColor(x))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(const x in u.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:x},()=>this.selectCharset("("+x)),this._parser.registerEscHandler({intermediates:")",final:x},()=>this.selectCharset(")"+x)),this._parser.registerEscHandler({intermediates:"*",final:x},()=>this.selectCharset("*"+x)),this._parser.registerEscHandler({intermediates:"+",final:x},()=>this.selectCharset("+"+x)),this._parser.registerEscHandler({intermediates:"-",final:x},()=>this.selectCharset("-"+x)),this._parser.registerEscHandler({intermediates:".",final:x},()=>this.selectCharset("."+x)),this._parser.registerEscHandler({intermediates:"/",final:x},()=>this.selectCharset("/"+x));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler(x=>(this._logService.error("Parsing error: ",x),x)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new S.DcsHandler((x,B)=>this.requestStatusString(x,B)))}getAttrData(){return this._curAttrData}_preserveStack(m,E,F,T){this._parseStack.paused=!0,this._parseStack.cursorStartX=m,this._parseStack.cursorStartY=E,this._parseStack.decodedLength=F,this._parseStack.position=T}_logSlowResolvingAsync(m){this._logService.logLevel<=d.LogLevelEnum.WARN&&Promise.race([m,new Promise((E,F)=>setTimeout(()=>F("#SLOW_TIMEOUT"),5e3))]).catch(E=>{if(E!=="#SLOW_TIMEOUT")throw E;console.warn("async parser handler taking longer than 5000 ms")})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(m,E){let F,T=this._activeBuffer.x,U=this._activeBuffer.y,z=0;const V=this._parseStack.paused;if(V){if(F=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,E))return this._logSlowResolvingAsync(F),F;T=this._parseStack.cursorStartX,U=this._parseStack.cursorStartY,this._parseStack.paused=!1,m.length>y&&(z=this._parseStack.position+y)}if(this._logService.logLevel<=d.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+(typeof m=="string"?` "${m}"`:` "${Array.prototype.map.call(m,W=>String.fromCharCode(W)).join("")}"`),typeof m=="string"?m.split("").map(W=>W.charCodeAt(0)):m),this._parseBuffer.length<m.length&&this._parseBuffer.length<y&&(this._parseBuffer=new Uint32Array(Math.min(m.length,y))),V||this._dirtyRowTracker.clearRange(),m.length>y)for(let W=z;W<m.length;W+=y){const q=W+y<m.length?W+y:m.length,x=typeof m=="string"?this._stringDecoder.decode(m.substring(W,q),this._parseBuffer):this._utf8Decoder.decode(m.subarray(W,q),this._parseBuffer);if(F=this._parser.parse(this._parseBuffer,x))return this._preserveStack(T,U,x,W),this._logSlowResolvingAsync(F),F}else if(!V){const W=typeof m=="string"?this._stringDecoder.decode(m,this._parseBuffer):this._utf8Decoder.decode(m,this._parseBuffer);if(F=this._parser.parse(this._parseBuffer,W))return this._preserveStack(T,U,W,0),this._logSlowResolvingAsync(F),F}this._activeBuffer.x===T&&this._activeBuffer.y===U||this._onCursorMove.fire(),this._onRequestRefreshRows.fire(this._dirtyRowTracker.start,this._dirtyRowTracker.end)}print(m,E,F){let T,U;const z=this._charsetService.charset,V=this._optionsService.rawOptions.screenReaderMode,W=this._bufferService.cols,q=this._coreService.decPrivateModes.wraparound,x=this._coreService.modes.insertMode,B=this._curAttrData;let I=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&F-E>0&&I.getWidth(this._activeBuffer.x-1)===2&&I.setCellFromCodePoint(this._activeBuffer.x-1,0,1,B.fg,B.bg,B.extended);for(let H=E;H<F;++H){if(T=m[H],U=this._unicodeService.wcwidth(T),T<127&&z){const $=z[String.fromCharCode(T)];$&&(T=$.charCodeAt(0))}if(V&&this._onA11yChar.fire((0,c.stringFromCodePoint)(T)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),U||!this._activeBuffer.x){if(this._activeBuffer.x+U-1>=W){if(q){for(;this._activeBuffer.x<W;)I.setCellFromCodePoint(this._activeBuffer.x++,0,1,B.fg,B.bg,B.extended);this._activeBuffer.x=0,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),I=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)}else if(this._activeBuffer.x=W-1,U===2)continue}if(x&&(I.insertCells(this._activeBuffer.x,U,this._activeBuffer.getNullCell(B),B),I.getWidth(W-1)===2&&I.setCellFromCodePoint(W-1,o.NULL_CELL_CODE,o.NULL_CELL_WIDTH,B.fg,B.bg,B.extended)),I.setCellFromCodePoint(this._activeBuffer.x++,T,U,B.fg,B.bg,B.extended),U>0)for(;--U;)I.setCellFromCodePoint(this._activeBuffer.x++,0,0,B.fg,B.bg,B.extended)}else I.getWidth(this._activeBuffer.x-1)?I.addCodepointToCell(this._activeBuffer.x-1,T):I.addCodepointToCell(this._activeBuffer.x-2,T)}F-E>0&&(I.loadCell(this._activeBuffer.x-1,this._workCell),this._workCell.getWidth()===2||this._workCell.getCode()>65535?this._parser.precedingCodepoint=0:this._workCell.isCombined()?this._parser.precedingCodepoint=this._workCell.getChars().charCodeAt(0):this._parser.precedingCodepoint=this._workCell.content),this._activeBuffer.x<W&&F-E>0&&I.getWidth(this._activeBuffer.x)===0&&!I.hasContent(this._activeBuffer.x)&&I.setCellFromCodePoint(this._activeBuffer.x,0,1,B.fg,B.bg,B.extended),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(m,E){return m.final!=="t"||m.prefix||m.intermediates?this._parser.registerCsiHandler(m,E):this._parser.registerCsiHandler(m,F=>!L(F.params[0],this._optionsService.rawOptions.windowOptions)||E(F))}registerDcsHandler(m,E){return this._parser.registerDcsHandler(m,new S.DcsHandler(E))}registerEscHandler(m,E){return this._parser.registerEscHandler(m,E)}registerOscHandler(m,E){return this._parser.registerOscHandler(m,new g.OscHandler(E))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){var m;if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&(!((m=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y))===null||m===void 0)&&m.isWrapped)){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;const E=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);E.hasWidth(this._activeBuffer.x)&&!E.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;const m=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-m),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(m=this._bufferService.cols-1){this._activeBuffer.x=Math.min(m,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(m,E){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=m,this._activeBuffer.y=this._activeBuffer.scrollTop+E):(this._activeBuffer.x=m,this._activeBuffer.y=E),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(m,E){this._restrictCursor(),this._setCursor(this._activeBuffer.x+m,this._activeBuffer.y+E)}cursorUp(m){const E=this._activeBuffer.y-this._activeBuffer.scrollTop;return E>=0?this._moveCursor(0,-Math.min(E,m.params[0]||1)):this._moveCursor(0,-(m.params[0]||1)),!0}cursorDown(m){const E=this._activeBuffer.scrollBottom-this._activeBuffer.y;return E>=0?this._moveCursor(0,Math.min(E,m.params[0]||1)):this._moveCursor(0,m.params[0]||1),!0}cursorForward(m){return this._moveCursor(m.params[0]||1,0),!0}cursorBackward(m){return this._moveCursor(-(m.params[0]||1),0),!0}cursorNextLine(m){return this.cursorDown(m),this._activeBuffer.x=0,!0}cursorPrecedingLine(m){return this.cursorUp(m),this._activeBuffer.x=0,!0}cursorCharAbsolute(m){return this._setCursor((m.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(m){return this._setCursor(m.length>=2?(m.params[1]||1)-1:0,(m.params[0]||1)-1),!0}charPosAbsolute(m){return this._setCursor((m.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(m){return this._moveCursor(m.params[0]||1,0),!0}linePosAbsolute(m){return this._setCursor(this._activeBuffer.x,(m.params[0]||1)-1),!0}vPositionRelative(m){return this._moveCursor(0,m.params[0]||1),!0}hVPosition(m){return this.cursorPosition(m),!0}tabClear(m){const E=m.params[0];return E===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:E===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(m){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let E=m.params[0]||1;for(;E--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(m){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let E=m.params[0]||1;for(;E--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(m){const E=m.params[0];return E===1&&(this._curAttrData.bg|=536870912),E!==2&&E!==0||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(m,E,F,T=!1,U=!1){const z=this._activeBuffer.lines.get(this._activeBuffer.ybase+m);z.replaceCells(E,F,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData(),U),T&&(z.isWrapped=!1)}_resetBufferLine(m,E=!1){const F=this._activeBuffer.lines.get(this._activeBuffer.ybase+m);F.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),E),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+m),F.isWrapped=!1}eraseInDisplay(m,E=!1){let F;switch(this._restrictCursor(this._bufferService.cols),m.params[0]){case 0:for(F=this._activeBuffer.y,this._dirtyRowTracker.markDirty(F),this._eraseInBufferLine(F++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,E);F<this._bufferService.rows;F++)this._resetBufferLine(F,E);this._dirtyRowTracker.markDirty(F);break;case 1:for(F=this._activeBuffer.y,this._dirtyRowTracker.markDirty(F),this._eraseInBufferLine(F,0,this._activeBuffer.x+1,!0,E),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(F+1).isWrapped=!1);F--;)this._resetBufferLine(F,E);this._dirtyRowTracker.markDirty(0);break;case 2:for(F=this._bufferService.rows,this._dirtyRowTracker.markDirty(F-1);F--;)this._resetBufferLine(F,E);this._dirtyRowTracker.markDirty(0);break;case 3:const T=this._activeBuffer.lines.length-this._bufferService.rows;T>0&&(this._activeBuffer.lines.trimStart(T),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-T,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-T,0),this._onScroll.fire(0))}return!0}eraseInLine(m,E=!1){switch(this._restrictCursor(this._bufferService.cols),m.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,E);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,E);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,E)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(m){this._restrictCursor();let E=m.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const F=this._activeBuffer.ybase+this._activeBuffer.y,T=this._bufferService.rows-1-this._activeBuffer.scrollBottom,U=this._bufferService.rows-1+this._activeBuffer.ybase-T+1;for(;E--;)this._activeBuffer.lines.splice(U-1,1),this._activeBuffer.lines.splice(F,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(m){this._restrictCursor();let E=m.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const F=this._activeBuffer.ybase+this._activeBuffer.y;let T;for(T=this._bufferService.rows-1-this._activeBuffer.scrollBottom,T=this._bufferService.rows-1+this._activeBuffer.ybase-T;E--;)this._activeBuffer.lines.splice(F,1),this._activeBuffer.lines.splice(T,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(m){this._restrictCursor();const E=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return E&&(E.insertCells(this._activeBuffer.x,m.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(m){this._restrictCursor();const E=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return E&&(E.deleteCells(this._activeBuffer.x,m.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(m){let E=m.params[0]||1;for(;E--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(m){let E=m.params[0]||1;for(;E--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(e.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(m){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const E=m.params[0]||1;for(let F=this._activeBuffer.scrollTop;F<=this._activeBuffer.scrollBottom;++F){const T=this._activeBuffer.lines.get(this._activeBuffer.ybase+F);T.deleteCells(0,E,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),T.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(m){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const E=m.params[0]||1;for(let F=this._activeBuffer.scrollTop;F<=this._activeBuffer.scrollBottom;++F){const T=this._activeBuffer.lines.get(this._activeBuffer.ybase+F);T.insertCells(0,E,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),T.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(m){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const E=m.params[0]||1;for(let F=this._activeBuffer.scrollTop;F<=this._activeBuffer.scrollBottom;++F){const T=this._activeBuffer.lines.get(this._activeBuffer.ybase+F);T.insertCells(this._activeBuffer.x,E,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),T.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(m){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const E=m.params[0]||1;for(let F=this._activeBuffer.scrollTop;F<=this._activeBuffer.scrollBottom;++F){const T=this._activeBuffer.lines.get(this._activeBuffer.ybase+F);T.deleteCells(this._activeBuffer.x,E,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),T.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(m){this._restrictCursor();const E=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return E&&(E.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(m.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(m){if(!this._parser.precedingCodepoint)return!0;const E=m.params[0]||1,F=new Uint32Array(E);for(let T=0;T<E;++T)F[T]=this._parser.precedingCodepoint;return this.print(F,0,F.length),!0}sendDeviceAttributesPrimary(m){return m.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(_.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(_.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(m){return m.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(_.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(_.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(m.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(_.C0.ESC+"[>83;40003;0c")),!0}_is(m){return(this._optionsService.rawOptions.termName+"").indexOf(m)===0}setMode(m){for(let E=0;E<m.length;E++)switch(m.params[E]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(m){for(let E=0;E<m.length;E++)switch(m.params[E]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,u.DEFAULT_CHARSET),this._charsetService.setgCharset(1,u.DEFAULT_CHARSET),this._charsetService.setgCharset(2,u.DEFAULT_CHARSET),this._charsetService.setgCharset(3,u.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(m){for(let E=0;E<m.length;E++)switch(m.params[E]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(m){for(let E=0;E<m.length;E++)switch(m.params[E]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),m.params[E]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(m,E){const F=this._coreService.decPrivateModes,{activeProtocol:T,activeEncoding:U}=this._coreMouseService,z=this._coreService,{buffers:V,cols:W}=this._bufferService,{active:q,alt:x}=V,B=this._optionsService.rawOptions,I=K=>K?1:2,H=m.params[0];return $=H,J=E?H===2?3:H===4?I(z.modes.insertMode):H===12?4:H===20?I(B.convertEol):0:H===1?I(F.applicationCursorKeys):H===3?B.windowOptions.setWinLines?W===80?2:W===132?1:0:0:H===6?I(F.origin):H===7?I(F.wraparound):H===8?3:H===9?I(T==="X10"):H===12?I(B.cursorBlink):H===25?I(!z.isCursorHidden):H===45?I(F.reverseWraparound):H===66?I(F.applicationKeypad):H===1e3?I(T==="VT200"):H===1002?I(T==="DRAG"):H===1003?I(T==="ANY"):H===1004?I(F.sendFocus):H===1005?4:H===1006?I(U==="SGR"):H===1015?4:H===1016?I(U==="SGR_PIXELS"):H===1048?1:H===47||H===1047||H===1049?I(q===x):H===2004?I(F.bracketedPasteMode):0,z.triggerDataEvent(`${_.C0.ESC}[${E?"":"?"}${$};${J}$y`),!0;var $,J}_updateAttrColor(m,E,F,T,U){return E===2?(m|=50331648,m&=-16777216,m|=r.AttributeData.fromColorRGB([F,T,U])):E===5&&(m&=-50331904,m|=33554432|255&F),m}_extractColor(m,E,F){const T=[0,0,-1,0,0,0];let U=0,z=0;do{if(T[z+U]=m.params[E+z],m.hasSubParams(E+z)){const V=m.getSubParams(E+z);let W=0;do T[1]===5&&(U=1),T[z+W+1+U]=V[W];while(++W<V.length&&W+z+1+U<T.length);break}if(T[1]===5&&z+U>=2||T[1]===2&&z+U>=5)break;T[1]&&(U=1)}while(++z+E<m.length&&z+U<T.length);for(let V=2;V<T.length;++V)T[V]===-1&&(T[V]=0);switch(T[0]){case 38:F.fg=this._updateAttrColor(F.fg,T[1],T[3],T[4],T[5]);break;case 48:F.bg=this._updateAttrColor(F.bg,T[1],T[3],T[4],T[5]);break;case 58:F.extended=F.extended.clone(),F.extended.underlineColor=this._updateAttrColor(F.extended.underlineColor,T[1],T[3],T[4],T[5])}return z}_processUnderline(m,E){E.extended=E.extended.clone(),(!~m||m>5)&&(m=1),E.extended.underlineStyle=m,E.fg|=268435456,m===0&&(E.fg&=-268435457),E.updateExtended()}_processSGR0(m){m.fg=e.DEFAULT_ATTR_DATA.fg,m.bg=e.DEFAULT_ATTR_DATA.bg,m.extended=m.extended.clone(),m.extended.underlineStyle=0,m.extended.underlineColor&=-67108864,m.updateExtended()}charAttributes(m){if(m.length===1&&m.params[0]===0)return this._processSGR0(this._curAttrData),!0;const E=m.length;let F;const T=this._curAttrData;for(let U=0;U<E;U++)F=m.params[U],F>=30&&F<=37?(T.fg&=-50331904,T.fg|=16777216|F-30):F>=40&&F<=47?(T.bg&=-50331904,T.bg|=16777216|F-40):F>=90&&F<=97?(T.fg&=-50331904,T.fg|=16777224|F-90):F>=100&&F<=107?(T.bg&=-50331904,T.bg|=16777224|F-100):F===0?this._processSGR0(T):F===1?T.fg|=134217728:F===3?T.bg|=67108864:F===4?(T.fg|=268435456,this._processUnderline(m.hasSubParams(U)?m.getSubParams(U)[0]:1,T)):F===5?T.fg|=536870912:F===7?T.fg|=67108864:F===8?T.fg|=1073741824:F===9?T.fg|=2147483648:F===2?T.bg|=134217728:F===21?this._processUnderline(2,T):F===22?(T.fg&=-134217729,T.bg&=-134217729):F===23?T.bg&=-67108865:F===24?(T.fg&=-268435457,this._processUnderline(0,T)):F===25?T.fg&=-536870913:F===27?T.fg&=-67108865:F===28?T.fg&=-1073741825:F===29?T.fg&=2147483647:F===39?(T.fg&=-67108864,T.fg|=16777215&e.DEFAULT_ATTR_DATA.fg):F===49?(T.bg&=-67108864,T.bg|=16777215&e.DEFAULT_ATTR_DATA.bg):F===38||F===48||F===58?U+=this._extractColor(m,U,T):F===59?(T.extended=T.extended.clone(),T.extended.underlineColor=-1,T.updateExtended()):F===100?(T.fg&=-67108864,T.fg|=16777215&e.DEFAULT_ATTR_DATA.fg,T.bg&=-67108864,T.bg|=16777215&e.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",F);return!0}deviceStatus(m){switch(m.params[0]){case 5:this._coreService.triggerDataEvent(`${_.C0.ESC}[0n`);break;case 6:const E=this._activeBuffer.y+1,F=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${_.C0.ESC}[${E};${F}R`)}return!0}deviceStatusPrivate(m){if(m.params[0]===6){const E=this._activeBuffer.y+1,F=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${_.C0.ESC}[?${E};${F}R`)}return!0}softReset(m){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=e.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(m){const E=m.params[0]||1;switch(E){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}const F=E%2==1;return this._optionsService.options.cursorBlink=F,!0}setScrollRegion(m){const E=m.params[0]||1;let F;return(m.length<2||(F=m.params[1])>this._bufferService.rows||F===0)&&(F=this._bufferService.rows),F>E&&(this._activeBuffer.scrollTop=E-1,this._activeBuffer.scrollBottom=F-1,this._setCursor(0,0)),!0}windowOptions(m){if(!L(m.params[0],this._optionsService.rawOptions.windowOptions))return!0;const E=m.length>1?m.params[1]:0;switch(m.params[0]){case 14:E!==2&&this._onRequestWindowsOptionsReport.fire(A.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(A.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${_.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:E!==0&&E!==2||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),E!==0&&E!==1||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:E!==0&&E!==2||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),E!==0&&E!==1||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(m){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(m){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(m){return this._windowTitle=m,this._onTitleChange.fire(m),!0}setIconName(m){return this._iconName=m,!0}setOrReportIndexedColor(m){const E=[],F=m.split(";");for(;F.length>1;){const T=F.shift(),U=F.shift();if(/^\d+$/.exec(T)){const z=parseInt(T);if(0<=z&&z<256)if(U==="?")E.push({type:0,index:z});else{const V=(0,l.parseColor)(U);V&&E.push({type:1,index:z,color:V})}}}return E.length&&this._onColor.fire(E),!0}setHyperlink(m){const E=m.split(";");return!(E.length<2)&&(E[1]?this._createHyperlink(E[0],E[1]):!E[0]&&this._finishHyperlink())}_createHyperlink(m,E){this._getCurrentLinkId()&&this._finishHyperlink();const F=m.split(":");let T;const U=F.findIndex(z=>z.startsWith("id="));return U!==-1&&(T=F[U].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:T,uri:E}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(m,E){const F=m.split(";");for(let T=0;T<F.length&&!(E>=this._specialColors.length);++T,++E)if(F[T]==="?")this._onColor.fire([{type:0,index:this._specialColors[E]}]);else{const U=(0,l.parseColor)(F[T]);U&&this._onColor.fire([{type:1,index:this._specialColors[E],color:U}])}return!0}setOrReportFgColor(m){return this._setOrReportSpecialColor(m,0)}setOrReportBgColor(m){return this._setOrReportSpecialColor(m,1)}setOrReportCursorColor(m){return this._setOrReportSpecialColor(m,2)}restoreIndexedColor(m){if(!m)return this._onColor.fire([{type:2}]),!0;const E=[],F=m.split(";");for(let T=0;T<F.length;++T)if(/^\d+$/.exec(F[T])){const U=parseInt(F[T]);0<=U&&U<256&&E.push({type:2,index:U})}return E.length&&this._onColor.fire(E),!0}restoreFgColor(m){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(m){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(m){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,u.DEFAULT_CHARSET),!0}selectCharset(m){return m.length!==2?(this.selectDefaultCharset(),!0):(m[0]==="/"||this._charsetService.setgCharset(D[m[0]],u.CHARSETS[m[1]]||u.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){const m=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,m,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=e.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=e.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(m){return this._charsetService.setgLevel(m),!0}screenAlignmentPattern(){const m=new i.CellData;m.content=4194304|"E".charCodeAt(0),m.fg=this._curAttrData.fg,m.bg=this._curAttrData.bg,this._setCursor(0,0);for(let E=0;E<this._bufferService.rows;++E){const F=this._activeBuffer.ybase+this._activeBuffer.y+E,T=this._activeBuffer.lines.get(F);T&&(T.fill(m),T.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(m,E){const F=this._bufferService.buffer,T=this._optionsService.rawOptions;return(U=>(this._coreService.triggerDataEvent(`${_.C0.ESC}${U}${_.C0.ESC}\\`),!0))(m==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:m==='"p'?'P1$r61;1"p':m==="r"?`P1$r${F.scrollTop+1};${F.scrollBottom+1}r`:m==="m"?"P1$r0m":m===" q"?`P1$r${{block:2,underline:4,bar:6}[T.cursorStyle]-(T.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(m,E){this._dirtyRowTracker.markRangeDirty(m,E)}}t.InputHandler=P;let N=class{constructor(j){this._bufferService=j,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(j){j<this.start?this.start=j:j>this.end&&(this.end=j)}markRangeDirty(j,m){j>m&&(M=j,j=m,m=M),j<this.start&&(this.start=j),m>this.end&&(this.end=m)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};N=h([a(0,d.IBufferService)],N)},844:(R,t)=>{function n(h){for(const a of h)a.dispose();h.length=0}Object.defineProperty(t,"__esModule",{value:!0}),t.getDisposeArrayDisposable=t.disposeArray=t.toDisposable=t.Disposable=void 0,t.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const h of this._disposables)h.dispose();this._disposables.length=0}register(h){return this._disposables.push(h),h}unregister(h){const a=this._disposables.indexOf(h);a!==-1&&this._disposables.splice(a,1)}},t.toDisposable=function(h){return{dispose:h}},t.disposeArray=n,t.getDisposeArrayDisposable=function(h){return{dispose:()=>n(h)}}},1505:(R,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FourKeyMap=t.TwoKeyMap=void 0;class n{constructor(){this._data={}}set(a,_,u){this._data[a]||(this._data[a]={}),this._data[a][_]=u}get(a,_){return this._data[a]?this._data[a][_]:void 0}clear(){this._data={}}}t.TwoKeyMap=n,t.FourKeyMap=class{constructor(){this._data=new n}set(h,a,_,u,p){this._data.get(h,a)||this._data.set(h,a,new n),this._data.get(h,a).set(_,u,p)}get(h,a,_,u){var p;return(p=this._data.get(h,a))===null||p===void 0?void 0:p.get(_,u)}clear(){this._data.clear()}}},6114:(R,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isChromeOS=t.isLinux=t.isWindows=t.isIphone=t.isIpad=t.isMac=t.getSafariVersion=t.isSafari=t.isLegacyEdge=t.isFirefox=t.isNode=void 0,t.isNode=typeof navigator>"u";const n=t.isNode?"node":navigator.userAgent,h=t.isNode?"node":navigator.platform;t.isFirefox=n.includes("Firefox"),t.isLegacyEdge=n.includes("Edge"),t.isSafari=/^((?!chrome|android).)*safari/i.test(n),t.getSafariVersion=function(){if(!t.isSafari)return 0;const a=n.match(/Version\/(\d+)/);return a===null||a.length<2?0:parseInt(a[1])},t.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(h),t.isIpad=h==="iPad",t.isIphone=h==="iPhone",t.isWindows=["Windows","Win16","Win32","WinCE"].includes(h),t.isLinux=h.indexOf("Linux")>=0,t.isChromeOS=/\bCrOS\b/.test(n)},6106:(R,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SortedList=void 0;let n=0;t.SortedList=class{constructor(h){this._getKey=h,this._array=[]}clear(){this._array.length=0}insert(h){this._array.length!==0?(n=this._search(this._getKey(h),0,this._array.length-1),this._array.splice(n,0,h)):this._array.push(h)}delete(h){if(this._array.length===0)return!1;const a=this._getKey(h);if(a===void 0||(n=this._search(a,0,this._array.length-1),n===-1)||this._getKey(this._array[n])!==a)return!1;do if(this._array[n]===h)return this._array.splice(n,1),!0;while(++n<this._array.length&&this._getKey(this._array[n])===a);return!1}*getKeyIterator(h){if(this._array.length!==0&&(n=this._search(h,0,this._array.length-1),!(n<0||n>=this._array.length)&&this._getKey(this._array[n])===h))do yield this._array[n];while(++n<this._array.length&&this._getKey(this._array[n])===h)}forEachByKey(h,a){if(this._array.length!==0&&(n=this._search(h,0,this._array.length-1),!(n<0||n>=this._array.length)&&this._getKey(this._array[n])===h))do a(this._array[n]);while(++n<this._array.length&&this._getKey(this._array[n])===h)}values(){return this._array.values()}_search(h,a,_){if(_<a)return a;let u=Math.floor((a+_)/2);const p=this._getKey(this._array[u]);if(p>h)return this._search(h,a,u-1);if(p<h)return this._search(h,u+1,_);for(;u>0&&this._getKey(this._array[u-1])===h;)u--;return u}}},7226:(R,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DebouncedIdleTask=t.IdleTaskQueue=t.PriorityTaskQueue=void 0;const h=n(6114);class a{constructor(){this._tasks=[],this._i=0}enqueue(p){this._tasks.push(p),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(p){this._idleCallback=void 0;let v=0,c=0,e=p.timeRemaining(),s=0;for(;this._i<this._tasks.length;){if(v=Date.now(),this._tasks[this._i]()||this._i++,v=Math.max(1,Date.now()-v),c=Math.max(v,c),s=p.timeRemaining(),1.5*c>s)return e-v<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(e-v))}ms`),void this._start();e=s}this.clear()}}class _ extends a{_requestCallback(p){return setTimeout(()=>p(this._createDeadline(16)))}_cancelCallback(p){clearTimeout(p)}_createDeadline(p){const v=Date.now()+p;return{timeRemaining:()=>Math.max(0,v-Date.now())}}}t.PriorityTaskQueue=_,t.IdleTaskQueue=!h.isNode&&"requestIdleCallback"in window?class extends a{_requestCallback(u){return requestIdleCallback(u)}_cancelCallback(u){cancelIdleCallback(u)}}:_,t.DebouncedIdleTask=class{constructor(){this._queue=new t.IdleTaskQueue}set(u){this._queue.clear(),this._queue.enqueue(u)}flush(){this._queue.flush()}}},9282:(R,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.updateWindowsModeWrappedState=void 0;const h=n(643);t.updateWindowsModeWrappedState=function(a){const _=a.buffer.lines.get(a.buffer.ybase+a.buffer.y-1),u=_?.get(a.cols-1),p=a.buffer.lines.get(a.buffer.ybase+a.buffer.y);p&&u&&(p.isWrapped=u[h.CHAR_DATA_CODE_INDEX]!==h.NULL_CELL_CODE&&u[h.CHAR_DATA_CODE_INDEX]!==h.WHITESPACE_CELL_CODE)}},3734:(R,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExtendedAttrs=t.AttributeData=void 0;class n{constructor(){this.fg=0,this.bg=0,this.extended=new h}static toColorRGB(_){return[_>>>16&255,_>>>8&255,255&_]}static fromColorRGB(_){return(255&_[0])<<16|(255&_[1])<<8|255&_[2]}clone(){const _=new n;return _.fg=this.fg,_.bg=this.bg,_.extended=this.extended.clone(),_}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}}t.AttributeData=n;class h{constructor(_=0,u=0){this._ext=0,this._urlId=0,this._ext=_,this._urlId=u}get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(_){this._ext=_}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(_){this._ext&=-469762049,this._ext|=_<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(_){this._ext&=-67108864,this._ext|=67108863&_}get urlId(){return this._urlId}set urlId(_){this._urlId=_}clone(){return new h(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}t.ExtendedAttrs=h},9092:(R,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferStringIterator=t.Buffer=t.MAX_BUFFER_SIZE=void 0;const h=n(6349),a=n(8437),_=n(511),u=n(643),p=n(4634),v=n(4863),c=n(7116),e=n(3734),s=n(7226);t.MAX_BUFFER_SIZE=4294967295,t.Buffer=class{constructor(i,r,d){this._hasScrollback=i,this._optionsService=r,this._bufferService=d,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=a.DEFAULT_ATTR_DATA.clone(),this.savedCharset=c.DEFAULT_CHARSET,this.markers=[],this._nullCell=_.CellData.fromCharData([0,u.NULL_CELL_CHAR,u.NULL_CELL_WIDTH,u.NULL_CELL_CODE]),this._whitespaceCell=_.CellData.fromCharData([0,u.WHITESPACE_CELL_CHAR,u.WHITESPACE_CELL_WIDTH,u.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new s.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new h.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(i){return i?(this._nullCell.fg=i.fg,this._nullCell.bg=i.bg,this._nullCell.extended=i.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new e.ExtendedAttrs),this._nullCell}getWhitespaceCell(i){return i?(this._whitespaceCell.fg=i.fg,this._whitespaceCell.bg=i.bg,this._whitespaceCell.extended=i.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new e.ExtendedAttrs),this._whitespaceCell}getBlankLine(i,r){return new a.BufferLine(this._bufferService.cols,this.getNullCell(i),r)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){const i=this.ybase+this.y-this.ydisp;return i>=0&&i<this._rows}_getCorrectBufferLength(i){if(!this._hasScrollback)return i;const r=i+this._optionsService.rawOptions.scrollback;return r>t.MAX_BUFFER_SIZE?t.MAX_BUFFER_SIZE:r}fillViewportRows(i){if(this.lines.length===0){i===void 0&&(i=a.DEFAULT_ATTR_DATA);let r=this._rows;for(;r--;)this.lines.push(this.getBlankLine(i))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new h.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(i,r){const d=this.getNullCell(a.DEFAULT_ATTR_DATA);let g=0;const S=this._getCorrectBufferLength(r);if(S>this.lines.maxLength&&(this.lines.maxLength=S),this.lines.length>0){if(this._cols<i)for(let D=0;D<this.lines.length;D++)g+=+this.lines.get(D).resize(i,d);let l=0;if(this._rows<r)for(let D=this._rows;D<r;D++)this.lines.length<r+this.ybase&&(this._optionsService.rawOptions.windowsMode?this.lines.push(new a.BufferLine(i,d)):this.ybase>0&&this.lines.length<=this.ybase+this.y+l+1?(this.ybase--,l++,this.ydisp>0&&this.ydisp--):this.lines.push(new a.BufferLine(i,d)));else for(let D=this._rows;D>r;D--)this.lines.length>r+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(S<this.lines.maxLength){const D=this.lines.length-S;D>0&&(this.lines.trimStart(D),this.ybase=Math.max(this.ybase-D,0),this.ydisp=Math.max(this.ydisp-D,0),this.savedY=Math.max(this.savedY-D,0)),this.lines.maxLength=S}this.x=Math.min(this.x,i-1),this.y=Math.min(this.y,r-1),l&&(this.y+=l),this.savedX=Math.min(this.savedX,i-1),this.scrollTop=0}if(this.scrollBottom=r-1,this._isReflowEnabled&&(this._reflow(i,r),this._cols>i))for(let l=0;l<this.lines.length;l++)g+=+this.lines.get(l).resize(i,d);this._cols=i,this._rows=r,this._memoryCleanupQueue.clear(),g>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let i=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,i=!1);let r=0;for(;this._memoryCleanupPosition<this.lines.length;)if(r+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),r>100)return!0;return i}get _isReflowEnabled(){return this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(i,r){this._cols!==i&&(i>this._cols?this._reflowLarger(i,r):this._reflowSmaller(i,r))}_reflowLarger(i,r){const d=(0,p.reflowLargerGetLinesToRemove)(this.lines,this._cols,i,this.ybase+this.y,this.getNullCell(a.DEFAULT_ATTR_DATA));if(d.length>0){const g=(0,p.reflowLargerCreateNewLayout)(this.lines,d);(0,p.reflowLargerApplyNewLayout)(this.lines,g.layout),this._reflowLargerAdjustViewport(i,r,g.countRemoved)}}_reflowLargerAdjustViewport(i,r,d){const g=this.getNullCell(a.DEFAULT_ATTR_DATA);let S=d;for(;S-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<r&&this.lines.push(new a.BufferLine(i,g))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-d,0)}_reflowSmaller(i,r){const d=this.getNullCell(a.DEFAULT_ATTR_DATA),g=[];let S=0;for(let l=this.lines.length-1;l>=0;l--){let D=this.lines.get(l);if(!D||!D.isWrapped&&D.getTrimmedLength()<=i)continue;const y=[D];for(;D.isWrapped&&l>0;)D=this.lines.get(--l),y.unshift(D);const L=this.ybase+this.y;if(L>=l&&L<l+y.length)continue;const A=y[y.length-1].getTrimmedLength(),M=(0,p.reflowSmallerGetNewLineLengths)(y,this._cols,i),P=M.length-y.length;let N;N=this.ybase===0&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+P):Math.max(0,this.lines.length-this.lines.maxLength+P);const j=[];for(let z=0;z<P;z++){const V=this.getBlankLine(a.DEFAULT_ATTR_DATA,!0);j.push(V)}j.length>0&&(g.push({start:l+y.length+S,newLines:j}),S+=j.length),y.push(...j);let m=M.length-1,E=M[m];E===0&&(m--,E=M[m]);let F=y.length-P-1,T=A;for(;F>=0;){const z=Math.min(T,E);if(y[m]===void 0)break;if(y[m].copyCellsFrom(y[F],T-z,E-z,z,!0),E-=z,E===0&&(m--,E=M[m]),T-=z,T===0){F--;const V=Math.max(F,0);T=(0,p.getWrappedLineTrimmedLength)(y,V,this._cols)}}for(let z=0;z<y.length;z++)M[z]<i&&y[z].setCell(M[z],d);let U=P-N;for(;U-- >0;)this.ybase===0?this.y<r-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+S)-r&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+P,this.ybase+r-1)}if(g.length>0){const l=[],D=[];for(let m=0;m<this.lines.length;m++)D.push(this.lines.get(m));const y=this.lines.length;let L=y-1,A=0,M=g[A];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+S);let P=0;for(let m=Math.min(this.lines.maxLength-1,y+S-1);m>=0;m--)if(M&&M.start>L+P){for(let E=M.newLines.length-1;E>=0;E--)this.lines.set(m--,M.newLines[E]);m++,l.push({index:L+1,amount:M.newLines.length}),P+=M.newLines.length,M=g[++A]}else this.lines.set(m,D[L--]);let N=0;for(let m=l.length-1;m>=0;m--)l[m].index+=N,this.lines.onInsertEmitter.fire(l[m]),N+=l[m].amount;const j=Math.max(0,y+S-this.lines.maxLength);j>0&&this.lines.onTrimEmitter.fire(j)}}stringIndexToBufferIndex(i,r,d=!1){for(;r;){const g=this.lines.get(i);if(!g)return[-1,-1];const S=d?g.getTrimmedLength():g.length;for(let l=0;l<S;++l)if(g.get(l)[u.CHAR_DATA_WIDTH_INDEX]&&(r-=g.get(l)[u.CHAR_DATA_CHAR_INDEX].length||1),r<0)return[i,l];i++}return[i,0]}translateBufferLineToString(i,r,d=0,g){const S=this.lines.get(i);return S?S.translateToString(r,d,g):""}getWrappedRangeForLine(i){let r=i,d=i;for(;r>0&&this.lines.get(r).isWrapped;)r--;for(;d+1<this.lines.length&&this.lines.get(d+1).isWrapped;)d++;return{first:r,last:d}}setupTabStops(i){for(i!=null?this.tabs[i]||(i=this.prevStop(i)):(this.tabs={},i=0);i<this._cols;i+=this._optionsService.rawOptions.tabStopWidth)this.tabs[i]=!0}prevStop(i){for(i==null&&(i=this.x);!this.tabs[--i]&&i>0;);return i>=this._cols?this._cols-1:i<0?0:i}nextStop(i){for(i==null&&(i=this.x);!this.tabs[++i]&&i<this._cols;);return i>=this._cols?this._cols-1:i<0?0:i}clearMarkers(i){this._isClearing=!0;for(let r=0;r<this.markers.length;r++)this.markers[r].line===i&&(this.markers[r].dispose(),this.markers.splice(r--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let i=0;i<this.markers.length;i++)this.markers[i].dispose(),this.markers.splice(i--,1);this._isClearing=!1}addMarker(i){const r=new v.Marker(i);return this.markers.push(r),r.register(this.lines.onTrim(d=>{r.line-=d,r.line<0&&r.dispose()})),r.register(this.lines.onInsert(d=>{r.line>=d.index&&(r.line+=d.amount)})),r.register(this.lines.onDelete(d=>{r.line>=d.index&&r.line<d.index+d.amount&&r.dispose(),r.line>d.index&&(r.line-=d.amount)})),r.register(r.onDispose(()=>this._removeMarker(r))),r}_removeMarker(i){this._isClearing||this.markers.splice(this.markers.indexOf(i),1)}iterator(i,r,d,g,S){return new o(this,i,r,d,g,S)}};class o{constructor(r,d,g=0,S=r.lines.length,l=0,D=0){this._buffer=r,this._trimRight=d,this._startIndex=g,this._endIndex=S,this._startOverscan=l,this._endOverscan=D,this._startIndex<0&&(this._startIndex=0),this._endIndex>this._buffer.lines.length&&(this._endIndex=this._buffer.lines.length),this._current=this._startIndex}hasNext(){return this._current<this._endIndex}next(){const r=this._buffer.getWrappedRangeForLine(this._current);r.first<this._startIndex-this._startOverscan&&(r.first=this._startIndex-this._startOverscan),r.last>this._endIndex+this._endOverscan&&(r.last=this._endIndex+this._endOverscan),r.first=Math.max(r.first,0),r.last=Math.min(r.last,this._buffer.lines.length);let d="";for(let g=r.first;g<=r.last;++g)d+=this._buffer.translateBufferLineToString(g,this._trimRight);return this._current=r.last+1,{range:r,content:d}}}t.BufferStringIterator=o},8437:(R,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferLine=t.DEFAULT_ATTR_DATA=void 0;const h=n(482),a=n(643),_=n(511),u=n(3734);t.DEFAULT_ATTR_DATA=Object.freeze(new u.AttributeData);let p=0;class v{constructor(e,s,o=!1){this.isWrapped=o,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*e);const i=s||_.CellData.fromCharData([0,a.NULL_CELL_CHAR,a.NULL_CELL_WIDTH,a.NULL_CELL_CODE]);for(let r=0;r<e;++r)this.setCell(r,i);this.length=e}get(e){const s=this._data[3*e+0],o=2097151&s;return[this._data[3*e+1],2097152&s?this._combined[e]:o?(0,h.stringFromCodePoint)(o):"",s>>22,2097152&s?this._combined[e].charCodeAt(this._combined[e].length-1):o]}set(e,s){this._data[3*e+1]=s[a.CHAR_DATA_ATTR_INDEX],s[a.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[e]=s[1],this._data[3*e+0]=2097152|e|s[a.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*e+0]=s[a.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|s[a.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(e){return this._data[3*e+0]>>22}hasWidth(e){return 12582912&this._data[3*e+0]}getFg(e){return this._data[3*e+1]}getBg(e){return this._data[3*e+2]}hasContent(e){return 4194303&this._data[3*e+0]}getCodePoint(e){const s=this._data[3*e+0];return 2097152&s?this._combined[e].charCodeAt(this._combined[e].length-1):2097151&s}isCombined(e){return 2097152&this._data[3*e+0]}getString(e){const s=this._data[3*e+0];return 2097152&s?this._combined[e]:2097151&s?(0,h.stringFromCodePoint)(2097151&s):""}isProtected(e){return 536870912&this._data[3*e+2]}loadCell(e,s){return p=3*e,s.content=this._data[p+0],s.fg=this._data[p+1],s.bg=this._data[p+2],2097152&s.content&&(s.combinedData=this._combined[e]),268435456&s.bg&&(s.extended=this._extendedAttrs[e]),s}setCell(e,s){2097152&s.content&&(this._combined[e]=s.combinedData),268435456&s.bg&&(this._extendedAttrs[e]=s.extended),this._data[3*e+0]=s.content,this._data[3*e+1]=s.fg,this._data[3*e+2]=s.bg}setCellFromCodePoint(e,s,o,i,r,d){268435456&r&&(this._extendedAttrs[e]=d),this._data[3*e+0]=s|o<<22,this._data[3*e+1]=i,this._data[3*e+2]=r}addCodepointToCell(e,s){let o=this._data[3*e+0];2097152&o?this._combined[e]+=(0,h.stringFromCodePoint)(s):(2097151&o?(this._combined[e]=(0,h.stringFromCodePoint)(2097151&o)+(0,h.stringFromCodePoint)(s),o&=-2097152,o|=2097152):o=s|4194304,this._data[3*e+0]=o)}insertCells(e,s,o,i){if((e%=this.length)&&this.getWidth(e-1)===2&&this.setCellFromCodePoint(e-1,0,1,i?.fg||0,i?.bg||0,i?.extended||new u.ExtendedAttrs),s<this.length-e){const r=new _.CellData;for(let d=this.length-e-s-1;d>=0;--d)this.setCell(e+s+d,this.loadCell(e+d,r));for(let d=0;d<s;++d)this.setCell(e+d,o)}else for(let r=e;r<this.length;++r)this.setCell(r,o);this.getWidth(this.length-1)===2&&this.setCellFromCodePoint(this.length-1,0,1,i?.fg||0,i?.bg||0,i?.extended||new u.ExtendedAttrs)}deleteCells(e,s,o,i){if(e%=this.length,s<this.length-e){const r=new _.CellData;for(let d=0;d<this.length-e-s;++d)this.setCell(e+d,this.loadCell(e+s+d,r));for(let d=this.length-s;d<this.length;++d)this.setCell(d,o)}else for(let r=e;r<this.length;++r)this.setCell(r,o);e&&this.getWidth(e-1)===2&&this.setCellFromCodePoint(e-1,0,1,i?.fg||0,i?.bg||0,i?.extended||new u.ExtendedAttrs),this.getWidth(e)!==0||this.hasContent(e)||this.setCellFromCodePoint(e,0,1,i?.fg||0,i?.bg||0,i?.extended||new u.ExtendedAttrs)}replaceCells(e,s,o,i,r=!1){if(r)for(e&&this.getWidth(e-1)===2&&!this.isProtected(e-1)&&this.setCellFromCodePoint(e-1,0,1,i?.fg||0,i?.bg||0,i?.extended||new u.ExtendedAttrs),s<this.length&&this.getWidth(s-1)===2&&!this.isProtected(s)&&this.setCellFromCodePoint(s,0,1,i?.fg||0,i?.bg||0,i?.extended||new u.ExtendedAttrs);e<s&&e<this.length;)this.isProtected(e)||this.setCell(e,o),e++;else for(e&&this.getWidth(e-1)===2&&this.setCellFromCodePoint(e-1,0,1,i?.fg||0,i?.bg||0,i?.extended||new u.ExtendedAttrs),s<this.length&&this.getWidth(s-1)===2&&this.setCellFromCodePoint(s,0,1,i?.fg||0,i?.bg||0,i?.extended||new u.ExtendedAttrs);e<s&&e<this.length;)this.setCell(e++,o)}resize(e,s){if(e===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;const o=3*e;if(e>this.length){if(this._data.buffer.byteLength>=4*o)this._data=new Uint32Array(this._data.buffer,0,o);else{const i=new Uint32Array(o);i.set(this._data),this._data=i}for(let i=this.length;i<e;++i)this.setCell(i,s)}else{this._data=this._data.subarray(0,o);const i=Object.keys(this._combined);for(let d=0;d<i.length;d++){const g=parseInt(i[d],10);g>=e&&delete this._combined[g]}const r=Object.keys(this._extendedAttrs);for(let d=0;d<r.length;d++){const g=parseInt(r[d],10);g>=e&&delete this._extendedAttrs[g]}}return this.length=e,4*o*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){const e=new Uint32Array(this._data.length);return e.set(this._data),this._data=e,1}return 0}fill(e,s=!1){if(s)for(let o=0;o<this.length;++o)this.isProtected(o)||this.setCell(o,e);else{this._combined={},this._extendedAttrs={};for(let o=0;o<this.length;++o)this.setCell(o,e)}}copyFrom(e){this.length!==e.length?this._data=new Uint32Array(e._data):this._data.set(e._data),this.length=e.length,this._combined={};for(const s in e._combined)this._combined[s]=e._combined[s];this._extendedAttrs={};for(const s in e._extendedAttrs)this._extendedAttrs[s]=e._extendedAttrs[s];this.isWrapped=e.isWrapped}clone(){const e=new v(0);e._data=new Uint32Array(this._data),e.length=this.length;for(const s in this._combined)e._combined[s]=this._combined[s];for(const s in this._extendedAttrs)e._extendedAttrs[s]=this._extendedAttrs[s];return e.isWrapped=this.isWrapped,e}getTrimmedLength(){for(let e=this.length-1;e>=0;--e)if(4194303&this._data[3*e+0])return e+(this._data[3*e+0]>>22);return 0}copyCellsFrom(e,s,o,i,r){const d=e._data;if(r)for(let S=i-1;S>=0;S--){for(let l=0;l<3;l++)this._data[3*(o+S)+l]=d[3*(s+S)+l];268435456&d[3*(s+S)+2]&&(this._extendedAttrs[o+S]=e._extendedAttrs[s+S])}else for(let S=0;S<i;S++){for(let l=0;l<3;l++)this._data[3*(o+S)+l]=d[3*(s+S)+l];268435456&d[3*(s+S)+2]&&(this._extendedAttrs[o+S]=e._extendedAttrs[s+S])}const g=Object.keys(e._combined);for(let S=0;S<g.length;S++){const l=parseInt(g[S],10);l>=s&&(this._combined[l-s+o]=e._combined[l])}}translateToString(e=!1,s=0,o=this.length){e&&(o=Math.min(o,this.getTrimmedLength()));let i="";for(;s<o;){const r=this._data[3*s+0],d=2097151&r;i+=2097152&r?this._combined[s]:d?(0,h.stringFromCodePoint)(d):a.WHITESPACE_CELL_CHAR,s+=r>>22||1}return i}}t.BufferLine=v},4841:(R,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getRangeLength=void 0,t.getRangeLength=function(n,h){if(n.start.y>n.end.y)throw new Error(`Buffer range end (${n.end.x}, ${n.end.y}) cannot be before start (${n.start.x}, ${n.start.y})`);return h*(n.end.y-n.start.y)+(n.end.x-n.start.x+1)}},4634:(R,t)=>{function n(h,a,_){if(a===h.length-1)return h[a].getTrimmedLength();const u=!h[a].hasContent(_-1)&&h[a].getWidth(_-1)===1,p=h[a+1].getWidth(0)===2;return u&&p?_-1:_}Object.defineProperty(t,"__esModule",{value:!0}),t.getWrappedLineTrimmedLength=t.reflowSmallerGetNewLineLengths=t.reflowLargerApplyNewLayout=t.reflowLargerCreateNewLayout=t.reflowLargerGetLinesToRemove=void 0,t.reflowLargerGetLinesToRemove=function(h,a,_,u,p){const v=[];for(let c=0;c<h.length-1;c++){let e=c,s=h.get(++e);if(!s.isWrapped)continue;const o=[h.get(c)];for(;e<h.length&&s.isWrapped;)o.push(s),s=h.get(++e);if(u>=c&&u<e){c+=o.length-1;continue}let i=0,r=n(o,i,a),d=1,g=0;for(;d<o.length;){const l=n(o,d,a),D=l-g,y=_-r,L=Math.min(D,y);o[i].copyCellsFrom(o[d],g,r,L,!1),r+=L,r===_&&(i++,r=0),g+=L,g===l&&(d++,g=0),r===0&&i!==0&&o[i-1].getWidth(_-1)===2&&(o[i].copyCellsFrom(o[i-1],_-1,r++,1,!1),o[i-1].setCell(_-1,p))}o[i].replaceCells(r,_,p);let S=0;for(let l=o.length-1;l>0&&(l>i||o[l].getTrimmedLength()===0);l--)S++;S>0&&(v.push(c+o.length-S),v.push(S)),c+=o.length-1}return v},t.reflowLargerCreateNewLayout=function(h,a){const _=[];let u=0,p=a[u],v=0;for(let c=0;c<h.length;c++)if(p===c){const e=a[++u];h.onDeleteEmitter.fire({index:c-v,amount:e}),c+=e-1,v+=e,p=a[++u]}else _.push(c);return{layout:_,countRemoved:v}},t.reflowLargerApplyNewLayout=function(h,a){const _=[];for(let u=0;u<a.length;u++)_.push(h.get(a[u]));for(let u=0;u<_.length;u++)h.set(u,_[u]);h.length=a.length},t.reflowSmallerGetNewLineLengths=function(h,a,_){const u=[],p=h.map((s,o)=>n(h,o,a)).reduce((s,o)=>s+o);let v=0,c=0,e=0;for(;e<p;){if(p-e<_){u.push(p-e);break}v+=_;const s=n(h,c,a);v>s&&(v-=s,c++);const o=h[c].getWidth(v-1)===2;o&&v--;const i=o?_-1:_;u.push(i),e+=i}return u},t.getWrappedLineTrimmedLength=n},5295:(R,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferSet=void 0;const h=n(9092),a=n(8460),_=n(844);class u extends _.Disposable{constructor(v,c){super(),this._optionsService=v,this._bufferService=c,this._onBufferActivate=this.register(new a.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new h.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new h.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(v){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(v),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(v,c){this._normal.resize(v,c),this._alt.resize(v,c),this.setupTabStops(v)}setupTabStops(v){this._normal.setupTabStops(v),this._alt.setupTabStops(v)}}t.BufferSet=u},511:(R,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CellData=void 0;const h=n(482),a=n(643),_=n(3734);class u extends _.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new _.ExtendedAttrs,this.combinedData=""}static fromCharData(v){const c=new u;return c.setFromCharData(v),c}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,h.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(v){this.fg=v[a.CHAR_DATA_ATTR_INDEX],this.bg=0;let c=!1;if(v[a.CHAR_DATA_CHAR_INDEX].length>2)c=!0;else if(v[a.CHAR_DATA_CHAR_INDEX].length===2){const e=v[a.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=e&&e<=56319){const s=v[a.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=s&&s<=57343?this.content=1024*(e-55296)+s-56320+65536|v[a.CHAR_DATA_WIDTH_INDEX]<<22:c=!0}else c=!0}else this.content=v[a.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|v[a.CHAR_DATA_WIDTH_INDEX]<<22;c&&(this.combinedData=v[a.CHAR_DATA_CHAR_INDEX],this.content=2097152|v[a.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}t.CellData=u},643:(R,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WHITESPACE_CELL_CODE=t.WHITESPACE_CELL_WIDTH=t.WHITESPACE_CELL_CHAR=t.NULL_CELL_CODE=t.NULL_CELL_WIDTH=t.NULL_CELL_CHAR=t.CHAR_DATA_CODE_INDEX=t.CHAR_DATA_WIDTH_INDEX=t.CHAR_DATA_CHAR_INDEX=t.CHAR_DATA_ATTR_INDEX=t.DEFAULT_EXT=t.DEFAULT_ATTR=t.DEFAULT_COLOR=void 0,t.DEFAULT_COLOR=0,t.DEFAULT_ATTR=256|t.DEFAULT_COLOR<<9,t.DEFAULT_EXT=0,t.CHAR_DATA_ATTR_INDEX=0,t.CHAR_DATA_CHAR_INDEX=1,t.CHAR_DATA_WIDTH_INDEX=2,t.CHAR_DATA_CODE_INDEX=3,t.NULL_CELL_CHAR="",t.NULL_CELL_WIDTH=1,t.NULL_CELL_CODE=0,t.WHITESPACE_CELL_CHAR=" ",t.WHITESPACE_CELL_WIDTH=1,t.WHITESPACE_CELL_CODE=32},4863:(R,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Marker=void 0;const h=n(8460),a=n(844);class _{constructor(p){this.line=p,this.isDisposed=!1,this._disposables=[],this._id=_._nextId++,this._onDispose=this.register(new h.EventEmitter),this.onDispose=this._onDispose.event}get id(){return this._id}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,a.disposeArray)(this._disposables),this._disposables.length=0)}register(p){return this._disposables.push(p),p}}t.Marker=_,_._nextId=1},7116:(R,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_CHARSET=t.CHARSETS=void 0,t.CHARSETS={},t.DEFAULT_CHARSET=t.CHARSETS.B,t.CHARSETS[0]={"`":"◆",a:"▒",b:"␉",c:"␌",d:"␍",e:"␊",f:"°",g:"±",h:"␤",i:"␋",j:"┘",k:"┐",l:"┌",m:"└",n:"┼",o:"⎺",p:"⎻",q:"─",r:"⎼",s:"⎽",t:"├",u:"┤",v:"┴",w:"┬",x:"│",y:"≤",z:"≥","{":"π","|":"≠","}":"£","~":"·"},t.CHARSETS.A={"#":"£"},t.CHARSETS.B=void 0,t.CHARSETS[4]={"#":"£","@":"¾","[":"ij","\\":"½","]":"|","{":"¨","|":"f","}":"¼","~":"´"},t.CHARSETS.C=t.CHARSETS[5]={"[":"Ä","\\":"Ö","]":"Å","^":"Ü","`":"é","{":"ä","|":"ö","}":"å","~":"ü"},t.CHARSETS.R={"#":"£","@":"à","[":"°","\\":"ç","]":"§","{":"é","|":"ù","}":"è","~":"¨"},t.CHARSETS.Q={"@":"à","[":"â","\\":"ç","]":"ê","^":"î","`":"ô","{":"é","|":"ù","}":"è","~":"û"},t.CHARSETS.K={"@":"§","[":"Ä","\\":"Ö","]":"Ü","{":"ä","|":"ö","}":"ü","~":"ß"},t.CHARSETS.Y={"#":"£","@":"§","[":"°","\\":"ç","]":"é","`":"ù","{":"à","|":"ò","}":"è","~":"ì"},t.CHARSETS.E=t.CHARSETS[6]={"@":"Ä","[":"Æ","\\":"Ø","]":"Å","^":"Ü","`":"ä","{":"æ","|":"ø","}":"å","~":"ü"},t.CHARSETS.Z={"#":"£","@":"§","[":"¡","\\":"Ñ","]":"¿","{":"°","|":"ñ","}":"ç"},t.CHARSETS.H=t.CHARSETS[7]={"@":"É","[":"Ä","\\":"Ö","]":"Å","^":"Ü","`":"é","{":"ä","|":"ö","}":"å","~":"ü"},t.CHARSETS["="]={"#":"ù","@":"à","[":"é","\\":"ç","]":"ê","^":"î",_:"è","`":"ô","{":"ä","|":"ö","}":"ü","~":"û"}},2584:(R,t)=>{var n,h;Object.defineProperty(t,"__esModule",{value:!0}),t.C1_ESCAPED=t.C1=t.C0=void 0,function(a){a.NUL="\0",a.SOH="",a.STX="",a.ETX="",a.EOT="",a.ENQ="",a.ACK="",a.BEL="\x07",a.BS="\b",a.HT="	",a.LF=`
`,a.VT="\v",a.FF="\f",a.CR="\r",a.SO="",a.SI="",a.DLE="",a.DC1="",a.DC2="",a.DC3="",a.DC4="",a.NAK="",a.SYN="",a.ETB="",a.CAN="",a.EM="",a.SUB="",a.ESC="\x1B",a.FS="",a.GS="",a.RS="",a.US="",a.SP=" ",a.DEL=""}(n=t.C0||(t.C0={})),(h=t.C1||(t.C1={})).PAD="",h.HOP="",h.BPH="",h.NBH="",h.IND="",h.NEL="",h.SSA="",h.ESA="",h.HTS="",h.HTJ="",h.VTS="",h.PLD="",h.PLU="",h.RI="",h.SS2="",h.SS3="",h.DCS="",h.PU1="",h.PU2="",h.STS="",h.CCH="",h.MW="",h.SPA="",h.EPA="",h.SOS="",h.SGCI="",h.SCI="",h.CSI="",h.ST="",h.OSC="",h.PM="",h.APC="",(t.C1_ESCAPED||(t.C1_ESCAPED={})).ST=`${n.ESC}\\`},7399:(R,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateKeyboardEvent=void 0;const h=n(2584),a={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};t.evaluateKeyboardEvent=function(_,u,p,v){const c={type:0,cancel:!1,key:void 0},e=(_.shiftKey?1:0)|(_.altKey?2:0)|(_.ctrlKey?4:0)|(_.metaKey?8:0);switch(_.keyCode){case 0:_.key==="UIKeyInputUpArrow"?c.key=u?h.C0.ESC+"OA":h.C0.ESC+"[A":_.key==="UIKeyInputLeftArrow"?c.key=u?h.C0.ESC+"OD":h.C0.ESC+"[D":_.key==="UIKeyInputRightArrow"?c.key=u?h.C0.ESC+"OC":h.C0.ESC+"[C":_.key==="UIKeyInputDownArrow"&&(c.key=u?h.C0.ESC+"OB":h.C0.ESC+"[B");break;case 8:if(_.altKey){c.key=h.C0.ESC+h.C0.DEL;break}c.key=h.C0.DEL;break;case 9:if(_.shiftKey){c.key=h.C0.ESC+"[Z";break}c.key=h.C0.HT,c.cancel=!0;break;case 13:c.key=_.altKey?h.C0.ESC+h.C0.CR:h.C0.CR,c.cancel=!0;break;case 27:c.key=h.C0.ESC,_.altKey&&(c.key=h.C0.ESC+h.C0.ESC),c.cancel=!0;break;case 37:if(_.metaKey)break;e?(c.key=h.C0.ESC+"[1;"+(e+1)+"D",c.key===h.C0.ESC+"[1;3D"&&(c.key=h.C0.ESC+(p?"b":"[1;5D"))):c.key=u?h.C0.ESC+"OD":h.C0.ESC+"[D";break;case 39:if(_.metaKey)break;e?(c.key=h.C0.ESC+"[1;"+(e+1)+"C",c.key===h.C0.ESC+"[1;3C"&&(c.key=h.C0.ESC+(p?"f":"[1;5C"))):c.key=u?h.C0.ESC+"OC":h.C0.ESC+"[C";break;case 38:if(_.metaKey)break;e?(c.key=h.C0.ESC+"[1;"+(e+1)+"A",p||c.key!==h.C0.ESC+"[1;3A"||(c.key=h.C0.ESC+"[1;5A")):c.key=u?h.C0.ESC+"OA":h.C0.ESC+"[A";break;case 40:if(_.metaKey)break;e?(c.key=h.C0.ESC+"[1;"+(e+1)+"B",p||c.key!==h.C0.ESC+"[1;3B"||(c.key=h.C0.ESC+"[1;5B")):c.key=u?h.C0.ESC+"OB":h.C0.ESC+"[B";break;case 45:_.shiftKey||_.ctrlKey||(c.key=h.C0.ESC+"[2~");break;case 46:c.key=e?h.C0.ESC+"[3;"+(e+1)+"~":h.C0.ESC+"[3~";break;case 36:c.key=e?h.C0.ESC+"[1;"+(e+1)+"H":u?h.C0.ESC+"OH":h.C0.ESC+"[H";break;case 35:c.key=e?h.C0.ESC+"[1;"+(e+1)+"F":u?h.C0.ESC+"OF":h.C0.ESC+"[F";break;case 33:_.shiftKey?c.type=2:_.ctrlKey?c.key=h.C0.ESC+"[5;"+(e+1)+"~":c.key=h.C0.ESC+"[5~";break;case 34:_.shiftKey?c.type=3:_.ctrlKey?c.key=h.C0.ESC+"[6;"+(e+1)+"~":c.key=h.C0.ESC+"[6~";break;case 112:c.key=e?h.C0.ESC+"[1;"+(e+1)+"P":h.C0.ESC+"OP";break;case 113:c.key=e?h.C0.ESC+"[1;"+(e+1)+"Q":h.C0.ESC+"OQ";break;case 114:c.key=e?h.C0.ESC+"[1;"+(e+1)+"R":h.C0.ESC+"OR";break;case 115:c.key=e?h.C0.ESC+"[1;"+(e+1)+"S":h.C0.ESC+"OS";break;case 116:c.key=e?h.C0.ESC+"[15;"+(e+1)+"~":h.C0.ESC+"[15~";break;case 117:c.key=e?h.C0.ESC+"[17;"+(e+1)+"~":h.C0.ESC+"[17~";break;case 118:c.key=e?h.C0.ESC+"[18;"+(e+1)+"~":h.C0.ESC+"[18~";break;case 119:c.key=e?h.C0.ESC+"[19;"+(e+1)+"~":h.C0.ESC+"[19~";break;case 120:c.key=e?h.C0.ESC+"[20;"+(e+1)+"~":h.C0.ESC+"[20~";break;case 121:c.key=e?h.C0.ESC+"[21;"+(e+1)+"~":h.C0.ESC+"[21~";break;case 122:c.key=e?h.C0.ESC+"[23;"+(e+1)+"~":h.C0.ESC+"[23~";break;case 123:c.key=e?h.C0.ESC+"[24;"+(e+1)+"~":h.C0.ESC+"[24~";break;default:if(!_.ctrlKey||_.shiftKey||_.altKey||_.metaKey)if(p&&!v||!_.altKey||_.metaKey)!p||_.altKey||_.ctrlKey||_.shiftKey||!_.metaKey?_.key&&!_.ctrlKey&&!_.altKey&&!_.metaKey&&_.keyCode>=48&&_.key.length===1?c.key=_.key:_.key&&_.ctrlKey&&(_.key==="_"&&(c.key=h.C0.US),_.key==="@"&&(c.key=h.C0.NUL)):_.keyCode===65&&(c.type=1);else{const s=a[_.keyCode],o=s?.[_.shiftKey?1:0];if(o)c.key=h.C0.ESC+o;else if(_.keyCode>=65&&_.keyCode<=90){const i=_.ctrlKey?_.keyCode-64:_.keyCode+32;let r=String.fromCharCode(i);_.shiftKey&&(r=r.toUpperCase()),c.key=h.C0.ESC+r}else if(_.keyCode===32)c.key=h.C0.ESC+(_.ctrlKey?h.C0.NUL:" ");else if(_.key==="Dead"&&_.code.startsWith("Key")){let i=_.code.slice(3,4);_.shiftKey||(i=i.toLowerCase()),c.key=h.C0.ESC+i,c.cancel=!0}}else _.keyCode>=65&&_.keyCode<=90?c.key=String.fromCharCode(_.keyCode-64):_.keyCode===32?c.key=h.C0.NUL:_.keyCode>=51&&_.keyCode<=55?c.key=String.fromCharCode(_.keyCode-51+27):_.keyCode===56?c.key=h.C0.DEL:_.keyCode===219?c.key=h.C0.ESC:_.keyCode===220?c.key=h.C0.FS:_.keyCode===221&&(c.key=h.C0.GS)}return c}},482:(R,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Utf8ToUtf32=t.StringToUtf32=t.utf32ToString=t.stringFromCodePoint=void 0,t.stringFromCodePoint=function(n){return n>65535?(n-=65536,String.fromCharCode(55296+(n>>10))+String.fromCharCode(n%1024+56320)):String.fromCharCode(n)},t.utf32ToString=function(n,h=0,a=n.length){let _="";for(let u=h;u<a;++u){let p=n[u];p>65535?(p-=65536,_+=String.fromCharCode(55296+(p>>10))+String.fromCharCode(p%1024+56320)):_+=String.fromCharCode(p)}return _},t.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(n,h){const a=n.length;if(!a)return 0;let _=0,u=0;if(this._interim){const p=n.charCodeAt(u++);56320<=p&&p<=57343?h[_++]=1024*(this._interim-55296)+p-56320+65536:(h[_++]=this._interim,h[_++]=p),this._interim=0}for(let p=u;p<a;++p){const v=n.charCodeAt(p);if(55296<=v&&v<=56319){if(++p>=a)return this._interim=v,_;const c=n.charCodeAt(p);56320<=c&&c<=57343?h[_++]=1024*(v-55296)+c-56320+65536:(h[_++]=v,h[_++]=c)}else v!==65279&&(h[_++]=v)}return _}},t.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(n,h){const a=n.length;if(!a)return 0;let _,u,p,v,c=0,e=0,s=0;if(this.interim[0]){let r=!1,d=this.interim[0];d&=(224&d)==192?31:(240&d)==224?15:7;let g,S=0;for(;(g=63&this.interim[++S])&&S<4;)d<<=6,d|=g;const l=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,D=l-S;for(;s<D;){if(s>=a)return 0;if(g=n[s++],(192&g)!=128){s--,r=!0;break}this.interim[S++]=g,d<<=6,d|=63&g}r||(l===2?d<128?s--:h[c++]=d:l===3?d<2048||d>=55296&&d<=57343||d===65279||(h[c++]=d):d<65536||d>1114111||(h[c++]=d)),this.interim.fill(0)}const o=a-4;let i=s;for(;i<a;){for(;!(!(i<o)||128&(_=n[i])||128&(u=n[i+1])||128&(p=n[i+2])||128&(v=n[i+3]));)h[c++]=_,h[c++]=u,h[c++]=p,h[c++]=v,i+=4;if(_=n[i++],_<128)h[c++]=_;else if((224&_)==192){if(i>=a)return this.interim[0]=_,c;if(u=n[i++],(192&u)!=128){i--;continue}if(e=(31&_)<<6|63&u,e<128){i--;continue}h[c++]=e}else if((240&_)==224){if(i>=a)return this.interim[0]=_,c;if(u=n[i++],(192&u)!=128){i--;continue}if(i>=a)return this.interim[0]=_,this.interim[1]=u,c;if(p=n[i++],(192&p)!=128){i--;continue}if(e=(15&_)<<12|(63&u)<<6|63&p,e<2048||e>=55296&&e<=57343||e===65279)continue;h[c++]=e}else if((248&_)==240){if(i>=a)return this.interim[0]=_,c;if(u=n[i++],(192&u)!=128){i--;continue}if(i>=a)return this.interim[0]=_,this.interim[1]=u,c;if(p=n[i++],(192&p)!=128){i--;continue}if(i>=a)return this.interim[0]=_,this.interim[1]=u,this.interim[2]=p,c;if(v=n[i++],(192&v)!=128){i--;continue}if(e=(7&_)<<18|(63&u)<<12|(63&p)<<6|63&v,e<65536||e>1114111)continue;h[c++]=e}}return c}}},225:(R,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeV6=void 0;const n=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],h=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]];let a;t.UnicodeV6=class{constructor(){if(this.version="6",!a){a=new Uint8Array(65536),a.fill(1),a[0]=0,a.fill(0,1,32),a.fill(0,127,160),a.fill(2,4352,4448),a[9001]=2,a[9002]=2,a.fill(2,11904,42192),a[12351]=1,a.fill(2,44032,55204),a.fill(2,63744,64256),a.fill(2,65040,65050),a.fill(2,65072,65136),a.fill(2,65280,65377),a.fill(2,65504,65511);for(let _=0;_<n.length;++_)a.fill(0,n[_][0],n[_][1]+1)}}wcwidth(_){return _<32?0:_<127?1:_<65536?a[_]:function(u,p){let v,c=0,e=p.length-1;if(u<p[0][0]||u>p[e][1])return!1;for(;e>=c;)if(v=c+e>>1,u>p[v][1])c=v+1;else{if(!(u<p[v][0]))return!0;e=v-1}return!1}(_,h)?0:_>=131072&&_<=196605||_>=196608&&_<=262141?2:1}}},5981:(R,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WriteBuffer=void 0;const h=n(8460),a=n(844);class _ extends a.Disposable{constructor(p){super(),this._action=p,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new h.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(p,v){if(v!==void 0&&this._syncCalls>v)return void(this._syncCalls=0);if(this._pendingData+=p.length,this._writeBuffer.push(p),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let c;for(this._isSyncWriting=!0;c=this._writeBuffer.shift();){this._action(c);const e=this._callbacks.shift();e&&e()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(p,v){if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=p.length,this._writeBuffer.push(p),this._callbacks.push(v),void this._innerWrite();setTimeout(()=>this._innerWrite())}this._pendingData+=p.length,this._writeBuffer.push(p),this._callbacks.push(v)}_innerWrite(p=0,v=!0){const c=p||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){const e=this._writeBuffer[this._bufferOffset],s=this._action(e,v);if(s){const i=r=>Date.now()-c>=12?setTimeout(()=>this._innerWrite(0,r)):this._innerWrite(c,r);return void s.catch(r=>(queueMicrotask(()=>{throw r}),Promise.resolve(!1))).then(i)}const o=this._callbacks[this._bufferOffset];if(o&&o(),this._bufferOffset++,this._pendingData-=e.length,Date.now()-c>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}t.WriteBuffer=_},5941:(R,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toRgbString=t.parseColor=void 0;const n=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,h=/^[\da-f]+$/;function a(_,u){const p=_.toString(16),v=p.length<2?"0"+p:p;switch(u){case 4:return p[0];case 8:return v;case 12:return(v+v).slice(0,3);default:return v+v}}t.parseColor=function(_){if(!_)return;let u=_.toLowerCase();if(u.indexOf("rgb:")===0){u=u.slice(4);const p=n.exec(u);if(p){const v=p[1]?15:p[4]?255:p[7]?4095:65535;return[Math.round(parseInt(p[1]||p[4]||p[7]||p[10],16)/v*255),Math.round(parseInt(p[2]||p[5]||p[8]||p[11],16)/v*255),Math.round(parseInt(p[3]||p[6]||p[9]||p[12],16)/v*255)]}}else if(u.indexOf("#")===0&&(u=u.slice(1),h.exec(u)&&[3,6,9,12].includes(u.length))){const p=u.length/3,v=[0,0,0];for(let c=0;c<3;++c){const e=parseInt(u.slice(p*c,p*c+p),16);v[c]=p===1?e<<4:p===2?e:p===3?e>>4:e>>8}return v}},t.toRgbString=function(_,u=16){const[p,v,c]=_;return`rgb:${a(p,u)}/${a(v,u)}/${a(c,u)}`}},5770:(R,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PAYLOAD_LIMIT=void 0,t.PAYLOAD_LIMIT=1e7},6351:(R,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DcsHandler=t.DcsParser=void 0;const h=n(482),a=n(8742),_=n(5770),u=[];t.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=u,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=u}registerHandler(v,c){this._handlers[v]===void 0&&(this._handlers[v]=[]);const e=this._handlers[v];return e.push(c),{dispose:()=>{const s=e.indexOf(c);s!==-1&&e.splice(s,1)}}}clearHandler(v){this._handlers[v]&&delete this._handlers[v]}setHandlerFallback(v){this._handlerFb=v}reset(){if(this._active.length)for(let v=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;v>=0;--v)this._active[v].unhook(!1);this._stack.paused=!1,this._active=u,this._ident=0}hook(v,c){if(this.reset(),this._ident=v,this._active=this._handlers[v]||u,this._active.length)for(let e=this._active.length-1;e>=0;e--)this._active[e].hook(c);else this._handlerFb(this._ident,"HOOK",c)}put(v,c,e){if(this._active.length)for(let s=this._active.length-1;s>=0;s--)this._active[s].put(v,c,e);else this._handlerFb(this._ident,"PUT",(0,h.utf32ToString)(v,c,e))}unhook(v,c=!0){if(this._active.length){let e=!1,s=this._active.length-1,o=!1;if(this._stack.paused&&(s=this._stack.loopPosition-1,e=c,o=this._stack.fallThrough,this._stack.paused=!1),!o&&e===!1){for(;s>=0&&(e=this._active[s].unhook(v),e!==!0);s--)if(e instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=s,this._stack.fallThrough=!1,e;s--}for(;s>=0;s--)if(e=this._active[s].unhook(!1),e instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=s,this._stack.fallThrough=!0,e}else this._handlerFb(this._ident,"UNHOOK",v);this._active=u,this._ident=0}};const p=new a.Params;p.addParam(0),t.DcsHandler=class{constructor(v){this._handler=v,this._data="",this._params=p,this._hitLimit=!1}hook(v){this._params=v.length>1||v.params[0]?v.clone():p,this._data="",this._hitLimit=!1}put(v,c,e){this._hitLimit||(this._data+=(0,h.utf32ToString)(v,c,e),this._data.length>_.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(v){let c=!1;if(this._hitLimit)c=!1;else if(v&&(c=this._handler(this._data,this._params),c instanceof Promise))return c.then(e=>(this._params=p,this._data="",this._hitLimit=!1,e));return this._params=p,this._data="",this._hitLimit=!1,c}}},2015:(R,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EscapeSequenceParser=t.VT500_TRANSITION_TABLE=t.TransitionTable=void 0;const h=n(844),a=n(8742),_=n(6242),u=n(6351);class p{constructor(s){this.table=new Uint8Array(s)}setDefault(s,o){this.table.fill(s<<4|o)}add(s,o,i,r){this.table[o<<8|s]=i<<4|r}addMany(s,o,i,r){for(let d=0;d<s.length;d++)this.table[o<<8|s[d]]=i<<4|r}}t.TransitionTable=p;const v=160;t.VT500_TRANSITION_TABLE=function(){const e=new p(4095),s=Array.apply(null,Array(256)).map((S,l)=>l),o=(S,l)=>s.slice(S,l),i=o(32,127),r=o(0,24);r.push(25),r.push.apply(r,o(28,32));const d=o(0,14);let g;for(g in e.setDefault(1,0),e.addMany(i,0,2,0),d)e.addMany([24,26,153,154],g,3,0),e.addMany(o(128,144),g,3,0),e.addMany(o(144,152),g,3,0),e.add(156,g,0,0),e.add(27,g,11,1),e.add(157,g,4,8),e.addMany([152,158,159],g,0,7),e.add(155,g,11,3),e.add(144,g,11,9);return e.addMany(r,0,3,0),e.addMany(r,1,3,1),e.add(127,1,0,1),e.addMany(r,8,0,8),e.addMany(r,3,3,3),e.add(127,3,0,3),e.addMany(r,4,3,4),e.add(127,4,0,4),e.addMany(r,6,3,6),e.addMany(r,5,3,5),e.add(127,5,0,5),e.addMany(r,2,3,2),e.add(127,2,0,2),e.add(93,1,4,8),e.addMany(i,8,5,8),e.add(127,8,5,8),e.addMany([156,27,24,26,7],8,6,0),e.addMany(o(28,32),8,0,8),e.addMany([88,94,95],1,0,7),e.addMany(i,7,0,7),e.addMany(r,7,0,7),e.add(156,7,0,0),e.add(127,7,0,7),e.add(91,1,11,3),e.addMany(o(64,127),3,7,0),e.addMany(o(48,60),3,8,4),e.addMany([60,61,62,63],3,9,4),e.addMany(o(48,60),4,8,4),e.addMany(o(64,127),4,7,0),e.addMany([60,61,62,63],4,0,6),e.addMany(o(32,64),6,0,6),e.add(127,6,0,6),e.addMany(o(64,127),6,0,0),e.addMany(o(32,48),3,9,5),e.addMany(o(32,48),5,9,5),e.addMany(o(48,64),5,0,6),e.addMany(o(64,127),5,7,0),e.addMany(o(32,48),4,9,5),e.addMany(o(32,48),1,9,2),e.addMany(o(32,48),2,9,2),e.addMany(o(48,127),2,10,0),e.addMany(o(48,80),1,10,0),e.addMany(o(81,88),1,10,0),e.addMany([89,90,92],1,10,0),e.addMany(o(96,127),1,10,0),e.add(80,1,11,9),e.addMany(r,9,0,9),e.add(127,9,0,9),e.addMany(o(28,32),9,0,9),e.addMany(o(32,48),9,9,12),e.addMany(o(48,60),9,8,10),e.addMany([60,61,62,63],9,9,10),e.addMany(r,11,0,11),e.addMany(o(32,128),11,0,11),e.addMany(o(28,32),11,0,11),e.addMany(r,10,0,10),e.add(127,10,0,10),e.addMany(o(28,32),10,0,10),e.addMany(o(48,60),10,8,10),e.addMany([60,61,62,63],10,0,11),e.addMany(o(32,48),10,9,12),e.addMany(r,12,0,12),e.add(127,12,0,12),e.addMany(o(28,32),12,0,12),e.addMany(o(32,48),12,9,12),e.addMany(o(48,64),12,0,11),e.addMany(o(64,127),12,12,13),e.addMany(o(64,127),10,12,13),e.addMany(o(64,127),9,12,13),e.addMany(r,13,13,13),e.addMany(i,13,13,13),e.add(127,13,0,13),e.addMany([27,156,24,26],13,14,0),e.add(v,0,2,0),e.add(v,8,5,8),e.add(v,6,0,6),e.add(v,11,0,11),e.add(v,13,13,13),e}();class c extends h.Disposable{constructor(s=t.VT500_TRANSITION_TABLE){super(),this._transitions=s,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new a.Params,this._params.addParam(0),this._collect=0,this.precedingCodepoint=0,this._printHandlerFb=(o,i,r)=>{},this._executeHandlerFb=o=>{},this._csiHandlerFb=(o,i)=>{},this._escHandlerFb=o=>{},this._errorHandlerFb=o=>o,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register((0,h.toDisposable)(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this.register(new _.OscParser),this._dcsParser=this.register(new u.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier(s,o=[64,126]){let i=0;if(s.prefix){if(s.prefix.length>1)throw new Error("only one byte as prefix supported");if(i=s.prefix.charCodeAt(0),i&&60>i||i>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(s.intermediates){if(s.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let d=0;d<s.intermediates.length;++d){const g=s.intermediates.charCodeAt(d);if(32>g||g>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");i<<=8,i|=g}}if(s.final.length!==1)throw new Error("final must be a single byte");const r=s.final.charCodeAt(0);if(o[0]>r||r>o[1])throw new Error(`final must be in range ${o[0]} .. ${o[1]}`);return i<<=8,i|=r,i}identToString(s){const o=[];for(;s;)o.push(String.fromCharCode(255&s)),s>>=8;return o.reverse().join("")}setPrintHandler(s){this._printHandler=s}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(s,o){const i=this._identifier(s,[48,126]);this._escHandlers[i]===void 0&&(this._escHandlers[i]=[]);const r=this._escHandlers[i];return r.push(o),{dispose:()=>{const d=r.indexOf(o);d!==-1&&r.splice(d,1)}}}clearEscHandler(s){this._escHandlers[this._identifier(s,[48,126])]&&delete this._escHandlers[this._identifier(s,[48,126])]}setEscHandlerFallback(s){this._escHandlerFb=s}setExecuteHandler(s,o){this._executeHandlers[s.charCodeAt(0)]=o}clearExecuteHandler(s){this._executeHandlers[s.charCodeAt(0)]&&delete this._executeHandlers[s.charCodeAt(0)]}setExecuteHandlerFallback(s){this._executeHandlerFb=s}registerCsiHandler(s,o){const i=this._identifier(s);this._csiHandlers[i]===void 0&&(this._csiHandlers[i]=[]);const r=this._csiHandlers[i];return r.push(o),{dispose:()=>{const d=r.indexOf(o);d!==-1&&r.splice(d,1)}}}clearCsiHandler(s){this._csiHandlers[this._identifier(s)]&&delete this._csiHandlers[this._identifier(s)]}setCsiHandlerFallback(s){this._csiHandlerFb=s}registerDcsHandler(s,o){return this._dcsParser.registerHandler(this._identifier(s),o)}clearDcsHandler(s){this._dcsParser.clearHandler(this._identifier(s))}setDcsHandlerFallback(s){this._dcsParser.setHandlerFallback(s)}registerOscHandler(s,o){return this._oscParser.registerHandler(s,o)}clearOscHandler(s){this._oscParser.clearHandler(s)}setOscHandlerFallback(s){this._oscParser.setHandlerFallback(s)}setErrorHandler(s){this._errorHandler=s}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(s,o,i,r,d){this._parseStack.state=s,this._parseStack.handlers=o,this._parseStack.handlerPos=i,this._parseStack.transition=r,this._parseStack.chunkPos=d}parse(s,o,i){let r,d=0,g=0,S=0;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,S=this._parseStack.chunkPos+1;else{if(i===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");const l=this._parseStack.handlers;let D=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(i===!1&&D>-1){for(;D>=0&&(r=l[D](this._params),r!==!0);D--)if(r instanceof Promise)return this._parseStack.handlerPos=D,r}this._parseStack.handlers=[];break;case 4:if(i===!1&&D>-1){for(;D>=0&&(r=l[D](),r!==!0);D--)if(r instanceof Promise)return this._parseStack.handlerPos=D,r}this._parseStack.handlers=[];break;case 6:if(d=s[this._parseStack.chunkPos],r=this._dcsParser.unhook(d!==24&&d!==26,i),r)return r;d===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(d=s[this._parseStack.chunkPos],r=this._oscParser.end(d!==24&&d!==26,i),r)return r;d===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,S=this._parseStack.chunkPos+1,this.precedingCodepoint=0,this.currentState=15&this._parseStack.transition}for(let l=S;l<o;++l){switch(d=s[l],g=this._transitions.table[this.currentState<<8|(d<160?d:v)],g>>4){case 2:for(let M=l+1;;++M){if(M>=o||(d=s[M])<32||d>126&&d<v){this._printHandler(s,l,M),l=M-1;break}if(++M>=o||(d=s[M])<32||d>126&&d<v){this._printHandler(s,l,M),l=M-1;break}if(++M>=o||(d=s[M])<32||d>126&&d<v){this._printHandler(s,l,M),l=M-1;break}if(++M>=o||(d=s[M])<32||d>126&&d<v){this._printHandler(s,l,M),l=M-1;break}}break;case 3:this._executeHandlers[d]?this._executeHandlers[d]():this._executeHandlerFb(d),this.precedingCodepoint=0;break;case 0:break;case 1:if(this._errorHandler({position:l,code:d,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:const D=this._csiHandlers[this._collect<<8|d];let y=D?D.length-1:-1;for(;y>=0&&(r=D[y](this._params),r!==!0);y--)if(r instanceof Promise)return this._preserveStack(3,D,y,g,l),r;y<0&&this._csiHandlerFb(this._collect<<8|d,this._params),this.precedingCodepoint=0;break;case 8:do switch(d){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(d-48)}while(++l<o&&(d=s[l])>47&&d<60);l--;break;case 9:this._collect<<=8,this._collect|=d;break;case 10:const L=this._escHandlers[this._collect<<8|d];let A=L?L.length-1:-1;for(;A>=0&&(r=L[A](),r!==!0);A--)if(r instanceof Promise)return this._preserveStack(4,L,A,g,l),r;A<0&&this._escHandlerFb(this._collect<<8|d),this.precedingCodepoint=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|d,this._params);break;case 13:for(let M=l+1;;++M)if(M>=o||(d=s[M])===24||d===26||d===27||d>127&&d<v){this._dcsParser.put(s,l,M),l=M-1;break}break;case 14:if(r=this._dcsParser.unhook(d!==24&&d!==26),r)return this._preserveStack(6,[],0,g,l),r;d===27&&(g|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0;break;case 4:this._oscParser.start();break;case 5:for(let M=l+1;;M++)if(M>=o||(d=s[M])<32||d>127&&d<v){this._oscParser.put(s,l,M),l=M-1;break}break;case 6:if(r=this._oscParser.end(d!==24&&d!==26),r)return this._preserveStack(5,[],0,g,l),r;d===27&&(g|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0}this.currentState=15&g}}}t.EscapeSequenceParser=c},6242:(R,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OscHandler=t.OscParser=void 0;const h=n(5770),a=n(482),_=[];t.OscParser=class{constructor(){this._state=0,this._active=_,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(u,p){this._handlers[u]===void 0&&(this._handlers[u]=[]);const v=this._handlers[u];return v.push(p),{dispose:()=>{const c=v.indexOf(p);c!==-1&&v.splice(c,1)}}}clearHandler(u){this._handlers[u]&&delete this._handlers[u]}setHandlerFallback(u){this._handlerFb=u}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=_}reset(){if(this._state===2)for(let u=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;u>=0;--u)this._active[u].end(!1);this._stack.paused=!1,this._active=_,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||_,this._active.length)for(let u=this._active.length-1;u>=0;u--)this._active[u].start();else this._handlerFb(this._id,"START")}_put(u,p,v){if(this._active.length)for(let c=this._active.length-1;c>=0;c--)this._active[c].put(u,p,v);else this._handlerFb(this._id,"PUT",(0,a.utf32ToString)(u,p,v))}start(){this.reset(),this._state=1}put(u,p,v){if(this._state!==3){if(this._state===1)for(;p<v;){const c=u[p++];if(c===59){this._state=2,this._start();break}if(c<48||57<c)return void(this._state=3);this._id===-1&&(this._id=0),this._id=10*this._id+c-48}this._state===2&&v-p>0&&this._put(u,p,v)}}end(u,p=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),this._active.length){let v=!1,c=this._active.length-1,e=!1;if(this._stack.paused&&(c=this._stack.loopPosition-1,v=p,e=this._stack.fallThrough,this._stack.paused=!1),!e&&v===!1){for(;c>=0&&(v=this._active[c].end(u),v!==!0);c--)if(v instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=c,this._stack.fallThrough=!1,v;c--}for(;c>=0;c--)if(v=this._active[c].end(!1),v instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=c,this._stack.fallThrough=!0,v}else this._handlerFb(this._id,"END",u);this._active=_,this._id=-1,this._state=0}}},t.OscHandler=class{constructor(u){this._handler=u,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(u,p,v){this._hitLimit||(this._data+=(0,a.utf32ToString)(u,p,v),this._data.length>h.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(u){let p=!1;if(this._hitLimit)p=!1;else if(u&&(p=this._handler(this._data),p instanceof Promise))return p.then(v=>(this._data="",this._hitLimit=!1,v));return this._data="",this._hitLimit=!1,p}}},8742:(R,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Params=void 0;const n=2147483647;class h{constructor(_=32,u=32){if(this.maxLength=_,this.maxSubParamsLength=u,u>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(_),this.length=0,this._subParams=new Int32Array(u),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(_),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}static fromArray(_){const u=new h;if(!_.length)return u;for(let p=Array.isArray(_[0])?1:0;p<_.length;++p){const v=_[p];if(Array.isArray(v))for(let c=0;c<v.length;++c)u.addSubParam(v[c]);else u.addParam(v)}return u}clone(){const _=new h(this.maxLength,this.maxSubParamsLength);return _.params.set(this.params),_.length=this.length,_._subParams.set(this._subParams),_._subParamsLength=this._subParamsLength,_._subParamsIdx.set(this._subParamsIdx),_._rejectDigits=this._rejectDigits,_._rejectSubDigits=this._rejectSubDigits,_._digitIsSub=this._digitIsSub,_}toArray(){const _=[];for(let u=0;u<this.length;++u){_.push(this.params[u]);const p=this._subParamsIdx[u]>>8,v=255&this._subParamsIdx[u];v-p>0&&_.push(Array.prototype.slice.call(this._subParams,p,v))}return _}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(_){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(_<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=_>n?n:_}}addSubParam(_){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(_<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=_>n?n:_,this._subParamsIdx[this.length-1]++}}hasSubParams(_){return(255&this._subParamsIdx[_])-(this._subParamsIdx[_]>>8)>0}getSubParams(_){const u=this._subParamsIdx[_]>>8,p=255&this._subParamsIdx[_];return p-u>0?this._subParams.subarray(u,p):null}getSubParamsAll(){const _={};for(let u=0;u<this.length;++u){const p=this._subParamsIdx[u]>>8,v=255&this._subParamsIdx[u];v-p>0&&(_[u]=this._subParams.slice(p,v))}return _}addDigit(_){let u;if(this._rejectDigits||!(u=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;const p=this._digitIsSub?this._subParams:this.params,v=p[u-1];p[u-1]=~v?Math.min(10*v+_,n):_}}t.Params=h},5741:(R,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AddonManager=void 0,t.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let n=this._addons.length-1;n>=0;n--)this._addons[n].instance.dispose()}loadAddon(n,h){const a={instance:h,dispose:h.dispose,isDisposed:!1};this._addons.push(a),h.dispose=()=>this._wrappedAddonDispose(a),h.activate(n)}_wrappedAddonDispose(n){if(n.isDisposed)return;let h=-1;for(let a=0;a<this._addons.length;a++)if(this._addons[a]===n){h=a;break}if(h===-1)throw new Error("Could not dispose an addon that has not been loaded");n.isDisposed=!0,n.dispose.apply(n.instance),this._addons.splice(h,1)}}},8771:(R,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferApiView=void 0;const h=n(3785),a=n(511);t.BufferApiView=class{constructor(_,u){this._buffer=_,this.type=u}init(_){return this._buffer=_,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(_){const u=this._buffer.lines.get(_);if(u)return new h.BufferLineApiView(u)}getNullCell(){return new a.CellData}}},3785:(R,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferLineApiView=void 0;const h=n(511);t.BufferLineApiView=class{constructor(a){this._line=a}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(a,_){if(!(a<0||a>=this._line.length))return _?(this._line.loadCell(a,_),_):this._line.loadCell(a,new h.CellData)}translateToString(a,_,u){return this._line.translateToString(a,_,u)}}},8285:(R,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferNamespaceApi=void 0;const h=n(8771),a=n(8460);t.BufferNamespaceApi=class{constructor(_){this._core=_,this._onBufferChange=new a.EventEmitter,this.onBufferChange=this._onBufferChange.event,this._normal=new h.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new h.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}},7975:(R,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ParserApi=void 0,t.ParserApi=class{constructor(n){this._core=n}registerCsiHandler(n,h){return this._core.registerCsiHandler(n,a=>h(a.toArray()))}addCsiHandler(n,h){return this.registerCsiHandler(n,h)}registerDcsHandler(n,h){return this._core.registerDcsHandler(n,(a,_)=>h(a,_.toArray()))}addDcsHandler(n,h){return this.registerDcsHandler(n,h)}registerEscHandler(n,h){return this._core.registerEscHandler(n,h)}addEscHandler(n,h){return this.registerEscHandler(n,h)}registerOscHandler(n,h){return this._core.registerOscHandler(n,h)}addOscHandler(n,h){return this.registerOscHandler(n,h)}}},7090:(R,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeApi=void 0,t.UnicodeApi=class{constructor(n){this._core=n}register(n){this._core.unicodeService.register(n)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(n){this._core.unicodeService.activeVersion=n}}},744:function(R,t,n){var h=this&&this.__decorate||function(e,s,o,i){var r,d=arguments.length,g=d<3?s:i===null?i=Object.getOwnPropertyDescriptor(s,o):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(e,s,o,i);else for(var S=e.length-1;S>=0;S--)(r=e[S])&&(g=(d<3?r(g):d>3?r(s,o,g):r(s,o))||g);return d>3&&g&&Object.defineProperty(s,o,g),g},a=this&&this.__param||function(e,s){return function(o,i){s(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BufferService=t.MINIMUM_ROWS=t.MINIMUM_COLS=void 0;const _=n(2585),u=n(5295),p=n(8460),v=n(844);t.MINIMUM_COLS=2,t.MINIMUM_ROWS=1;let c=class extends v.Disposable{constructor(e){super(),this.isUserScrolling=!1,this._onResize=this.register(new p.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new p.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(e.rawOptions.cols||0,t.MINIMUM_COLS),this.rows=Math.max(e.rawOptions.rows||0,t.MINIMUM_ROWS),this.buffers=this.register(new u.BufferSet(e,this))}get buffer(){return this.buffers.active}resize(e,s){this.cols=e,this.rows=s,this.buffers.resize(e,s),this._onResize.fire({cols:e,rows:s})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(e,s=!1){const o=this.buffer;let i;i=this._cachedBlankLine,i&&i.length===this.cols&&i.getFg(0)===e.fg&&i.getBg(0)===e.bg||(i=o.getBlankLine(e,s),this._cachedBlankLine=i),i.isWrapped=s;const r=o.ybase+o.scrollTop,d=o.ybase+o.scrollBottom;if(o.scrollTop===0){const g=o.lines.isFull;d===o.lines.length-1?g?o.lines.recycle().copyFrom(i):o.lines.push(i.clone()):o.lines.splice(d+1,0,i.clone()),g?this.isUserScrolling&&(o.ydisp=Math.max(o.ydisp-1,0)):(o.ybase++,this.isUserScrolling||o.ydisp++)}else{const g=d-r+1;o.lines.shiftElements(r+1,g-1,-1),o.lines.set(d,i.clone())}this.isUserScrolling||(o.ydisp=o.ybase),this._onScroll.fire(o.ydisp)}scrollLines(e,s,o){const i=this.buffer;if(e<0){if(i.ydisp===0)return;this.isUserScrolling=!0}else e+i.ydisp>=i.ybase&&(this.isUserScrolling=!1);const r=i.ydisp;i.ydisp=Math.max(Math.min(i.ydisp+e,i.ybase),0),r!==i.ydisp&&(s||this._onScroll.fire(i.ydisp))}scrollPages(e){this.scrollLines(e*(this.rows-1))}scrollToTop(){this.scrollLines(-this.buffer.ydisp)}scrollToBottom(){this.scrollLines(this.buffer.ybase-this.buffer.ydisp)}scrollToLine(e){const s=e-this.buffer.ydisp;s!==0&&this.scrollLines(s)}};c=h([a(0,_.IOptionsService)],c),t.BufferService=c},7994:(R,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CharsetService=void 0,t.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(n){this.glevel=n,this.charset=this._charsets[n]}setgCharset(n,h){this._charsets[n]=h,this.glevel===n&&(this.charset=h)}}},1753:function(R,t,n){var h=this&&this.__decorate||function(i,r,d,g){var S,l=arguments.length,D=l<3?r:g===null?g=Object.getOwnPropertyDescriptor(r,d):g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")D=Reflect.decorate(i,r,d,g);else for(var y=i.length-1;y>=0;y--)(S=i[y])&&(D=(l<3?S(D):l>3?S(r,d,D):S(r,d))||D);return l>3&&D&&Object.defineProperty(r,d,D),D},a=this&&this.__param||function(i,r){return function(d,g){r(d,g,i)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CoreMouseService=void 0;const _=n(2585),u=n(8460),p=n(844),v={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:i=>i.button!==4&&i.action===1&&(i.ctrl=!1,i.alt=!1,i.shift=!1,!0)},VT200:{events:19,restrict:i=>i.action!==32},DRAG:{events:23,restrict:i=>i.action!==32||i.button!==3},ANY:{events:31,restrict:i=>!0}};function c(i,r){let d=(i.ctrl?16:0)|(i.shift?4:0)|(i.alt?8:0);return i.button===4?(d|=64,d|=i.action):(d|=3&i.button,4&i.button&&(d|=64),8&i.button&&(d|=128),i.action===32?d|=32:i.action!==0||r||(d|=3)),d}const e=String.fromCharCode,s={DEFAULT:i=>{const r=[c(i,!1)+32,i.col+32,i.row+32];return r[0]>255||r[1]>255||r[2]>255?"":`\x1B[M${e(r[0])}${e(r[1])}${e(r[2])}`},SGR:i=>{const r=i.action===0&&i.button!==4?"m":"M";return`\x1B[<${c(i,!0)};${i.col};${i.row}${r}`},SGR_PIXELS:i=>{const r=i.action===0&&i.button!==4?"m":"M";return`\x1B[<${c(i,!0)};${i.x};${i.y}${r}`}};let o=class extends p.Disposable{constructor(i,r){super(),this._bufferService=i,this._coreService=r,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new u.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(const d of Object.keys(v))this.addProtocol(d,v[d]);for(const d of Object.keys(s))this.addEncoding(d,s[d]);this.reset()}addProtocol(i,r){this._protocols[i]=r}addEncoding(i,r){this._encodings[i]=r}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(i){if(!this._protocols[i])throw new Error(`unknown protocol "${i}"`);this._activeProtocol=i,this._onProtocolChange.fire(this._protocols[i].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(i){if(!this._encodings[i])throw new Error(`unknown encoding "${i}"`);this._activeEncoding=i}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(i){if(i.col<0||i.col>=this._bufferService.cols||i.row<0||i.row>=this._bufferService.rows||i.button===4&&i.action===32||i.button===3&&i.action!==32||i.button!==4&&(i.action===2||i.action===3)||(i.col++,i.row++,i.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,i,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(i))return!1;const r=this._encodings[this._activeEncoding](i);return r&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(r):this._coreService.triggerDataEvent(r,!0)),this._lastEvent=i,!0}explainEvents(i){return{down:!!(1&i),up:!!(2&i),drag:!!(4&i),move:!!(8&i),wheel:!!(16&i)}}_equalEvents(i,r,d){if(d){if(i.x!==r.x||i.y!==r.y)return!1}else if(i.col!==r.col||i.row!==r.row)return!1;return i.button===r.button&&i.action===r.action&&i.ctrl===r.ctrl&&i.alt===r.alt&&i.shift===r.shift}};o=h([a(0,_.IBufferService),a(1,_.ICoreService)],o),t.CoreMouseService=o},6975:function(R,t,n){var h=this&&this.__decorate||function(o,i,r,d){var g,S=arguments.length,l=S<3?i:d===null?d=Object.getOwnPropertyDescriptor(i,r):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(o,i,r,d);else for(var D=o.length-1;D>=0;D--)(g=o[D])&&(l=(S<3?g(l):S>3?g(i,r,l):g(i,r))||l);return S>3&&l&&Object.defineProperty(i,r,l),l},a=this&&this.__param||function(o,i){return function(r,d){i(r,d,o)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CoreService=void 0;const _=n(2585),u=n(8460),p=n(1439),v=n(844),c=Object.freeze({insertMode:!1}),e=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0});let s=class extends v.Disposable{constructor(o,i,r){super(),this._bufferService=o,this._logService=i,this._optionsService=r,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new u.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new u.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new u.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new u.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,p.clone)(c),this.decPrivateModes=(0,p.clone)(e)}reset(){this.modes=(0,p.clone)(c),this.decPrivateModes=(0,p.clone)(e)}triggerDataEvent(o,i=!1){if(this._optionsService.rawOptions.disableStdin)return;const r=this._bufferService.buffer;i&&this._optionsService.rawOptions.scrollOnUserInput&&r.ybase!==r.ydisp&&this._onRequestScrollToBottom.fire(),i&&this._onUserInput.fire(),this._logService.debug(`sending data "${o}"`,()=>o.split("").map(d=>d.charCodeAt(0))),this._onData.fire(o)}triggerBinaryEvent(o){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${o}"`,()=>o.split("").map(i=>i.charCodeAt(0))),this._onBinary.fire(o))}};s=h([a(0,_.IBufferService),a(1,_.ILogService),a(2,_.IOptionsService)],s),t.CoreService=s},9074:(R,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DecorationService=void 0;const h=n(8055),a=n(8460),_=n(844),u=n(6106);let p=0,v=0;class c extends _.Disposable{constructor(){super(),this._decorations=new u.SortedList(o=>o?.marker.line),this._onDecorationRegistered=this.register(new a.EventEmitter),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this.register(new a.EventEmitter),this.onDecorationRemoved=this._onDecorationRemoved.event,this.register((0,_.toDisposable)(()=>{for(const o of this._decorations.values())this._onDecorationRemoved.fire(o);this.reset()}))}get decorations(){return this._decorations.values()}registerDecoration(o){if(o.marker.isDisposed)return;const i=new e(o);if(i){const r=i.marker.onDispose(()=>i.dispose());i.onDispose(()=>{i&&(this._decorations.delete(i)&&this._onDecorationRemoved.fire(i),r.dispose())}),this._decorations.insert(i),this._onDecorationRegistered.fire(i)}return i}reset(){for(const o of this._decorations.values())o.dispose();this._decorations.clear()}*getDecorationsAtCell(o,i,r){var d,g,S;let l=0,D=0;for(const y of this._decorations.getKeyIterator(i))l=(d=y.options.x)!==null&&d!==void 0?d:0,D=l+((g=y.options.width)!==null&&g!==void 0?g:1),o>=l&&o<D&&(!r||((S=y.options.layer)!==null&&S!==void 0?S:"bottom")===r)&&(yield y)}forEachDecorationAtCell(o,i,r,d){this._decorations.forEachByKey(i,g=>{var S,l,D;p=(S=g.options.x)!==null&&S!==void 0?S:0,v=p+((l=g.options.width)!==null&&l!==void 0?l:1),o>=p&&o<v&&(!r||((D=g.options.layer)!==null&&D!==void 0?D:"bottom")===r)&&d(g)})}dispose(){for(const o of this._decorations.values())this._onDecorationRemoved.fire(o);this.reset()}}t.DecorationService=c;class e extends _.Disposable{constructor(o){super(),this.options=o,this.isDisposed=!1,this.onRenderEmitter=this.register(new a.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new a.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=o.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=h.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=h.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}dispose(){this._onDispose.fire(),super.dispose()}}},4348:(R,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InstantiationService=t.ServiceCollection=void 0;const h=n(2585),a=n(8343);class _{constructor(...p){this._entries=new Map;for(const[v,c]of p)this.set(v,c)}set(p,v){const c=this._entries.get(p);return this._entries.set(p,v),c}forEach(p){for(const[v,c]of this._entries.entries())p(v,c)}has(p){return this._entries.has(p)}get(p){return this._entries.get(p)}}t.ServiceCollection=_,t.InstantiationService=class{constructor(){this._services=new _,this._services.set(h.IInstantiationService,this)}setService(u,p){this._services.set(u,p)}getService(u){return this._services.get(u)}createInstance(u,...p){const v=(0,a.getServiceDependencies)(u).sort((s,o)=>s.index-o.index),c=[];for(const s of v){const o=this._services.get(s.id);if(!o)throw new Error(`[createInstance] ${u.name} depends on UNKNOWN service ${s.id}.`);c.push(o)}const e=v.length>0?v[0].index:p.length;if(p.length!==e)throw new Error(`[createInstance] First service dependency of ${u.name} at position ${e+1} conflicts with ${p.length} static arguments`);return new u(...p,...c)}}},7866:function(R,t,n){var h=this&&this.__decorate||function(c,e,s,o){var i,r=arguments.length,d=r<3?e:o===null?o=Object.getOwnPropertyDescriptor(e,s):o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,s,o);else for(var g=c.length-1;g>=0;g--)(i=c[g])&&(d=(r<3?i(d):r>3?i(e,s,d):i(e,s))||d);return r>3&&d&&Object.defineProperty(e,s,d),d},a=this&&this.__param||function(c,e){return function(s,o){e(s,o,c)}};Object.defineProperty(t,"__esModule",{value:!0}),t.LogService=void 0;const _=n(844),u=n(2585),p={debug:u.LogLevelEnum.DEBUG,info:u.LogLevelEnum.INFO,warn:u.LogLevelEnum.WARN,error:u.LogLevelEnum.ERROR,off:u.LogLevelEnum.OFF};let v=class extends _.Disposable{constructor(c){super(),this._optionsService=c,this.logLevel=u.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel()))}_updateLogLevel(){this.logLevel=p[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(c){for(let e=0;e<c.length;e++)typeof c[e]=="function"&&(c[e]=c[e]())}_log(c,e,s){this._evalLazyOptionalParams(s),c.call(console,"xterm.js: "+e,...s)}debug(c,...e){this.logLevel<=u.LogLevelEnum.DEBUG&&this._log(console.log,c,e)}info(c,...e){this.logLevel<=u.LogLevelEnum.INFO&&this._log(console.info,c,e)}warn(c,...e){this.logLevel<=u.LogLevelEnum.WARN&&this._log(console.warn,c,e)}error(c,...e){this.logLevel<=u.LogLevelEnum.ERROR&&this._log(console.error,c,e)}};v=h([a(0,u.IOptionsService)],v),t.LogService=v},7302:(R,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OptionsService=t.DEFAULT_OPTIONS=void 0;const h=n(8460),a=n(6114),_=n(844);t.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,customGlyphs:!0,drawBoldTextInBrightColors:!0,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rightClickSelectsWord:a.isMac,windowOptions:{},windowsMode:!1,wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};const u=["normal","bold","100","200","300","400","500","600","700","800","900"];class p extends _.Disposable{constructor(c){super(),this._onOptionChange=this.register(new h.EventEmitter),this.onOptionChange=this._onOptionChange.event;const e=Object.assign({},t.DEFAULT_OPTIONS);for(const s in c)if(s in e)try{const o=c[s];e[s]=this._sanitizeAndValidateOption(s,o)}catch(o){console.error(o)}this.rawOptions=e,this.options=Object.assign({},e),this._setupOptions()}onSpecificOptionChange(c,e){return this.onOptionChange(s=>{s===c&&e(this.rawOptions[c])})}onMultipleOptionChange(c,e){return this.onOptionChange(s=>{c.indexOf(s)!==-1&&e()})}_setupOptions(){const c=s=>{if(!(s in t.DEFAULT_OPTIONS))throw new Error(`No option with key "${s}"`);return this.rawOptions[s]},e=(s,o)=>{if(!(s in t.DEFAULT_OPTIONS))throw new Error(`No option with key "${s}"`);o=this._sanitizeAndValidateOption(s,o),this.rawOptions[s]!==o&&(this.rawOptions[s]=o,this._onOptionChange.fire(s))};for(const s in this.rawOptions){const o={get:c.bind(this,s),set:e.bind(this,s)};Object.defineProperty(this.options,s,o)}}_sanitizeAndValidateOption(c,e){switch(c){case"cursorStyle":if(e||(e=t.DEFAULT_OPTIONS[c]),!function(s){return s==="block"||s==="underline"||s==="bar"}(e))throw new Error(`"${e}" is not a valid value for ${c}`);break;case"wordSeparator":e||(e=t.DEFAULT_OPTIONS[c]);break;case"fontWeight":case"fontWeightBold":if(typeof e=="number"&&1<=e&&e<=1e3)break;e=u.includes(e)?e:t.DEFAULT_OPTIONS[c];break;case"cursorWidth":e=Math.floor(e);case"lineHeight":case"tabStopWidth":if(e<1)throw new Error(`${c} cannot be less than 1, value: ${e}`);break;case"minimumContrastRatio":e=Math.max(1,Math.min(21,Math.round(10*e)/10));break;case"scrollback":if((e=Math.min(e,4294967295))<0)throw new Error(`${c} cannot be less than 0, value: ${e}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(e<=0)throw new Error(`${c} cannot be less than or equal to 0, value: ${e}`);case"rows":case"cols":if(!e&&e!==0)throw new Error(`${c} must be numeric, value: ${e}`)}return e}}t.OptionsService=p},2660:function(R,t,n){var h=this&&this.__decorate||function(p,v,c,e){var s,o=arguments.length,i=o<3?v:e===null?e=Object.getOwnPropertyDescriptor(v,c):e;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(p,v,c,e);else for(var r=p.length-1;r>=0;r--)(s=p[r])&&(i=(o<3?s(i):o>3?s(v,c,i):s(v,c))||i);return o>3&&i&&Object.defineProperty(v,c,i),i},a=this&&this.__param||function(p,v){return function(c,e){v(c,e,p)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OscLinkService=void 0;const _=n(2585);let u=class{constructor(p){this._bufferService=p,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(p){const v=this._bufferService.buffer;if(p.id===void 0){const r=v.addMarker(v.ybase+v.y),d={data:p,id:this._nextId++,lines:[r]};return r.onDispose(()=>this._removeMarkerFromLink(d,r)),this._dataByLinkId.set(d.id,d),d.id}const c=p,e=this._getEntryIdKey(c),s=this._entriesWithId.get(e);if(s)return this.addLineToLink(s.id,v.ybase+v.y),s.id;const o=v.addMarker(v.ybase+v.y),i={id:this._nextId++,key:this._getEntryIdKey(c),data:c,lines:[o]};return o.onDispose(()=>this._removeMarkerFromLink(i,o)),this._entriesWithId.set(i.key,i),this._dataByLinkId.set(i.id,i),i.id}addLineToLink(p,v){const c=this._dataByLinkId.get(p);if(c&&c.lines.every(e=>e.line!==v)){const e=this._bufferService.buffer.addMarker(v);c.lines.push(e),e.onDispose(()=>this._removeMarkerFromLink(c,e))}}getLinkData(p){var v;return(v=this._dataByLinkId.get(p))===null||v===void 0?void 0:v.data}_getEntryIdKey(p){return`${p.id};;${p.uri}`}_removeMarkerFromLink(p,v){const c=p.lines.indexOf(v);c!==-1&&(p.lines.splice(c,1),p.lines.length===0&&(p.data.id!==void 0&&this._entriesWithId.delete(p.key),this._dataByLinkId.delete(p.id)))}};u=h([a(0,_.IBufferService)],u),t.OscLinkService=u},8343:(R,t)=>{function n(h,a,_){a.di$target===a?a.di$dependencies.push({id:h,index:_}):(a.di$dependencies=[{id:h,index:_}],a.di$target=a)}Object.defineProperty(t,"__esModule",{value:!0}),t.createDecorator=t.getServiceDependencies=t.serviceRegistry=void 0,t.serviceRegistry=new Map,t.getServiceDependencies=function(h){return h.di$dependencies||[]},t.createDecorator=function(h){if(t.serviceRegistry.has(h))return t.serviceRegistry.get(h);const a=function(_,u,p){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");n(a,_,p)};return a.toString=()=>h,t.serviceRegistry.set(h,a),a}},2585:(R,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IDecorationService=t.IUnicodeService=t.IOscLinkService=t.IOptionsService=t.ILogService=t.LogLevelEnum=t.IInstantiationService=t.ICharsetService=t.ICoreService=t.ICoreMouseService=t.IBufferService=void 0;const h=n(8343);var a;t.IBufferService=(0,h.createDecorator)("BufferService"),t.ICoreMouseService=(0,h.createDecorator)("CoreMouseService"),t.ICoreService=(0,h.createDecorator)("CoreService"),t.ICharsetService=(0,h.createDecorator)("CharsetService"),t.IInstantiationService=(0,h.createDecorator)("InstantiationService"),(a=t.LogLevelEnum||(t.LogLevelEnum={}))[a.DEBUG=0]="DEBUG",a[a.INFO=1]="INFO",a[a.WARN=2]="WARN",a[a.ERROR=3]="ERROR",a[a.OFF=4]="OFF",t.ILogService=(0,h.createDecorator)("LogService"),t.IOptionsService=(0,h.createDecorator)("OptionsService"),t.IOscLinkService=(0,h.createDecorator)("OscLinkService"),t.IUnicodeService=(0,h.createDecorator)("UnicodeService"),t.IDecorationService=(0,h.createDecorator)("DecorationService")},1480:(R,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeService=void 0;const h=n(8460),a=n(225);t.UnicodeService=class{constructor(){this._providers=Object.create(null),this._active="",this._onChange=new h.EventEmitter,this.onChange=this._onChange.event;const _=new a.UnicodeV6;this.register(_),this._active=_.version,this._activeProvider=_}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(_){if(!this._providers[_])throw new Error(`unknown Unicode version "${_}"`);this._active=_,this._activeProvider=this._providers[_],this._onChange.fire(_)}register(_){this._providers[_.version]=_}wcwidth(_){return this._activeProvider.wcwidth(_)}getStringCellWidth(_){let u=0;const p=_.length;for(let v=0;v<p;++v){let c=_.charCodeAt(v);if(55296<=c&&c<=56319){if(++v>=p)return u+this.wcwidth(c);const e=_.charCodeAt(v);56320<=e&&e<=57343?c=1024*(c-55296)+e-56320+65536:u+=this.wcwidth(e)}u+=this.wcwidth(c)}return u}}}},w={};function k(R){var t=w[R];if(t!==void 0)return t.exports;var n=w[R]={exports:{}};return b[R].call(n.exports,n,n.exports,k),n.exports}var O={};return(()=>{var R=O;Object.defineProperty(R,"__esModule",{value:!0}),R.Terminal=void 0;const t=k(3236),n=k(9042),h=k(7975),a=k(7090),_=k(5741),u=k(8285),p=["cols","rows"];R.Terminal=class{constructor(v){this._core=new t.Terminal(v),this._addonManager=new _.AddonManager,this._publicOptions=Object.assign({},this._core.options);const c=s=>this._core.options[s],e=(s,o)=>{this._checkReadonlyOptions(s),this._core.options[s]=o};for(const s in this._core.options){const o={get:c.bind(this,s),set:e.bind(this,s)};Object.defineProperty(this._publicOptions,s,o)}}_checkReadonlyOptions(v){if(p.includes(v))throw new Error(`Option "${v}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new h.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new a.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=new u.BufferNamespaceApi(this._core)),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){const v=this._core.coreService.decPrivateModes;let c="none";switch(this._core.coreMouseService.activeProtocol){case"X10":c="x10";break;case"VT200":c="vt200";break;case"DRAG":c="drag";break;case"ANY":c="any"}return{applicationCursorKeysMode:v.applicationCursorKeys,applicationKeypadMode:v.applicationKeypad,bracketedPasteMode:v.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:c,originMode:v.origin,reverseWraparoundMode:v.reverseWraparound,sendFocusMode:v.sendFocus,wraparoundMode:v.wraparound}}get options(){return this._publicOptions}set options(v){for(const c in v)this._publicOptions[c]=v[c]}blur(){this._core.blur()}focus(){this._core.focus()}resize(v,c){this._verifyIntegers(v,c),this._core.resize(v,c)}open(v){this._core.open(v)}attachCustomKeyEventHandler(v){this._core.attachCustomKeyEventHandler(v)}registerLinkProvider(v){return this._core.registerLinkProvider(v)}registerCharacterJoiner(v){return this._checkProposedApi(),this._core.registerCharacterJoiner(v)}deregisterCharacterJoiner(v){this._checkProposedApi(),this._core.deregisterCharacterJoiner(v)}registerMarker(v=0){return this._verifyIntegers(v),this._core.addMarker(v)}registerDecoration(v){var c,e,s;return this._checkProposedApi(),this._verifyPositiveIntegers((c=v.x)!==null&&c!==void 0?c:0,(e=v.width)!==null&&e!==void 0?e:0,(s=v.height)!==null&&s!==void 0?s:0),this._core.registerDecoration(v)}hasSelection(){return this._core.hasSelection()}select(v,c,e){this._verifyIntegers(v,c,e),this._core.select(v,c,e)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(v,c){this._verifyIntegers(v,c),this._core.selectLines(v,c)}dispose(){this._addonManager.dispose(),this._core.dispose()}scrollLines(v){this._verifyIntegers(v),this._core.scrollLines(v)}scrollPages(v){this._verifyIntegers(v),this._core.scrollPages(v)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(v){this._verifyIntegers(v),this._core.scrollToLine(v)}clear(){this._core.clear()}write(v,c){this._core.write(v,c)}writeln(v,c){this._core.write(v),this._core.write(`\r
`,c)}paste(v){this._core.paste(v)}refresh(v,c){this._verifyIntegers(v,c),this._core.refresh(v,c)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(v){return this._addonManager.loadAddon(this,v)}static get strings(){return n}_verifyIntegers(...v){for(const c of v)if(c===1/0||isNaN(c)||c%1!=0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...v){for(const c of v)if(c&&(c===1/0||isNaN(c)||c%1!=0||c<0))throw new Error("This API only accepts positive integers")}}})(),O})()})})(yt);var Kt=yt.exports,$e={},wt={};(function(C){Object.defineProperty(C,"__esModule",{value:!0}),C.parseInput=C.InputType=void 0;var f;(function(k){k[k.Text=0]="Text",k[k.AltEnter=1]="AltEnter",k[k.ArrowUp=2]="ArrowUp",k[k.ArrowDown=3]="ArrowDown",k[k.ArrowLeft=4]="ArrowLeft",k[k.ArrowRight=5]="ArrowRight",k[k.Delete=6]="Delete",k[k.Backspace=7]="Backspace",k[k.CtrlA=8]="CtrlA",k[k.CtrlC=9]="CtrlC",k[k.CtrlD=10]="CtrlD",k[k.CtrlE=11]="CtrlE",k[k.CtrlK=12]="CtrlK",k[k.CtrlL=13]="CtrlL",k[k.CtrlQ=14]="CtrlQ",k[k.CtrlS=15]="CtrlS",k[k.CtrlU=16]="CtrlU",k[k.End=17]="End",k[k.Enter=18]="Enter",k[k.Home=19]="Home",k[k.ShiftEnter=20]="ShiftEnter",k[k.UnsupportedControlChar=21]="UnsupportedControlChar",k[k.UnsupportedEscape=22]="UnsupportedEscape"})(f=C.InputType||(C.InputType={}));function b(k){return Array.from(w(k))}C.parseInput=b;function*w(k){let O=[];const R=k[Symbol.iterator]();for(let t=R.next();!t.done;t=R.next()){const n=t.value;if(n.length>1){O.push(n);continue}const h=n.charCodeAt(0);if(O.length>0&&(h<32||h===127)&&(yield{inputType:f.Text,data:O},O=[]),h===27){const a=R.next();if(a.done){O.push("\x1B");continue}let _=f.UnsupportedEscape;if(a.value!=="["){switch(a.value){case"\r":_=f.AltEnter;break}yield{inputType:_,data:["\x1B",a.value]};continue}const u=R.next();if(u.done)continue;if(u.value>="0"&&u.value<="9"){let p=u.value;const v=R.next();if(v.done)return;if(v.value>="0"&&v.value<="9")p+=v.value;else if(v.value!=="~")continue;switch(p){case"3":_=f.Delete;break}yield{inputType:_,data:["\x1B","[",p,"~"]};continue}switch(u.value){case"A":_=f.ArrowUp;break;case"B":_=f.ArrowDown;break;case"C":_=f.ArrowRight;break;case"D":_=f.ArrowLeft;break;case"F":_=f.End;break;case"H":_=f.Home;break;case"\r":_=f.AltEnter;break}yield{inputType:_,data:["\x1B","[",u.value]};continue}if(h<32||h===127){let a=f.UnsupportedControlChar;switch(h){case 1:a=f.CtrlA;break;case 3:a=f.CtrlC;break;case 4:a=f.CtrlD;break;case 5:a=f.CtrlE;break;case 11:a=f.CtrlK;break;case 17:a=f.CtrlQ;break;case 19:a=f.CtrlS;break;case 21:a=f.CtrlU;break;case 13:a=f.Enter;break;case 127:a=f.Backspace;break;case 12:a=f.CtrlL;break}yield{inputType:a,data:[n]};continue}O.push(n)}O.length>0&&(yield{inputType:f.Text,data:O})}})(wt);var ne={},Ae={};Object.defineProperty(Ae,"__esModule",{value:!0});Ae.LineBuffer=void 0;class qt{constructor(){this.buf="",this.pos=0}buffer(){return this.buf}pos_buffer(){return this.buf.slice(0,this.pos)}length(){return this.buf.length}char_length(){return[...this.buf].length}update(f,b){this.buf=f,this.pos=b}insert(f){const b=f.length,w=this.pos===this.buf.length;return w?this.buf=this.buf+f:this.buf=this.buf.slice(0,this.pos)+f+this.buf.slice(this.pos),this.pos+=b,w}moveBack(f){const b=this.prevPos(f);return b!==void 0?(this.pos=b,!0):!1}moveForward(f){const b=this.nextPos(f);return b!==void 0?(this.pos=b,!0):!1}moveHome(){const f=this.startOfLine();return this.pos>f?(this.pos=f,!0):!1}moveEnd(){const f=this.endOfLine();return this.pos===f?!1:(this.pos=f,!0)}startOfLine(){const f=this.buf.slice(0,this.pos).lastIndexOf(`
`);return f!==-1?f+1:0}endOfLine(){const f=this.buf.slice(this.pos).indexOf(`
`);return f!==-1?this.pos+f:this.buf.length}moveLineUp(f){const b=this.buf.slice(0,this.pos).lastIndexOf(`
`);if(b===-1)return!1;const w=[...this.buf.slice(b+1,this.pos)].length;let k=this.buf.slice(0,b).lastIndexOf(`
`);k===-1?k=0:k=k+1;let O=b;for(let n=1;n<f&&k!==0;n++)O=k-1,k=this.buf.slice(0,O).lastIndexOf(`
`),k===-1?k=0:k=k+1;const R=[...this.buf.slice(k,O)].slice(0,w);let t=b;return R.length>0&&(t=R.map(n=>n.length).reduce((n,h)=>n+h,0),t=k+t),this.pos=t,!0}moveLineDown(f){const b=this.buf.slice(this.pos).indexOf(`
`);if(b===-1)return!1;let w=this.buf.slice(0,this.pos).lastIndexOf(`
`);w===-1?w=0:w+=1;const k=[...this.buf.slice(w,this.pos)].length;let O=this.pos+b+1,R=this.buf.slice(O).indexOf(`
`);R===-1?R=this.buf.length:R=O+R;for(let n=1;n<f&&R!==this.buf.length;n++)O=R+1,R=this.buf.slice(O).indexOf(`
`),R===-1?R=this.buf.length:R=O+R;const t=[...this.buf.slice(O,R)];return k<t.length?this.pos=t.slice(0,k).map(n=>n.length).reduce((n,h)=>n+h,0)+O:this.pos=R,!0}set_pos(f){this.pos=f}prevPos(f){if(this.pos===0)return;const b=this.buf.slice(0,this.pos);return this.pos-[...b].slice(-f).map(w=>w.length).reduce((w,k)=>w+k,0)}nextPos(f){if(this.pos===this.buf.length)return;const b=this.buf.slice(this.pos);return this.pos+[...b].slice(0,f).map(w=>w.length).reduce((w,k)=>w+k,0)}backspace(f){const b=this.prevPos(f);return b===void 0?!1:(this.buf=this.buf.slice(0,b)+this.buf.slice(this.pos),this.pos=b,!0)}delete(f){const b=this.nextPos(f);return b!==void 0?(this.buf=this.buf.slice(0,this.pos)+this.buf.slice(b),!0):!1}deleteEndOfLine(){if(this.buf.length==0||this.pos==this.buf.length)return!1;const f=this.pos,b=this.endOfLine();return f==b?this.delete(1):this.buf=this.buf.slice(0,f)+this.buf.slice(b),!0}}Ae.LineBuffer=qt;var je={exports:{}},Vt=({onlyFirst:C=!1}={})=>{const f=["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|");return new RegExp(f,C?void 0:"g")};const Gt=Vt;var Xt=C=>typeof C=="string"?C.replace(Gt(),""):C,ze={exports:{}};const kt=C=>Number.isNaN(C)?!1:C>=4352&&(C<=4447||C===9001||C===9002||11904<=C&&C<=12871&&C!==12351||12880<=C&&C<=19903||19968<=C&&C<=42182||43360<=C&&C<=43388||44032<=C&&C<=55203||63744<=C&&C<=64255||65040<=C&&C<=65049||65072<=C&&C<=65131||65281<=C&&C<=65376||65504<=C&&C<=65510||110592<=C&&C<=110593||127488<=C&&C<=127569||131072<=C&&C<=262141);ze.exports=kt;ze.exports.default=kt;var Yt=ze.exports,Jt=function(){return/\uD83C\uDFF4\uDB40\uDC67\uDB40\uDC62(?:\uDB40\uDC65\uDB40\uDC6E\uDB40\uDC67|\uDB40\uDC73\uDB40\uDC63\uDB40\uDC74|\uDB40\uDC77\uDB40\uDC6C\uDB40\uDC73)\uDB40\uDC7F|\uD83D\uDC68(?:\uD83C\uDFFC\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68\uD83C\uDFFB|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFF\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFB-\uDFFE])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFE\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFB-\uDFFD])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFD\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFB\uDFFC])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\u200D(?:\u2764\uFE0F\u200D(?:\uD83D\uDC8B\u200D)?\uD83D\uDC68|(?:\uD83D[\uDC68\uDC69])\u200D(?:\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67]))|\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67])|(?:\uD83D[\uDC68\uDC69])\u200D(?:\uD83D[\uDC66\uDC67])|[\u2695\u2696\u2708]\uFE0F|\uD83D[\uDC66\uDC67]|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|(?:\uD83C\uDFFB\u200D[\u2695\u2696\u2708]|\uD83C\uDFFF\u200D[\u2695\u2696\u2708]|\uD83C\uDFFE\u200D[\u2695\u2696\u2708]|\uD83C\uDFFD\u200D[\u2695\u2696\u2708]|\uD83C\uDFFC\u200D[\u2695\u2696\u2708])\uFE0F|\uD83C\uDFFB\u200D(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C[\uDFFB-\uDFFF])|(?:\uD83E\uDDD1\uD83C\uDFFB\u200D\uD83E\uDD1D\u200D\uD83E\uDDD1|\uD83D\uDC69\uD83C\uDFFC\u200D\uD83E\uDD1D\u200D\uD83D\uDC69)\uD83C\uDFFB|\uD83E\uDDD1(?:\uD83C\uDFFF\u200D\uD83E\uDD1D\u200D\uD83E\uDDD1(?:\uD83C[\uDFFB-\uDFFF])|\u200D\uD83E\uDD1D\u200D\uD83E\uDDD1)|(?:\uD83E\uDDD1\uD83C\uDFFE\u200D\uD83E\uDD1D\u200D\uD83E\uDDD1|\uD83D\uDC69\uD83C\uDFFF\u200D\uD83E\uDD1D\u200D(?:\uD83D[\uDC68\uDC69]))(?:\uD83C[\uDFFB-\uDFFE])|(?:\uD83E\uDDD1\uD83C\uDFFC\u200D\uD83E\uDD1D\u200D\uD83E\uDDD1|\uD83D\uDC69\uD83C\uDFFD\u200D\uD83E\uDD1D\u200D\uD83D\uDC69)(?:\uD83C[\uDFFB\uDFFC])|\uD83D\uDC69(?:\uD83C\uDFFE\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFB-\uDFFD\uDFFF])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFC\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFB\uDFFD-\uDFFF])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFB\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFC-\uDFFF])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFD\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\u200D(?:\u2764\uFE0F\u200D(?:\uD83D\uDC8B\u200D(?:\uD83D[\uDC68\uDC69])|\uD83D[\uDC68\uDC69])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFF\u200D(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD]))|\uD83D\uDC69\u200D\uD83D\uDC69\u200D(?:\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67]))|(?:\uD83E\uDDD1\uD83C\uDFFD\u200D\uD83E\uDD1D\u200D\uD83E\uDDD1|\uD83D\uDC69\uD83C\uDFFE\u200D\uD83E\uDD1D\u200D\uD83D\uDC69)(?:\uD83C[\uDFFB-\uDFFD])|\uD83D\uDC69\u200D\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC69\u200D\uD83D\uDC69\u200D(?:\uD83D[\uDC66\uDC67])|(?:\uD83D\uDC41\uFE0F\u200D\uD83D\uDDE8|\uD83D\uDC69(?:\uD83C\uDFFF\u200D[\u2695\u2696\u2708]|\uD83C\uDFFE\u200D[\u2695\u2696\u2708]|\uD83C\uDFFC\u200D[\u2695\u2696\u2708]|\uD83C\uDFFB\u200D[\u2695\u2696\u2708]|\uD83C\uDFFD\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708])|(?:(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)\uFE0F|\uD83D\uDC6F|\uD83E[\uDD3C\uDDDE\uDDDF])\u200D[\u2640\u2642]|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDCD-\uDDCF\uDDD6-\uDDDD])(?:(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]|\u200D[\u2640\u2642])|\uD83C\uDFF4\u200D\u2620)\uFE0F|\uD83D\uDC69\u200D\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67])|\uD83C\uDFF3\uFE0F\u200D\uD83C\uDF08|\uD83D\uDC15\u200D\uD83E\uDDBA|\uD83D\uDC69\u200D\uD83D\uDC66|\uD83D\uDC69\u200D\uD83D\uDC67|\uD83C\uDDFD\uD83C\uDDF0|\uD83C\uDDF4\uD83C\uDDF2|\uD83C\uDDF6\uD83C\uDDE6|[#\*0-9]\uFE0F\u20E3|\uD83C\uDDE7(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEF\uDDF1-\uDDF4\uDDF6-\uDDF9\uDDFB\uDDFC\uDDFE\uDDFF])|\uD83C\uDDF9(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDED\uDDEF-\uDDF4\uDDF7\uDDF9\uDDFB\uDDFC\uDDFF])|\uD83C\uDDEA(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDED\uDDF7-\uDDFA])|\uD83E\uDDD1(?:\uD83C[\uDFFB-\uDFFF])|\uD83C\uDDF7(?:\uD83C[\uDDEA\uDDF4\uDDF8\uDDFA\uDDFC])|\uD83D\uDC69(?:\uD83C[\uDFFB-\uDFFF])|\uD83C\uDDF2(?:\uD83C[\uDDE6\uDDE8-\uDDED\uDDF0-\uDDFF])|\uD83C\uDDE6(?:\uD83C[\uDDE8-\uDDEC\uDDEE\uDDF1\uDDF2\uDDF4\uDDF6-\uDDFA\uDDFC\uDDFD\uDDFF])|\uD83C\uDDF0(?:\uD83C[\uDDEA\uDDEC-\uDDEE\uDDF2\uDDF3\uDDF5\uDDF7\uDDFC\uDDFE\uDDFF])|\uD83C\uDDED(?:\uD83C[\uDDF0\uDDF2\uDDF3\uDDF7\uDDF9\uDDFA])|\uD83C\uDDE9(?:\uD83C[\uDDEA\uDDEC\uDDEF\uDDF0\uDDF2\uDDF4\uDDFF])|\uD83C\uDDFE(?:\uD83C[\uDDEA\uDDF9])|\uD83C\uDDEC(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEE\uDDF1-\uDDF3\uDDF5-\uDDFA\uDDFC\uDDFE])|\uD83C\uDDF8(?:\uD83C[\uDDE6-\uDDEA\uDDEC-\uDDF4\uDDF7-\uDDF9\uDDFB\uDDFD-\uDDFF])|\uD83C\uDDEB(?:\uD83C[\uDDEE-\uDDF0\uDDF2\uDDF4\uDDF7])|\uD83C\uDDF5(?:\uD83C[\uDDE6\uDDEA-\uDDED\uDDF0-\uDDF3\uDDF7-\uDDF9\uDDFC\uDDFE])|\uD83C\uDDFB(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDEE\uDDF3\uDDFA])|\uD83C\uDDF3(?:\uD83C[\uDDE6\uDDE8\uDDEA-\uDDEC\uDDEE\uDDF1\uDDF4\uDDF5\uDDF7\uDDFA\uDDFF])|\uD83C\uDDE8(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDEE\uDDF0-\uDDF5\uDDF7\uDDFA-\uDDFF])|\uD83C\uDDF1(?:\uD83C[\uDDE6-\uDDE8\uDDEE\uDDF0\uDDF7-\uDDFB\uDDFE])|\uD83C\uDDFF(?:\uD83C[\uDDE6\uDDF2\uDDFC])|\uD83C\uDDFC(?:\uD83C[\uDDEB\uDDF8])|\uD83C\uDDFA(?:\uD83C[\uDDE6\uDDEC\uDDF2\uDDF3\uDDF8\uDDFE\uDDFF])|\uD83C\uDDEE(?:\uD83C[\uDDE8-\uDDEA\uDDF1-\uDDF4\uDDF6-\uDDF9])|\uD83C\uDDEF(?:\uD83C[\uDDEA\uDDF2\uDDF4\uDDF5])|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDCD-\uDDCF\uDDD6-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uD83C[\uDFFB-\uDFFF])|(?:[\u261D\u270A-\u270D]|\uD83C[\uDF85\uDFC2\uDFC7]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66\uDC67\uDC6B-\uDC6D\uDC70\uDC72\uDC74-\uDC76\uDC78\uDC7C\uDC83\uDC85\uDCAA\uDD74\uDD7A\uDD90\uDD95\uDD96\uDE4C\uDE4F\uDEC0\uDECC]|\uD83E[\uDD0F\uDD18-\uDD1C\uDD1E\uDD1F\uDD30-\uDD36\uDDB5\uDDB6\uDDBB\uDDD2-\uDDD5])(?:\uD83C[\uDFFB-\uDFFF])|(?:[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u270A\u270B\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55]|\uD83C[\uDC04\uDCCF\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF7C\uDF7E-\uDF93\uDFA0-\uDFCA\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF4\uDFF8-\uDFFF]|\uD83D[\uDC00-\uDC3E\uDC40\uDC42-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDD7A\uDD95\uDD96\uDDA4\uDDFB-\uDE4F\uDE80-\uDEC5\uDECC\uDED0-\uDED2\uDED5\uDEEB\uDEEC\uDEF4-\uDEFA\uDFE0-\uDFEB]|\uD83E[\uDD0D-\uDD3A\uDD3C-\uDD45\uDD47-\uDD71\uDD73-\uDD76\uDD7A-\uDDA2\uDDA5-\uDDAA\uDDAE-\uDDCA\uDDCD-\uDDFF\uDE70-\uDE73\uDE78-\uDE7A\uDE80-\uDE82\uDE90-\uDE95])|(?:[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD7A\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA4\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED2\uDED5\uDEE0-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3-\uDEFA\uDFE0-\uDFEB]|\uD83E[\uDD0D-\uDD3A\uDD3C-\uDD45\uDD47-\uDD71\uDD73-\uDD76\uDD7A-\uDDA2\uDDA5-\uDDAA\uDDAE-\uDDCA\uDDCD-\uDDFF\uDE70-\uDE73\uDE78-\uDE7A\uDE80-\uDE82\uDE90-\uDE95])\uFE0F|(?:[\u261D\u26F9\u270A-\u270D]|\uD83C[\uDF85\uDFC2-\uDFC4\uDFC7\uDFCA-\uDFCC]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66-\uDC78\uDC7C\uDC81-\uDC83\uDC85-\uDC87\uDC8F\uDC91\uDCAA\uDD74\uDD75\uDD7A\uDD90\uDD95\uDD96\uDE45-\uDE47\uDE4B-\uDE4F\uDEA3\uDEB4-\uDEB6\uDEC0\uDECC]|\uD83E[\uDD0F\uDD18-\uDD1F\uDD26\uDD30-\uDD39\uDD3C-\uDD3E\uDDB5\uDDB6\uDDB8\uDDB9\uDDBB\uDDCD-\uDDCF\uDDD1-\uDDDD])/g};const Zt=Xt,Qt=Yt,ei=Jt,Lt=C=>{if(typeof C!="string"||C.length===0||(C=Zt(C),C.length===0))return 0;C=C.replace(ei(),"  ");let f=0;for(let b=0;b<C.length;b++){const w=C.codePointAt(b);w<=31||w>=127&&w<=159||w>=768&&w<=879||(w>65535&&b++,f+=Qt(w)?2:1)}return f};je.exports=Lt;je.exports.default=Lt;var At=je.exports,ti=Ee&&Ee.__importDefault||function(C){return C&&C.__esModule?C:{default:C}};Object.defineProperty(ne,"__esModule",{value:!0});ne.State=ne.Layout=ne.Position=void 0;const ii=Ae,si=ti(At);class he{constructor(f,b){f!==void 0?this.row=f:this.row=0,b!==void 0?this.col=b:this.col=0}}ne.Position=he;class Bt{constructor(f){this.promptSize=f,this.cursor=new he,this.end=new he}}ne.Layout=Bt;class ri{constructor(f,b,w,k){this.line=new ii.LineBuffer,this.highlighting=!1,this.prompt=f,this.tty=b,this.highlighter=w,this.history=k,this.promptSize=b.calculatePosition(f,new he),this.layout=new Bt(this.promptSize)}buffer(){return this.line.buffer()}shouldHighlight(){return this.highlighter.highlightChar(this.line.buf,this.line.pos)?(this.highlighting=!0,!0):this.highlighting?(this.highlighting=!1,!0):!1}clearScreen(){this.tty.clearScreen(),this.layout.cursor=new he,this.layout.end=new he,this.refresh()}editInsert(f){const b=this.line.insert(f),w=f.includes(`
`);if(b&&!w){const k=(0,si.default)(f);k>0&&this.layout.cursor.col+k<this.tty.col&&!this.shouldHighlight()?(this.layout.cursor.col+=k,this.layout.end.col+=k,this.tty.write(f)):this.refresh()}else this.refresh()}update(f){this.line.update(f,f.length),this.refresh()}editBackspace(f){this.line.backspace(f)&&this.refresh()}editDelete(f){this.line.delete(f)&&this.refresh()}editDeleteEndOfLine(){this.line.deleteEndOfLine()&&this.refresh()}refresh(){const f=this.tty.computeLayout(this.promptSize,this.line);this.tty.refreshLine(this.prompt,this.line,this.layout,f,this.highlighter),this.layout=f}moveCursorBack(f){this.line.moveBack(f)&&this.moveCursor()}moveCursorForward(f){this.line.moveForward(f)&&this.moveCursor()}moveCursorUp(f){this.line.moveLineUp(f)?this.moveCursor():this.previousHistory()}moveCursorDown(f){this.line.moveLineDown(f)?this.moveCursor():this.nextHistory()}moveCursorHome(){this.line.moveHome()&&this.moveCursor()}moveCursorEnd(){this.line.moveEnd()&&this.moveCursor()}moveCursorToEnd(){this.layout.cursor!==this.layout.end&&(this.tty.moveCursor(this.layout.cursor,this.layout.end),this.layout.cursor=Object.assign({},this.layout.end))}previousHistory(){if(this.history.cursor===-1&&this.line.length()>0)return;const f=this.history.prev();f!==void 0&&this.update(f)}nextHistory(){if(this.history.cursor===-1)return;const f=this.history.next();f!==void 0?this.update(f):this.update("")}moveCursor(){const f=this.tty.calculatePosition(this.line.pos_buffer(),this.promptSize);f!==this.layout.cursor&&(this.shouldHighlight()?this.refresh():(this.tty.moveCursor(this.layout.cursor,f),this.layout.promptSize=Object.assign({},this.promptSize),this.layout.cursor=Object.assign({},f)))}}ne.State=ri;var Be={};Object.defineProperty(Be,"__esModule",{value:!0});Be.History=void 0;class ni{constructor(f){this.entries=[],this.cursor=-1,this.maxEntries=f}saveToLocalStorage(){const f=window?.localStorage;f!==void 0&&f.setItem("history",JSON.stringify(this.entries))}restoreFromLocalStorage(){const f=window?.localStorage;if(f!==void 0){const b=f.getItem("history");if(b==null)return;try{const w=JSON.parse(b);!Array.isArray(w)||w.find(k=>typeof k!="string")!==void 0?(this.entries=[],f.setItem("history","[]")):this.entries=w}catch{this.entries=[],f.setItem("history","[]")}}}append(f){this.resetCursor(),this.entries.includes(f)?(this.entries.splice(this.entries.indexOf(f),1),this.entries.unshift(f)):this.entries.unshift(f),this.entries.length>this.maxEntries&&this.entries.pop(),this.saveToLocalStorage()}resetCursor(){this.cursor=-1}next(){if(this.cursor!==-1)return this.cursor-=1,this.entries[this.cursor]}prev(){if(!(this.cursor+1>=this.entries.length))return this.cursor+=1,this.entries[this.cursor]}}Be.History=ni;var Re={},oi=Ee&&Ee.__importDefault||function(C){return C&&C.__esModule?C:{default:C}};Object.defineProperty(Re,"__esModule",{value:!0});Re.Tty=void 0;const ai=oi(At);class hi{constructor(f,b,w,k){this.tabWidth=w,this.col=f,this.row=b,this.out=k}write(f){return this.out.write(f)}print(f){return this.out.print(f)}println(f){return this.out.println(f)}clearScreen(){this.out.write("\x1B[H\x1B[2J")}calculatePosition(f,b){const w=Object.assign({},b);let k=0;return[...f].forEach(O=>{if(O===`
`){w.row+=1,w.col=0;return}let R=0;if(O==="	")R=this.tabWidth-w.col%this.tabWidth;else{let t;[t,k]=li(O,k),R=t}w.col+=R,w.col>this.col&&(w.row+=1,w.col=R)}),w.col===this.col&&(w.col=0,w.row+=1),w}computeLayout(f,b){const w=Object.assign({},f),k=b.pos,O=this.calculatePosition(b.buf.slice(0,b.pos),f),R=k===b.buf.length?Object.assign({},O):this.calculatePosition(b.buf.slice(k),O);return{promptSize:w,cursor:O,end:R}}refreshLine(f,b,w,k,O){const R=k.cursor,t=k.end;this.clearOldRows(w),this.write(O.highlightPrompt(f)),this.write(O.highlight(b.buf,b.pos)),t.col===0&&t.row>0&&b.buf[b.buf.length-1]!==`
`&&this.write(`
`);const n=t.row-R.row;n>0&&this.write(`\x1B[${n}A`),R.col>0?this.write(`\r\x1B[${R.col}C`):this.write("\r")}clearOldRows(f){const b=f.cursor.row,w=f.end.row,k=Math.max(w-b,0);k>0&&this.write(`\x1B[${k}B`);for(let O=0;O<w;O++)this.write("\r\x1B[0K\x1B[A");this.write("\r\x1B[0K")}moveCursor(f,b){if(b.row>f.row){const w=b.row-f.row;w===1?this.write("\x1B[B"):this.write(`\x1B[${w}B`)}else if(b.row<f.row){const w=f.row-b.row;w===1?this.write("\x1B[A"):this.write(`\x1B[${w}A`)}if(b.col>f.col){const w=b.col-f.col;w===1?this.write("\x1B[C"):this.write(`\x1B[${w}C`)}else if(b.col<f.col){const w=f.col-b.col;w===1?this.write("\x1B[D"):this.write(`\x1B[${w}D`)}}}Re.Tty=hi;function li(C,f){return f===1?C==="["?[0,2]:[0,0]:f===2?C===";"||C[0]>="0"&&C[0]<="9"?[0,f]:[0,0]:C==="\x1B"?[0,1]:C===`
`?[0,f]:[(0,ai.default)(C),f]}var Fe={};Object.defineProperty(Fe,"__esModule",{value:!0});Fe.IdentityHighlighter=void 0;class ci{highlight(f,b){return f}highlightPrompt(f){return f}highlightChar(f,b){return!1}}Fe.IdentityHighlighter=ci;Object.defineProperty($e,"__esModule",{value:!0});var Rt=$e.Readline=void 0;const X=wt,Te=ne,ui=Be,nt=Re,_i=Fe;class di{constructor(){this.highlighter=new _i.IdentityHighlighter,this.history=new ui.History(50),this.disposables=[],this.watermark=0,this.highWatermark=1e4,this.lowWatermark=1e3,this.highWater=!1,this.state=new Te.State(">",this.tty(),this.highlighter,this.history),this.checkHandler=()=>!0,this.ctrlCHandler=()=>{},this.pauseHandler=f=>{},this.history.restoreFromLocalStorage()}activate(f){this.term=f,this.term.onData(this.readData.bind(this)),this.term.attachCustomKeyEventHandler(this.handleKeyEvent.bind(this))}dispose(){this.disposables.forEach(f=>f.dispose())}appendHistory(f){this.history.append(f)}setHighlighter(f){this.highlighter=f}setCheckHandler(f){this.checkHandler=f}setCtrlCHandler(f){this.ctrlCHandler=f}setPauseHandler(f){this.pauseHandler=f}writeReady(){return!this.highWater}write(f){f===`
`?f=`\r
`:(f=f.replace(/^\n/,`\r
`),f=f.replace(/([^\r])\n/g,`$1\r
`));const b=f.length;this.watermark+=b,this.watermark>this.highWatermark&&(this.highWater=!0),this.term&&this.term.write(f,()=>{this.watermark=Math.max(this.watermark-b,0),this.highWater&&this.watermark<this.lowWatermark&&(this.highWater=!1)})}print(f){return this.write(f)}println(f){return this.write(f+`\r
`)}output(){return this}tty(){var f,b;return((b=(f=this.term)===null||f===void 0?void 0:f.options)===null||b===void 0?void 0:b.tabStopWidth)!==void 0?new nt.Tty(this.term.cols,this.term.rows,this.term.options.tabStopWidth,this.output()):new nt.Tty(0,0,8,this.output())}read(f){return new Promise((b,w)=>{if(this.term===void 0){w("addon is not active");return}this.state=new Te.State(f,this.tty(),this.highlighter,this.history),this.state.refresh(),this.activeRead={prompt:f,resolve:b,reject:w}})}handleKeyEvent(f){return f.key==="Enter"&&f.shiftKey?(f.type==="keydown"&&this.readKey({inputType:X.InputType.ShiftEnter,data:["\r"]}),!1):!0}readData(f){const b=(0,X.parseInput)(f);if(b.length>1||b[0].inputType===X.InputType.Text&&b[0].data.length>1){this.readPaste(b);return}this.readKey(b[0])}readPaste(f){const b=f.map(w=>w.inputType===X.InputType.Enter?{inputType:X.InputType.Text,data:[`
`]}:w);for(const w of b)w.inputType===X.InputType.Text?this.state.editInsert(w.data.join("")):this.readKey(w)}readKey(f){var b,w,k;if(this.activeRead===void 0){switch(f.inputType){case X.InputType.CtrlC:this.ctrlCHandler();break;case X.InputType.CtrlL:this.write("\x1B[H\x1B[2J");break}return}switch(f.inputType){case X.InputType.Text:this.state.editInsert(f.data.join(""));break;case X.InputType.AltEnter:case X.InputType.ShiftEnter:this.state.editInsert(`
`);break;case X.InputType.Enter:this.checkHandler(this.state.buffer())?(this.state.moveCursorToEnd(),(b=this.term)===null||b===void 0||b.write(`\r
`),this.history.append(this.state.buffer()),(w=this.activeRead)===null||w===void 0||w.resolve(this.state.buffer()),this.activeRead=void 0):this.state.editInsert(`
`);break;case X.InputType.CtrlC:this.state.moveCursorToEnd(),(k=this.term)===null||k===void 0||k.write(`^C\r
`),this.state=new Te.State(this.activeRead.prompt,this.tty(),this.highlighter,this.history),this.state.refresh();break;case X.InputType.CtrlS:this.pauseHandler(!1);break;case X.InputType.CtrlU:this.state.update("");break;case X.InputType.CtrlK:this.state.editDeleteEndOfLine();break;case X.InputType.CtrlQ:this.pauseHandler(!0);break;case X.InputType.CtrlL:this.state.clearScreen();break;case X.InputType.Home:case X.InputType.CtrlA:this.state.moveCursorHome();break;case X.InputType.End:case X.InputType.CtrlE:this.state.moveCursorEnd();break;case X.InputType.Backspace:this.state.editBackspace(1);break;case X.InputType.Delete:case X.InputType.CtrlD:this.state.editDelete(1);break;case X.InputType.ArrowLeft:this.state.moveCursorBack(1);break;case X.InputType.ArrowRight:this.state.moveCursorForward(1);break;case X.InputType.ArrowUp:this.state.moveCursorUp(1);break;case X.InputType.ArrowDown:this.state.moveCursorDown(1);break;case X.InputType.UnsupportedControlChar:case X.InputType.UnsupportedEscape:break}}}Rt=$e.Readline=di;var fi=0;function Ke(C,f,b,w,k,O){var R,t,n={};for(t in f)t=="ref"?R=f[t]:n[t]=f[t];var h={type:C,props:n,key:b,ref:R,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:--fi,__source:k,__self:O};if(typeof C=="function"&&(R=C.defaultProps))for(t in R)n[t]===void 0&&(n[t]=R[t]);return G.vnode&&G.vnode(h),h}const vi=({onReadable:C,onSignal:f,worker:b})=>{const w=st(null),k=st("> ");return mt(()=>{if(!w.current)throw new Error("div not found");const O=new Kt.Terminal({cursorBlink:!0});O.open(w.current);const R=new Rt;O.loadAddon(R),O.focus();const t=()=>{R.read(k.current).then(n)},n=h=>{C(h)};return O.attachCustomKeyEventHandler(h=>(h.ctrlKey&&h.key==="c"&&f(),h.key==="Tab"&&console.log(h),!0)),b.onmessage=({data:{result:h,prompt:a}})=>{h&&R.println(h),k.current=a,setTimeout(t)},t(),()=>O.dispose()},[C,f,b]),Ke("div",{ref:w})};let Q;const Ft=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Ft.decode();let le=null;function Ce(){return(le===null||le.byteLength===0)&&(le=new Uint8Array(Q.memory.buffer)),le}function Ie(C,f){return C=C>>>0,Ft.decode(Ce().subarray(C,C+f))}const se=new Array(128).fill(void 0);se.push(void 0,null,!0,!1);let ue=se.length;function pi(C){ue===se.length&&se.push(se.length+1);const f=ue;return ue=se[f],se[f]=C,f}let Pe=0;const me=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},gi=typeof me.encodeInto=="function"?function(C,f){return me.encodeInto(C,f)}:function(C,f){const b=me.encode(C);return f.set(b),{read:C.length,written:b.length}};function Di(C,f,b){if(b===void 0){const t=me.encode(C),n=f(t.length)>>>0;return Ce().subarray(n,n+t.length).set(t),Pe=t.length,n}let w=C.length,k=f(w)>>>0;const O=Ce();let R=0;for(;R<w;R++){const t=C.charCodeAt(R);if(t>127)break;O[k+R]=t}if(R!==w){R!==0&&(C=C.slice(R)),k=b(k,w,w=R+C.length*3)>>>0;const t=Ce().subarray(k+R,k+w),n=gi(C,t);R+=n.written}return Pe=R,k}let ce=null;function ae(){return(ce===null||ce.byteLength===0)&&(ce=new Int32Array(Q.memory.buffer)),ce}function Ci(C){return se[C]}function mi(C){C<132||(se[C]=ue,ue=C)}function ot(C){const f=Ci(C);return mi(C),f}class we{static __wrap(f){f=f>>>0;const b=Object.create(we.prototype);return b.__wbg_ptr=f,b}__destroy_into_raw(){const f=this.__wbg_ptr;return this.__wbg_ptr=0,f}free(){const f=this.__destroy_into_raw();Q.__wbg_reader_free(f)}static new(){const f=Q.reader_new();return we.__wrap(f)}push(f){try{const k=Q.__wbindgen_add_to_stack_pointer(-16),O=Di(f,Q.__wbindgen_malloc,Q.__wbindgen_realloc),R=Pe;Q.reader_push(k,this.__wbg_ptr,O,R);var b=ae()[k/4+0],w=ae()[k/4+1];if(w)throw ot(b)}finally{Q.__wbindgen_add_to_stack_pointer(16)}}expression_complete(){return Q.reader_expression_complete(this.__wbg_ptr)!==0}new_expression(){return Q.reader_new_expression(this.__wbg_ptr)!==0}eval(){let f,b;try{const h=Q.__wbindgen_add_to_stack_pointer(-16);Q.reader_eval(h,this.__wbg_ptr);var w=ae()[h/4+0],k=ae()[h/4+1],O=ae()[h/4+2],R=ae()[h/4+3],t=w,n=k;if(R)throw t=0,n=0,ot(O);return f=t,b=n,Ie(t,n)}finally{Q.__wbindgen_add_to_stack_pointer(16),Q.__wbindgen_free(f,b)}}clear_buffer(){Q.reader_clear_buffer(this.__wbg_ptr)}}async function Si(C,f){if(typeof Response=="function"&&C instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(C,f)}catch(w){if(C.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",w);else throw w}const b=await C.arrayBuffer();return await WebAssembly.instantiate(b,f)}else{const b=await WebAssembly.instantiate(C,f);return b instanceof WebAssembly.Instance?{instance:b,module:C}:b}}function bi(){const C={};return C.wbg={},C.wbg.__wbindgen_string_new=function(f,b){const w=Ie(f,b);return pi(w)},C.wbg.__wbindgen_throw=function(f,b){throw new Error(Ie(f,b))},C}function yi(C,f){return Q=C.exports,xt.__wbindgen_wasm_module=f,ce=null,le=null,Q}async function xt(C){if(Q!==void 0)return Q;typeof C>"u"&&(C=new URL("/lisp_rs/assets/lisp_rs_bg-ffbb6bb3.wasm",self.location));const f=bi();(typeof C=="string"||typeof Request=="function"&&C instanceof Request||typeof URL=="function"&&C instanceof URL)&&(C=fetch(C));const{instance:b,module:w}=await Si(await C,f);return yi(b,w)}const Ei=()=>{const[C,f]=Wt();return mt(()=>{xt().then(()=>{f(we.new())})},[]),C};function wi(){const C=Ei(),f=Ne(()=>new Worker(new URL("/lisp_rs/assets/worker-70569bd5.js",self.location)),[]),b=$t(k=>{let O="";try{C?.push(k),C?.expression_complete()&&(O=C?.eval())}catch(t){O=t,C?.clear_buffer()}const R=C?.new_expression()?"> ":". ";f.postMessage({result:O,prompt:R})},[C]);return Ke(vi,{onReadable:b,onSignal:()=>{C?.clear_buffer(),f.postMessage({result:"",prompt:"> "})},worker:f})}Ut(Ke(wi,{}),document.getElementById("app"));
